window.storyFormat({"name":"Brick","version":"0.3.1","author":"Chris Neidhart","image":"icon.svg","description":"A modern story format with a JavaScript-like syntax, and a focus on performance and simplicity.<br><br><a href=\"https://github.com/cjneidhart/brick\">Homepage</a>","source":"<!doctype html>\n<html lang=\"en-US\" data-bs-theme=\"dark\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <title>{{STORY_NAME}}</title>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n    <style id=\"style-bootstrap\">\n      /*!\n * Bootstrap Reboot v5.3.3 (https://getbootstrap.com/)\n * Copyright 2011-2024 The Bootstrap Authors\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n */:root,[data-bs-theme=light]{--bs-blue:#0d6efd;--bs-indigo:#6610f2;--bs-purple:#6f42c1;--bs-pink:#d63384;--bs-red:#dc3545;--bs-orange:#fd7e14;--bs-yellow:#ffc107;--bs-green:#198754;--bs-teal:#20c997;--bs-cyan:#0dcaf0;--bs-black:#000;--bs-white:#fff;--bs-gray:#6c757d;--bs-gray-dark:#343a40;--bs-gray-100:#f8f9fa;--bs-gray-200:#e9ecef;--bs-gray-300:#dee2e6;--bs-gray-400:#ced4da;--bs-gray-500:#adb5bd;--bs-gray-600:#6c757d;--bs-gray-700:#495057;--bs-gray-800:#343a40;--bs-gray-900:#212529;--bs-primary:#0d6efd;--bs-secondary:#6c757d;--bs-success:#198754;--bs-info:#0dcaf0;--bs-warning:#ffc107;--bs-danger:#dc3545;--bs-light:#f8f9fa;--bs-dark:#212529;--bs-primary-rgb:13,110,253;--bs-secondary-rgb:108,117,125;--bs-success-rgb:25,135,84;--bs-info-rgb:13,202,240;--bs-warning-rgb:255,193,7;--bs-danger-rgb:220,53,69;--bs-light-rgb:248,249,250;--bs-dark-rgb:33,37,41;--bs-primary-text-emphasis:#052c65;--bs-secondary-text-emphasis:#2b2f32;--bs-success-text-emphasis:#0a3622;--bs-info-text-emphasis:#055160;--bs-warning-text-emphasis:#664d03;--bs-danger-text-emphasis:#58151c;--bs-light-text-emphasis:#495057;--bs-dark-text-emphasis:#495057;--bs-primary-bg-subtle:#cfe2ff;--bs-secondary-bg-subtle:#e2e3e5;--bs-success-bg-subtle:#d1e7dd;--bs-info-bg-subtle:#cff4fc;--bs-warning-bg-subtle:#fff3cd;--bs-danger-bg-subtle:#f8d7da;--bs-light-bg-subtle:#fcfcfd;--bs-dark-bg-subtle:#ced4da;--bs-primary-border-subtle:#9ec5fe;--bs-secondary-border-subtle:#c4c8cb;--bs-success-border-subtle:#a3cfbb;--bs-info-border-subtle:#9eeaf9;--bs-warning-border-subtle:#ffe69c;--bs-danger-border-subtle:#f1aeb5;--bs-light-border-subtle:#e9ecef;--bs-dark-border-subtle:#adb5bd;--bs-white-rgb:255,255,255;--bs-black-rgb:0,0,0;--bs-font-sans-serif:system-ui,-apple-system,\"Segoe UI\",Roboto,\"Helvetica Neue\",\"Noto Sans\",\"Liberation Sans\",Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\";--bs-font-monospace:SFMono-Regular,Menlo,Monaco,Consolas,\"Liberation Mono\",\"Courier New\",monospace;--bs-gradient:linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));--bs-body-font-family:var(--bs-font-sans-serif);--bs-body-font-size:1rem;--bs-body-font-weight:400;--bs-body-line-height:1.5;--bs-body-color:#212529;--bs-body-color-rgb:33,37,41;--bs-body-bg:#fff;--bs-body-bg-rgb:255,255,255;--bs-emphasis-color:#000;--bs-emphasis-color-rgb:0,0,0;--bs-secondary-color:rgba(33, 37, 41, 0.75);--bs-secondary-color-rgb:33,37,41;--bs-secondary-bg:#e9ecef;--bs-secondary-bg-rgb:233,236,239;--bs-tertiary-color:rgba(33, 37, 41, 0.5);--bs-tertiary-color-rgb:33,37,41;--bs-tertiary-bg:#f8f9fa;--bs-tertiary-bg-rgb:248,249,250;--bs-heading-color:inherit;--bs-link-color:#0d6efd;--bs-link-color-rgb:13,110,253;--bs-link-decoration:underline;--bs-link-hover-color:#0a58ca;--bs-link-hover-color-rgb:10,88,202;--bs-code-color:#d63384;--bs-highlight-color:#212529;--bs-highlight-bg:#fff3cd;--bs-border-width:1px;--bs-border-style:solid;--bs-border-color:#dee2e6;--bs-border-color-translucent:rgba(0, 0, 0, 0.175);--bs-border-radius:0.375rem;--bs-border-radius-sm:0.25rem;--bs-border-radius-lg:0.5rem;--bs-border-radius-xl:1rem;--bs-border-radius-xxl:2rem;--bs-border-radius-2xl:var(--bs-border-radius-xxl);--bs-border-radius-pill:50rem;--bs-box-shadow:0 0.5rem 1rem rgba(0, 0, 0, 0.15);--bs-box-shadow-sm:0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);--bs-box-shadow-lg:0 1rem 3rem rgba(0, 0, 0, 0.175);--bs-box-shadow-inset:inset 0 1px 2px rgba(0, 0, 0, 0.075);--bs-focus-ring-width:0.25rem;--bs-focus-ring-opacity:0.25;--bs-focus-ring-color:rgba(13, 110, 253, 0.25);--bs-form-valid-color:#198754;--bs-form-valid-border-color:#198754;--bs-form-invalid-color:#dc3545;--bs-form-invalid-border-color:#dc3545}[data-bs-theme=dark]{color-scheme:dark;--bs-body-color:#dee2e6;--bs-body-color-rgb:222,226,230;--bs-body-bg:#212529;--bs-body-bg-rgb:33,37,41;--bs-emphasis-color:#fff;--bs-emphasis-color-rgb:255,255,255;--bs-secondary-color:rgba(222, 226, 230, 0.75);--bs-secondary-color-rgb:222,226,230;--bs-secondary-bg:#343a40;--bs-secondary-bg-rgb:52,58,64;--bs-tertiary-color:rgba(222, 226, 230, 0.5);--bs-tertiary-color-rgb:222,226,230;--bs-tertiary-bg:#2b3035;--bs-tertiary-bg-rgb:43,48,53;--bs-primary-text-emphasis:#6ea8fe;--bs-secondary-text-emphasis:#a7acb1;--bs-success-text-emphasis:#75b798;--bs-info-text-emphasis:#6edff6;--bs-warning-text-emphasis:#ffda6a;--bs-danger-text-emphasis:#ea868f;--bs-light-text-emphasis:#f8f9fa;--bs-dark-text-emphasis:#dee2e6;--bs-primary-bg-subtle:#031633;--bs-secondary-bg-subtle:#161719;--bs-success-bg-subtle:#051b11;--bs-info-bg-subtle:#032830;--bs-warning-bg-subtle:#332701;--bs-danger-bg-subtle:#2c0b0e;--bs-light-bg-subtle:#343a40;--bs-dark-bg-subtle:#1a1d20;--bs-primary-border-subtle:#084298;--bs-secondary-border-subtle:#41464b;--bs-success-border-subtle:#0f5132;--bs-info-border-subtle:#087990;--bs-warning-border-subtle:#997404;--bs-danger-border-subtle:#842029;--bs-light-border-subtle:#495057;--bs-dark-border-subtle:#343a40;--bs-heading-color:inherit;--bs-link-color:#6ea8fe;--bs-link-hover-color:#8bb9fe;--bs-link-color-rgb:110,168,254;--bs-link-hover-color-rgb:139,185,254;--bs-code-color:#e685b5;--bs-highlight-color:#dee2e6;--bs-highlight-bg:#664d03;--bs-border-color:#495057;--bs-border-color-translucent:rgba(255, 255, 255, 0.15);--bs-form-valid-color:#75b798;--bs-form-valid-border-color:#75b798;--bs-form-invalid-color:#ea868f;--bs-form-invalid-border-color:#ea868f}*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:var(--bs-body-font-family);font-size:var(--bs-body-font-size);font-weight:var(--bs-body-font-weight);line-height:var(--bs-body-line-height);color:var(--bs-body-color);text-align:var(--bs-body-text-align);background-color:var(--bs-body-bg);-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;border:0;border-top:var(--bs-border-width) solid;opacity:.25}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2;color:var(--bs-heading-color)}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.1875em;color:var(--bs-highlight-color);background-color:var(--bs-highlight-bg)}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:rgba(var(--bs-link-color-rgb),var(--bs-link-opacity,1));text-decoration:underline}a:hover{--bs-link-color-rgb:var(--bs-link-hover-color-rgb)}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:var(--bs-font-monospace);font-size:1em}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:var(--bs-code-color);word-wrap:break-word}a>code{color:inherit}kbd{padding:.1875rem .375rem;font-size:.875em;color:var(--bs-body-bg);background-color:var(--bs-body-color);border-radius:.25rem}kbd kbd{padding:0;font-size:1em}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:var(--bs-secondary-color);text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]:not([type=date]):not([type=datetime-local]):not([type=month]):not([type=week]):not([type=time])::-webkit-calendar-picker-indicator{display:none!important}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}::file-selector-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}\n/* */\n    </style>\n    <style id=\"style-brick\">\n      #brick-viewport{display:flex;flex-direction:column}#brick-viewport>*{flex:1}.brick-linkReplace,.brick-active-passage{transition:opacity .4s}.brick-transparent{opacity:0}#ui-bar{background-color:var(--bs-secondary-bg);border-bottom:1px solid var(--bs-border-color);overflow-block:auto;padding:.5rem;width:100%}.brick-ui-btn{background-color:#364d63;border:1px solid var(--bs-secondary);padding-block:.25rem;transition:border-color .15s ease-in-out,background-color .15s ease-in-out}.brick-ui-btn:hover:enabled,.brick-ui-btn:focus{background-color:#3e5974}.brick-ui-btn:disabled{color:var(--bs-secondary)}#brick-history-controls{display:flex;flex-direction:row;text-align:center;width:100%;margin-bottom:.5rem}#brick-history-controls>*{flex-grow:1}#story-title{text-align:center}#brick-menu-core{width:100%;text-align:center;list-style:none;padding:0}#brick-menu-core button{width:100%}#brick-main{max-width:60rem}.brick-passage{padding:1rem}.brick-passage:not(:last-child){border-bottom:1px solid currentColor;padding-bottom:1rem}.brick-active-passage{margin-bottom:5rem;min-height:100vh}@media (min-width: 60rem){#brick-viewport{flex-direction:row}#ui-bar{border-bottom:0;border-right:1px solid var(--bs-border-color);height:100vh;height:100dvh;max-width:24rem;position:-webkit-sticky;position:sticky;top:0;width:auto}#brick-main{margin-inline:auto}.brick-active-passage{min-height:unset}}#brick-dialog{border-color:var(--bs-border-color);border-radius:.5rem;margin-top:2rem;max-width:min(95vw,50rem);max-width:min(95svw,50rem);min-width:min(95vw,30rem);min-width:min(95svw,30rem);overflow-x:auto}#brick-dialog::backdrop{-webkit-backdrop-filter:brightness(50%) blur(.25rem);backdrop-filter:brightness(50%) blur(.25rem)}#brick-dialog.brick-saves table{border:1px solid var(--bs-border-color);width:100%}#brick-dialog.brick-saves table :is(th,td){border:1px solid var(--bs-border-color);padding:.25rem}#brick-dialog.brick-saves table td:nth-child(3){width:100%}#brick-dialog.brick-saves table td:last-child button:enabled{background-color:var(--bs-danger)}#brick-dialog.brick-saves table td:last-child button:enabled:hover{background-color:inherit;color:var(--bs-danger)}.brick-link{padding:0;border:0;background:none;text-decoration:underline var(--bs-link-color);color:var(--bs-link-color)}.brick-link:hover:enabled{color:var(--bs-link-hover-color);-webkit-text-decoration-color:var(--bs-link-hover-color);text-decoration-color:var(--bs-link-hover-color)}.brick-link:disabled{color:var(--bs-secondary);cursor:not-allowed;-webkit-text-decoration-color:var(--bs-secondary);text-decoration-color:var(--bs-secondary)}.brick-text-secondary{color:var(--bs-secondary)}.brick-error{background-color:#5c0a0a;border-inline:.25rem solid red;line-height:2;padding:.25rem}.brick-error code{background-color:var(--bs-body-bg);color:var(--bs-body-color);padding:.125rem}.brick-saves-menu ul{border:1px solid currentColor;list-style:none;padding:0}.brick-saves-menu li:not(:first-child){border-top:1px solid currentColor}.brick-saves-menu li{display:flex;flex-direction:row;padding:.25rem}.brick-saves-menu li>div{flex-grow:1}.brick-saves-empty{color:var(--bs-secondary)}.brick-saves-buttons{display:flex;flex-direction:row;justify-content:space-between}dialog.brick-restart .brick-ui-btn{margin-right:1em}\n\n    </style>\n  </head>\n\n  <body>\n    {{STORY_DATA}}\n    <div id=\"brick-viewport\">\n      <aside id=\"ui-bar\">\n        <div id=\"brick-history-controls\">\n          <button id=\"brick-history-backward\" class=\"brick-ui-btn\" type=\"button\">&#x2190;</button>\n          <button id=\"brick-history-forward\" class=\"brick-ui-btn\" type=\"button\">&#x2192;</button>\n        </div>\n        <h1 id=\"story-title\">{{STORY_NAME}}</h1>\n        <ul id=\"brick-menu-core\">\n          <li><button id=\"brick-saves\" class=\"brick-ui-btn\" type=\"button\">SAVES</button></li>\n          <li><button id=\"brick-restart\" class=\"brick-ui-btn\" type=\"button\">RESTART</button></li>\n        </ul>\n      </aside>\n\n      <main id=\"brick-main\">\n        <noscript>JavaScript must be enabled to play this story.</noscript>\n      </main>\n    </div>\n    <dialog id=\"brick-dialog\"></dialog>\n    <script id=\"script-brick\" type=\"text/javascript\">\n      /**\n       * Copyright (C) 2024  Chris Neidhart\n       *\n       *\n       * The JavaScript code in this element is free software: you can\n       * redistribute it and/or modify it under the terms of the GNU\n       * General Public License (GNU GPL) as published by the Free Software\n       * Foundation, either version 3 of the License, or (at your option)\n       * any later version.  The code is distributed WITHOUT ANY WARRANTY;\n       * without even the implied warranty of MERCHANTABILITY or FITNESS\n       * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.\n       *\n       * As additional permission under GNU GPL version 3 section 7, you\n       * may distribute non-source (e.g., minimized or compacted) forms of\n       * that code without the copy of the GNU GPL normally required by\n       * section 4, provided you include this license notice and a URL\n       * through which recipients can access the Corresponding Source.\n       *\n       * The source code for this <script> element is available at:\n       *    https://github.com/cjneidhart/brick\n       */\n      \"use strict\";(()=>{var Nn=Object.create;var Ae=Object.defineProperty;var Sn=Object.getOwnPropertyDescriptor;var Tn=Object.getOwnPropertyNames;var In=Object.getPrototypeOf,Cn=Object.prototype.hasOwnProperty;var lt=t=>{throw TypeError(t)};var An=(t,e)=>()=>(t&&(e=t(t=0)),e);var Ln=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Dn=(t,e)=>{for(var n in e)Ae(t,n,{get:e[n],enumerable:!0})},Bn=(t,e,n,r)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of Tn(e))!Cn.call(t,s)&&s!==n&&Ae(t,s,{get:()=>e[s],enumerable:!(r=Sn(e,s))||r.enumerable});return t};var $n=(t,e,n)=>(n=t!=null?Nn(In(t)):{},Bn(e||!t||!t.__esModule?Ae(n,\"default\",{value:t,enumerable:!0}):n,t));var pt=(t,e,n)=>e.has(t)||lt(\"Cannot \"+n);var mt=(t,e,n)=>(pt(t,e,\"read from private field\"),n?n.call(t):e.get(t)),ft=(t,e,n)=>e.has(t)?lt(\"Cannot add the same private member more than once\"):e instanceof WeakSet?e.add(t):e.set(t,n),dt=(t,e,n,r)=>(pt(t,e,\"write to private field\"),r?r.call(t,n):e.set(t,n),n);var v,d=An(()=>{v={major:0,minor:3,patch:1,version:\"0.3.1\",time:1734989389975}});var gt=Ln((Lr,ht)=>{\"use strict\";d();ht.exports=function(){function t(e,n,r,s,i){return e<n||r<n?e>r?r+1:e+1:s===i?n:n+1}return function(e,n){if(e===n)return 0;if(e.length>n.length){var r=e;e=n,n=r}for(var s=e.length,i=n.length;s>0&&e.charCodeAt(s-1)===n.charCodeAt(i-1);)s--,i--;for(var o=0;o<s&&e.charCodeAt(o)===n.charCodeAt(o);)o++;if(s-=o,i-=o,s===0||i<3)return i;var a=0,c,l,p,g,m,w,y,b,j,he,at,ct,_=[];for(c=0;c<s;c++)_.push(c+1),_.push(e.charCodeAt(o+c));for(var ut=_.length-1;a<i-3;)for(j=n.charCodeAt(o+(l=a)),he=n.charCodeAt(o+(p=a+1)),at=n.charCodeAt(o+(g=a+2)),ct=n.charCodeAt(o+(m=a+3)),w=a+=4,c=0;c<ut;c+=2)y=_[c],b=_[c+1],l=t(y,l,p,j,b),p=t(l,p,g,he,b),g=t(p,g,m,at,b),w=t(g,m,w,ct,b),_[c]=w,m=g,g=p,p=l,l=y;for(;a<i;)for(j=n.charCodeAt(o+(l=a)),w=++a,c=0;c<ut;c+=2)y=_[c],_[c]=w=t(y,l,w,j,_[c+1]),l=y;return w}}()});d();d();d();d();var q={historyLength:100,maxLoopIterations:1e3,preProcessText:void 0,stream:!1};function Rn(t,e,n){throw new TypeError(\"\".concat(t,\": expected \").concat(e,\", got \").concat(typeof n))}var M={get historyLength(){return q.historyLength},set historyLength(t){if(typeof t!=\"number\"||t<=0||t%1!==0)throw new TypeError(\"config.historyLength must be a positive integer\");q.historyLength=t},get maxLoopIterations(){return q.maxLoopIterations},set maxLoopIterations(t){if(typeof t!=\"number\"||t<=0||t%1!==0)throw new TypeError(\"Config.maxLoopIterations must be a positive integer\");q.maxLoopIterations=t},get preProcessText(){return q.preProcessText},set preProcessText(t){typeof t<\"u\"&&typeof t!=\"function\"&&Rn(\"Config.preProcessText\",\"function or undefined\",t),q.preProcessText=t},get stream(){return q.stream},set stream(t){q.stream=!!t}};var ue={};Dn(ue,{Passage:()=>Y,filter:()=>xt,find:()=>Un,get:()=>F,init:()=>Pe,start:()=>Re,withTag:()=>He});d();d();var wt=$n(gt(),1),Hn=new Set(\"'\\\",()[]{}.!`?\");function U(t){return Array.from(t).map(e=>e>=\"a\"&&e<=\"z\"||e>=\"0\"&&e<=\"9\"?e:e>=\"A\"&&e<=\"Z\"||e>\"\\x7F\"?e.toLowerCase():Hn.has(e)?\"\":\"-\").join(\"\").replace(/-+/g,\"-\")}function yt(t,e){let n=-1,r=0;for(;n=t.indexOf(e,n+1),n!==-1;)r++;return r}function O(t){switch(typeof t){case\"bigint\":case\"boolean\":case\"number\":case\"string\":case\"undefined\":return t;case\"symbol\":throw new Error(\"Symbols cannot be cloned\");case\"function\":throw new Error(\"Functions cannot be cloned\");case\"object\":if(t===null)return t;if(\"clone\"in t&&typeof t.clone==\"function\")return t.clone();if(t instanceof Array)return t.map(O);if(t instanceof Date)return new Date(t);if(t instanceof Map){let e=new Map;for(let[n,r]of t)e.set(O(n),O(r));return e}else{if(t instanceof RegExp)return new RegExp(t);if(t instanceof Set){let e=new Set;for(let n of t)e.add(O(n));return e}else{let e=Object.getPrototypeOf(t);if(e!==null&&e!==Object.prototype)throw new Error(\"Can't clone an object with an unknown prototype and no `.clone()` method\");let n=Object.create(e);for(let r in t)n[r]=O(t[r]);return n}}default:throw new Error(\"Unknown type: \".concat(typeof t))}}function bt(t){if(t.length<1)throw new Error(\"either: array is empty\");return t[Le(t.length)]}function ee(t){let e=document.getElementById(t);if(!e)throw new Error('No element with id \"'.concat(t,'\" found'));return e}function Le(t){return Math.floor(Math.random()*t)}var On=0;function De(){return\"brick-unique-id-\".concat(On++)}function u(t,e={},...n){let r=document.createElement(t);for(let s in e)r.setAttribute(s,e[s]);return r.append(...n),r}function*kt(t,e,n=1){let r;if(typeof e>\"u\"?(r=0,e=t):r=t,n>0)for(;r<e;)yield r,r+=n;else for(;r>e;)yield r,r+=n}function*Et(t,e=0){let n=e;for(let r of t)yield[n,r],n++}function K(t){return arguments.length===0?\"\":t instanceof Array&&!(Symbol.toPrimitive in t)&&t.toString===Array.prototype.toString?\"[\".concat(t.join(\", \"),\"]\"):String(t)}function ge(t,e){e!=null||(e=(r,s)=>'Unknown property \"'.concat(r,'\". Did you mean \"').concat(s,'\"?'));let n={get(r,s,i){if(s in i||typeof s!=\"string\")return Reflect.get(r,s,i);let o=Object.getOwnPropertyNames(i),a=Object.getPrototypeOf(i);for(;a;)o.push(...Object.getOwnPropertyNames(a)),a=Object.getPrototypeOf(a);let c=o.map(p=>({name:p,distance:(0,wt.default)(s,p)})),{name:l}=c.reduce((p,g)=>g.distance<=s.length*.4&&g.distance<p.distance?g:p,{name:void 0,distance:1/0});return c.length>0&&console.warn(e(s,l)),Reflect.get(r,s,i)}};return new Proxy(t,n)}var ce,Y=class{constructor(e){ft(this,ce);var s;let n=e.getAttribute(\"pid\");if(!n)throw new Error(\"Passage has no pid: \"+e.outerHTML);let r=e.getAttribute(\"name\");if(!r)throw new Error(\"Passage \".concat(n,\" has no name\"));this.id=n,this.name=r,this.slug=U(r),this.tags=((s=e.getAttribute(\"tags\"))==null?void 0:s.split(\" \").filter(i=>i.length>=0))||[],dt(this,ce,e)}get content(){return mt(this,ce).textContent}toString(){return'Passage \"'.concat(this.name,'\"')}};ce=new WeakMap;var Fn=[\"PassageDone\",\"PassageFooter\",\"PassageHeader\",\"PassageReady\",\"StoryAuthor\",\"StoryBanner\",\"StoryCaption\",\"StoryDisplayTitle\",\"StoryMenu\",\"StorySettings\",\"StorySubtitle\",\"StoryTitle\"],Vn=[\"init\",\"script\",\"stylesheet\",\"Twine.audio\",\"Twine.image\",\"Twine.video\",\"Twine.vtt\",\"widget\",\"header\",\"footer\",\"startup\",\"debug-header\",\"debug-footer\",\"debug-startup\",\"nobr\"];function jn(t){if(Fn.includes(t))throw new Error('The passage name \"'.concat(t,'\" is not allowed'))}function qn(t,e){for(let n of t)if(Vn.includes(n))throw new Error(\"The tag '\".concat(n,\"' on the passage \\\"\").concat(e,\" is not allowed\"))}var Be=new Map,te=new Map,$e;function Pe(t){let e=t.getElementsByTagName(\"tw-passagedata\");for(let r of e){let s=new Y(r),{id:i,name:o}=s;if(jn(s.name),s.name.startsWith(\"::\")&&console.warn('Found a passage named \"'.concat(o,'\". Although starting a passage name with \"::\" is allowed, this is likely a mistake.')),qn(s.tags,o),Be.has(i))throw new Error(\"Duplicate passage id \".concat(i));if(te.has(o))throw new Error(\"Duplicate passage name \".concat(o));s.content.trim()||console.warn(\"Passage \".concat(o,\" has no text.\")),Be.set(i,s),te.set(o,s)}let n=t.getAttribute(\"startnode\");if(n){let r=Be.get(n);if(!r)throw new Error(\"Could not determine starting passage; no passage with \".concat(n));$e=r}else{let r=te.get(\"Start\");if(!r)throw new Error('Could not find a passage named \"Start\"');$e=r}}function xt(t){let e=[];for(let n of te.values())t(n)&&e.push(n);return e}function Un(t){for(let e of te.values())if(t(e))return e}function F(t){return te.get(t)}function Re(){return $e}function He(t){return xt(e=>e.tags.includes(t))}d();d();var R=class extends Error{constructor(e,n,r){super(\"in \\u201C\".concat(n,\"\\u201D at line \").concat(r,\": \").concat(e)),this.passage=n,this.lineNumber=r}},X=class extends R{constructor(e,n){let r;try{r=\"@\".concat(e.name,\": \").concat(n instanceof Error?n.message:n)}catch(s){r=\"@\".concat(e.name,\": (error could not be converted to string)\")}super(r,e.passageName,e.lineNumber),this.cause=n}},we=class extends R{constructor(e,n,r){let s;try{s='while evaluating the attribute \"'.concat(n,'\": ').concat(e instanceof Error?e.message:e)}catch(i){s='while evaluating the attribute \"'.concat(n,'\": (error could not be converted to string)')}super(s,r.passageName,r.lineNumber),this.cause=e}},W=class extends R{constructor(e,n,r,s){let i='while evaluating \"'.concat(n,'\": ').concat(e);super(i,r,s)}};d();d();var f={closeTag:/>/y,commentBlock:/\\*(?:[^])*?\\*\\//y,commentLine:/\\/.*\\n?/y,elementName:/([-\\p{ID_Continue}]+)(#[-\\p{ID_Continue}]+)?((?:\\.[-\\p{ID_Continue}]+)*)/uy,htmlAttr:/\\s*([-_\\p{ID_Start}][-\\p{ID_Continue}]*)=\"([^\"]*)\"/uy,htmlEvalAttr:/\\s*([-_\\p{ID_Start}][-\\p{ID_Continue}]*)=\\(/uy,js:{binaryOperator:/[%&*<=>^|]+/y,closingParen:/\\s*\\)/y,closingSquareBracket:/\\s*\\]/y,field:new RegExp(\"\\\\.\\\\p{ID_Start}[$\\\\p{ID_Continue}]*\",\"uy\"),identifier:new RegExp(\"\\\\p{ID_Start}[$\\\\p{ID_Continue}]*\",\"uy\"),number:/[0-9][0-9_]*/y,operator:/[!%&*+-<=>^|~]+/y,regexp:new RegExp(\"(?:[^\\\\\\\\[/]|\\\\\\\\[^]|\\\\[(?:[^\\\\\\\\\\\\]]|\\\\\\\\[^])*\\\\])*\\\\/(?:$|\\\\p{ID_Continue})*\",\"uy\"),stringDouble:/\"(?:[^\\\\\"]|\\\\[^])*\"/y,stringSingle:/'(?:[^\\\\']|\\\\[^])*'/y,normalInTemplateString:/(?:[^`$\\\\]|\\\\[^]|\\$(?!\\{))*/y},macroArgsStart:/ *\\(/y,macroBodyStart:/\\s*\\{/y,macroName:/[-\\p{ID_Start}][-\\p{ID_Continue}]*|=/uy,maybeElementClose:/\\/[-\\p{ID_Continue}]+(?: *>)?/uy,normalChars:/[^[\\\\$_?<@/}]+/y,singleChar:/[^]/y,whitespace:/\\s*/y,wikiLink:/((?:[^\\\\\\]]|\\\\.)*)\\]\\]/y},Kn=[\"base\",\"body\",\"link\",\"head\",\"html\",\"meta\",\"script\",\"style\",\"title\"],Wn=[\"area\",\"base\",\"br\",\"col\",\"embed\",\"hr\",\"img\",\"input\",\"link\",\"meta\",\"param\",\"source\",\"track\",\"wbr\"],ne=class{constructor(e,n,r){this.input=e,this.index=0,this.passageName=n,this.lineNumber=r||1}get[Symbol.toStringTag](){return this.constructor.name}consume(e){e.lastIndex=this.index;let n=e.exec(this.input);return n&&(this.lineNumber+=yt(n[0],\"\\n\"),this.index=e.lastIndex),n}lookahead(){return this.input[this.index]||null}locationSample(){if(this.input[this.index]===\"\\n\"){let r=this.input.lastIndexOf(\"\\n\",this.index-1)+1;return this.input.slice(r,this.index)}let e=this.input.lastIndexOf(\"\\n\",this.index-1)+1,n=this.input.indexOf(\"\\n\",this.index+1);return this.input.slice(e,n)}error(e){return{type:\"error\",passageName:this.passageName,lineNumber:this.lineNumber,message:e,locationSample:this.locationSample()}}parse(e){var s;let n=[],r=-1;e:for(;this.index<this.input.length;){if(this.index===r)return n.push(this.error(\"Parser stuck in infinite loop\")),n;r=this.index;let i=this.index;if(this.consume(f.normalChars),this.index!==i&&n.push(this.input.substring(i,this.index)),e&&this.consume(e))return n;let o=(s=this.consume(f.singleChar))==null?void 0:s[0];switch(o){case\"\\\\\":{let a=this.consume(f.singleChar);n.push((a==null?void 0:a[0])||\"\\n\");break}case\"<\":n.push(this.parseElement());break;case\"@\":n.push(this.parseExpr(\"constants\"));break;case\"/\":switch(this.lookahead()){case\"/\":this.consume(f.commentLine);break;case\"*\":if(!this.consume(f.commentBlock))return n.push(this.error(\"Missing trailing `*/` to close the block comment\")),n;break;default:n.push(o);break}break;case\"$\":{n.push(this.parseExpr(\"story\"));break}case\"_\":{n.push(this.parseExpr(\"temp\"));break}case\"[\":if(this.lookahead()===\"[\"){this.index++;let a=this.consume(f.wikiLink);if(!a){n.push(this.error(\"Unmatched `[[`\"));break}let c=a[1],l=c.includes(\"->\"),p=c.includes(\"<-\"),g=c.includes(\"|\"),m=Number(l)+Number(p)+Number(g);if(m>1)n.push(this.error(\"Link boxes can only have one of '->', '<-', or '|'\"));else if(m===0)n.push({type:\"linkBox\",passageName:this.passageName,lineNumber:this.lineNumber,link:c,text:c});else{let w=l?\"->\":p?\"<-\":\"|\";n.push(this.makeLinkBox(c,w))}}else n.push(\"[\");break;case\"}\":n.push(\"}\");break;case void 0:break e;default:throw new Error(\"Logic Error (\".concat(o,\")\"))}}return e&&!this.consume(e)&&n.push(this.error('Failed to match regex \"'.concat(e.source,'\"'))),n}parseExpr(e){let{lineNumber:n}=this,r=\"\";if(e!==\"constants\"||this.lookahead()!==\"(\"){let o=this.consume(f.macroName);if(!o)throw Error();r=o[0]}if(e===\"constants\"){let o=A[r];if(re(o)){let a=o[h];if(typeof a==\"object\"){if(a.chainWith)return this.parseMacroChain(r,a.chainWith);if(a.isForMacro)return this.parseForMacro()}}}let s=[];e:for(;;){let o=this.index;switch(this.lookahead()){case\"(\":{this.index++;let a=this.parseJsArgs(\")\");if(!(a instanceof Array))throw Error();let c=this.input.slice(o,this.index);s.push({type:\"call\",args:a,raw:c});break}case\"[\":{this.index++;let a=this.parseJsArgs(\"]\");if(!(a instanceof Array))throw Error();s.push({type:\"index\",key:a.join(\",\"),needsEval:!0,raw:this.input.slice(o,this.index)});break}case\".\":{this.index++;let a=this.consume(f.js.identifier);if(a)s.push({type:\"index\",key:a[0],needsEval:!1,raw:this.input.slice(o,this.index)});else{this.index--;break e}break}case\" \":if(e===\"constants\"&&s.length===0)this.index++;else break e;break;default:break e}}let i=this.consume(f.macroBodyStart)?this.parse(/\\}/y):void 0;return{type:\"expr\",lineNumber:n,passageName:this.passageName,store:e,base:r,ops:s,content:i}}parseMacroChain(e,n){let r=this.lineNumber;if(!this.consume(f.macroArgsStart))throw\"todo\";let s=this.parseJsArgs(\")\");if(!(s instanceof Array))throw Error(\"todo'):\");if(!this.consume(f.macroBodyStart))throw\"error\";let i=this.parse(/\\}/y),o=this.index,a=[{name:e,args:s,body:i}],c=n.sticky?n:new RegExp(n,n.flags+\"y\");for(;this.consume(/\\s*@/y);){let p=this.consume(c);if(!p){this.index=o;break}let g=p[0],m=[];if(this.lookahead()===\"(\"){let y=this.parseJsArgs(\")\");if(!(y instanceof Array))throw\"ererdsaf\";m=y}let w=[];this.consume(f.macroBodyStart)&&(w=this.parse(/\\}/y),o=this.index),a.push({name:g,args:m,body:w})}return{type:\"chain\",passageName:this.passageName,lineNumber:r,segments:a}}parseForMacro(){let{lineNumber:e}=this;if(!this.consume(f.macroArgsStart))throw\"bad for\";let n=this.index-1,r=this.parseForArgs();if(!(r instanceof Array))throw r;let s=this.input.slice(n,this.index),i=this.consume(f.macroBodyStart)?this.parse(/\\}/y):void 0;return{type:\"expr\",passageName:this.passageName,lineNumber:e,store:\"constants\",base:\"for\",ops:[{type:\"call\",args:r,raw:s}],content:i}}parseElement(){let e=this.consume(f.elementName);if(!e){let c=this.consume(f.maybeElementClose);return c?this.error('Unexpected closing tag \"'.concat(c[0],'\"')):this.error('Element names can contain only hyphens, underscores, and ASCII letters and numbers. The \"<\" character must be escaped with a \"\\\\\" backslash if not used as an HTML element.')}let[,n,r,s]=e,i=new Map,o=new Map;for(r&&i.set(\"id\",r.slice(1)),s.length&&i.set(\"class\",s.replace(\".\",\" \").trim()),this.consume(f.whitespace);!this.consume(f.closeTag);){let c=this.consume(f.htmlAttr);if(c){let[l,p,g]=c;i.has(p)||o.has(p)?console.warn(\"Ignoring duplicate attribute '\".concat(p)):i.set(p,g)}else if(c=this.consume(f.htmlEvalAttr),c){let l=c[1],p=this.parseJsExpression();if(typeof p==\"object\")return p;if(p.trim()===\"\")return this.error('Empty JavaScript attribute \"'.concat(l,'\"'));if(this.lookahead()!==\")\")return this.error('No closing paren on dynamic attribute \"'.concat(l,'\"'));this.index++,i.has(l)||o.has(l)?console.warn(\"Ignoring duplicate attribute '\".concat(l)):o.set(l,p)}else return this.error(\"Missing trailing `>` to close the HTML tag\")}let a=Wn.includes(n)?[]:this.parse(new RegExp(\"</\".concat(n,\">\"),\"y\"));return Kn.includes(n)?this.error('Passages cannot contain \"<'.concat(n,'>\" elements')):{type:\"element\",passageName:this.passageName,lineNumber:this.lineNumber,name:n,attributes:i,evalAttributes:o,content:a}}parseForArgs(){console.log('Entered parseForArgs at \"'.concat(this.input.substring(this.index,this.index+10),'\"'));let e=this.consume(/\\s*([^]*?)\\s+of\\b/y);if(!e)return this.error(\"Syntax: @for(_VAR of EXPRESSION)\");let n=e[1],r=this.parseJsExpression();return typeof r==\"object\"?r:r.trim()===\"\"?this.error(\"Syntax: @for(_VAR of EXPRESSION)\"):this.consume(/\\s*\\)/y)?[n,r]:this.error(\"@for: missing closing ')'\")}parseJsArgs(e){let n=[],r;for(;r=this.parseJsExpression();){if(typeof r==\"object\")return r;if(n.push(r),!this.consume(/\\s*,/uy))break}return this.consume(f.whitespace),this.lookahead()!==e?this.error(\"Missing a closing `\".concat(e,\"`\")):(this.index++,n)}parseJsExpression(){let e=[],n=[],r=!0,s,i=0;e:for(;this.index<this.input.length;){if(this.index===i)throw new Error(\"Infinite loop at index \".concat(i,\" (\").concat(this.input[this.index],\")\"));if(i=this.index,s=this.consume(f.whitespace),s&&n.push(s[0]),s=this.consume(f.js.identifier),s){n.push(s[0]),r=!1;continue}if(s=this.consume(f.js.number),s){n.push(s[0]),r=!1;continue}if(s=this.consume(f.js.binaryOperator),s){n.push(s[0]),r=!0;continue}let o=this.lookahead();switch(o){case'\"':if(s=this.consume(f.js.stringDouble),s)n.push(s[0]),r=!1;else return this.error(\"Unclosed double-quoted string\");break;case\"'\":if(s=this.consume(f.js.stringSingle),s)n.push(s[0]),r=!1;else return this.error(\"Unclosed single-quoted string\");break;case\"`\":this.index++,n.push(o),this.parseJsTemplateString(n),r=!1;break;case\"(\":e.push(\")\"),n.push(o),this.index++,r=!0;break;case\"[\":e.push(\"]\"),n.push(o),this.index++,r=!0;break;case\"{\":e.push(\"}\"),n.push(o),this.index++,r=!1;break;case\"$\":case\"_\":case\"@\":if(this.index++,s=this.consume(f.js.identifier),s){let a=o===\"$\"?\"Engine.vars.\":o===\"_\"?\"Engine.temp.\":\"constants.\";n.push(a,s[0]),r=!1}else return this.error(\"Illegal identifier\");break;case\",\":if(e.length>0)this.index++,n.push(o),r=!0;else break e;break;case\"#\":case\":\":case\";\":case\"?\":case\".\":r=!0,n.push(o),this.index++;break;case\"!\":this.index++,this.lookahead()===\"=\"?(this.index++,this.lookahead()===\"=\"?(this.index++,n.push(\"!==\")):n.push(\"!=\"),r=!0):(n.push(o),r=!1);break;case\"+\":case\"-\":{n.push(o),this.index++;let a=this.lookahead();a===o?(n.push(a),this.index++,r=!1):a===\"=\"?(this.index++,r=!0,n.push(\"=\")):r=!0}break;case\"~\":n.push(o),this.index++,r=!0;break;case\"/\":if(this.index++,this.consume(f.commentLine))n.push(\"\\n\");else if(s=this.consume(f.commentBlock))s[0].includes(\"\\n\")&&n.push(\"\\n\");else if(r){if(n.push(o),s=this.consume(f.js.regexp),!s)return this.error(\"Invalid RegExp literal\");n.push(s[0]),r=!1}else n.push(o),r=!0;break;default:if(o&&o===e[e.length-1]){this.index++,n.push(o),e.pop();break}if(![\")\",\"]\",\"}\"].includes(o||\"\"))return this.error(\"Can't handle unescaped \".concat(o,\" yet\"));break e}}return e.length>0?this.error('Expected a \"'.concat(e.pop(),'\"')):n.join(\"\")}parseJsTemplateString(e){for(;;){let n=this.consume(f.js.normalInTemplateString);n&&e.push(n[0]);let r=this.lookahead();if(!r)return this.error(\"Unclosed template string\");switch(r){case\"`\":e.push(r),this.index++;return;case\"$\":{this.index+=2,e.push(\"${\");let s=this.parseJsExpression();if(typeof s==\"object\")return s;if(e.push(s),this.lookahead()!==\"}\")return this.error('missing \"}\" inside template string');this.index++,e.push(\"}\");break}default:return this.error(\"Logic Error: '\".concat(r,\"' (U+\").concat(r.charCodeAt(0),\") was not matched by regex\"))}}}makeLinkBox(e,n){let r=e.split(n);if(r.length!==2){let s='Links in [[...]] can only contain \"'.concat(n,'\" once');return this.error(s)}return n===\"<-\"?{type:\"linkBox\",passageName:this.passageName,lineNumber:this.lineNumber,link:r[0],text:r[1]}:{type:\"linkBox\",passageName:this.passageName,lineNumber:this.lineNumber,link:r[1],text:r[0]}}toString(){return\"[object Parser]\"}};d();d();d();var Fe=(t,e)=>e.some(n=>t instanceof n),vt,Mt;function Jn(){return vt||(vt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zn(){return Mt||(Mt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Ve=new WeakMap,Oe=new WeakMap,ye=new WeakMap;function Yn(t){let e=new Promise((n,r)=>{let s=()=>{t.removeEventListener(\"success\",i),t.removeEventListener(\"error\",o)},i=()=>{n(G(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener(\"success\",i),t.addEventListener(\"error\",o)});return ye.set(e,t),e}function Xn(t){if(Ve.has(t))return;let e=new Promise((n,r)=>{let s=()=>{t.removeEventListener(\"complete\",i),t.removeEventListener(\"error\",o),t.removeEventListener(\"abort\",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException(\"AbortError\",\"AbortError\")),s()};t.addEventListener(\"complete\",i),t.addEventListener(\"error\",o),t.addEventListener(\"abort\",o)});Ve.set(t,e)}var je={get(t,e,n){if(t instanceof IDBTransaction){if(e===\"done\")return Ve.get(t);if(e===\"store\")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return G(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e===\"done\"||e===\"store\")?!0:e in t}};function It(t){je=t(je)}function Gn(t){return zn().includes(t)?function(...e){return t.apply(qe(this),e),G(this.request)}:function(...e){return G(t.apply(qe(this),e))}}function Zn(t){return typeof t==\"function\"?Gn(t):(t instanceof IDBTransaction&&Xn(t),Fe(t,Jn())?new Proxy(t,je):t)}function G(t){if(t instanceof IDBRequest)return Yn(t);if(Oe.has(t))return Oe.get(t);let e=Zn(t);return e!==t&&(Oe.set(t,e),ye.set(e,t)),e}var qe=t=>ye.get(t);function Ct(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){let o=indexedDB.open(t,e),a=G(o);return r&&o.addEventListener(\"upgradeneeded\",c=>{r(G(o.result),c.oldVersion,c.newVersion,G(o.transaction),c)}),n&&o.addEventListener(\"blocked\",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener(\"close\",()=>i()),s&&c.addEventListener(\"versionchange\",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}var Qn=[\"get\",\"getKey\",\"getAll\",\"getAllKeys\",\"count\"],er=[\"put\",\"add\",\"delete\",\"clear\"],_e=new Map;function Nt(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e==\"string\"))return;if(_e.get(e))return _e.get(e);let n=e.replace(/FromIndex$/,\"\"),r=e!==n,s=er.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Qn.includes(n)))return;let i=async function(o,...a){let c=this.transaction(o,s?\"readwrite\":\"readonly\"),l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),s&&c.done]))[0]};return _e.set(e,i),i}It(t=>({...t,get:(e,n,r)=>Nt(e,n)||t.get(e,n,r),has:(e,n)=>!!Nt(e,n)||t.has(e,n)}));var tr=[\"continue\",\"continuePrimaryKey\",\"advance\"],St={},Ue=new WeakMap,At=new WeakMap,nr={get(t,e){if(!tr.includes(e))return t[e];let n=St[e];return n||(n=St[e]=function(...r){Ue.set(this,At.get(this)[e](...r))}),n}};async function*rr(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;let n=new Proxy(e,nr);for(At.set(n,e),ye.set(n,qe(e));e;)yield n,e=await(Ue.get(n)||e.continue()),Ue.delete(n)}function Tt(t,e){return e===Symbol.asyncIterator&&Fe(t,[IDBIndex,IDBObjectStore,IDBCursor])||e===\"iterate\"&&Fe(t,[IDBIndex,IDBObjectStore])}It(t=>({...t,get(e,n,r){return Tt(e,n)?rr:t.get(e,n,r)},has(e,n){return Tt(e,n)||t.has(e,n)}}));var Lt,L;var be=[];async function Dt(t,e){Lt=\"brick.\".concat(U(t),\".\").concat(e),L=await Ct(Lt,1,{upgrade(n,r,s,i,o){n.createObjectStore(\"moments\",{autoIncrement:!0}),n.createObjectStore(\"histories\",{autoIncrement:!0,keyPath:\"id\"})}}),await or()}async function or(){let t=L.transaction(L.objectStoreNames,\"readwrite\"),e=t.objectStore(\"moments\");if(await e.count()>1e3){let r=await t.objectStore(\"histories\").getAll(),s=new Set;for(let o of r)for(let a of o.momentIds)s.add(a);let i=[];for await(let o of e)s.has(o.key)||i.push(o.delete());await Promise.all(i)}await t.done}async function Ke(t){let e=await L.get(\"moments\",t);if(!e)throw new Error(\"Could not load moment \".concat(t));return{...e,vars:se(e.vars)}}async function ke(t){let e={...t,vars:Je(t.vars,!1)};return await L.put(\"moments\",e)}async function We(t){return await L.get(\"histories\",t)}async function Bt(){return await L.getAll(\"histories\",IDBKeyRange.upperBound(\"\"))}async function $t(t,e,n){let r={id:\"active\",momentIds:t,index:e,timestamp:Date.now(),title:n};await L.put(\"histories\",r)}async function Pt(t,e,n){let r={momentIds:t,index:e,timestamp:Date.now(),title:n};return r.id=await L.put(\"histories\",r),r}async function Rt(){return await L.delete(\"histories\",\"active\")}async function Ht(){return await L.delete(\"histories\",IDBKeyRange.upperBound(\"\"))}async function Ot(t){return await L.delete(\"histories\",t)}async function _t(t){let e=await We(t);if(!e)throw new Error(\"No history in slot \".concat(t));return{index:e.index,timestamp:e.timestamp,title:e.title,moments:await Promise.all(e.momentIds.map(async r=>{let s=await Ke(r);return s.vars=Je(s.vars,!0),s}))}}function k(t){throw new Error(\"Malformed save data: \".concat(t))}async function Ft(t){let e=await t.text(),n=JSON.parse(e);typeof n!=\"object\"||n===null||Array.isArray(n)?k(\"history is not an object\"):\"index\"in n?typeof n.index!=\"number\"?k(\"`index` property is not a number\"):\"timestamp\"in n?typeof n.timestamp!=\"number\"?k(\"`timestamp` property is not a number\"):\"title\"in n?typeof n.title!=\"string\"?k(\"`title` property is not a string\"):\"moments\"in n?Array.isArray(n.moments)||k(\"`moments` property is not an array\"):k(\"Missing `moments` property\"):k(\"Missing `title` property\"):k(\"Missing `timestamp` property\"):k(\"Missing `index` property\");let{moments:r}=n,s=await Promise.all(r.map(o=>(typeof o!=\"object\"||o===null?k(\"one or more moments are not objects\"):\"passageName\"in o?typeof o.passageName!=\"string\"?k(\"`passageName` property is not a string\"):\"timestamp\"in o?typeof o.timestamp!=\"number\"?k(\"`timestamp` property is not a number\"):\"turnCount\"in o?typeof o.turnCount!=\"number\"?k(\"`turnCount` property is not a number\"):\"vars\"in o?(typeof o.vars!=\"object\"||o.vars===null)&&k(\"`vars` property is not an object\"):k(\"missing `vars` property\"):k(\"missing `turnCount` property\"):k(\"missing `timestamp` property\"):k(\"missing `passageName` property\"),ke({passageName:o.passageName,timestamp:o.timestamp,turnCount:o.turnCount,vars:se(o.vars)})))),i={index:n.index,timestamp:n.timestamp,title:n.title,momentIds:s};return await L.put(\"histories\",i)}function Vt(t,e,n,r){if(typeof t!=\"function\")throw new Error(\"registerClass: `constructor` must be a function\");if(t===Array)throw new Error('\"Array\" cannot be a registered class');if(r===void 0&&(r=t.name),typeof r!=\"string\")throw new Error(\"registerClass: `name` must be undefined or a string\");if(e===void 0&&(e=t.serialize),typeof e!=\"function\")throw new Error(\"registerClass: `serialize` must be undefined or a string\");if(n===void 0&&(n=t.deserialize),typeof n!=\"function\")throw new Error(\"registerClass: `deserialize` must be undefined or a string\");if(be.some(s=>s.name===r)||[\"undefined\",\"neg-inf\",\"pos-inf\",\"nan\",\"Map\",\"Date\",\"Set\",\"RegExp\"].includes(r))throw new Error('registerClass: \"'.concat(r,'\" has already been registered'));if([Map,Set,Date,RegExp].includes(t))throw new Error(\"\".concat(t.name,\" is already handled by Brick.\"));be.unshift({constructor:t,name:r,serialize:e,deserialize:n})}function se(t){for(let e in t){let n=t[e];typeof n==\"object\"&&n!==null&&(t[e]=se(n))}if(t instanceof Array&&typeof t[0]==\"string\")if(t[0].startsWith(\"!brick-revive:\")){let e=t[0].substring(14);if(![1,2].includes(t.length))throw new Error(\"malformed save data\");return ir(e,t[1])}else/^!{2,}brick-revive:/.test(t[0])&&(t[0]=t[0].substring(1));else if(t instanceof Map){let e=new Map;for(let[n,r]of t)typeof n==\"object\"&&n&&(n=se(n)),typeof r==\"object\"&&r&&(r=se(r)),e.set(n,r);return e}else if(t instanceof Set){let e=new Set;for(let n of t)typeof n==\"object\"&&n&&(n=se(n)),e.add(n);return e}return t}function ir(t,e){switch(t){case\"undefined\":return;case\"pos-inf\":return 1/0;case\"neg-inf\":return-1/0;case\"nan\":return NaN;case\"bigint\":if(\"BigInt\"in window&&typeof window.BigInt==\"function\")return window.BigInt(e);throw new Error(\"This browser does not support BigInts\");case\"null-proto\":return Object.assign(Object.create(null),e);case\"Map\":if(!Array.isArray(e)||!e.every(r=>Array.isArray(r)&&r.length===2))throw new Error(\"Malformed save data. Could not revive a Map.\");return new Map(e);case\"Set\":if(!Array.isArray(e))throw new Error(\"Malformed save data. Could not revive a Set.\");return new Set(e);case\"Date\":if(typeof e!=\"string\")throw new Error(\"Malformed save data. Could not revive a Date object.\");return new Date(e);case\"RegExp\":{if(!Array.isArray(e)||e.length!==2||!e.every(i=>typeof i==\"string\"))throw new Error(\"Malformed save data. Could not revive a RegExp.\");let[r,s]=e;return new RegExp(r,s)}}let n=be.find(r=>r.name===t);if(!n)throw new Error('Malformed save data. Unknown type \"'.concat(t,'\".'));return n.deserialize(e)}function J(t,e){switch(typeof t){case\"boolean\":case\"string\":return t;case\"undefined\":return e?[\"!brick-revive:undefined\"]:t;case\"number\":if(e)switch(t){case 1/0:return[\"!brick-revive:pos-inf\"];case-1/0:return[\"!brick-revive:neg-inf\"];default:return Number.isNaN(t)?[\"!brick-revive:nan\"]:t}else return t;case\"bigint\":return e?[\"!brick-revive:bigint\",String(t)]:t;case\"function\":case\"symbol\":throw new Error(\"Cannot serialize a \".concat(typeof t));case\"object\":return t===null?null:Je(t,e)}}function Je(t,e){if(Array.isArray(t))return typeof t[0]==\"string\"&&/^!+brick-revive:/.test(t[0])?[\"!\"+t[0],...t.slice(1)]:t;if(t instanceof Map)if(e){let s=[];for(let[i,o]of t)s.push([J(i,e),J(o,e)]);return[\"!brick-revive:Map\",s]}else{let s=new Map;for(let[i,o]of t)s.set(J(i,e),J(o,e));return s}if(t instanceof Set)if(e){let s=[];for(let i of t)s.push(J(i,e));return[\"!brick-revive:Set\",s]}else{let s=new Set;for(let i of t)s.add(J(i,e));return s}if(t instanceof Date)return e?[\"!brick-revive:Date\",t.toJSON()]:t;if(t instanceof RegExp)return e?[\"!brick-revive:RegExp\",[t.source,t.flags]]:t;if(t instanceof Date||t instanceof RegExp)return t;for(let s of be)if(t instanceof s.constructor)return[\"!brick-revive:\".concat(s.name),J(s.serialize(t),e)];let n=Object.getPrototypeOf(t);if(n!==null&&n!==Object.prototype)throw new Error(\"Can't serialize an object with an unknown prototype\");let r={};for(let s in t)r[s]=J(t[s],e);return n===null?[\"!brick-revive:null-proto\",r]:r}var oe={BRICK_VERSION:v,get constants(){return A},Engine:{forward:ve,backward:xe,redo:Ut,get vars(){return C},get temp(){return D}},config:M,Dialog:{showPassage:Kt},passages:ue,saves:{registerClass:Vt},clone:O,createMacro:qt,either(t){if(arguments.length!==1)throw new Error(\"either(): exactly one argument required\");if(typeof t!=\"object\"||t===null)throw new Error(\"either(): first argument was not an array\");if(!(\"length\"in t)||typeof t.length!=\"number\")throw new Error(\"either(): first argument was not an array\");return bt(t)},enumerate:Et,makeElement:u,numberRange:kt,randomInt(t){if(arguments.length!==1)throw new Error(\"randomInt: exactly 1 argument required\");if(typeof t!=\"number\")throw new Error(\"randomInt: argument must be a number\");return Le(t)},render:x,renderPassage:I,slugify:U};oe.BRICK_VERSION.toString=function(){return this.version};oe.BRICK_VERSION.time=new Date(oe.BRICK_VERSION.time);var Ye,Xe;function jt(){Ye=Object.keys(oe),Xe=Object.values(oe),window.Brick=oe}function le(t){return new Function(...Ye,\"'use strict';\".concat(t))(...Xe)}function N(t){return le(\"return \"+t)}function Ee(t,e){new Function(...Ye,'\"use strict\"; '.concat(t,\" = arguments[arguments.length - 1]\"))(...Xe,e)}var h=Symbol.for(\"BRICK_MACRO\");function re(t){if(typeof t==\"function\"&&h in t){let e=t[h];if(typeof e==\"object\"||e===!0)return!0}return!1}var $=class{constructor(e,n){this.context=e,this.type=n}toString(){return\"Signal from @\".concat(this.type,' in \"').concat(this.context.passageName,'\" line ').concat(this.context.lineNumber)}};function qt(t,e){let n=(r,...s)=>t(r,...s);return n[h]=e!=null?e:!0,n}function Wt(t){Object.assign(t,{\"\":zt,\"-\":Ze,\"=\":Qe,append:Ge(\"append\"),break:Gt,checkBox:en,continue:Zt,for:Qt,if:nn,include:Jt,later:on,link:et,linkReplace:Yt,prepend:Ge(\"prepend\"),print:Ze,punt:an,redoable:sn,render:Qe,replace:Ge(\"replace\"),switch:rn,textBox:tn,while:Xt})}var ie=class{constructor(e,n,r,s,i){this.name=e,this.content=i,this.passageName=n,this.lineNumber=r,s!=null&&s.captures&&(this.captures=s.captures)}createCallback(e){let n=this;return function(...s){if(!n.captures)return e.apply(this,s);let i={};for(let a of n.captures)a.name in i||(i[a.name]=D[a.name]),D[a.name]=a.value;let o;try{o=e.apply(this,s)}finally{Object.assign(D,i)}return o}}get[Symbol.toStringTag](){return this.constructor.name}},Jt=(t,...e)=>{if(e.length<1||e.length>2)throw new Error(\"must be called with 1 argument\");let[n,r]=e;if(typeof n!=\"string\")throw new Error(\"first arg (passage name) must be a string\");if(typeof r<\"u\"&&typeof r!=\"string\")throw new Error(\"second arg (element type) must be a string or undefined\");let i=u(r||\"div\");return I(i,n),i};Jt[h]=!0;var zt=(t,...e)=>(le(e.join(\", \")),document.createDocumentFragment());zt[h]={skipArgs:!0};var Ze=(t,...e)=>{if(e.length!==1)throw new Error(\"requires 1 argument (got \".concat(e.length,\")\"));if(t.content)throw new Error(\"no body allowed\");return K(e[0])};Ze[h]=!0;var Qe=(t,...e)=>{if(e.length!==1)throw new Error(\"requires 1 argument (got \".concat(e.length,\")\"));if(t.content)throw new Error(\"no body allowed\");if(typeof e[0]!=\"string\")throw new Error(\"argument must be a string. Use the String() constructor if you want to convert a value to a string.\");let n=document.createDocumentFragment(),r=new ne(e[0],t.passageName,t.lineNumber);return x(n,r.parse()),n};Qe[h]=!0;var et=(t,...e)=>{if(e.length<1||e.length>3)throw new Error(\"requires 1, 2 or 3 arguments\");if(typeof e[0]!=\"string\")throw new Error(\"first argument (link text) must be a string\");let n=e[0],r,s;if(e.length===2)if(typeof e[1]==\"string\")r=e[1],s=void 0;else if(typeof e[1]==\"function\")r=void 0,s=e[1];else throw new Error(\"second argument must be a string or function\");else if(e.length===3){if(typeof e[1]==\"function\"&&typeof e[2]==\"string\")throw new Error(\"second argument must be a string and third argument must be a function\");if(typeof e[1]!=\"string\")throw new Error(\"second argument must be a string\");if(typeof e[2]!=\"function\")throw new Error(\"third argument must be a function\");r=e[1],s=e[2]}else console.warn(\"@link received only 1 argument. This link will do nothing when clicked.\"),r=void 0,s=void 0;let i=u(\"button\",{class:\"brick-link\",type:\"button\"},n);return r&&(i.dataset.linkDestination=r),i.addEventListener(\"click\",t.createCallback(function(o){s&&s.call(this,o),i.dataset.linkDestination&&cn(i.dataset.linkDestination)})),i};et[h]=!0;window.link=et;var Yt=(t,...e)=>{if(e.length!==1)throw new Error(\"requires exactly 1 argument\");let[n]=e;if(typeof n!=\"string\")throw new Error(\"first arg (link text) must be a string\");let r=u(\"button\",{class:\"brick-link\",type:\"button\"},n);return r.addEventListener(\"click\",()=>{let s=u(\"span\",{class:\"brick-linkReplace brick-transparent\"});t.content&&x(s,t.content,t),r.replaceWith(s),setTimeout(()=>s.classList.remove(\"brick-transparent\"),40)}),r};Yt[h]=!0;var Xt=(t,...e)=>{if(e.some(o=>typeof o!=\"string\"))throw new Error(\"received a non-string arg\");let n=e.join(\",\"),r=document.createDocumentFragment(),{content:s}=t,i=1;for(;N(n);){if(i>M.maxLoopIterations)throw new Error(\"Too many iterations (Config.maxLoopIterations = \".concat(M.maxLoopIterations,\")\"));i++;try{if(!(s?x(r,s,t):!0))break}catch(o){if(o instanceof $){if(o.type===\"break\")break;continue}else throw o}}return r};Xt[h]={skipArgs:!0};var Gt=t=>{throw new $(t,\"break\")};Gt[h]=!0;var Zt=t=>{throw new $(t,\"continue\")};Zt[h]=!0;var Qt=(t,...e)=>{if(!e.every(g=>typeof g==\"string\"))throw new Error(\"received a non-string arg\");if(e.length!==2)throw new Error(\"requires exactly 2 arguments\");let[n,r]=e;if(!n.startsWith(\"_\"))throw new Error(\"loop variable must be a temp variable\");let s=n.substring(1),i=\"Engine.temp.\".concat(s),o=N(r);if(typeof o[Symbol.iterator]!=\"function\")throw new Error(\"Right-hand side must be an iterable value, such as an array\");let a=document.createDocumentFragment(),{content:c}=t,l=t.captures||[],p=1;for(let g of o){if(p>M.maxLoopIterations)throw new Error(\"Too many iterations (Config.maxLoopIterations = \".concat(M.maxLoopIterations,\")\"));p++,Ee(i,g),t.captures=[...l,{name:s,value:g}];try{if(!(c?x(a,c,t):!0))break}catch(m){if(m instanceof $){if(m.type===\"break\")break;continue}else throw m}}return t.captures=l,a};Qt[h]={isForMacro:!0,skipArgs:!0};var en=(t,...e)=>{if(e.length!==2)throw new Error(\"requires 2 arguments\");if(e.some(l=>typeof l!=\"string\"))throw new Error(\"both arguments must be strings\");let[n,r]=e,s=N(r);if(typeof s!=\"string\"&&!(s instanceof Node))throw new Error(\"label must be a string or Node\");let i=N(n),o=u(\"input\",{type:\"checkbox\",id:De()});o.checked=!!i,o.addEventListener(\"change\",()=>Ee(n,o.checked));let a=u(\"label\",{for:o.id},s);return u(\"div\",{},o,\" \",a)};en[h]={skipArgs:!0};var tn=(t,...e)=>{if(e.length!==2)throw new Error(\"requires 2 arguments\");if(!e.every(l=>typeof l==\"string\"))throw new Error(\"both arguments must be strings\");let[n,r]=e,s=N(r);if(typeof s!=\"string\"&&!(s instanceof Node))throw new Error(\"label must be a string or Node\");let i=K(N(n)||\"\"),o=u(\"input\",{id:De(),type:\"text\",value:i});o.addEventListener(\"keyup\",()=>Ee(n,o.value));let a=u(\"label\",{for:o.id},s);return u(\"div\",{},o,\" \",a)};tn[h]={skipArgs:!0};var nn=(t,...e)=>{let n=e;for(let r of n)if(!r.name.includes(\"if\")||N(r.args.join(\", \"))){let s=document.createDocumentFragment();return x(s,r.body,t),s}return\"\"};nn[h]={skipArgs:!0,chainWith:/else(?:\\s+if)?\\s*/y};var rn=(t,...e)=>{if(e.length!==1)throw new Error(\"requires 1 arg\");if(!t.content)throw new Error(\"requires a body\");let[n]=e,r=[];for(let i of t.content)if(typeof i==\"string\"){if(i.trim())throw new Error(\"all children must be @case macros 1\")}else if(i.type===\"expr\"&&i.store===\"constants\"&&i.content&&(i.base===\"case\"&&i.ops.length===1&&i.ops[0].type===\"call\"||i.base===\"default\"&&i.ops.length===0))r.push(i);else throw new Error(\"all children must be @case macros 2\");for(let i=0;i<r.length;i++){let o=r[i],a=o.ops[0];if(o.base===\"default\"){if(i!==r.length-1)throw new Error(\"@default must be the last macro\")}else{if(o.base!==\"case\")throw new Error(\"all children must be @case macros 3\");if(a.args.length===0)throw new Error(\"@case macro requires at least one argument\")}}let s=document.createDocumentFragment();for(let i of r){if(i.base===\"default\")return i.content&&x(s,i.content,t),s;for(let o of i.ops[0].args){let a=N(o);if(n===a)return i.content&&x(s,i.content,t),s}}return s};rn[h]=!0;var sn=(t,...e)=>{let{content:n}=t;if(!n)throw new Error(\"must be called with a body\");let r=u(\"span\",{class:\"brick-macro-redoable\"});try{t.content&&x(r,t.content,t)}catch(s){throw s instanceof $?new X(s.context,\"Can't @\".concat(s.type,\" from inside @\").concat(t.name)):s}return r.addEventListener(\"brick-redo\",()=>{r.innerHTML=\"\",t.content&&x(r,t.content,t)}),r};sn[h]=!0;var on=(t,...e)=>{if(e.length!==0&&e.length!==1)throw new Error(\"does not take any args\");let n=40;if(e.length===1){if(typeof e[0]!=\"number\")throw new Error(\"first argument must be a number\");n=e[0]}let{content:r}=t;if(!r)throw new Error(\"requires a body\");let s=u(\"span\",{class:\"brick-macro-later\",hidden:\"\"});return setTimeout(t.createCallback(()=>{let i=document.createDocumentFragment();x(i,r),s.replaceWith(i)}),n),s};on[h]=!0;function Ge(t){let e=(n,...r)=>{if(r.length!==1)throw new Error(\"requires exactly one argument\");if(typeof r[0]!=\"string\")throw new Error(\"first argument must be a string\");let s=document.querySelector(r[0]);if(!s)throw new Error(\"The selector '\".concat(r[0],\"' did not match any elements\"));let i=document.createDocumentFragment();if(n.content)x(i,n.content,n);else if(n.name!==\"replace\")throw new Error('no content provided. Use \"{}\" to provide content.');switch(t){case\"append\":s.append(i);break;case\"prepend\":s.prepend(i);break;case\"replace\":s.innerHTML=\"\",s.append(i);break}return\"\"};return e[h]=!0,e}var an=(t,...e)=>{if(t.content)throw new Error(\"Does not take content\");if(e.length===0)throw new Error(\"requires at least one argument\");if(!e.every(n=>typeof n==\"string\"))throw new Error(\"received a non-string arg\");if(!e.every(n=>n.startsWith(\"Engine.temp.\")))throw new Error(\"only temp variables can be punted\");for(let n of e)un(n.slice(12));return\"\"};an[h]={skipArgs:!0};function P(t){return console.error(t),u(\"span\",{class:\"brick-error\"},K(t))}function I(t,e){if(typeof e==\"string\"){let n=F(e);return n?I(t,n):(t.innerHTML=\"\",t.append(u(\"span\",{class:\"brick-error\"},'No passage named \"'.concat(e,'\" found'))),!1)}return t.innerHTML=\"\",t.classList.add(\"psg-\".concat(e.slug)),t.dataset.name=e.name,t.dataset.tags=e.tags.join(\" \"),x(t,e)}var Me=1e3,nt=!1;function x(t,e,n){if(nt)return!1;if(Me<=0){let s=(n==null?void 0:n.passageName)||e instanceof Y&&e.name||\"unknown\",i=(n==null?void 0:n.lineNumber)||0,o=new R(\"Infinite recursion detected\",s,i);return t.append(P(o)),nt=!0,!1}let r;try{Me--,r=lr(t,e,n)}finally{Me++,Me>=1e3&&(nt=!1)}return r}function lr(t,e,n){let r=!0;if(e instanceof Y){let s=M.preProcessText?M.preProcessText(e):e.content;if(typeof s!=\"string\")throw new TypeError(\"Config.preProcessText returned a \".concat(typeof s,\", expected a string\"));let i=new ne(s,e.name);return x(t,i.parse(),n)}for(let s of e)if(typeof s==\"string\"){let i=s.split(\"\\n\\n\"),o=i.shift();if(typeof o==\"string\")for(t.append(o);typeof(o=i.shift())==\"string\";)t.append(u(\"br\")),t.append(u(\"br\")),t.append(o)}else if(s.type===\"expr\")r=pr(t,s,n)&&r;else if(s.type===\"chain\"){let i=s.segments[0].name,o=A[i];if(!re(o))throw new Error(\"chain macro not a macro\");let a=new ie(i,s.passageName,s.lineNumber,n,[]);rt(t,o,a,s.segments)}else if(s.type===\"element\")r=mr(s,t,n)&&r;else if(s.type===\"linkBox\"){let i=A.link;if(!re(i))throw\"link is not link\";let o=new ie(\"link\",s.passageName,s.lineNumber);rt(t,i,o,[s.text,s.link])}else if(s.type===\"error\")r=!1,t.append(P(new R(s.message,s.passageName,s.lineNumber)));else throw new Error(\"Unknown NodeTemplate type: \".concat(s.type));return r}function pr(t,e,n){var g;let r=!0,s=e.store===\"constants\"?A:e.store===\"story\"?C:D,i={constants:\"@\",story:\"$\",temp:\"_\"}[e.store],o;try{o=s[e.base]}catch(m){let w=new W(m,i+e.base,e.passageName,e.lineNumber);return t.append(P(w)),!1}let a=null,c=((g=e.ops[e.ops.length-1])==null?void 0:g.type)===\"call\"?e.ops[e.ops.length-1]:void 0,l=c?e.ops.slice(0,-1):e.ops,p=i+e.base;for(let m of l)switch(m.type){case\"index\":{let w;try{w=m.needsEval?N(m.key):m.key}catch(y){let b=new W(y,m.raw.slice(1,-1),e.passageName,e.lineNumber);return t.append(P(b)),!1}a=o;try{o=o[w]}catch(y){let b=new W(y,\"\".concat(p).concat(m.raw),e.passageName,e.lineNumber);return t.append(P(b)),!1}p+=m.raw;break}case\"call\":{let w=[];for(let b of m.args)try{w.push(N(b))}catch(j){let he=new W(j,b,e.passageName,e.lineNumber);return t.append(P(he)),!1}if(typeof o!=\"function\"){let b=new R('\"'.concat(p,'\" is not a function'),e.passageName,e.lineNumber);return t.append(P(b)),!1}let y;try{y=o.apply(a,w)}catch(b){let j=new W(b,p+m.raw,e.passageName,e.lineNumber);t.append(P(j))}a=o,o=y}}if(re(o)){let m=(c==null?void 0:c.args)||[],w=new ie(p,e.passageName,e.lineNumber,n,e.content),y=o[h],b=typeof y==\"object\"&&y.skipArgs;r=rt(t,o,w,b?m:m.map(N))&&r}else{if(e.content){let m=new R(\"\".concat(p,\" is not a macro\"),e.passageName,e.lineNumber);return t.append(P(m)),!1}if(c){let m=c.args.map(N);if(typeof o!=\"function\"){let y=new R('\"'.concat(p,'\" is not a function'),e.passageName,e.lineNumber);return t.append(P(y)),!1}let w=o.apply(a,m);a=o,o=w}t.append(o instanceof Node?o:String(o))}return r}function mr(t,e,n){let r=u(t.name);for(let[i,o]of t.attributes)r.setAttribute(i,o);for(let[i,o]of t.evalAttributes)try{let a=N(o);i.startsWith(\"on\")&&i.length>=3&&typeof a==\"function\"?r.addEventListener(i.substring(2),a):r.setAttribute(i,K(a))}catch(a){if(a instanceof $)throw a;return e.append(P(new we(a,i,t))),!1}let s=x(r,t.content,n);return e.append(r),s}function rt(t,e,n,r){try{let s=e.call(null,n,...r);return t.append(s),!0}catch(s){if(s instanceof $)throw s;let i=s instanceof X?s:new X(n,s);return t.append(P(i)),!1}}var ae,B,H,S,Z,z,Q,C,D,A;function fr(t,e){return typeof e==\"string\"?'Unknown story variable \"$'.concat(t,'\". Did you mean \"$').concat(e,'\"?'):'Unknown story variable \"$'.concat(t,'\".')}function dr(t,e){return typeof e==\"string\"?'Unknown temporary variable \"_'.concat(t,'\". Did you mean \"_').concat(e,'\"?'):'Unknown temporary variable \"_'.concat(t,'\".')}function hr(t,e){return typeof e==\"string\"?'Unknown constant \"@'.concat(t,'\". Did you mean \"@').concat(e,'\"?'):'Unknown constant \"@'.concat(t,'\".')}function st(t){return ge(t||{},fr)}function ot(){return ge({},dr)}function gr(){return ge({},hr)}async function ln(){ae=ee(\"brick-main\"),ae.innerHTML=\"\",B=[],H=[],S=-1,Z=0,z=\"\",C=st(),D=ot(),A=gr(),Q=[]}async function pn(){if(Object.freeze(A),!await Ne(\"active\")){Z=1,z=Re().name,C=st(),D=ot(),Q=[];let t={passageName:z,timestamp:Date.now(),turnCount:Z,vars:C};H=[t],B=[await ke(t)],S=0,Se(),pe()}}async function it(){let t=H[S];t||(t=await Ke(B[S]),H[S]=t),C=st(O(t.vars)),Z=t.turnCount,z=t.passageName}async function xe(){if(S===0)return!1;if(M.stream){let t=Array.from(document.querySelectorAll(\".brick-passage\"));for(let e of t.slice(-2))e.remove()}return S--,await it(),Se(),pe(),!0}async function ve(){return S===B.length-1?!1:(S++,await it(),Se(),pe(),!0)}async function cn(t){z=typeof t==\"string\"?t:t.name,B.length=S+1,H.length=S+1,Z++,Q.length>0&&(C[\"-brick-punted\"]=Q.map(n=>[n,D[n]]));let e={passageName:z,timestamp:Date.now(),turnCount:Z,vars:O(C)};H.push(e),B.push(await ke(e)),H.length>M.historyLength&&(H=H.slice(-M.historyLength),B=B.slice(-M.historyLength)),S=B.length-1,Se(),pe()}async function mn(){return await Pt(B,S,fn())}async function Ne(t){let e=await We(t);return e?(B=e.momentIds,H=Array(B.length),H.fill(void 0),S=e.index,await it(),ae.innerHTML=\"\",pe(),!0):!1}function fn(){return\"\".concat(z,\" | Turn \").concat(Z)}function Se(){return $t(B,S,fn())}function pe(){if(D=ot(),Q=[],\"-brick-punted\"in C&&C[\"-brick-punted\"]instanceof Array)for(let[r,s]of C[\"-brick-punted\"])typeof r!=\"string\"?console.warn(\"non-string key in $-brick-punted\"):D[r]=s;if(delete C[\"-brick-punted\"],M.stream){for(let r of ae.querySelectorAll(\":enabled\"))r.setAttribute(\"disabled\",\"\");for(let r of document.querySelectorAll(\".brick-active-passage\"))r.classList.remove(\"brick-active-passage\")}else ae.innerHTML=\"\";let t=u(\"article\",{class:\"brick-passage brick-active-passage brick-transparent\"});I(t,z);let e=F(\"StoryHeader\"),n=F(\"StoryFooter\");if(e){let r=u(\"header\");I(r,e),t.prepend(r)}if(n){let r=u(\"footer\");I(r,n),t.append(r)}ae.append(t),t.scrollIntoView(),setTimeout(()=>t.classList.remove(\"brick-transparent\"),40)}function dn(){Rt(),window.location.reload()}function Ut(){for(let t of document.querySelectorAll(\".brick-macro-redoable\"))t.dispatchEvent(new CustomEvent(\"brick-redo\"))}function un(t){Q.includes(t)&&console.warn(\"_\".concat(t,\" was already punted\")),Q.push(t)}d();var hn={generic:{cancel:\"Cancel\",restart:\"Restart\"},misc:{restartConfirmation:\"Are you sure you would like to restart?\"},savesDialog:{delete:\"Delete\",deleteAll:\"Delete All\",deleteMode:\"Delete\",export:\"Export\",exportMode:\"Export\",empty:\"No saves found\",import:\"Import\",loadSave:\"Load\",newSave:\"Save\",title:\"Saves\"}};var yr=hn;function br(t,e){let n=e.split(\".\"),r=t,s;for(let[i,o]of n.entries()){if(!(o in r))throw new Error(\"Invalid key: \".concat(n.slice(0,i+1).join(\".\")));let a=r;if(i===n.length-1)s=a[o];else{if(typeof a[o]!=\"object\"||a[o]===null)throw new Error('\"'.concat(n.slice(0,i+1).join(\".\"),'\" is not an object'));r=a[o]}}return s}function E(t,e){let n;try{n=br(yr,t)}catch(r){console.error(r)}return typeof n==\"string\"?n:\"{{\".concat(t,\"}}\")}var T,me,V,gn;function wn(t){gn=t;let e=ee(\"brick-dialog\");if(e instanceof HTMLDialogElement)T=e;else throw new Error(\"#brick-dialog was not a <dialog> element\");Ie(),T.addEventListener(\"click\",n=>{let r=T.getBoundingClientRect(),{clientX:s,clientY:i}=n;r.top<=i&&i<=r.top+r.height&&r.left<=s&&s<=r.left+r.width||T.close()})}function Ie(){T.innerHTML=\"\",T.className=\"\",me=u(\"h1\");let t=u(\"div\",{},me);V=u(\"div\"),T.append(t,V)}function Kt(t){Ie(),me.append(t),I(V,t),T.showModal()}async function yn(){Ie(),me.append(E(\"savesDialog.title\")),V.append(\"Loading...\"),T.classList.add(\"brick-saves-menu\"),T.showModal();let t=await Bt();t.sort((s,i)=>i.timestamp-s.timestamp);let e=await Promise.all(t.map(bn));V.innerHTML=\"\";let n=u(\"ul\");V.append(n),e.length===0?n.append(u(\"li\",{class:\"brick-saves-empty\"},u(\"em\",{},E(\"savesDialog.empty\")))):n.append(...e);let r=u(\"div\",{class:\"brick-saves-buttons\"});Te(n,r),V.append(r)}function Te(t,e){let n=u(\"button\",{class:\"brick-ui-btn\"},E(\"savesDialog.deleteMode\"));n.addEventListener(\"click\",()=>{for(let a of t.querySelectorAll(\"button\"))a.removeEventListener(\"click\",fe),a.addEventListener(\"click\",kn),a.textContent=\"Delete\";kr(t,e)});let r=u(\"button\",{class:\"brick-ui-btn\"},E(\"savesDialog.exportMode\"));r.addEventListener(\"click\",()=>{for(let a of t.querySelectorAll(\"button\"))a.removeEventListener(\"click\",fe),a.addEventListener(\"click\",En),a.textContent=E(\"savesDialog.export\");Er(t,e)});let s=u(\"input\",{type:\"file\"});s.addEventListener(\"change\",async()=>{if(!s.files||s.files.length===0)return;let a=await Ft(s.files[0]);T.close(),await Ne(a)});let i=u(\"button\",{class:\"brick-ui-btn\"},E(\"savesDialog.import\"));i.addEventListener(\"click\",()=>s.click());let o=u(\"button\",{class:\"brick-ui-btn\"},E(\"savesDialog.newSave\"));o.addEventListener(\"click\",async()=>{var c;let a=await mn();(c=t.querySelector(\".brick-saves-empty\"))==null||c.remove(),t.prepend(bn(a))}),e.innerHTML=\"\",e.append(n,r,i,o)}function kr(t,e){let n=u(\"button\",{class:\"brick-ui-btn\",disabled:\"\"},E(\"savesDialog.deleteAll\"));n.addEventListener(\"click\",async function(){this.disabled=!0,await Ht(),t.innerHTML=\"\",t.append(u(\"li\",{},u(\"em\",{},\"No saves found\"))),Te(t,e)}),setTimeout(()=>{n.disabled=!1},2e3);let r=u(\"button\",{class:\"brick-ui-btn\"},E(\"generic.cancel\"));r.addEventListener(\"click\",()=>{let s=E(\"savesDialog.loadSave\");for(let i of t.querySelectorAll(\"button\"))i.removeEventListener(\"click\",kn),i.addEventListener(\"click\",fe),i.textContent=s;Te(t,e)}),e.innerHTML=\"\",e.append(n,r)}function Er(t,e){let n=u(\"button\",{class:\"brick-ui-btn\"},E(\"generic.cancel\"));n.addEventListener(\"click\",()=>{let r=E(\"savesDialog.loadSave\");for(let s of t.querySelectorAll(\"button\"))s.removeEventListener(\"click\",En),s.addEventListener(\"click\",fe),s.textContent=r;Te(t,e)}),e.innerHTML=\"\",e.append(n)}function bn(t){let e=new Date(t.timestamp).toLocaleString(),{id:n}=t;if(!n)throw new Error(\"Tried to create a save menu entry for an unsaved History\");let r=u(\"button\",{class:\"brick-ui-btn\",\"data-brick-history-id\":String(n)},E(\"savesDialog.loadSave\"));return r.addEventListener(\"click\",fe),u(\"li\",{},u(\"div\",{},t.title,u(\"br\"),u(\"small\",{},e)),r)}async function fe(){let t=Number(this.dataset.brickHistoryId);if(t!==t)throw new Error('Tried to load invalid ID \"'.concat(this.dataset.brickHistoryId,'\"'));if(T.close(),!await Ne(t))throw new Error(\"Could not load history #\".concat(t))}async function kn(){var n,r;let t=Number(this.dataset.brickHistoryId);if(t!==t)throw new Error('Tried to delete invalid ID \"'.concat(this.dataset.brickHistoryId,'\"'));await Ot(t);let e=(n=this.parentElement)==null?void 0:n.parentElement;(r=this.parentElement)==null||r.remove(),e&&e.childElementCount===0&&e.append(u(\"li\",{class:\"brick-saves-empty\"},u(\"em\",{},E(\"savesDialog.empty\"))))}async function En(){let t=Number(this.dataset.brickHistoryId);if(Number.isNaN(t))throw new Error('Tried to export invalid ID \"'.concat(this.dataset.brickHistoryId,'\"'));let e=await _t(t),n=new Date(e.timestamp).toISOString().replace(/-|:|\\..*/g,\"\").replace(\"T\",\"-\"),r=\"\".concat(gn,\"-\").concat(n,\".json\"),s=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:\"application/json\"}));u(\"a\",{download:r,href:s}).click(),URL.revokeObjectURL(s)}function xn(){Ie(),T.classList.add(\"brick-restart\"),me.textContent=\"Restart\",V.append(u(\"p\",{},E(\"misc.restartConfirmation\")));let t=u(\"button\",{class:\"brick-ui-btn\"},E(\"generic.restart\"));t.addEventListener(\"click\",dn);let e=u(\"button\",{class:\"brick-ui-btn\"},E(\"generic.cancel\"));e.addEventListener(\"click\",()=>T.close()),V.append(t,e),T.showModal()}window.addEventListener(\"error\",t=>{let{error:e}=t,n=\"\";e instanceof Error?(n+=\"Fatal Error!\\n\",n+=e.toString(),e.stack&&(n+=\"\\n\"+e.stack)):e instanceof $?n+=\"@\".concat(e.type,' was called outside a loop, at \"').concat(e.context.passageName,'\" line ').concat(e.context.lineNumber):(n+=\"Non-error object was thrown and not caught:\\n\",n+=K(t)),alert(n)});window.addEventListener(\"unhandledrejection\",t=>{let{reason:e}=t;alert(\"Fatal Error!\\n\".concat(e))});var de=document.getElementsByTagName(\"tw-storydata\")[0];Pe(de);var vr=de.querySelectorAll('style[type=\"text/twine-css\"]'),Mr=de.querySelectorAll('script[type=\"text/twine-javascript\"]'),vn=F(\"StoryInterface\");vn&&(ee(\"brick-viewport\").outerHTML=vn.content);var Mn=de.getAttribute(\"name\")||(()=>{throw new Error(\"Story has no title\")})(),Nr=de.getAttribute(\"ifid\")||\"00000000-0000-4000-A000-000000000000\";for(let t of vr){let e=u(\"style\",{class:\"brick-author-style\"},t.textContent);document.head.appendChild(e)}function Ce(t,e){var n;(n=document.getElementById(t))==null||n.addEventListener(\"click\",e)}Ce(\"brick-history-backward\",xe);Ce(\"brick-history-forward\",ve);Ce(\"brick-saves\",yn);Ce(\"brick-restart\",xn);async function Sr(){wn(U(Mn)),await Dt(Mn,Nr),await ln(),jt(),Wt(A);for(let e of He(\"macro\")){if(!new RegExp(\"\\\\p{ID_Start}\\\\p{ID_Continue}*\",\"u\").test(e.name))throw new Error('Invalid macro name: \"'.concat(e.name,'\"'));let n=(r,...s)=>{if(r.content)throw new Error('This macro was created with the \"macro\" tag and cannot take children');if(s.length!==0)throw new Error('This macro was created with the \"macro\" tag and does not accept arguments');let i=u(\"div\");return I(i,e),i};n[h]=!0,A[e.name]=n}for(let e of Mr)le(e.textContent);let t=F(\"StoryInit\");if(t){let e=u(\"div\");I(e,t),e.normalize();let n=e.textContent.trim();n&&console.warn(\"StoryInit, when rendered, contained non-whitespace characters. This is likely an error. Its contents:\\n\"+n)}await pn()}Sr();})();\n\n    </script>\n  </body>\n</html>\n","hydrate":"function startState(){return{blockComment:!1,js:!1,nesting:[],jsNesting:[],status:\"default\"}}const KEYWORDS=\"break case catch class const continue debugger default delete do else export extends false finally for function if import in instanceof new null return super switch this throw true try typeof var void while with let static yield await enum implements interface package private protected public arguments as async eval from get of set undefined\".split(\" \"),OPERATORS=[\"!\",\"!=\",\"!==\",\"%\",\"%=\",\"&\",\"&&\",\"&=\",\"&&=\",\"*\",\"**\",\"*=\",\"**=\",\"+\",\"++\",\"+=\",\"-\",\"--\",\"-=\",\"/\",\"/=\",\"<\",\"<<\",\"<=\",\"<<=\",\"=\",\"==\",\"===\",\"=>\",\">\",\">>\",\">>>\",\">=\",\">>=\",\">>>=\",\"^\",\"^=\",\"|\",\"||\",\"|=\",\"||=\",\"~\"],RE_NUMBER_ERROR=/^[_0-9.a-fA-F]+n?/,RE_NUMBER_LEADING_ZERO=/^(?:[bB](?:_?[01])+n?|[oO](?:_?[0-7])+n?|[xX](?:_?[0-9a-fA-F])+n?|n|(?:\\.(?:_?[0-9])*)?(?:[eE](?:_?[0-9])+)?)/,RE_POSTNUMBER_ERROR=/^[_0-9\\p{ID_Start}]/u;function postNumberCheck(e){return e.match(RE_POSTNUMBER_ERROR)?\"error number\":\"number\"}function tokenJsNumber(e,r){if(r===\"0\"){if(e.match(RE_NUMBER_LEADING_ZERO))return postNumberCheck(e);if(e.eol()||e.peek().match(/^[^0-9\\p{ID_Start}]/u))return postNumberCheck(e)}else if(r===\".\"){if(e.match(/^(?:_?[0-9])+(?:[eE](?:_?[0-9])+)?/))return postNumberCheck(e)}else if(e.match(/^(?:(?:_?[0-9])*(?:\\.(?:_?[0-9])*)?(?:[eE](?:_?[0-9])+)?|(?:_?[0-9])*n)/))return postNumberCheck(e);return e.match(RE_NUMBER_ERROR),\"error number\"}function tokenJs(e,r){if(e.match(/^[!%&*+\\-<=>^|~]+/))return OPERATORS.includes(e.current())?\"operator\":\"error operator\";if(e.match(/^@?[$_a-zA-Z][$_a-zA-Z0-9]*/))return[\"$\",\"_\",\"@\"].includes(e.current()[0])?\"variable-2\":KEYWORDS.includes(e.current())?\"keyword\":\"variable\";const n=e.next();if(n>=\"0\"&&n<=\"9\"||n===\".\"&&e.peek()>=\"0\"&&e.peek()<=\"9\")return tokenJsNumber(e,n);switch(n){case\"/\":return e.peek()===\"/\"?(e.skipToEnd(),\"comment\"):e.peek()===\"*\"?(e.next(),r.blockComment=!0,\"comment\"):(e.eat(\"=\"),\"operator\");case\"(\":return r.jsNesting.push(\")\"),\"bracket\";case\"{\":return r.jsNesting.push(\"}\"),\"bracket\";case\"[\":return r.jsNesting.push(\"]\"),\"bracket\";case\")\":case\"}\":case\"]\":return n===r.jsNesting[r.jsNesting.length-1]?(r.jsNesting.pop(),r.jsNesting.length===0&&(r.js=!1),\"bracket\"):\"bracket error\";case'\"':return e.match(/^(?:[^\\\\\"]|\\\\[^]])*\"/)?\"string\":(e.skipToEnd(),\"string error\");case\"'\":return e.match(/^(?:[^\\\\']|\\\\[^])*'/)?\"string\":(e.skipToEnd(),\"string error\");default:return e.eatSpace(),null}}const miniModes={closingTag(e,r){return r.status=\"default\",e.match(/^\\s*>/)?\"bracket\":(e.next(),\"error\")},closingTagPreName(e,r){return e.match(new RegExp(\"\\\\p{ID_Start}\\\\p{ID_Continue}*(?:-\\\\p{ID_Continue})*\",\"u\"))?(r.status=\"closingTag\",\"tag\"):(r.status=\"default\",e.next(),\"error\")},expectAttrValue(e,r){return e.match(/^\"([^\"]*)\"/)?(r.status=\"openTag\",\"string\"):e.match(/^\".*/)?(r.status=\"default\",\"string error\"):e.eat(\"(\")?(r.js=!0,r.jsNesting=[\")\"],r.status=\"openTag\",\"bracket\"):(r.status=\"default\",e.next(),\"error\")},exprFollowUp(e,r){return e.eat(\"[\")?(r.jsNesting=[\"]\"],r.js=!0,\"bracket\"):e.eat(\"(\")?(r.jsNesting=[\")\"],r.js=!0,\"bracket\"):e.eat(\".\")?(r.status=\"exprPostDot\",e.peek()&&new RegExp(\"\\\\p{ID_Start}\",\"u\").test(e.peek())?\"variable-2\":\"\"):e.match(/^\\s*\\{/)?(r.nesting.push(\"}\"),\"bracket\"):(r.status=\"default\",token(e,r))},exprPostDot(e,r){return e.match(new RegExp(\"^\\\\p{ID_Start}\\\\p{ID_Continue}*\",\"u\"))?(r.status=\"exprFollowUp\",\"variable-2\"):(r.status=\"default\",token(e,r))},macroFollowUp(e,r){return e.match(/^\\s*\\(/)?(r.jsNesting=[\")\"],r.js=!0,r.status=\"exprFollowUp\",\"bracket\"):miniModes.exprFollowUp(e,r)},openTag(e,r){return r.maybeAttrEquals&&(r.maybeAttrEquals=!1,e.eat(\"=\"))?(r.status=\"expectAttrValue\",\"\"):e.match(/^\\s*\\/?>/)?(r.status=\"default\",\"bracket\"):e.match(new RegExp(\"^\\\\s*\\\\p{ID_Start}\\\\p{ID_Continue}*(?:-\\\\p{ID_Continue})*\",\"u\"))?(r.maybeAttrEquals=!0,\"attribute\"):(e.next(),r.status=\"default\",\"error\")},openTagPreName(e,r){return e.match(new RegExp(\"^\\\\p{ID_Start}\\\\p{ID_Continue}*(?:-\\\\p{ID_Continue})*\",\"u\"))?(r.status=\"openTag\",\"tag\"):(r.status=\"default\",e.next(),\"error\")},wikiLink(e,r){return e.match(/^->|<-|\\|/)?\"bracket\":e.match(\"]]\")?(r.status=\"default\",\"bracket\"):(e.match(/^[^<|\\-\\]]+/)||e.next(),null)}};function token(e,r){if(r.blockComment)return e.match(/^[^]*?\\*\\//)?r.blockComment=!1:e.skipToEnd(),\"comment\";if(r.js)return tokenJs(e,r);if(r.status in miniModes)return miniModes[r.status](e,r);const n=e.next();switch(n){case\"@\":case\"$\":case\"_\":return e.match(new RegExp(\"^\\\\p{ID_Start}\\\\p{ID_Continue}*\",\"u\"))||n===\"@\"&&e.peek()===\"(\"?(r.status=n===\"@\"?\"macroFollowUp\":\"exprFollowUp\",n===\"@\"?\"keyword\":\"variable-2\"):\"error\";case\"/\":return e.peek()===\"/\"?(e.skipToEnd(),\"comment\"):e.peek()===\"*\"?(e.next(),r.blockComment=!0,\"comment\"):null;case\"{\":return\"error\";case\"[\":if(e.eat(\"[\"))return r.status=\"wikiLink\",\"bracket\";case\"}\":return n===r.nesting.at(-1)?(r.nesting.pop(),\"bracket\"):\"error\";case\"\\\\\":return e.next(),\"atom\";case\"<\":{const t=e.peek();return t&&new RegExp(\"\\\\p{ID_Start}\",\"u\").test(t)?(r.status=\"openTagPreName\",\"bracket\"):t===\"/\"?(e.next(),r.status=\"closingTagPreName\",\"bracket\"):\"bracket error\"}case\">\":return\"error\";default:return e.match(/^[^$_/@{}\\\\<>\\[]*/),null}}function mode(){return{startState,token}}function register(e){e.defineMode(\"brick\",mode)}this.editorExtensions={twine:{\"^2.4.0\":{codeMirror:{mode}}}};\n","url":"https://github.com/cjneidhart/brick","license":"GPL-3.0"});