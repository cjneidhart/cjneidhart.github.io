window.storyFormat({"name":"Brick","version":"0.2.1","author":"Chris Neidhart","image":"icon.svg","description":"A modern story format with a JavaScript-like syntax, and a focus on performance and simplicity.<br><br><a href=\"https://github.com/cjneidhart/brick\">Homepage</a>","source":"<!DOCTYPE html>\n<html lang=\"en-US\" data-bs-theme=\"dark\">\n\n<head>\n  <meta charset=\"utf-8\">\n  <title>{{STORY_NAME}}</title>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <style id=\"style-bootstrap\">\n    /*!\n * Bootstrap Reboot v5.3.3 (https://getbootstrap.com/)\n * Copyright 2011-2024 The Bootstrap Authors\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n */:root,[data-bs-theme=light]{--bs-blue:#0d6efd;--bs-indigo:#6610f2;--bs-purple:#6f42c1;--bs-pink:#d63384;--bs-red:#dc3545;--bs-orange:#fd7e14;--bs-yellow:#ffc107;--bs-green:#198754;--bs-teal:#20c997;--bs-cyan:#0dcaf0;--bs-black:#000;--bs-white:#fff;--bs-gray:#6c757d;--bs-gray-dark:#343a40;--bs-gray-100:#f8f9fa;--bs-gray-200:#e9ecef;--bs-gray-300:#dee2e6;--bs-gray-400:#ced4da;--bs-gray-500:#adb5bd;--bs-gray-600:#6c757d;--bs-gray-700:#495057;--bs-gray-800:#343a40;--bs-gray-900:#212529;--bs-primary:#0d6efd;--bs-secondary:#6c757d;--bs-success:#198754;--bs-info:#0dcaf0;--bs-warning:#ffc107;--bs-danger:#dc3545;--bs-light:#f8f9fa;--bs-dark:#212529;--bs-primary-rgb:13,110,253;--bs-secondary-rgb:108,117,125;--bs-success-rgb:25,135,84;--bs-info-rgb:13,202,240;--bs-warning-rgb:255,193,7;--bs-danger-rgb:220,53,69;--bs-light-rgb:248,249,250;--bs-dark-rgb:33,37,41;--bs-primary-text-emphasis:#052c65;--bs-secondary-text-emphasis:#2b2f32;--bs-success-text-emphasis:#0a3622;--bs-info-text-emphasis:#055160;--bs-warning-text-emphasis:#664d03;--bs-danger-text-emphasis:#58151c;--bs-light-text-emphasis:#495057;--bs-dark-text-emphasis:#495057;--bs-primary-bg-subtle:#cfe2ff;--bs-secondary-bg-subtle:#e2e3e5;--bs-success-bg-subtle:#d1e7dd;--bs-info-bg-subtle:#cff4fc;--bs-warning-bg-subtle:#fff3cd;--bs-danger-bg-subtle:#f8d7da;--bs-light-bg-subtle:#fcfcfd;--bs-dark-bg-subtle:#ced4da;--bs-primary-border-subtle:#9ec5fe;--bs-secondary-border-subtle:#c4c8cb;--bs-success-border-subtle:#a3cfbb;--bs-info-border-subtle:#9eeaf9;--bs-warning-border-subtle:#ffe69c;--bs-danger-border-subtle:#f1aeb5;--bs-light-border-subtle:#e9ecef;--bs-dark-border-subtle:#adb5bd;--bs-white-rgb:255,255,255;--bs-black-rgb:0,0,0;--bs-font-sans-serif:system-ui,-apple-system,\"Segoe UI\",Roboto,\"Helvetica Neue\",\"Noto Sans\",\"Liberation Sans\",Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\";--bs-font-monospace:SFMono-Regular,Menlo,Monaco,Consolas,\"Liberation Mono\",\"Courier New\",monospace;--bs-gradient:linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));--bs-body-font-family:var(--bs-font-sans-serif);--bs-body-font-size:1rem;--bs-body-font-weight:400;--bs-body-line-height:1.5;--bs-body-color:#212529;--bs-body-color-rgb:33,37,41;--bs-body-bg:#fff;--bs-body-bg-rgb:255,255,255;--bs-emphasis-color:#000;--bs-emphasis-color-rgb:0,0,0;--bs-secondary-color:rgba(33, 37, 41, 0.75);--bs-secondary-color-rgb:33,37,41;--bs-secondary-bg:#e9ecef;--bs-secondary-bg-rgb:233,236,239;--bs-tertiary-color:rgba(33, 37, 41, 0.5);--bs-tertiary-color-rgb:33,37,41;--bs-tertiary-bg:#f8f9fa;--bs-tertiary-bg-rgb:248,249,250;--bs-heading-color:inherit;--bs-link-color:#0d6efd;--bs-link-color-rgb:13,110,253;--bs-link-decoration:underline;--bs-link-hover-color:#0a58ca;--bs-link-hover-color-rgb:10,88,202;--bs-code-color:#d63384;--bs-highlight-color:#212529;--bs-highlight-bg:#fff3cd;--bs-border-width:1px;--bs-border-style:solid;--bs-border-color:#dee2e6;--bs-border-color-translucent:rgba(0, 0, 0, 0.175);--bs-border-radius:0.375rem;--bs-border-radius-sm:0.25rem;--bs-border-radius-lg:0.5rem;--bs-border-radius-xl:1rem;--bs-border-radius-xxl:2rem;--bs-border-radius-2xl:var(--bs-border-radius-xxl);--bs-border-radius-pill:50rem;--bs-box-shadow:0 0.5rem 1rem rgba(0, 0, 0, 0.15);--bs-box-shadow-sm:0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);--bs-box-shadow-lg:0 1rem 3rem rgba(0, 0, 0, 0.175);--bs-box-shadow-inset:inset 0 1px 2px rgba(0, 0, 0, 0.075);--bs-focus-ring-width:0.25rem;--bs-focus-ring-opacity:0.25;--bs-focus-ring-color:rgba(13, 110, 253, 0.25);--bs-form-valid-color:#198754;--bs-form-valid-border-color:#198754;--bs-form-invalid-color:#dc3545;--bs-form-invalid-border-color:#dc3545}[data-bs-theme=dark]{color-scheme:dark;--bs-body-color:#dee2e6;--bs-body-color-rgb:222,226,230;--bs-body-bg:#212529;--bs-body-bg-rgb:33,37,41;--bs-emphasis-color:#fff;--bs-emphasis-color-rgb:255,255,255;--bs-secondary-color:rgba(222, 226, 230, 0.75);--bs-secondary-color-rgb:222,226,230;--bs-secondary-bg:#343a40;--bs-secondary-bg-rgb:52,58,64;--bs-tertiary-color:rgba(222, 226, 230, 0.5);--bs-tertiary-color-rgb:222,226,230;--bs-tertiary-bg:#2b3035;--bs-tertiary-bg-rgb:43,48,53;--bs-primary-text-emphasis:#6ea8fe;--bs-secondary-text-emphasis:#a7acb1;--bs-success-text-emphasis:#75b798;--bs-info-text-emphasis:#6edff6;--bs-warning-text-emphasis:#ffda6a;--bs-danger-text-emphasis:#ea868f;--bs-light-text-emphasis:#f8f9fa;--bs-dark-text-emphasis:#dee2e6;--bs-primary-bg-subtle:#031633;--bs-secondary-bg-subtle:#161719;--bs-success-bg-subtle:#051b11;--bs-info-bg-subtle:#032830;--bs-warning-bg-subtle:#332701;--bs-danger-bg-subtle:#2c0b0e;--bs-light-bg-subtle:#343a40;--bs-dark-bg-subtle:#1a1d20;--bs-primary-border-subtle:#084298;--bs-secondary-border-subtle:#41464b;--bs-success-border-subtle:#0f5132;--bs-info-border-subtle:#087990;--bs-warning-border-subtle:#997404;--bs-danger-border-subtle:#842029;--bs-light-border-subtle:#495057;--bs-dark-border-subtle:#343a40;--bs-heading-color:inherit;--bs-link-color:#6ea8fe;--bs-link-hover-color:#8bb9fe;--bs-link-color-rgb:110,168,254;--bs-link-hover-color-rgb:139,185,254;--bs-code-color:#e685b5;--bs-highlight-color:#dee2e6;--bs-highlight-bg:#664d03;--bs-border-color:#495057;--bs-border-color-translucent:rgba(255, 255, 255, 0.15);--bs-form-valid-color:#75b798;--bs-form-valid-border-color:#75b798;--bs-form-invalid-color:#ea868f;--bs-form-invalid-border-color:#ea868f}*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:var(--bs-body-font-family);font-size:var(--bs-body-font-size);font-weight:var(--bs-body-font-weight);line-height:var(--bs-body-line-height);color:var(--bs-body-color);text-align:var(--bs-body-text-align);background-color:var(--bs-body-bg);-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;border:0;border-top:var(--bs-border-width) solid;opacity:.25}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2;color:var(--bs-heading-color)}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.1875em;color:var(--bs-highlight-color);background-color:var(--bs-highlight-bg)}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:rgba(var(--bs-link-color-rgb),var(--bs-link-opacity,1));text-decoration:underline}a:hover{--bs-link-color-rgb:var(--bs-link-hover-color-rgb)}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:var(--bs-font-monospace);font-size:1em}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:var(--bs-code-color);word-wrap:break-word}a>code{color:inherit}kbd{padding:.1875rem .375rem;font-size:.875em;color:var(--bs-body-bg);background-color:var(--bs-body-color);border-radius:.25rem}kbd kbd{padding:0;font-size:1em}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:var(--bs-secondary-color);text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]:not([type=date]):not([type=datetime-local]):not([type=month]):not([type=week]):not([type=time])::-webkit-calendar-picker-indicator{display:none!important}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}::file-selector-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}\n/* */\n  </style>\n  <style id=\"style-brick\">\n    #brick-viewport{display:flex;flex-direction:column}#brick-viewport>*{flex:1}.brick-linkReplace,.brick-active-passage{transition:opacity .4s}.brick-transparent{opacity:0}#ui-bar{background-color:var(--bs-secondary-bg);border-bottom:1px solid var(--bs-border-color);overflow-block:auto;padding:.5rem;width:100%}.brick-ui-btn{background-color:#364d63;border:1px solid var(--bs-secondary);padding-block:.25rem;transition:border-color .15s ease-in-out,background-color .15s ease-in-out}.brick-ui-btn:hover:enabled,.brick-ui-btn:focus{background-color:#3e5974}.brick-ui-btn:disabled{color:var(--bs-secondary)}#brick-history-controls{display:flex;flex-direction:row;text-align:center;width:100%;margin-bottom:.5rem}#brick-history-controls>*{flex-grow:1}#story-title{text-align:center}#brick-menu-core{width:100%;text-align:center;list-style:none;padding:0}#brick-menu-core button{width:100%}#brick-main{max-width:60rem}.brick-passage{padding:1rem}.brick-passage:not(:last-child){border-bottom:1px solid currentColor;padding-bottom:1rem}.brick-active-passage{margin-bottom:5rem;min-height:100vh}@media (min-width: 60rem){#brick-viewport{flex-direction:row}#ui-bar{border-bottom:0;border-right:1px solid var(--bs-border-color);height:100vh;height:100dvh;max-width:24rem;position:-webkit-sticky;position:sticky;top:0;width:auto}#brick-main{margin-inline:auto}.brick-active-passage{min-height:unset}}#brick-dialog{border-color:var(--bs-border-color);border-radius:.5rem;margin-top:2rem;max-width:min(95vw,50rem);max-width:min(95svw,50rem);min-width:min(95vw,30rem);min-width:min(95svw,30rem);overflow-x:auto}#brick-dialog::backdrop{-webkit-backdrop-filter:brightness(50%) blur(.25rem);backdrop-filter:brightness(50%) blur(.25rem)}#brick-dialog.brick-saves table{border:1px solid var(--bs-border-color);width:100%}#brick-dialog.brick-saves table :is(th,td){border:1px solid var(--bs-border-color);padding:.25rem}#brick-dialog.brick-saves table td:nth-child(3){width:100%}#brick-dialog.brick-saves table td:last-child button:enabled{background-color:var(--bs-danger)}#brick-dialog.brick-saves table td:last-child button:enabled:hover{background-color:inherit;color:var(--bs-danger)}.brick-link{padding:0;border:0;background:none;text-decoration:underline var(--bs-link-color);color:var(--bs-link-color)}.brick-link:hover:enabled{color:var(--bs-link-hover-color);-webkit-text-decoration-color:var(--bs-link-hover-color);text-decoration-color:var(--bs-link-hover-color)}.brick-link:disabled{color:var(--bs-secondary);cursor:not-allowed;-webkit-text-decoration-color:var(--bs-secondary);text-decoration-color:var(--bs-secondary)}.brick-text-secondary{color:var(--bs-secondary)}.brick-error{background-color:#5c0a0a;border-inline:.25rem solid red;line-height:2;padding:.25rem}.brick-error code{background-color:var(--bs-body-bg);color:var(--bs-body-color);padding:.125rem}.brick-saves-menu ul{border:1px solid currentColor;list-style:none;padding:0}.brick-saves-menu li:not(:first-child){border-top:1px solid currentColor}.brick-saves-menu li{display:flex;flex-direction:row;padding:.25rem}.brick-saves-menu li>div{flex-grow:1}.brick-saves-empty{color:var(--bs-secondary)}.brick-saves-buttons{display:flex;flex-direction:row;justify-content:space-between}\n\n  </style>\n</head>\n\n<body>\n  {{STORY_DATA}}\n  <div id=\"brick-viewport\">\n    <aside id=\"ui-bar\">\n      <div id=\"brick-history-controls\">\n        <button id=\"brick-history-backward\" class=\"brick-ui-btn\" type=\"button\">&#x2190;</button>\n        <button id=\"brick-history-forward\" class=\"brick-ui-btn\" type=\"button\">&#x2192;</button>\n      </div>\n      <h1 id=\"story-title\">{{STORY_NAME}}</h1>\n      <ul id=\"brick-menu-core\">\n        <li><button id=\"brick-saves\" class=\"brick-ui-btn\" type=\"button\">SAVES</button></li>\n        <li><button id=\"brick-restart\" class=\"brick-ui-btn\" type=\"button\">RESTART</button></li>\n      </ul>\n    </aside>\n\n    <main id=\"brick-main\">\n      <noscript>JavaScript must be enabled to play this story.</noscript>\n    </main>\n  </div>\n  <dialog id=\"brick-dialog\"></dialog>\n  <script id=\"script-brick\" type=\"text/javascript\">\"use strict\";(()=>{var Lt=Object.defineProperty;var Pe=e=>{throw TypeError(e)};var At=(e,t)=>{for(var n in t)Lt(e,n,{get:t[n],enumerable:!0})};var He=(e,t,n)=>t.has(e)||Pe(\"Cannot \"+n);var Re=(e,t,n)=>(He(e,t,\"read from private field\"),n?n.call(e):t.get(e)),_e=(e,t,n)=>t.has(e)?Pe(\"Cannot add the same private member more than once\"):t instanceof WeakSet?t.add(e):t.set(e,n),Ve=(e,t,n,r)=>(He(e,t,\"write to private field\"),r?r.call(e,n):t.set(e,n),n);var w={major:0,minor:2,patch:1,version:\"0.2.1\"};var P={maxLoopIterations:1e3,preProcessText:void 0,stream:!1};function Ct(e,t,n){throw new TypeError(\"\".concat(e,\": expected \").concat(t,\", got \").concat(typeof n))}var b={get maxLoopIterations(){return P.maxLoopIterations},set maxLoopIterations(e){if(typeof e!=\"number\"||e<=0||e%1!==0)throw new TypeError(\"Config.maxLoopIterations must be a positive integer\");P.maxLoopIterations=e},get preProcessText(){return P.preProcessText},set preProcessText(e){typeof e<\"u\"&&typeof e!=\"function\"&&Ct(\"Config.preProcessText\",\"function or undefined\",e),P.preProcessText=e},get stream(){return P.stream},set stream(e){P.stream=!!e}};var K={};At(K,{Passage:()=>C,filter:()=>Je,find:()=>Ft,get:()=>_,init:()=>ye,start:()=>ke,withTag:()=>Ot});var Bt=new Set(\"'\\\",()[]{}.!`?\");function H(e){return Array.from(e).map(t=>t>=\"a\"&&t<=\"z\"||t>=\"0\"&&t<=\"9\"?t:t>=\"A\"&&t<=\"Z\"||t>\"\\x7F\"?t.toLowerCase():Bt.has(t)?\"\":\"-\").join(\"\").replace(/-+/g,\"-\")}function Fe(e,t){let n=-1,r=0;for(;n=e.indexOf(t,n+1),n!==-1;)r++;return r}function T(e){switch(typeof e){case\"bigint\":case\"boolean\":case\"number\":case\"string\":case\"undefined\":return e;case\"symbol\":throw new Error(\"Symbols cannot be cloned\");case\"function\":throw new Error(\"Functions cannot be cloned\");case\"object\":if(e===null)return e;if(\"clone\"in e&&typeof e.clone==\"function\")return e.clone();if(e instanceof Array)return e.map(T);if(e instanceof Date)return new Date(e);if(e instanceof Map){let t=new Map;for(let[n,r]of e)t.set(T(n),T(r));return t}else{if(e instanceof RegExp)return new RegExp(e);if(e instanceof Set){let t=new Set;for(let n of e)t.add(T(n));return t}else{let t=Object.getPrototypeOf(e);if(t!==null&&t!==Object.prototype)throw new Error(\"Can't clone an object with an unknown prototype and no `.clone()` method\");let n={};for(let r in e)n[r]=T(e[r]);return n}}default:throw new Error(\"Unknown type: \".concat(typeof e))}}function Oe(e){if(e.length<1)throw new Error(\"either: array is empty\");return e[he(e.length)]}function te(e){let t=document.getElementById(e);if(!t)throw new Error('No element with id \"'.concat(e,'\" found'));return t}function he(e){return Math.floor(Math.random()*e)}var $t=0;function ge(){return\"brick-unique-id-\".concat($t++)}function c(e,t={},...n){let r=document.createElement(e);for(let s in t)r.setAttribute(s,t[s]);return r.append(...n),r}function*qe(e,t,n=1){let r;if(typeof t>\"u\"?(r=0,t=e):r=e,n>0)for(;r<t;)yield r,r+=n;else for(;r>t;)yield r,r+=n}function*je(e,t=0){let n=t;for(let r of e)yield[n,r],n++}var J,C=class{constructor(t){_e(this,J);var s;let n=t.getAttribute(\"pid\");if(!n)throw new Error(\"Passage has no pid: \"+t.outerHTML);let r=t.getAttribute(\"name\");if(!r)throw new Error(\"Passage \".concat(n,\" has no name\"));this.id=n,this.name=r,this.slug=H(r),this.tags=((s=t.getAttribute(\"tags\"))==null?void 0:s.split(\" \").filter(o=>o.length>=0))||[],Ve(this,J,t)}get content(){return Re(this,J).textContent}};J=new WeakMap;var Ht=[\"PassageDone\",\"PassageFooter\",\"PassageHeader\",\"PassageReady\",\"StoryAuthor\",\"StoryBanner\",\"StoryCaption\",\"StoryDisplayTitle\",\"StoryInit\",\"StoryInterface\",\"StoryMenu\",\"StorySettings\",\"StorySubtitle\",\"StoryTitle\"],Rt=[\"init\",\"script\",\"stylesheet\",\"Twine.audio\",\"Twine.image\",\"Twine.video\",\"Twine.vtt\",\"widget\",\"header\",\"footer\",\"startup\",\"debug-header\",\"debug-footer\",\"debug-startup\",\"nobr\"];function _t(e){if(Ht.includes(e))throw new Error('The passage name \"'.concat(e,'\" is not allowed'))}function Vt(e,t){for(let n of e)if(Rt.includes(n))throw new Error(\"The tag '\".concat(n,\"' on the passage \\\"\").concat(t,\" is not allowed\"))}var we=new Map,R=new Map,be;function ye(e){let t=e.getElementsByTagName(\"tw-passagedata\");for(let r of t){let s=new C(r),{id:o,name:i}=s;if(_t(s.name),s.name.startsWith(\"::\")&&console.warn('Found a passage named \"'.concat(i,'\". Although starting a passage name with \"::\" is allowed, this is likely a mistake.')),Vt(s.tags,i),we.has(o))throw new Error(\"Duplicate passage id \".concat(o));if(R.has(i))throw new Error(\"Duplicate passage name \".concat(i));s.content.trim()||console.warn(\"Passage \".concat(i,\" has no text.\")),we.set(o,s),R.set(i,s)}let n=e.getAttribute(\"startnode\");if(n){let r=we.get(n);if(!r)throw new Error(\"Could not determine starting passage; no passage with \".concat(n));be=r}else{let r=R.get(\"Start\");if(!r)throw new Error('Could not find a passage named \"Start\"');be=r}}function Je(e){let t=[];for(let n of R.values())e(n)&&t.push(n);return t}function Ft(e){for(let t of R.values())if(e(t))return t}function _(e){return R.get(e)}function ke(){return be}function Ot(e){return Je(t=>t.tags.includes(e))}var A=class extends Error{constructor(t,n,r){super(\"in \\u201C\".concat(n,\"\\u201D at line \").concat(r,\": \").concat(t)),this.passage=n,this.lineNumber=r}},B=class extends A{constructor(t,n){let r;try{r=\"@\".concat(t.name,\": \").concat(n instanceof Error?n.message:n)}catch(s){r=\"@\".concat(t.name,\": (error could not be converted to string)\")}super(r,t.passageName,t.lineNumber),this.cause=n}},ne=class extends A{constructor(t,n,r){let s;try{s='while evaluating the attribute \"'.concat(n,'\": ').concat(t instanceof Error?t.message:t)}catch(o){s='while evaluating the attribute \"'.concat(n,'\": (error could not be converted to string)')}super(s,r.passageName,r.lineNumber),this.cause=t}};var m={closeTag:/>/y,commentBlock:/\\*(?:[^])*?\\*\\//y,commentLine:/\\/.*\\n?/y,elementName:/([-\\p{ID_Continue}]+)(#[-\\p{ID_Continue}]+)?((?:\\.[-\\p{ID_Continue}]+)*)/uy,htmlAttr:/\\s*([-_\\p{ID_Start}][-\\p{ID_Continue}]*)=\"([^\"]*)\"/uy,htmlEvalAttr:/\\s*([-_\\p{ID_Start}][-\\p{ID_Continue}]*)=\\(/uy,js:{binaryOperator:/[%&*<=>^|]+/y,closingParen:/\\s*\\)/y,closingSquareBracket:/\\s*\\]/y,field:new RegExp(\"\\\\.\\\\p{ID_Start}[$\\\\p{ID_Continue}]*\",\"uy\"),identifier:new RegExp(\"\\\\p{ID_Start}[$\\\\p{ID_Continue}]*\",\"uy\"),number:/[0-9][0-9_]*/y,operator:/[!%&*+-<=>^|~]+/y,regexp:new RegExp(\"(?:[^\\\\\\\\[/]|\\\\\\\\[^]|\\\\[(?:[^\\\\\\\\\\\\]]|\\\\\\\\[^])*\\\\])*\\\\/(?:$|\\\\p{ID_Continue})*\",\"uy\"),stringDouble:/\"(?:[^\\\\\"]|\\\\[^])*\"/y,stringSingle:/'(?:[^\\\\']|\\\\[^])*'/y,normalInTemplateString:/(?:[^`$\\\\]|\\\\[^]|\\$(?!\\{))*/y},macroArgsStart:/ *\\(/y,macroBodyStart:/\\s*\\{/y,macroName:/[-_=<>\\p{ID_Start}][-=<>\\p{ID_Continue}]*/uy,maybeElementClose:/\\/[-\\p{ID_Continue}]+(?: *>)?/uy,normalChars:/[^[\\\\$_?<@/}]+/y,singleChar:/[^]/y,whitespace:/\\s*/y,wikiLink:/((?:[^\\\\\\]]|\\\\.)*)\\]\\]/y},qt=[\"base\",\"body\",\"link\",\"head\",\"html\",\"meta\",\"script\",\"style\",\"title\"],jt=[\"area\",\"base\",\"br\",\"col\",\"embed\",\"hr\",\"img\",\"input\",\"link\",\"meta\",\"param\",\"source\",\"track\",\"wbr\"];function re(e){return typeof e==\"object\"&&e.type===\"macro\"}var V=class{constructor(t,n,r){this.input=t,this.index=0,this.passageName=n,this.lineNumber=r||1}consume(t){t.lastIndex=this.index;let n=t.exec(this.input);return n&&(this.lineNumber+=Fe(n[0],\"\\n\"),this.index=t.lastIndex),n}lookahead(){return this.input[this.index]||null}locationSample(){if(this.input[this.index]===\"\\n\"){let r=this.input.lastIndexOf(\"\\n\",this.index-1)+1;return this.input.slice(r,this.index)}let t=this.input.lastIndexOf(\"\\n\",this.index-1)+1,n=this.input.indexOf(\"\\n\",this.index+1);return this.input.slice(t,n)}error(t){return{type:\"error\",passageName:this.passageName,lineNumber:this.lineNumber,message:t,locationSample:this.locationSample()}}parse(t){var s;let n=[],r=0;e:for(;this.index<this.input.length;){if(r>=1e6)return n.push(this.error(\"Parser stuck in infinite loop\")),n;r++;let o=this.index;if(this.consume(m.normalChars),this.index!==o&&n.push(this.input.substring(o,this.index)),t&&this.consume(t))return n;let i=(s=this.consume(m.singleChar))==null?void 0:s[0];switch(i){case\"\\\\\":{let a=this.consume(m.singleChar);n.push((a==null?void 0:a[0])||\"\\n\");break}case\"<\":n.push(this.parseElement());break;case\"@\":n.push(this.parseMacro());break;case\"/\":switch(this.lookahead()){case\"/\":this.consume(m.commentLine);break;case\"*\":if(!this.consume(m.commentBlock))return n.push(this.error(\"Missing trailing `*/` to close the block comment\")),n;break;default:n.push(i);break}break;case\"$\":{n.push(this.parseNakedVariable(\"story\"));break}case\"_\":{n.push(this.parseNakedVariable(\"temp\"));break}case\"[\":if(this.lookahead()===\"[\"){this.index++;let a=this.consume(m.wikiLink);if(!a){n.push(this.error(\"Unmatched `[[`\"));break}let l=a[1],d=l.includes(\"->\"),u=l.includes(\"<-\"),p=l.includes(\"|\"),L=Number(d)+Number(u)+Number(p);if(L>1)n.push(this.error(\"Link boxes can only have one of '->', '<-', or '|'\"));else if(L===0)n.push({type:\"linkBox\",passageName:this.passageName,lineNumber:this.lineNumber,link:l,text:l});else{let It=d?\"->\":u?\"<-\":\"|\";n.push(this.makeLinkBox(l,It))}}else n.push(\"[\");break;case\"}\":n.push(\"}\");break;case void 0:break e;default:throw new Error(\"Logic Error (\".concat(i,\")\"))}}return t&&!this.consume(t)&&n.push(this.error('Failed to match regex \"'.concat(t.source,'\"'))),n}parseElement(){let t=this.consume(m.elementName);if(!t){let l=this.consume(m.maybeElementClose);return l?this.error('Unexpected closing tag \"'.concat(l[0],'\"')):this.error('Element names can contain only hyphens, underscores, and ASCII letters and numbers. The \"<\" character must be escaped with a \"\\\\\" backslash if not used as an HTML element.')}let[,n,r,s]=t,o=new Map,i=new Map;for(r&&o.set(\"id\",r.slice(1)),s.length&&o.set(\"class\",s.replace(\".\",\" \").trim()),this.consume(m.whitespace);!this.consume(m.closeTag);){let l=this.consume(m.htmlAttr);if(l){let[d,u,p]=l;o.has(u)||i.has(u)?console.warn(\"Ignoring duplicate attribute '\".concat(u)):o.set(u,p)}else if(l=this.consume(m.htmlEvalAttr),l){let d=l[1],u=this.parseJsExpression();if(typeof u==\"object\")return u;if(u.trim()===\"\")return this.error('Empty JavaScript attribute \"'.concat(d,'\"'));if(this.lookahead()!==\")\")return this.error('No closing paren on dynamic attribute \"'.concat(d,'\"'));this.index++,o.has(d)||i.has(d)?console.warn(\"Ignoring duplicate attribute '\".concat(d)):i.set(d,u)}else return this.error(\"Missing trailing `>` to close the HTML tag\")}let a=jt.includes(n)?[]:this.parse(new RegExp(\"</\".concat(n,\">\"),\"y\"));return qt.includes(n)?this.error('Passages cannot contain \"<'.concat(n,'>\" elements')):{type:\"element\",passageName:this.passageName,lineNumber:this.lineNumber,name:n,attributes:o,evalAttributes:i,content:a}}parseNakedVariable(t){let n=this.index,r=this.consume(m.js.identifier);if(!r){let i=t===\"story\"?\"$\":\"_\";return this.error(\"\".concat(i,\" must be part of a \").concat(t,\" variable, \").concat(\"or escaped with a backslash `\\\\`\"))}let s=r[0],o=this.index;for(;;){switch(this.lookahead()){case\".\":if(r=this.consume(m.js.field),r)continue;break;case\"[\":this.index++,this.parseJsArgs(\"]\");continue;case\"(\":this.index++,this.parseJsArgs(\")\");continue}break}return this.index===o?{type:t,passageName:this.passageName,lineNumber:this.lineNumber,name:s}:{type:\"macro\",name:\"print\",args:[(t===\"story\"?\"Engine.vars.\":\"Engine.temp.\")+this.input.substring(n,this.index)],passageName:this.passageName,lineNumber:this.lineNumber}}parseMacro(){let t=this.consume(m.macroName),n;if(t)n=t[0];else if(this.lookahead()===\"(\")n=\"\";else return this.error(\"`@` must be followed by a macro name, or be escaped with a `\\\\`\");let r=null;if(this.consume(m.macroArgsStart)){let i=n===\"for\"?this.parseForArgs():this.parseJsArgs(\")\");if(\"type\"in i)return i;r=i}let s=this.consume(m.macroBodyStart);if(!r&&!s)return this.error(\"Macro invocations must be followed by `(` or `[`\");let o=s?this.parse(/\\}/y):void 0;return{type:\"macro\",name:n,args:r||[],content:o,passageName:this.passageName,lineNumber:this.lineNumber}}parseForArgs(){let t=this.consume(/\\s*([^]*?)\\s+of\\b/y);if(!t)return this.error(\"Syntax: @for(_VAR of EXPRESSION)\");let n=t[1],r=this.parseJsExpression();return typeof r==\"object\"?r:r.trim()===\"\"?this.error(\"Syntax: @for(_VAR of EXPRESSION)\"):this.consume(/\\s*\\)/y)?[n,r]:this.error(\"@for: missing closing ')'\")}parseJsArgs(t){let n=[],r;for(;r=this.parseJsExpression();){if(typeof r==\"object\")return r;if(n.push(r),!this.consume(/\\s*,/uy))break}return this.consume(m.whitespace),this.lookahead()!==t?this.error(\"Missing a closing `\".concat(t,\"`\")):(this.index++,n)}parseJsExpression(){let t=[],n=[],r=!0,s,o=0;e:for(;this.index<this.input.length;){if(this.index===o)throw new Error(\"Infinite loop at index \".concat(o,\" (\").concat(this.input[this.index],\")\"));if(o=this.index,s=this.consume(m.whitespace),s&&n.push(s[0]),s=this.consume(m.js.identifier),s){n.push(s[0]),r=!1;continue}if(s=this.consume(m.js.number),s){n.push(s[0]),r=!1;continue}if(s=this.consume(m.js.binaryOperator),s){n.push(s[0]),r=!0;continue}let i=this.lookahead();switch(i){case'\"':if(s=this.consume(m.js.stringDouble),s)n.push(s[0]),r=!1;else return this.error(\"Unclosed double-quoted string\");break;case\"'\":if(s=this.consume(m.js.stringSingle),s)n.push(s[0]),r=!1;else return this.error(\"Unclosed single-quoted string\");break;case\"`\":this.index++,n.push(i),this.parseJsTemplateString(n),r=!1;break;case\"(\":t.push(\")\"),n.push(i),this.index++,r=!0;break;case\"[\":t.push(\"]\"),n.push(i),this.index++,r=!0;break;case\"{\":t.push(\"}\"),n.push(i),this.index++,r=!1;break;case\"$\":if(this.index++,s=this.consume(m.js.identifier),s)n.push(\"Engine.vars.\",s[0]),r=!1;else return this.error(\"Illegal identifier\");break;case\"_\":if(this.index++,s=this.consume(m.js.identifier),s)n.push(\"Engine.temp.\",s[0]),r=!1;else return this.error(\"Illegal identifier\");break;case\",\":if(t.length>0)this.index++,n.push(i),r=!0;else break e;break;case\"#\":case\":\":case\";\":case\"?\":case\".\":r=!0,n.push(i),this.index++;break;case\"!\":this.index++,this.lookahead()===\"=\"?(this.index++,this.lookahead()===\"=\"?(this.index++,n.push(\"!==\")):n.push(\"!=\"),r=!0):(n.push(i),r=!1);break;case\"+\":case\"-\":{n.push(i),this.index++;let a=this.lookahead();a===i?(n.push(a),this.index++,r=!1):a===\"=\"?(this.index++,r=!0,n.push(\"=\")):r=!0}break;case\"~\":n.push(i),this.index++,r=!0;break;case\"/\":if(this.index++,this.consume(m.commentLine))n.push(\"\\n\");else if(s=this.consume(m.commentBlock))s[0].includes(\"\\n\")&&n.push(\"\\n\");else if(r){if(n.push(i),s=this.consume(m.js.regexp),!s)return this.error(\"Invalid RegExp literal\");n.push(s[0]),r=!1}else n.push(i),r=!0;break;default:if(i&&i===t[t.length-1]){this.index++,n.push(i),t.pop();break}if(![\")\",\"]\",\"}\"].includes(i||\"\"))return this.error(\"Can't handle unescaped \".concat(i,\" yet\"));break e}}return t.length>0?this.error('Expected a \"'.concat(t.pop(),'\"')):n.join(\"\")}parseJsTemplateString(t){for(;;){let n=this.consume(m.js.normalInTemplateString);n&&t.push(n[0]);let r=this.lookahead();if(!r)return this.error(\"Unclosed template string\");switch(r){case\"`\":t.push(r),this.index++;return;case\"$\":{this.index+=2,t.push(\"${\");let s=this.parseJsExpression();if(typeof s==\"object\")return s;if(t.push(s),this.lookahead()!==\"}\")return this.error('missing \"}\" inside template string');this.index++,t.push(\"}\");break}default:return this.error(\"Logic Error: '\".concat(r,\"' (U+\").concat(r.charCodeAt(0),\") was not matched by regex\"))}}}makeLinkBox(t,n){let r=t.split(n);if(r.length!==2){let s='Links in [[...]] can only contain \"'.concat(n,'\" once');return this.error(s)}return n===\"<-\"?{type:\"linkBox\",passageName:this.passageName,lineNumber:this.lineNumber,link:r[0],text:r[1]}:{type:\"linkBox\",passageName:this.passageName,lineNumber:this.lineNumber,link:r[1],text:r[0]}}};var W={BRICK_VERSION:w,Engine:{forward:ie,backward:oe,redo:Ue,get vars(){return E},get temp(){return x}},Config:b,Dialog:{showPassage:Ge},Passages:K,clone:T,either(e){if(arguments.length!==1)throw new Error(\"either(): exactly one argument required\");if(typeof e!=\"object\"||e===null)throw new Error(\"either(): first argument was not an array\");if(!(\"length\"in e)||typeof e.length!=\"number\")throw new Error(\"either(): first argument was not an array\");return Oe(e)},enumerate:je,makeElement:c,numberRange:qe,randomInt(e){if(arguments.length!==1)throw new Error(\"randomInt: exactly 1 argument required\");if(typeof e!=\"number\")throw new Error(\"randomInt: argument must be a number\");return he(e)},slugify:H};W.BRICK_VERSION.toString=function(){return this.version};var Ke=Object.keys(W),We=Object.values(W);function U(e){return new Function(...Ke,\"'use strict';\".concat(e))(...We)}function k(e){return U(\"return \"+e)}function se(e,t){new Function(...Ke,'\"use strict\"; '.concat(e,\" = arguments[arguments.length - 1]\"))(...We,t)}var v=class{constructor(t){if(t.name!==\"break\"&&t.name!==\"continue\")throw new Error('BreakError requires a \"break\" or \"continue\" context');this.context=t,this.type=t.name}toString(){return\"Signal from @\".concat(this.type,' in \"').concat(this.context.passageName,'\" line ').concat(this.context.lineNumber)}},F=class{constructor(t,n,r,s,o){this.name=t,this.content=o,this.passageName=n,this.lineNumber=r,s!=null&&s.captures&&(this.captures=s.captures)}createCallback(t){let n=this;return function(...s){if(!n.captures)return t.apply(this,s);let o={};for(let a of n.captures)a.name in o||(o[a.name]=x[a.name]),x[a.name]=a.value;let i;try{i=t.apply(this,s)}finally{Object.assign(x,o)}return i}}},G=new Map;function f(e,t){G.has(e)&&console.warn('Replacing an existing macro: \"'.concat(e,'\"')),G.set(e,t)}function ae(e,t){let n=G.get(e);if(!n)throw new Error('No macro \"'.concat(e,'\" found'));G.set(t,n)}function Ee(e){return G.get(e)||null}f(\"include\",{handler(...e){if(e.length<1||e.length>2)throw new Error(\"must be called with 1 argument\");let[t,n]=e;if(typeof t!=\"string\")throw new Error(\"first arg (passage name) must be a string\");if(typeof n<\"u\"&&typeof n!=\"string\")throw new Error(\"second arg (element type) must be a string or undefined\");let s=c(n||\"div\");return S(s,t),s}});f(\"\",{skipArgs:!0,handler(...e){return U(e.join(\", \")),document.createDocumentFragment()}});f(\"print\",{handler(...e){if(e.length!==1)throw new Error(\"requires 1 argument (got \".concat(e.length,\")\"));if(this.content)throw new Error(\"no body allowed\");return Array.isArray(e[0])&&e[0].toString===Array.prototype.toString?\"[\".concat(e[0].join(\", \"),\"]\"):String(e[0])}});ae(\"print\",\"-\");f(\"render\",{handler(...e){if(e.length!==1)throw new Error(\"requires 1 argument (got \".concat(e.length,\")\"));if(this.content)throw new Error(\"no body allowed\");let t=document.createDocumentFragment(),n=new V(String(e[0]),this.passageName,this.lineNumber);return h(t,n.parse()),t}});ae(\"render\",\"=\");f(\"link\",{handler(...e){if(e.length<1||e.length>3)throw new Error(\"requires 1, 2 or 3 arguments\");if(typeof e[0]!=\"string\")throw new Error(\"first argument (link text) must be a string\");let t=e[0],n,r;if(e.length===2)if(typeof e[1]==\"string\")n=e[1],r=void 0;else if(typeof e[1]==\"function\")n=void 0,r=e[1];else throw new Error(\"second argument must be a string or function\");else if(e.length===3){if(typeof e[1]==\"function\"&&typeof e[2]==\"string\")throw new Error(\"second argument must be a string and third argument must be a function\");if(typeof e[1]!=\"string\")throw new Error(\"second argument must be a string\");if(typeof e[2]!=\"function\")throw new Error(\"third argument must be a function\");n=e[1],r=e[2]}else console.warn(\"@link received only 1 argument. This link will do nothing when clicked.\"),n=void 0,r=void 0;let s=c(\"button\",{class:\"brick-link\",type:\"button\"},t);return n&&(s.dataset.linkDestination=n),s.addEventListener(\"click\",this.createCallback(function(o){r&&r.call(this,o),s.dataset.linkDestination&&ze(s.dataset.linkDestination)})),s}});f(\"linkReplace\",{handler(...e){if(e.length!==1)throw new Error(\"requires exactly 1 argument\");let[t]=e;if(typeof t!=\"string\")throw new Error(\"first arg (link text) must be a string\");let n=c(\"button\",{class:\"brick-link\",type:\"button\"},t);return n.addEventListener(\"click\",()=>{let r=c(\"span\",{class:\"brick-linkReplace brick-transparent\"});this.content&&h(r,this.content,this),n.replaceWith(r),setTimeout(()=>r.classList.remove(\"brick-transparent\"),40)}),n}});f(\"while\",{skipArgs:!0,handler(...e){if(e.some(o=>typeof o!=\"string\"))throw new Error(\"received a non-string arg\");let t=e.join(\",\"),n=document.createDocumentFragment(),{content:r}=this,s=1;for(;k(t);){if(s>b.maxLoopIterations)throw new Error(\"Too many iterations (Config.maxLoopIterations = \".concat(b.maxLoopIterations,\")\"));s++;try{if(!(r?h(n,r,this):!0))break}catch(o){if(o instanceof v){if(o.type===\"break\")break;continue}else throw o}}return n}});f(\"break\",{handler(){throw new v(this)}});f(\"continue\",{handler(){throw new v(this)}});f(\"for\",{skipArgs:!0,handler(...e){if(!e.every(u=>typeof u==\"string\"))throw new Error(\"received a non-string arg\");if(e.length!==2)throw new Error(\"requires exactly 2 arguments\");let[t,n]=e;if(!t.startsWith(\"_\"))throw new Error(\"loop variable must be a temp variable\");let r=t.substring(1),s=\"Engine.temp.\".concat(r),o=k(n);if(typeof o[Symbol.iterator]!=\"function\")throw new Error(\"Right-hand side must be an iterable value, such as an array\");let i=document.createDocumentFragment(),{content:a}=this,l=this.captures||[],d=1;for(let u of o){if(d>b.maxLoopIterations)throw new Error(\"Too many iterations (Config.maxLoopIterations = \".concat(b.maxLoopIterations,\")\"));d++,se(s,u),this.captures=[...l,{name:r,value:u}];try{if(!(a?h(i,a,this):!0))break}catch(p){if(p instanceof v){if(p.type===\"break\")break;continue}else throw p}}return this.captures=l,i}});f(\"checkBox\",{skipArgs:!0,handler(...e){if(e.length!==2)throw new Error(\"requires 2 arguments\");if(e.some(l=>typeof l!=\"string\"))throw new Error(\"both arguments must be strings\");let[t,n]=e,r=k(n);if(typeof r!=\"string\"&&!(r instanceof Node))throw new Error(\"label must be a string or Node\");let s=k(t),o=c(\"input\",{type:\"checkbox\",id:ge()});o.checked=!!s,o.addEventListener(\"change\",()=>se(t,o.checked));let i=c(\"label\",{for:o.id},r);return c(\"div\",{},o,\" \",i)}});f(\"textBox\",{skipArgs:!0,handler(...e){if(e.length!==2)throw new Error(\"requires 2 arguments\");if(!e.every(l=>typeof l==\"string\"))throw new Error(\"both arguments must be strings\");let[t,n]=e,r=k(n);if(typeof r!=\"string\"&&!(r instanceof Node))throw new Error(\"label must be a string or Node\");let s=String(k(t)||\"\"),o=c(\"input\",{id:ge(),type:\"text\",value:s});o.addEventListener(\"keyup\",()=>se(t,o.value));let i=c(\"label\",{for:o.id},r);return c(\"div\",{},o,\" \",i)}});f(\"switch\",{handler(...e){if(e.length!==1)throw new Error(\"requires 1 arg\");if(!this.content)throw new Error(\"requires a body\");let[t]=e,n=[];for(let s of this.content)if(typeof s==\"string\"){if(s.trim())throw new Error(\"all children must be @case macros\")}else if(s.type===\"macro\")n.push(s);else throw new Error(\"all children must be @case macros\");for(let s=0;s<n.length;s++){let o=n[s];if(o.name===\"default\"){if(s!==n.length-1)throw new Error(\"@default must be the last macro\");if(o.args.length>0)throw new Error(\"@default cannot receive any arguments\")}else{if(o.name!==\"case\")throw new Error(\"all children must be @case macros\");if(o.args.length===0)throw new Error(\"@case macro requires at least one argument\")}}let r=document.createDocumentFragment();for(let s of n){if(s.name===\"default\")return s.content&&h(r,s.content,this),r;for(let o of s.args){let i=k(o);if(t===i)return s.content&&h(r,s.content,this),r}}return r}});f(\"if\",{trailingMacros:[\"elseif\",\"else\"],handler(){if(!this.content)throw new Error(\"no child templates\");for(let e of this.content){if(!re(e))throw new Error(\"child was not a MacroTemplate\");if(e.name===\"else\"||k(e.args.join(\",\"))){let t=document.createDocumentFragment();return e.content&&h(t,e.content,this),t}}return document.createDocumentFragment()}});f(\"redoable\",{handler(){let{content:e}=this;if(!e)throw new Error(\"must be called with a body\");let t=c(\"span\",{class:\"brick-macro-redoable\"});try{this.content&&h(t,this.content,this)}catch(n){throw n instanceof v?new B(n.context,\"Can't @\".concat(n.type,\" from inside @\").concat(this.name)):n}return t.addEventListener(\"brick-redo\",()=>{t.innerHTML=\"\",this.content&&h(t,this.content,this)}),t}});f(\"later\",{handler(...e){if(e.length!==0&&e.length!==1)throw new Error(\"does not take any args\");let t=40;if(e.length===1){if(typeof e[0]!=\"number\")throw new Error(\"first argument must be a number\");t=e[0]}let{content:n}=this;if(!n)throw new Error(\"requires a body\");let r=c(\"span\",{class:\"brick-macro-later\",hidden:\"\"});return setTimeout(this.createCallback(()=>{let s=document.createDocumentFragment();h(s,n),r.replaceWith(s)}),t),r}});f(\"replace\",{handler(...e){if(e.length!==1)throw new Error(\"requires exactly one argument\");if(typeof e[0]!=\"string\")throw new Error(\"first argument must be a string\");let t=document.querySelector(e[0]);if(!t)throw new Error(\"The selector '\".concat(e[0],\"' did not match any elements\"));let n=document.createDocumentFragment();if(this.content)h(n,this.content,this);else if(this.name!==\"replace\")throw new Error('no content provided. Use \"{}\" to provide content.');switch(this.name){case\"append\":t.append(n);break;case\"prepend\":t.prepend(n);break;case\"replace\":t.innerHTML=\"\",t.append(n);break;default:throw new Error(\"Unknown name. Call this macro only with @append, @prepend, or @replace\")}return\"\"}});ae(\"replace\",\"append\");ae(\"replace\",\"prepend\");f(\"punt\",{skipArgs:!0,handler(...e){if(this.content)throw new Error(\"Does not take content\");if(e.length===0)throw new Error(\"requires at least one argument\");if(!e.every(t=>typeof t==\"string\"))throw new Error(\"received a non-string arg\");if(!e.every(t=>t.startsWith(\"Engine.temp.\")))throw new Error(\"only temp variables can be punted\");for(let t of e)Xe(t.slice(12));return\"\"}});function z(e){return console.error(e),c(\"span\",{class:\"brick-error\"},String(e))}function S(e,t){if(typeof t==\"string\"){let n=_(t);return n?S(e,n):(e.innerHTML=\"\",e.append(c(\"span\",{class:\"brick-error\"},'No passage named \"'.concat(t,'\" found'))),!1)}return e.innerHTML=\"\",e.classList.add(\"psg-\".concat(t.slug)),e.dataset.name=t.name,e.dataset.tags=t.tags.join(\" \"),h(e,t)}var ce=1e3,ve=!1;function h(e,t,n){if(ve)return!1;if(ce<=0){let s=(n==null?void 0:n.passageName)||t instanceof C&&t.name||\"unknown\",o=(n==null?void 0:n.lineNumber)||0,i=new A(\"Infinite recursion detected\",s,o);return e.append(z(i)),ve=!0,!1}let r=!1;try{ce--,r=Jt(e,t,n)}finally{ce++,ce>=1e3&&(ve=!1)}return r}function Jt(e,t,n){let r=!0;if(t instanceof C){let s=b.preProcessText?b.preProcessText(t):t.content;if(typeof s!=\"string\")throw new TypeError(\"Config.preProcessText returned a \".concat(typeof s,\", expected a string\"));let o=new V(s,t.name);return h(e,o.parse(),n)}for(let s=0;s<t.length;s++){let o=t[s],i;if(typeof o==\"string\"){i=o;let a=i.split(\"\\n\\n\"),l=a.shift();if(typeof l==\"string\")for(e.append(l);typeof(l=a.shift())==\"string\";)e.append(c(\"br\")),e.append(c(\"br\")),e.append(l)}else if(o.type===\"macro\"){let a=Ee(o.name);if(!a){let u=new A('Macro not found: \"'.concat(o.name,'\"'),o.passageName,o.lineNumber);e.append(z(u)),r=!1;continue}let l,d;if(a.trailingMacros){let u=[o];for(let p=s+1;p<t.length;p++){let L=t[p];if(re(L)&&a.trailingMacros.includes(L.name))u.push(L),s=p;else if(!(typeof L==\"string\"&&!L.trim()))break}l=new F(o.name,o.passageName,o.lineNumber,n,u),d=[]}else d=a.skipArgs?o.args:o.args.map(u=>k(u)),l=new F(o.name,o.passageName,o.lineNumber,n,o.content);try{let u=a.handler.apply(l,d);e.append(u)}catch(u){if(u instanceof v)throw u;let p=u instanceof B?u:new B(l,u);e.append(z(p))}}else if(o.type===\"element\")r=Kt(o,e,n)||r;else if(o.type===\"linkBox\"){let a=Ee(\"link\");if(!a)throw new Error(\"Can't find @link macro for wiki-style [[link]]\");if(!o.text)throw new Error(\"The text of a [[link box]] cannot be empty\");let l=new F(\"link\",o.passageName,o.lineNumber);e.append(a.handler.call(l,o.text,o.link))}else if(o.type===\"error\")r=!1,e.append(z(new A(o.message,o.passageName,o.lineNumber)));else{let a=(o.type===\"story\"?E:x)[o.name];Array.isArray(a)&&a.toString===Array.prototype.toString?e.append(\"[\".concat(a.join(\", \"),\"]\")):e.append(String(a))}}return r}function Kt(e,t,n){let r=c(e.name);for(let[o,i]of e.attributes)r.setAttribute(o,i);for(let[o,i]of e.evalAttributes)try{let a=String(k(i));r.setAttribute(o,a)}catch(a){if(a instanceof v)throw a;return t.append(z(new ne(a,o,e))),!1}let s=h(r,e.content,n);return t.append(r),s}var Me=(e,t)=>t.some(n=>e instanceof n),Ye,Ze;function Wt(){return Ye||(Ye=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ut(){return Ze||(Ze=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Se=new WeakMap,Ne=new WeakMap,le=new WeakMap;function Gt(e){let t=new Promise((n,r)=>{let s=()=>{e.removeEventListener(\"success\",o),e.removeEventListener(\"error\",i)},o=()=>{n($(e.result)),s()},i=()=>{r(e.error),s()};e.addEventListener(\"success\",o),e.addEventListener(\"error\",i)});return le.set(t,e),t}function zt(e){if(Se.has(e))return;let t=new Promise((n,r)=>{let s=()=>{e.removeEventListener(\"complete\",o),e.removeEventListener(\"error\",i),e.removeEventListener(\"abort\",i)},o=()=>{n(),s()},i=()=>{r(e.error||new DOMException(\"AbortError\",\"AbortError\")),s()};e.addEventListener(\"complete\",o),e.addEventListener(\"error\",i),e.addEventListener(\"abort\",i)});Se.set(e,t)}var Ie={get(e,t,n){if(e instanceof IDBTransaction){if(t===\"done\")return Se.get(e);if(t===\"store\")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return $(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t===\"done\"||t===\"store\")?!0:t in e}};function nt(e){Ie=e(Ie)}function Xt(e){return Ut().includes(e)?function(...t){return e.apply(Le(this),t),$(this.request)}:function(...t){return $(e.apply(Le(this),t))}}function Yt(e){return typeof e==\"function\"?Xt(e):(e instanceof IDBTransaction&&zt(e),Me(e,Wt())?new Proxy(e,Ie):e)}function $(e){if(e instanceof IDBRequest)return Gt(e);if(Ne.has(e))return Ne.get(e);let t=Yt(e);return t!==e&&(Ne.set(e,t),le.set(t,e)),t}var Le=e=>le.get(e);function rt(e,t,{blocked:n,upgrade:r,blocking:s,terminated:o}={}){let i=indexedDB.open(e,t),a=$(i);return r&&i.addEventListener(\"upgradeneeded\",l=>{r($(i.result),l.oldVersion,l.newVersion,$(i.transaction),l)}),n&&i.addEventListener(\"blocked\",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener(\"close\",()=>o()),s&&l.addEventListener(\"versionchange\",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),a}var Zt=[\"get\",\"getKey\",\"getAll\",\"getAllKeys\",\"count\"],Qt=[\"put\",\"add\",\"delete\",\"clear\"],Te=new Map;function Qe(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t==\"string\"))return;if(Te.get(t))return Te.get(t);let n=t.replace(/FromIndex$/,\"\"),r=t!==n,s=Qt.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Zt.includes(n)))return;let o=async function(i,...a){let l=this.transaction(i,s?\"readwrite\":\"readonly\"),d=l.store;return r&&(d=d.index(a.shift())),(await Promise.all([d[n](...a),s&&l.done]))[0]};return Te.set(t,o),o}nt(e=>({...e,get:(t,n,r)=>Qe(t,n)||e.get(t,n,r),has:(t,n)=>!!Qe(t,n)||e.has(t,n)}));var en=[\"continue\",\"continuePrimaryKey\",\"advance\"],et={},Ae=new WeakMap,st=new WeakMap,tn={get(e,t){if(!en.includes(t))return e[t];let n=et[t];return n||(n=et[t]=function(...r){Ae.set(this,st.get(this)[t](...r))}),n}};async function*nn(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;let n=new Proxy(t,tn);for(st.set(n,t),le.set(n,Le(t));t;)yield n,t=await(Ae.get(n)||t.continue()),Ae.delete(n)}function tt(e,t){return t===Symbol.asyncIterator&&Me(e,[IDBIndex,IDBObjectStore,IDBCursor])||t===\"iterate\"&&Me(e,[IDBIndex,IDBObjectStore])}nt(e=>({...e,get(t,n,r){return tt(t,n)?nn:e.get(t,n,r)},has(t,n){return tt(t,n)||e.has(t,n)}}));var ot,N;var it=[];async function at(e,t){ot=\"brick.\".concat(H(e),\".\").concat(t),N=await rt(ot,1,{upgrade(n,r,s,o,i){n.createObjectStore(\"moments\",{autoIncrement:!0}),n.createObjectStore(\"histories\",{autoIncrement:!0,keyPath:\"id\"})}}),await sn()}async function sn(){let e=N.transaction(N.objectStoreNames,\"readwrite\"),t=e.objectStore(\"moments\");if(await t.count()>1e3){let r=await e.objectStore(\"histories\").getAll(),s=new Set;for(let a of r)for(let l of a.momentIds)s.add(l);let o=await t.openCursor(),i=[];for(;o;)s.has(o.key)||i.push(o.delete()),o=await o.continue();await Promise.all(i)}await e.done}async function ct(e){let t=await N.get(\"moments\",e);if(!t)throw new Error(\"Could not load moment \".concat(e));return{...t,vars:gt(t.vars)}}async function De(e){let t={...e,vars:Y(e.vars)};return await N.put(\"moments\",t)}async function lt(e){return await N.get(\"histories\",e)}async function ut(){return await N.getAll(\"histories\",IDBKeyRange.upperBound(\"\"))}async function mt(e,t,n){let r={id:\"active\",momentIds:e,index:t,timestamp:Date.now(),title:n};await N.put(\"histories\",r)}async function dt(e,t,n){let r={momentIds:e,index:t,timestamp:Date.now(),title:n};return r.id=await N.put(\"histories\",r),r}async function ft(){return await N.delete(\"histories\",\"active\")}async function pt(){return await N.delete(\"histories\",IDBKeyRange.upperBound(\"\"))}async function ht(e){return await N.delete(\"histories\",e)}function gt(e){for(let t in Object.keys(e)){let n=e[t];typeof n==\"object\"&&n!==null&&(e[t]=gt(n))}if(e instanceof Array&&typeof e[0]==\"string\")if(e[0].startsWith(\"!brick-revive:\")){let t=e[0].substring(14);if(e.length!==2)throw new Error(\"malformed save data\");let n=it.find(r=>r.name===t);if(!n)throw new Error(\"malformed save data\");return n.deserialize(e[1])}else/^!{2,}brick-revive:/.test(e[0])&&(e[0]=e[0].substring(1));else if(e instanceof Map){let t=new Map;for(let[n,r]of e)typeof n==\"object\"&&n&&(n=Y(n)),typeof r==\"object\"&&r&&(r=Y(r)),t.set(n,r);return t}else if(e instanceof Set){let t=new Set;for(let n of e)typeof n==\"object\"&&n&&(n=Y(n)),t.add(n);return t}return e}function X(e){switch(typeof e){case\"boolean\":case\"string\":case\"number\":case\"undefined\":case\"bigint\":return e;case\"function\":case\"symbol\":throw new Error(\"Cannot serialize a \".concat(typeof e));case\"object\":return e===null?null:Y(e)}}function Y(e){if(Array.isArray(e))return typeof e[0]==\"string\"&&/^!+brick-revive:/.test(e[0])?[\"!\"+e[0],...e.slice(1)]:e;if(e instanceof Map){let r=new Map;for(let[s,o]of e)r.set(X(s),X(o));return r}if(e instanceof Set){let r=new Set;for(let s of e)r.add(X(s));return r}if(e instanceof Date||e instanceof RegExp)return e;for(let r of it)if(e instanceof r.constructor)return[\"!brick-revive:\".concat(r.name),X(r.serialize(e))];let t=Object.getPrototypeOf(e);if(t!==null&&t!==Object.prototype)throw new Error(\"Can't serialize an object with an unknown prototype\");let n={};for(let r in e)n[r]=X(e[r]);return n}var O,M,D,g,ue,q,j,E,x;async function bt(){O=te(\"brick-main\"),O.innerHTML=\"\",M=[],D=[],g=-1,ue=0,q=\"\",E={},x={},j=[]}async function yt(){if(!await Ce(\"active\")){let e={passageName:ke().name,timestamp:Date.now(),turnCount:1,vars:E};D=[e],M=[await De(e)],g=0,de(),await me(),Z()}}async function me(){let e=D[g];e||(e=await ct(M[g]),D[g]=e),E=T(e.vars),ue=e.turnCount,q=e.passageName}async function oe(){if(g===0)return!1;if(b.stream){let e=Array.from(document.querySelectorAll(\".brick-passage\"));for(let t of e.slice(-2))t.remove()}return g--,await me(),de(),Z(),!0}async function ie(){return g===M.length-1?!1:(g++,await me(),de(),Z(),!0)}async function ze(e){q=typeof e==\"string\"?e:e.name,M.length=g+1,D.length=g+1,j.length>0&&(E[\"-brick-punted\"]=j.map(n=>[n,x[n]]));let t={passageName:q,timestamp:Date.now(),turnCount:ue,vars:T(E)};D.push(t),M.push(await De(t)),g++,de(),Z()}async function kt(){return await dt(M,g,Et())}async function Ce(e){let t=await lt(e);if(t)M=t.momentIds,D=Array(M.length),D.fill(void 0),g=t.index;else return!1;return await me(),O.innerHTML=\"\",Z(),!0}function Et(){return\"\".concat(q,\" | Turn \").concat(ue)}function de(){return mt(M,g,Et())}function Z(){if(x={},j=[],E[\"-brick-punted\"]instanceof Array)for(let[r,s]of E[\"-brick-punted\"])typeof r!=\"string\"?console.warn(\"non-string key in $-brick-punted\"):x[r]=s;if(delete E[\"-brick-punted\"],b.stream){for(let r of O.querySelectorAll(\":enabled\"))r.setAttribute(\"disabled\",\"\");for(let r of document.querySelectorAll(\".brick-active-passage\"))r.classList.remove(\"brick-active-passage\")}else O.innerHTML=\"\";let e=c(\"article\",{class:\"brick-passage brick-active-passage brick-transparent\"});S(e,q);let t=_(\"StoryHeader\"),n=_(\"StoryFooter\");if(t){let r=c(\"header\");S(r,t),e.prepend(r)}if(n){let r=c(\"footer\");S(r,n),e.append(r)}O.append(e),e.scrollIntoView(),setTimeout(()=>e.classList.remove(\"brick-transparent\"),40)}function xt(){ft(),window.location.reload()}function Ue(){for(let e of document.querySelectorAll(\".brick-macro-redoable\"))e.dispatchEvent(new CustomEvent(\"brick-redo\"))}function Xe(e){j.includes(e)&&console.warn(\"_\".concat(e,\" was already punted\")),j.push(e)}var y,Q,I;function vt(){let e=te(\"brick-dialog\");if(e instanceof HTMLDialogElement)y=e;else throw new Error(\"#brick-dialog was not a <dialog> element\");fe(),y.addEventListener(\"click\",t=>{let n=y.getBoundingClientRect(),{clientX:r,clientY:s}=t;n.top<=s&&s<=n.top+n.height&&n.left<=r&&r<=n.left+n.width||y.close()})}function fe(){y.innerHTML=\"\",y.className=\"\",Q=c(\"h1\");let e=c(\"div\",{},Q);I=c(\"div\"),y.append(e,I)}function Ge(e){fe(),Q.append(e),S(I,e),y.showModal()}async function Nt(){fe(),Q.append(\"Saves\"),I.append(\"Loading...\"),y.classList.add(\"brick-saves-menu\"),y.showModal();let e=await ut();e.sort((s,o)=>o.timestamp-s.timestamp);let t=await Promise.all(e.map(Tt));I.innerHTML=\"\";let n=c(\"ul\");I.append(n),t.length===0?n.append(c(\"li\",{class:\"brick-saves-empty\"},c(\"em\",{},\"No saves found\"))):n.append(...t);let r=c(\"div\",{class:\"brick-saves-buttons\"});Be(n,r),I.append(r)}function Be(e,t){let n=c(\"button\",{class:\"brick-ui-btn\"},\"Delete\");n.addEventListener(\"click\",()=>{for(let i of e.querySelectorAll(\"button\"))i.removeEventListener(\"click\",$e),i.addEventListener(\"click\",Mt),i.textContent=\"Delete\";on(e,t)});let r=c(\"button\",{class:\"brick-ui-btn\"},\"Export\");r.addEventListener(\"click\",()=>alert(\"Not supported yet\"));let s=c(\"button\",{class:\"brick-ui-btn\"},\"Import\");s.addEventListener(\"click\",()=>alert(\"Not supported yet\"));let o=c(\"button\",{class:\"brick-ui-btn\"},\"Save\");o.addEventListener(\"click\",async()=>{var a;let i=await kt();(a=e.querySelector(\".brick-saves-empty\"))==null||a.remove(),e.prepend(Tt(i))}),t.innerHTML=\"\",t.append(n,r,s,o)}function on(e,t){let n=c(\"button\",{class:\"brick-ui-btn\",disabled:\"\"},\"Delete All\");n.addEventListener(\"click\",async function(){this.disabled=!0,await pt(),e.innerHTML=\"\",e.append(c(\"li\",{},c(\"em\",{},\"No saves found\"))),Be(e,t)}),setTimeout(()=>{n.disabled=!1},3e3);let r=c(\"button\",{class:\"brick-ui-btn\"},\"Cancel\");r.addEventListener(\"click\",()=>{for(let s of e.querySelectorAll(\"button\"))s.removeEventListener(\"click\",Mt),s.addEventListener(\"click\",$e),s.textContent=\"Load\";Be(e,t)}),t.innerHTML=\"\",t.append(n,r)}function Tt(e){let t=new Date(e.timestamp).toLocaleString(),{id:n}=e;if(!n)throw new Error(\"Tried to create a save menu entry for an unsaved History\");let r=c(\"button\",{class:\"brick-ui-btn\",\"data-brick-history-id\":String(n)},\"Load\");return r.addEventListener(\"click\",$e),c(\"li\",{},c(\"div\",{},e.title,c(\"br\"),c(\"small\",{},t)),r)}async function $e(){let e=Number(this.dataset.brickHistoryId);if(e!==e)throw new Error('Tried to load invalid ID \"'.concat(this.dataset.brickHistoryId));if(y.close(),!await Ce(e))throw new Error(\"Could not load history #\".concat(e))}async function Mt(){var n,r;let e=Number(this.dataset.brickHistoryId);if(e!==e)throw new Error('Tried to delete invalid ID \"'.concat(this.dataset.brickHistoryId));await ht(e);let t=(n=this.parentElement)==null?void 0:n.parentElement;(r=this.parentElement)==null||r.remove(),t&&t.childElementCount===0&&t.append(c(\"li\",{class:\"brick-saves-empty\"},c(\"em\",{},\"No saves found\")))}function St(){fe(),Q.textContent=\"Restart\",I.append(c(\"p\",{},\"Are you sure you would like to restart?\"));let e=c(\"button\",{class:\"brick-ui-btn\"},\"Restart\");e.addEventListener(\"click\",xt);let t=c(\"button\",{class:\"brick-ui-btn\"},\"Cancel\");t.addEventListener(\"click\",()=>y.close()),I.append(e,t),y.showModal()}window.addEventListener(\"error\",e=>{let{error:t}=e,n=\"\";t instanceof Error?(n+=\"Fatal Error!\\n\",n+=t.toString(),t.stack&&(n+=\"\\n\"+t.stack)):t instanceof v?n+=\"@\".concat(t.type,' was called outside a loop, at \"').concat(t.context.passageName,'\" line ').concat(t.context.lineNumber):(n+=\"Non-error object was thrown and not caught:\\n\",n+=String(e)),alert(n)});window.addEventListener(\"unhandledrejection\",e=>{let{reason:t}=e;alert(\"Fatal Error!\\n\".concat(t))});window.Brick=W;var ee=document.getElementsByTagName(\"tw-storydata\")[0];ye(ee);var cn=ee.querySelectorAll('style[type=\"text/twine-css\"]'),ln=ee.querySelectorAll('script[type=\"text/twine-javascript\"]'),un=ee.getAttribute(\"name\")||(()=>{throw new Error(\"Story has no title\")})(),mn=ee.getAttribute(\"ifid\")||\"00000000-0000-4000-A000-000000000000\";for(let e of cn){let t=c(\"style\",{class:\"brick-author-style\"},e.textContent);document.head.appendChild(t)}function pe(e,t){var n;(n=document.getElementById(e))==null||n.addEventListener(\"click\",t)}pe(\"brick-history-backward\",oe);pe(\"brick-history-forward\",ie);pe(\"brick-saves\",Nt);pe(\"brick-restart\",St);async function dn(){vt(),await at(un,mn),await bt();for(let e of ln)U(e.textContent);await yt()}dn();})();\n</script>\n</body>\n\n</html>\n","hydrate":"\"use strict\";function startState(){return{blockComment:!1,expectMacroBody:!1,js:!1,nesting:[],jsNesting:[]}}const KEYWORDS=\"break case catch class const continue debugger default delete do else export extends false finally for function if import in instanceof new null return super switch this throw true try typeof var void while with let static yield await enum implements interface package private protected public arguments as async eval from get of set undefined\".split(\" \"),OPERATORS=[\"!\",\"!=\",\"!==\",\"%\",\"%=\",\"&\",\"&&\",\"&=\",\"&&=\",\"*\",\"**\",\"*=\",\"**=\",\"+\",\"++\",\"+=\",\"-\",\"--\",\"-=\",\"/\",\"/=\",\"<\",\"<<\",\"<=\",\"<<=\",\"=\",\"==\",\"===\",\">\",\">>\",\">>>\",\">=\",\">>=\",\">>>=\",\"^\",\"^=\",\"|\",\"||\",\"|=\",\"||=\",\"~\"],RE_NUMBER_ERROR=/^[0-9.a-fA-F]+n?/,RE_NUMBER_LEADING_ZERO=/^(?:[bB](?:_?[01])+n?|[oO](?:_?[0-7])+n?|[xX](?:_?[0-9a-fA-F])+n?|n|(?:\\.(?:_?[0-9])*)?(?:[eE](?:_?[0-9])+)?)/,RE_POSTNUMBER_ERROR=/^[0-9\\p{ID_Start}]/u;function postNumberCheck(e){return e.match(RE_POSTNUMBER_ERROR)?\"error number\":\"number\"}function tokenJsNumber(e,n){if(n===\"0\"){if(e.match(RE_NUMBER_LEADING_ZERO))return postNumberCheck(e);if(e.eol()||e.peek().match(/^[^0-9\\p{ID_Start}]/u))return postNumberCheck(e)}else if(n===\".\"){if(e.match(/^(?:_?[0-9])+(?:[eE](?:_?[0-9])+)?/))return postNumberCheck(e)}else if(e.match(/^(?:(?:_?[0-9])*(?:\\.(?:_?[0-9])*)?(?:[eE](?:_?[0-9])+)?|(?:_?[0-9])*n)/))return postNumberCheck(e);return e.match(RE_NUMBER_ERROR),\"error number\"}function tokenJs(e,n){if(e.match(/^[!%&*+\\-<=>^|~]+/))return OPERATORS.includes(e.current())?\"operator\":\"error operator\";if(e.match(/^[$_a-zA-Z][$_a-zA-Z0-9]*/))return[\"$\",\"_\"].includes(e.current()[0])?\"variable-3\":KEYWORDS.includes(e.current())?\"keyword\":\"variable\";const r=e.next();if(r>=\"0\"&&r<=\"9\"||r===\".\"&&e.peek()>=\"0\"&&e.peek()<=\"9\")return tokenJsNumber(e,r);switch(r){case\"/\":return e.peek()===\"/\"?(e.skipToEnd(),\"comment\"):e.peek()===\"*\"?(e.next(),n.blockComment=!0,\"comment\"):(e.eat(\"=\"),\"operator\");case\"(\":return n.jsNesting.push(\")\"),\"bracket\";case\"{\":return n.jsNesting.push(\"}\"),\"bracket\";case\"[\":return n.jsNesting.push(\"]\"),\"bracket\";case\")\":case\"}\":case\"]\":return r===n.jsNesting[n.jsNesting.length-1]?(n.jsNesting.pop(),n.jsNesting.length===0?(n.js=!1,n.expectMacroBody=!0,e.eatSpace(),\"variable-2\"):\"bracket\"):\"bracket error\";case'\"':return e.match(/^(?:[^\\\\\"]|\\\\[^]])*\"/)?\"string\":(e.skipToEnd(),\"string error\");case\"'\":return e.match(/^(?:[^\\\\']|\\\\[^])*'/)?\"string\":(e.skipToEnd(),\"string error\");default:return e.eatSpace(),null}}function token(e,n){if(n.blockComment)return e.match(/^[^]*?\\*\\//)?n.blockComment=!1:e.skipToEnd(),\"comment\";if(n.js)return tokenJs(e,n);const r=e.next();if(n.expectMacroBody&&(n.expectMacroBody=!1,r===\"{\"))return n.nesting.push(\"}\"),\"bracket\";switch(r){case\"$\":case\"_\":return e.match(/^[$_a-zA-Z]/)?(e.match(/^[$_a-zA-Z0-9]*/),\"variable-3\"):\"error\";case\"/\":return e.peek()===\"/\"?(e.skipToEnd(),\"comment\"):e.peek()===\"*\"?(e.next(),n.blockComment=!0,\"comment\"):null;case\"@\":return e.match(/^[a-zA-Z]*\\s*\\(/)?(n.jsNesting=[\")\"],n.js=!0,\"variable-2\"):e.match(/^[a-zA-Z]*\\s*\\{/)?(e.backUp(1),n.expectMacroBody=!0,\"variable-2\"):\"error\";case\"}\":return n.nesting[n.nesting.length-1]===\"}\"?(n.nesting.pop(),\"bracket\"):null;case\"\\\\\":return e.next()?\"atom\":\"error\";default:return e.match(/^[^$_/@{}\\\\]*/),null}}function mode(){return{startState,token}}this.editorExtensions={twine:{\"^2.0.0\":{codeMirror:{mode}}}};\n","url":"https://github.com/cjneidhart/brick","license":"GPL-3.0"});