window.storyFormat({"name":"Brick","version":"0.2.0","author":"Chris Neidhart","image":"icon.svg","description":"A modern story format with a JavaScript-like syntax, and a focus on performance and simplicity.<br><br><a href=\"https://github.com/cjneidhart/brick\">Homepage</a>","source":"<!DOCTYPE html>\n<html lang=\"en-US\" data-bs-theme=\"dark\">\n\n<head>\n  <meta charset=\"utf-8\">\n  <title>{{STORY_NAME}}</title>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <style id=\"style-bootstrap\">\n    /*!\n * Bootstrap Reboot v5.3.3 (https://getbootstrap.com/)\n * Copyright 2011-2024 The Bootstrap Authors\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n */:root,[data-bs-theme=light]{--bs-blue:#0d6efd;--bs-indigo:#6610f2;--bs-purple:#6f42c1;--bs-pink:#d63384;--bs-red:#dc3545;--bs-orange:#fd7e14;--bs-yellow:#ffc107;--bs-green:#198754;--bs-teal:#20c997;--bs-cyan:#0dcaf0;--bs-black:#000;--bs-white:#fff;--bs-gray:#6c757d;--bs-gray-dark:#343a40;--bs-gray-100:#f8f9fa;--bs-gray-200:#e9ecef;--bs-gray-300:#dee2e6;--bs-gray-400:#ced4da;--bs-gray-500:#adb5bd;--bs-gray-600:#6c757d;--bs-gray-700:#495057;--bs-gray-800:#343a40;--bs-gray-900:#212529;--bs-primary:#0d6efd;--bs-secondary:#6c757d;--bs-success:#198754;--bs-info:#0dcaf0;--bs-warning:#ffc107;--bs-danger:#dc3545;--bs-light:#f8f9fa;--bs-dark:#212529;--bs-primary-rgb:13,110,253;--bs-secondary-rgb:108,117,125;--bs-success-rgb:25,135,84;--bs-info-rgb:13,202,240;--bs-warning-rgb:255,193,7;--bs-danger-rgb:220,53,69;--bs-light-rgb:248,249,250;--bs-dark-rgb:33,37,41;--bs-primary-text-emphasis:#052c65;--bs-secondary-text-emphasis:#2b2f32;--bs-success-text-emphasis:#0a3622;--bs-info-text-emphasis:#055160;--bs-warning-text-emphasis:#664d03;--bs-danger-text-emphasis:#58151c;--bs-light-text-emphasis:#495057;--bs-dark-text-emphasis:#495057;--bs-primary-bg-subtle:#cfe2ff;--bs-secondary-bg-subtle:#e2e3e5;--bs-success-bg-subtle:#d1e7dd;--bs-info-bg-subtle:#cff4fc;--bs-warning-bg-subtle:#fff3cd;--bs-danger-bg-subtle:#f8d7da;--bs-light-bg-subtle:#fcfcfd;--bs-dark-bg-subtle:#ced4da;--bs-primary-border-subtle:#9ec5fe;--bs-secondary-border-subtle:#c4c8cb;--bs-success-border-subtle:#a3cfbb;--bs-info-border-subtle:#9eeaf9;--bs-warning-border-subtle:#ffe69c;--bs-danger-border-subtle:#f1aeb5;--bs-light-border-subtle:#e9ecef;--bs-dark-border-subtle:#adb5bd;--bs-white-rgb:255,255,255;--bs-black-rgb:0,0,0;--bs-font-sans-serif:system-ui,-apple-system,\"Segoe UI\",Roboto,\"Helvetica Neue\",\"Noto Sans\",\"Liberation Sans\",Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\";--bs-font-monospace:SFMono-Regular,Menlo,Monaco,Consolas,\"Liberation Mono\",\"Courier New\",monospace;--bs-gradient:linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));--bs-body-font-family:var(--bs-font-sans-serif);--bs-body-font-size:1rem;--bs-body-font-weight:400;--bs-body-line-height:1.5;--bs-body-color:#212529;--bs-body-color-rgb:33,37,41;--bs-body-bg:#fff;--bs-body-bg-rgb:255,255,255;--bs-emphasis-color:#000;--bs-emphasis-color-rgb:0,0,0;--bs-secondary-color:rgba(33, 37, 41, 0.75);--bs-secondary-color-rgb:33,37,41;--bs-secondary-bg:#e9ecef;--bs-secondary-bg-rgb:233,236,239;--bs-tertiary-color:rgba(33, 37, 41, 0.5);--bs-tertiary-color-rgb:33,37,41;--bs-tertiary-bg:#f8f9fa;--bs-tertiary-bg-rgb:248,249,250;--bs-heading-color:inherit;--bs-link-color:#0d6efd;--bs-link-color-rgb:13,110,253;--bs-link-decoration:underline;--bs-link-hover-color:#0a58ca;--bs-link-hover-color-rgb:10,88,202;--bs-code-color:#d63384;--bs-highlight-color:#212529;--bs-highlight-bg:#fff3cd;--bs-border-width:1px;--bs-border-style:solid;--bs-border-color:#dee2e6;--bs-border-color-translucent:rgba(0, 0, 0, 0.175);--bs-border-radius:0.375rem;--bs-border-radius-sm:0.25rem;--bs-border-radius-lg:0.5rem;--bs-border-radius-xl:1rem;--bs-border-radius-xxl:2rem;--bs-border-radius-2xl:var(--bs-border-radius-xxl);--bs-border-radius-pill:50rem;--bs-box-shadow:0 0.5rem 1rem rgba(0, 0, 0, 0.15);--bs-box-shadow-sm:0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);--bs-box-shadow-lg:0 1rem 3rem rgba(0, 0, 0, 0.175);--bs-box-shadow-inset:inset 0 1px 2px rgba(0, 0, 0, 0.075);--bs-focus-ring-width:0.25rem;--bs-focus-ring-opacity:0.25;--bs-focus-ring-color:rgba(13, 110, 253, 0.25);--bs-form-valid-color:#198754;--bs-form-valid-border-color:#198754;--bs-form-invalid-color:#dc3545;--bs-form-invalid-border-color:#dc3545}[data-bs-theme=dark]{color-scheme:dark;--bs-body-color:#dee2e6;--bs-body-color-rgb:222,226,230;--bs-body-bg:#212529;--bs-body-bg-rgb:33,37,41;--bs-emphasis-color:#fff;--bs-emphasis-color-rgb:255,255,255;--bs-secondary-color:rgba(222, 226, 230, 0.75);--bs-secondary-color-rgb:222,226,230;--bs-secondary-bg:#343a40;--bs-secondary-bg-rgb:52,58,64;--bs-tertiary-color:rgba(222, 226, 230, 0.5);--bs-tertiary-color-rgb:222,226,230;--bs-tertiary-bg:#2b3035;--bs-tertiary-bg-rgb:43,48,53;--bs-primary-text-emphasis:#6ea8fe;--bs-secondary-text-emphasis:#a7acb1;--bs-success-text-emphasis:#75b798;--bs-info-text-emphasis:#6edff6;--bs-warning-text-emphasis:#ffda6a;--bs-danger-text-emphasis:#ea868f;--bs-light-text-emphasis:#f8f9fa;--bs-dark-text-emphasis:#dee2e6;--bs-primary-bg-subtle:#031633;--bs-secondary-bg-subtle:#161719;--bs-success-bg-subtle:#051b11;--bs-info-bg-subtle:#032830;--bs-warning-bg-subtle:#332701;--bs-danger-bg-subtle:#2c0b0e;--bs-light-bg-subtle:#343a40;--bs-dark-bg-subtle:#1a1d20;--bs-primary-border-subtle:#084298;--bs-secondary-border-subtle:#41464b;--bs-success-border-subtle:#0f5132;--bs-info-border-subtle:#087990;--bs-warning-border-subtle:#997404;--bs-danger-border-subtle:#842029;--bs-light-border-subtle:#495057;--bs-dark-border-subtle:#343a40;--bs-heading-color:inherit;--bs-link-color:#6ea8fe;--bs-link-hover-color:#8bb9fe;--bs-link-color-rgb:110,168,254;--bs-link-hover-color-rgb:139,185,254;--bs-code-color:#e685b5;--bs-highlight-color:#dee2e6;--bs-highlight-bg:#664d03;--bs-border-color:#495057;--bs-border-color-translucent:rgba(255, 255, 255, 0.15);--bs-form-valid-color:#75b798;--bs-form-valid-border-color:#75b798;--bs-form-invalid-color:#ea868f;--bs-form-invalid-border-color:#ea868f}*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:var(--bs-body-font-family);font-size:var(--bs-body-font-size);font-weight:var(--bs-body-font-weight);line-height:var(--bs-body-line-height);color:var(--bs-body-color);text-align:var(--bs-body-text-align);background-color:var(--bs-body-bg);-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;border:0;border-top:var(--bs-border-width) solid;opacity:.25}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2;color:var(--bs-heading-color)}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.1875em;color:var(--bs-highlight-color);background-color:var(--bs-highlight-bg)}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:rgba(var(--bs-link-color-rgb),var(--bs-link-opacity,1));text-decoration:underline}a:hover{--bs-link-color-rgb:var(--bs-link-hover-color-rgb)}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:var(--bs-font-monospace);font-size:1em}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:var(--bs-code-color);word-wrap:break-word}a>code{color:inherit}kbd{padding:.1875rem .375rem;font-size:.875em;color:var(--bs-body-bg);background-color:var(--bs-body-color);border-radius:.25rem}kbd kbd{padding:0;font-size:1em}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:var(--bs-secondary-color);text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]:not([type=date]):not([type=datetime-local]):not([type=month]):not([type=week]):not([type=time])::-webkit-calendar-picker-indicator{display:none!important}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}::file-selector-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}\n/* */\n  </style>\n  <style id=\"style-brick\">\n    #brick-viewport{display:flex;flex-direction:column}#brick-viewport>*{flex:1}.brick-linkReplace,.brick-active-passage{transition:opacity .4s}.brick-transparent{opacity:0}#ui-bar{background-color:var(--bs-secondary-bg);border-bottom:1px solid var(--bs-border-color);overflow-block:auto;padding:.5rem;width:100%}.brick-ui-btn{background-color:#364d63;border:1px solid var(--bs-secondary);padding-block:.25rem;transition:border-color .15s ease-in-out,background-color .15s ease-in-out}.brick-ui-btn:hover:enabled,.brick-ui-btn:focus{background-color:#3e5974}.brick-ui-btn:disabled{color:var(--bs-secondary)}#brick-history-controls{display:flex;flex-direction:row;text-align:center;width:100%;margin-bottom:.5rem}#brick-history-controls>*{flex-grow:1}#story-title{text-align:center}#brick-menu-core{width:100%;text-align:center;list-style:none;padding:0}#brick-menu-core button{width:100%}#brick-main{max-width:60rem}.brick-passage{padding:1rem}.brick-passage:not(:last-child){border-bottom:1px solid currentColor;padding-bottom:1rem}.brick-active-passage{margin-bottom:5rem;min-height:100vh}@media (min-width: 60rem){#brick-viewport{flex-direction:row}#ui-bar{border-bottom:0;border-right:1px solid var(--bs-border-color);height:100vh;height:100dvh;max-width:24rem;position:-webkit-sticky;position:sticky;top:0;width:auto}#brick-main{margin-inline:auto}.brick-active-passage{min-height:unset}}#brick-dialog{border-color:var(--bs-border-color);border-radius:.5rem;margin-top:2rem;max-width:min(95vw,50rem);max-width:min(95svw,50rem);min-width:min(95vw,30rem);min-width:min(95svw,30rem);overflow-x:auto}#brick-dialog::backdrop{-webkit-backdrop-filter:brightness(50%) blur(.25rem);backdrop-filter:brightness(50%) blur(.25rem)}#brick-dialog.brick-saves table{border:1px solid var(--bs-border-color);width:100%}#brick-dialog.brick-saves table :is(th,td){border:1px solid var(--bs-border-color);padding:.25rem}#brick-dialog.brick-saves table td:nth-child(3){width:100%}#brick-dialog.brick-saves table td:last-child button:enabled{background-color:var(--bs-danger)}#brick-dialog.brick-saves table td:last-child button:enabled:hover{background-color:inherit;color:var(--bs-danger)}.brick-link{padding:0;border:0;background:none;text-decoration:underline var(--bs-link-color);color:var(--bs-link-color)}.brick-link:hover:enabled{color:var(--bs-link-hover-color);-webkit-text-decoration-color:var(--bs-link-hover-color);text-decoration-color:var(--bs-link-hover-color)}.brick-link:disabled{color:var(--bs-secondary);cursor:not-allowed;-webkit-text-decoration-color:var(--bs-secondary);text-decoration-color:var(--bs-secondary)}.brick-text-secondary{color:var(--bs-secondary)}.brick-error{background-color:#5c0a0a;border-inline:.25rem solid red;line-height:2;padding:.25rem}.brick-error code{background-color:var(--bs-body-bg);color:var(--bs-body-color);padding:.125rem}.brick-saves-menu ul{border:1px solid currentColor;list-style:none;padding:0}.brick-saves-menu li:not(:first-child){border-top:1px solid currentColor}.brick-saves-menu li{display:flex;flex-direction:row;padding:.25rem}.brick-saves-menu li>div{flex-grow:1}.brick-saves-empty{color:var(--bs-secondary)}.brick-saves-buttons{display:flex;flex-direction:row;justify-content:space-between}\n\n  </style>\n</head>\n\n<body>\n  {{STORY_DATA}}\n  <div id=\"brick-viewport\">\n    <aside id=\"ui-bar\">\n      <div id=\"brick-history-controls\">\n        <button id=\"brick-history-backward\" class=\"brick-ui-btn\" type=\"button\">&#x2190;</button>\n        <button id=\"brick-history-forward\" class=\"brick-ui-btn\" type=\"button\">&#x2192;</button>\n      </div>\n      <h1 id=\"story-title\">{{STORY_NAME}}</h1>\n      <ul id=\"brick-menu-core\">\n        <li><button id=\"brick-saves\" class=\"brick-ui-btn\" type=\"button\">SAVES</button></li>\n        <li><button id=\"brick-restart\" class=\"brick-ui-btn\" type=\"button\">RESTART</button></li>\n      </ul>\n    </aside>\n\n    <main id=\"brick-main\">\n      <noscript>JavaScript must be enabled to play this story.</noscript>\n    </main>\n  </div>\n  <dialog id=\"brick-dialog\"></dialog>\n  <script id=\"script-brick\" type=\"text/javascript\">\"use strict\";(()=>{var Tt=Object.defineProperty;var De=e=>{throw TypeError(e)};var Mt=(e,t)=>{for(var n in t)Tt(e,n,{get:t[n],enumerable:!0})};var Be=(e,t,n)=>t.has(e)||De(\"Cannot \"+n);var Ce=(e,t,n)=>(Be(e,t,\"read from private field\"),n?n.call(e):t.get(e)),Pe=(e,t,n)=>t.has(e)?De(\"Cannot add the same private member more than once\"):t instanceof WeakSet?t.add(e):t.set(e,n),$e=(e,t,n,r)=>(Be(e,t,\"write to private field\"),r?r.call(e,n):t.set(e,n),n);var g={major:0,minor:2,patch:0,version:\"0.2.0\"};var $={maxLoopIterations:1e3,preProcessText:void 0,stream:!1};function It(e,t,n){throw new TypeError(\"\".concat(e,\": expected \").concat(t,\", got \").concat(typeof n))}var w={get maxLoopIterations(){return $.maxLoopIterations},set maxLoopIterations(e){if(typeof e!=\"number\"||e<=0||e%1!==0)throw new TypeError(\"Config.maxLoopIterations must be a positive integer\");$.maxLoopIterations=e},get preProcessText(){return $.preProcessText},set preProcessText(e){typeof e<\"u\"&&typeof e!=\"function\"&&It(\"Config.preProcessText\",\"function or undefined\",e),$.preProcessText=e},get stream(){return $.stream},set stream(e){$.stream=!!e}};var U={};Mt(U,{Passage:()=>B,filter:()=>Oe,find:()=>Ht,get:()=>_,init:()=>ge,start:()=>we,withTag:()=>Rt});var Lt=new Set(\"'\\\",()[]{}.!`?\");function H(e){return Array.from(e).map(t=>t>=\"a\"&&t<=\"z\"||t>=\"0\"&&t<=\"9\"?t:t>=\"A\"&&t<=\"Z\"||t>\"\\x7F\"?t.toLowerCase():Lt.has(t)?\"\":\"-\").join(\"\").replace(/-+/g,\"-\")}function He(e,t){let n=-1,r=0;for(;n=e.indexOf(t,n+1),n!==-1;)r++;return r}function N(e){switch(typeof e){case\"bigint\":case\"boolean\":case\"number\":case\"string\":case\"undefined\":return e;case\"symbol\":throw new Error(\"Symbols cannot be cloned\");case\"function\":throw new Error(\"Functions cannot be cloned\");case\"object\":if(e===null)return e;if(\"clone\"in e&&typeof e.clone==\"function\")return e.clone();if(e instanceof Array)return e.map(N);if(e instanceof Date)return new Date(e);if(e instanceof Map){let t=new Map;for(let[n,r]of e)t.set(N(n),N(r));return t}else{if(e instanceof RegExp)return new RegExp(e);if(e instanceof Set){let t=new Set;for(let n of e)t.add(N(n));return t}else{let t=Object.getPrototypeOf(e);if(t!==null&&t!==Object.prototype)throw new Error(\"Can't clone an object with an unknown prototype and no `.clone()` method\");let n={};for(let r in e)n[r]=N(e[r]);return n}}default:throw new Error(\"Unknown type: \".concat(typeof e))}}function ee(e){let t=document.getElementById(e);if(!t)throw new Error('No element with id \"'.concat(e,'\" found'));return t}var At=0;function fe(){return\"brick-unique-id-\".concat(At++)}function c(e,t={},...n){let r=document.createElement(e);for(let s in t)r.setAttribute(s,t[s]);return r.append(...n),r}function*Re(e,t,n=1){let r;if(typeof t>\"u\"?(r=0,t=e):r=e,n>0)for(;r<t;)yield r,r+=n;else for(;r>t;)yield r,r+=n}function*_e(e,t=0){let n=t;for(let r of e)yield[n,r],n++}var q,B=class{constructor(t){Pe(this,q);var s;let n=t.getAttribute(\"pid\");if(!n)throw new Error(\"Passage has no pid: \"+t.outerHTML);let r=t.getAttribute(\"name\");if(!r)throw new Error(\"Passage \".concat(n,\" has no name\"));this.id=n,this.name=r,this.slug=H(r),this.tags=((s=t.getAttribute(\"tags\"))==null?void 0:s.split(\" \").filter(o=>o.length>=0))||[],$e(this,q,t)}get content(){return Ce(this,q).textContent}};q=new WeakMap;var Bt=[\"PassageDone\",\"PassageFooter\",\"PassageHeader\",\"PassageReady\",\"StoryAuthor\",\"StoryBanner\",\"StoryCaption\",\"StoryDisplayTitle\",\"StoryInit\",\"StoryInterface\",\"StoryMenu\",\"StorySettings\",\"StorySubtitle\",\"StoryTitle\"],Ct=[\"init\",\"script\",\"stylesheet\",\"Twine.audio\",\"Twine.image\",\"Twine.video\",\"Twine.vtt\",\"widget\",\"header\",\"footer\",\"startup\",\"debug-header\",\"debug-footer\",\"debug-startup\",\"nobr\"];function Pt(e){if(Bt.includes(e))throw new Error('The passage name \"'.concat(e,'\" is not allowed'))}function $t(e,t){for(let n of e)if(Ct.includes(n))throw new Error(\"The tag '\".concat(n,\"' on the passage \\\"\").concat(t,\" is not allowed\"))}var pe=new Map,R=new Map,he;function ge(e){let t=e.getElementsByTagName(\"tw-passagedata\");for(let r of t){let s=new B(r),{id:o,name:i}=s;if(Pt(s.name),s.name.startsWith(\"::\")&&console.warn('Found a passage named \"'.concat(i,'\". Although starting a passage name with \"::\" is allowed, this is likely a mistake.')),$t(s.tags,i),pe.has(o))throw new Error(\"Duplicate passage id \".concat(o));if(R.has(i))throw new Error(\"Duplicate passage name \".concat(i));s.content.trim()||console.warn(\"Passage \".concat(i,\" has no text.\")),pe.set(o,s),R.set(i,s)}let n=e.getAttribute(\"startnode\");if(n){let r=pe.get(n);if(!r)throw new Error(\"Could not determine starting passage; no passage with \".concat(n));he=r}else{let r=R.get(\"Start\");if(!r)throw new Error('Could not find a passage named \"Start\"');he=r}}function Oe(e){let t=[];for(let n of R.values())e(n)&&t.push(n);return t}function Ht(e){for(let t of R.values())if(e(t))return t}function _(e){return R.get(e)}function we(){return he}function Rt(e){return Oe(t=>t.tags.includes(e))}var L=class extends Error{constructor(t,n,r){super(\"in \\u201C\".concat(n,\"\\u201D at line \").concat(r,\": \").concat(t)),this.passage=n,this.lineNumber=r}},C=class extends L{constructor(t,n){let r;try{r=\"@\".concat(t.name,\": \").concat(n instanceof Error?n.message:n)}catch(s){r=\"@\".concat(t.name,\": (error could not be converted to string)\")}super(r,t.passageName,t.lineNumber),this.cause=n}},te=class extends L{constructor(t,n,r){let s;try{s='while evaluating the attribute \"'.concat(n,'\": ').concat(t instanceof Error?t.message:t)}catch(o){s='while evaluating the attribute \"'.concat(n,'\": (error could not be converted to string)')}super(s,r.passageName,r.lineNumber),this.cause=t}};var m={closeTag:/>/y,commentBlock:/\\*(?:[^])*?\\*\\//y,commentLine:/\\/.*\\n?/y,elementName:/([-\\p{ID_Continue}]+)(#[-\\p{ID_Continue}]+)?((?:\\.[-\\p{ID_Continue}]+)*)/uy,htmlAttr:/\\s*([-_\\p{ID_Start}][-\\p{ID_Continue}]*)=\"([^\"]*)\"/uy,htmlEvalAttr:/\\s*([-_\\p{ID_Start}][-\\p{ID_Continue}]*)=\\(/uy,js:{binaryOperator:/[%&*<=>^|]+/y,closingParen:/\\s*\\)/y,closingSquareBracket:/\\s*\\]/y,field:new RegExp(\"\\\\.\\\\p{ID_Start}[$\\\\p{ID_Continue}]*\",\"uy\"),identifier:new RegExp(\"\\\\p{ID_Start}[$\\\\p{ID_Continue}]*\",\"uy\"),number:/[0-9][0-9_]*/y,operator:/[!%&*+-<=>^|~]+/y,regexp:new RegExp(\"(?:[^\\\\\\\\[/]|\\\\\\\\[^]|\\\\[(?:[^\\\\\\\\\\\\]]|\\\\\\\\[^])*\\\\])*\\\\/(?:$|\\\\p{ID_Continue})*\",\"uy\"),stringDouble:/\"(?:[^\\\\\"]|\\\\[^])*\"/y,stringSingle:/'(?:[^\\\\']|\\\\[^])*'/y,normalInTemplateString:/(?:[^`$\\\\]|\\\\[^]|\\$(?!\\{))*/y},macroArgsStart:/ *\\(/y,macroBodyStart:/\\s*\\{/y,macroName:/[-_=<>\\p{ID_Start}][-=<>\\p{ID_Continue}]*/uy,normalChars:/[^[\\\\$_?<@/}]+/y,singleChar:/[^]/y,whitespace:/\\s*/y},_t=[\"base\",\"body\",\"link\",\"head\",\"html\",\"meta\",\"script\",\"style\",\"title\"],Ot=[\"area\",\"base\",\"br\",\"col\",\"embed\",\"hr\",\"img\",\"input\",\"link\",\"meta\",\"param\",\"source\",\"track\",\"wbr\"];function ne(e){return typeof e==\"object\"&&e.type===\"macro\"}var O=class{constructor(t,n,r){this.input=t,this.index=0,this.passageName=n,this.lineNumber=r||1}consume(t){t.lastIndex=this.index;let n=t.exec(this.input);return n&&(this.lineNumber+=He(n[0],\"\\n\"),this.index=t.lastIndex),n}lookahead(){return this.input[this.index]||null}locationSample(){if(this.input[this.index]===\"\\n\"){let r=this.input.lastIndexOf(\"\\n\",this.index-1)+1;return this.input.slice(r,this.index)}let t=this.input.lastIndexOf(\"\\n\",this.index-1)+1,n=this.input.indexOf(\"\\n\",this.index+1);return this.input.slice(t,n)}error(t){return{type:\"error\",passageName:this.passageName,lineNumber:this.lineNumber,message:t,locationSample:this.locationSample()}}parse(t){var s;let n=[],r=0;e:for(;this.index<this.input.length;){if(r>=1e6)return n.push(this.error(\"Parser stuck in infinite loop\")),n;r++;let o=this.index;if(this.consume(m.normalChars),this.index!==o&&n.push(this.input.substring(o,this.index)),t&&this.consume(t))return n;let i=(s=this.consume(m.singleChar))==null?void 0:s[0];switch(i){case\"\\\\\":{let a=this.consume(m.singleChar);n.push((a==null?void 0:a[0])||\"\\n\");break}case\"<\":n.push(this.parseElement());break;case\"@\":n.push(this.parseMacro());break;case\"/\":switch(this.lookahead()){case\"/\":this.consume(m.commentLine);break;case\"*\":if(!this.consume(m.commentBlock))return n.push(this.error(\"Missing trailing `*/` to close the block comment\")),n;break;default:n.push(i);break}break;case\"$\":{n.push(this.parseNakedVariable(\"story\"));break}case\"_\":{n.push(this.parseNakedVariable(\"temp\"));break}case\"[\":if(this.lookahead()===\"[\"){this.index++;let a=this.consume(/((?:[^\\\\\\]]|\\\\.)*)\\]\\]/y);if(!a){n.push(this.error(\"Unmatched `[[`\"));break}let l=a[1],d=l.includes(\"->\"),u=l.includes(\"<-\"),f=l.includes(\"|\"),v=Number(d)+Number(u)+Number(f);if(v>1)n.push(this.error(\"Link boxes can only have one of '->', '<-', or '|'\"));else if(v===0)n.push({type:\"linkBox\",passageName:this.passageName,lineNumber:this.lineNumber,link:l,text:l});else{let Nt=d?\"->\":u?\"<-\":\"|\";n.push(this.makeLinkBox(l,Nt))}}else n.push(\"[\");break;case\"}\":n.push(\"}\");break;case void 0:break e;default:throw new Error(\"Logic Error (\".concat(i,\")\"))}}return t&&!this.consume(t)&&n.push(this.error('Failed to match regex \"'.concat(t.source,'\"'))),n}parseElement(){let t=this.consume(m.elementName);if(!t)return this.error(\"Element names can contain only hyphens, underscores, and ASCII letters and numbers\");let[n,r,s,o]=t,i=new Map,a=new Map;for(s&&i.set(\"id\",s.slice(1)),o.length&&i.set(\"class\",o.replace(\".\",\" \").trim()),this.consume(m.whitespace);!this.consume(m.closeTag);){let d=this.consume(m.htmlAttr);if(d){let[u,f,v]=d;i.has(f)||a.has(f)?console.warn(\"Ignoring duplicate attribute '\".concat(f)):i.set(f,v)}else if(d=this.consume(m.htmlEvalAttr),d){let u=d[1],f=this.parseJsExpression();if(typeof f==\"object\")return f;if(f.trim()===\"\")return this.error('Empty JavaScript attribute \"'.concat(u,'\"'));if(this.lookahead()!==\")\")return this.error('No closing paren on dynamic attribute \"'.concat(u,'\"'));this.index++,i.has(u)||a.has(u)?console.warn(\"Ignoring duplicate attribute '\".concat(u)):a.set(u,f)}else return this.error(\"Missing trailing `>` to close the HTML tag\")}let l=Ot.includes(r)?[]:this.parse(new RegExp(\"</\".concat(r,\">\"),\"y\"));return _t.includes(r)?this.error('Passages cannot contain \"<'.concat(r,'>\" elements')):{type:\"element\",passageName:this.passageName,lineNumber:this.lineNumber,name:r,attributes:i,evalAttributes:a,content:l}}parseNakedVariable(t){let n=this.index,r=this.consume(m.js.identifier);if(!r){let i=t===\"story\"?\"$\":\"_\";return this.error(\"\".concat(i,\" must be part of a \").concat(t,\" variable, \").concat(\"or escaped with a backslash `\\\\`\"))}let s=r[0],o=this.index;for(;;){switch(this.lookahead()){case\".\":if(r=this.consume(m.js.field),r)continue;break;case\"[\":this.index++,this.parseJsArgs(\"]\");continue;case\"(\":this.index++,this.parseJsArgs(\")\");continue}break}return this.index===o?{type:t,passageName:this.passageName,lineNumber:this.lineNumber,name:s}:{type:\"macro\",name:\"print\",args:[(t===\"story\"?\"Engine.vars.\":\"Engine.temp.\")+this.input.substring(n,this.index)],passageName:this.passageName,lineNumber:this.lineNumber}}parseMacro(){let t=this.consume(m.macroName),n;if(t)n=t[0];else if(this.lookahead()===\"(\")n=\"\";else return this.error(\"`@` must be followed by a macro name, or be escaped with a `\\\\`\");let r=null;if(this.consume(m.macroArgsStart)){let i=n===\"for\"?this.parseForArgs():this.parseJsArgs(\")\");if(\"type\"in i)return i;r=i}let s=this.consume(m.macroBodyStart);if(!r&&!s)return this.error(\"Macro invocations must be followed by `(` or `[`\");let o=s?this.parse(/\\}/y):void 0;return{type:\"macro\",name:n,args:r||[],content:o,passageName:this.passageName,lineNumber:this.lineNumber}}parseForArgs(){let t=this.consume(/\\s*([^]*?)\\s+of\\b/y);if(!t)return this.error(\"Syntax: @for(_VAR of EXPRESSION)\");let n=t[1],r=this.parseJsExpression();return typeof r==\"object\"?r:r.trim()===\"\"?this.error(\"Syntax: @for(_VAR of EXPRESSION)\"):this.consume(/\\s*\\)/y)?[n,r]:this.error(\"@for: missing closing ')'\")}parseJsArgs(t){let n=[],r;for(;r=this.parseJsExpression();){if(typeof r==\"object\")return r;if(n.push(r),!this.consume(/\\s*,/uy))break}return this.consume(m.whitespace),this.lookahead()!==t?this.error(\"Missing a closing `\".concat(t,\"`\")):(this.index++,n)}parseJsExpression(){let t=[],n=[],r=!0,s,o=0;e:for(;this.index<this.input.length;){if(this.index===o)throw new Error(\"Infinite loop at index \".concat(o,\" (\").concat(this.input[this.index],\")\"));if(o=this.index,s=this.consume(m.whitespace),s&&n.push(s[0]),s=this.consume(m.js.identifier),s){n.push(s[0]),r=!1;continue}if(s=this.consume(m.js.number),s){n.push(s[0]),r=!1;continue}if(s=this.consume(m.js.binaryOperator),s){n.push(s[0]),r=!0;continue}let i=this.lookahead();switch(i){case'\"':if(s=this.consume(m.js.stringDouble),s)n.push(s[0]),r=!1;else return this.error(\"Unclosed double-quoted string\");break;case\"'\":if(s=this.consume(m.js.stringSingle),s)n.push(s[0]),r=!1;else return this.error(\"Unclosed single-quoted string\");break;case\"`\":this.index++,n.push(i),this.parseJsTemplateString(n),r=!1;break;case\"(\":t.push(\")\"),n.push(i),this.index++,r=!0;break;case\"[\":t.push(\"]\"),n.push(i),this.index++,r=!0;break;case\"{\":t.push(\"}\"),n.push(i),this.index++,r=!1;break;case\"$\":if(this.index++,s=this.consume(m.js.identifier),s)n.push(\"Engine.vars.\",s[0]),r=!1;else return this.error(\"Illegal identifier\");break;case\"_\":if(this.index++,s=this.consume(m.js.identifier),s)n.push(\"Engine.temp.\",s[0]),r=!1;else return this.error(\"Illegal identifier\");break;case\",\":if(t.length>0)this.index++,n.push(i),r=!0;else break e;break;case\"#\":case\":\":case\";\":case\"?\":case\".\":r=!0,n.push(i),this.index++;break;case\"!\":this.index++,this.lookahead()===\"=\"?(this.index++,this.lookahead()===\"=\"?(this.index++,n.push(\"!==\")):n.push(\"!=\"),r=!0):(n.push(i),r=!1);break;case\"+\":case\"-\":{n.push(i),this.index++;let a=this.lookahead();a===i?(n.push(a),this.index++,r=!1):a===\"=\"?(this.index++,r=!0,n.push(\"=\")):r=!0}break;case\"~\":n.push(i),this.index++,r=!0;break;case\"/\":if(this.index++,this.consume(m.commentLine))n.push(\"\\n\");else if(s=this.consume(m.commentBlock))s[0].includes(\"\\n\")&&n.push(\"\\n\");else if(r){if(n.push(i),s=this.consume(m.js.regexp),!s)return this.error(\"Invalid RegExp literal\");n.push(s[0]),r=!1}else n.push(i),r=!0;break;default:if(i&&i===t[t.length-1]){this.index++,n.push(i),t.pop();break}if(![\")\",\"]\",\"}\"].includes(i||\"\"))return this.error(\"Can't handle unescaped \".concat(i,\" yet\"));break e}}return t.length>0?this.error('Expected a \"'.concat(t.pop(),'\"')):n.join(\"\")}parseJsTemplateString(t){for(;;){let n=this.consume(m.js.normalInTemplateString);n&&t.push(n[0]);let r=this.lookahead();if(!r)return this.error(\"Unclosed template string\");switch(r){case\"`\":t.push(r),this.index++;return;case\"$\":{this.index+=2,t.push(\"${\");let s=this.parseJsExpression();if(typeof s==\"object\")return s;if(t.push(s),this.lookahead()!==\"}\")return this.error('missing \"}\" inside template string');this.index++,t.push(\"}\");break}default:return this.error(\"Logic Error: '\".concat(r,\"' (U+\").concat(r.charCodeAt(0),\") was not matched by regex\"))}}}makeLinkBox(t,n){let r=t.split(n);if(r.length!==2){let s='Links in [[...]] can only contain \"'.concat(n,'\" once');return this.error(s)}return n===\"<-\"?{type:\"linkBox\",passageName:this.passageName,lineNumber:this.lineNumber,link:r[0],text:r[1]}:{type:\"linkBox\",passageName:this.passageName,lineNumber:this.lineNumber,link:r[1],text:r[0]}}};var J={BRICK_VERSION:g,Engine:{forward:oe,backward:se,redo:je,get vars(){return A},get temp(){return T}},Config:w,Dialog:{showPassage:qe},Passages:U,clone:N,enumerate:_e,makeElement:c,numberRange:Re,slugify:H};J.BRICK_VERSION.toString=function(){return this.version};var Ve=Object.keys(J),Fe=Object.values(J);function K(e){return new Function(...Ve,\"'use strict';\".concat(e))(...Fe)}function k(e){return K(\"return \"+e)}function re(e,t){new Function(...Ve,'\"use strict\"; '.concat(e,\" = arguments[arguments.length - 1]\"))(...Fe,t)}var E=class{constructor(t){if(t.name!==\"break\"&&t.name!==\"continue\")throw new Error('BreakError requires a \"break\" or \"continue\" context');this.context=t,this.type=t.name}toString(){return\"Signal from @\".concat(this.type,' in \"').concat(this.context.passageName,'\" line ').concat(this.context.lineNumber)}},V=class{constructor(t,n,r,s,o){this.name=t,this.content=o,this.passageName=n,this.lineNumber=r,s!=null&&s.captures&&(this.captures=s.captures)}createCallback(t){let n=this;return function(...s){if(!n.captures)return t.apply(this,s);let o={};for(let a of n.captures)a.name in o||(o[a.name]=T[a.name]),T[a.name]=a.value;let i;try{i=t.apply(this,s)}finally{Object.assign(T,o)}return i}}},G=new Map;function p(e,t){G.has(e)&&console.warn('Replacing an existing macro: \"'.concat(e,'\"')),G.set(e,t)}function Ue(e,t){let n=G.get(e);if(!n)throw new Error('No macro \"'.concat(e,'\" found'));G.set(t,n)}function be(e){return G.get(e)||null}p(\"include\",{handler(...e){if(e.length<1||e.length>2)throw new Error(\"must be called with 1 argument\");let[t,n]=e;if(typeof t!=\"string\")throw new Error(\"first arg (passage name) must be a string\");if(typeof n<\"u\"&&typeof n!=\"string\")throw new Error(\"second arg (element type) must be a string or undefined\");let s=c(n||\"div\");return S(s,t),s}});p(\"\",{skipArgs:!0,handler(...e){return K(e.join(\", \")),document.createDocumentFragment()}});p(\"print\",{handler(...e){if(e.length!==1)throw new Error(\"requires 1 argument (got \".concat(e.length,\")\"));if(this.content)throw new Error(\"no body allowed\");return Array.isArray(e[0])&&e[0].toString===Array.prototype.toString?\"[\".concat(e[0].join(\", \"),\"]\"):String(e[0])}});Ue(\"print\",\"-\");p(\"render\",{handler(...e){if(e.length!==1)throw new Error(\"requires 1 argument (got \".concat(e.length,\")\"));if(this.content)throw new Error(\"no body allowed\");let t=document.createDocumentFragment(),n=new O(String(e[0]),this.passageName,this.lineNumber);return b(t,n.parse()),t}});Ue(\"render\",\"=\");p(\"link\",{handler(...e){if(e.length<1||e.length>3)throw new Error(\"requires 1, 2 or 3 arguments\");if(typeof e[0]!=\"string\")throw new Error(\"first argument (link text) must be a string\");let t=e[0],n,r;if(e.length===2)if(typeof e[1]==\"string\")n=e[1],r=void 0;else if(typeof e[1]==\"function\")n=void 0,r=e[1];else throw new Error(\"second argument must be a string or function\");else if(e.length===3){if(typeof e[1]==\"function\"&&typeof e[2]==\"string\")throw new Error(\"second argument must be a string and third argument must be a function\");if(typeof e[1]!=\"string\")throw new Error(\"second argument must be a string\");if(typeof e[2]!=\"function\")throw new Error(\"third argument must be a function\");n=e[1],r=e[2]}else console.warn(\"@link received only 1 argument. This link will do nothing when clicked.\"),n=void 0,r=void 0;let s=c(\"button\",{class:\"brick-link\",type:\"button\"},t);return n&&(s.dataset.linkDestination=n),s.addEventListener(\"click\",this.createCallback(function(o){r&&r.call(this,o),s.dataset.linkDestination&&Je(s.dataset.linkDestination)})),s}});p(\"linkReplace\",{handler(...e){if(e.length!==1)throw new Error(\"requires exactly 1 argument\");let[t]=e;if(typeof t!=\"string\")throw new Error(\"first arg (link text) must be a string\");let n=c(\"button\",{class:\"brick-link\",type:\"button\"},t);return n.addEventListener(\"click\",()=>{let r=c(\"span\",{class:\"brick-linkReplace brick-transparent\"});this.content&&b(r,this.content,this),n.replaceWith(r),setTimeout(()=>r.classList.remove(\"brick-transparent\"),40)}),n}});p(\"while\",{skipArgs:!0,handler(...e){if(e.some(o=>typeof o!=\"string\"))throw new Error(\"received a non-string arg\");let t=e.join(\",\"),n=document.createDocumentFragment(),{content:r}=this,s=1;for(;k(t);){if(s>w.maxLoopIterations)throw new Error(\"Too many iterations (Config.maxLoopIterations = \".concat(w.maxLoopIterations,\")\"));s++;try{if(!(r?b(n,r,this):!0))break}catch(o){if(o instanceof E){if(o.type===\"break\")break;continue}else throw o}}return n}});p(\"break\",{handler(){throw new E(this)}});p(\"continue\",{handler(){throw new E(this)}});p(\"for\",{skipArgs:!0,handler(...e){if(!e.every(u=>typeof u==\"string\"))throw new Error(\"received a non-string arg\");if(e.length!==2)throw new Error(\"requires exactly 2 arguments\");let[t,n]=e;if(!t.startsWith(\"_\"))throw new Error(\"loop variable must be a temp variable\");let r=t.substring(1),s=\"Engine.temp.\".concat(r),o=k(n);if(typeof o[Symbol.iterator]!=\"function\")throw new Error(\"Right-hand side must be an iterable value, such as an array\");let i=document.createDocumentFragment(),{content:a}=this,l=this.captures||[],d=1;for(let u of o){if(d>w.maxLoopIterations)throw new Error(\"Too many iterations (Config.maxLoopIterations = \".concat(w.maxLoopIterations,\")\"));d++,re(s,u),this.captures=[...l,{name:r,value:u}];try{if(!(a?b(i,a,this):!0))break}catch(f){if(f instanceof E){if(f.type===\"break\")break;continue}else throw f}}return this.captures=l,i}});p(\"checkBox\",{skipArgs:!0,handler(...e){if(e.length!==2)throw new Error(\"requires 2 arguments\");if(e.some(l=>typeof l!=\"string\"))throw new Error(\"both arguments must be strings\");let[t,n]=e,r=k(n);if(typeof r!=\"string\"&&!(r instanceof Node))throw new Error(\"label must be a string or Node\");let s=k(t),o=c(\"input\",{type:\"checkbox\",id:fe()});o.checked=!!s,o.addEventListener(\"change\",()=>re(t,o.checked));let i=c(\"label\",{for:o.id},r);return c(\"div\",{},o,\" \",i)}});p(\"textBox\",{skipArgs:!0,handler(...e){if(e.length!==2)throw new Error(\"requires 2 arguments\");if(!e.every(l=>typeof l==\"string\"))throw new Error(\"both arguments must be strings\");let[t,n]=e,r=k(n);if(typeof r!=\"string\"&&!(r instanceof Node))throw new Error(\"label must be a string or Node\");let s=String(k(t)||\"\"),o=c(\"input\",{id:fe(),type:\"text\",value:s});o.addEventListener(\"keyup\",()=>re(t,o.value));let i=c(\"label\",{for:o.id},r);return c(\"div\",{},o,\" \",i)}});p(\"switch\",{handler(...e){if(e.length!==1)throw new Error(\"requires 1 arg\");if(!this.content)throw new Error(\"requires a body\");let[t]=e,n=[];for(let s of this.content)if(typeof s==\"string\"){if(s.trim())throw new Error(\"all children must be @case macros\")}else if(s.type===\"macro\")n.push(s);else throw new Error(\"all children must be @case macros\");for(let s=0;s<n.length;s++){let o=n[s];if(o.name===\"default\"){if(s!==n.length-1)throw new Error(\"@default must be the last macro\");if(o.args.length>0)throw new Error(\"@default cannot receive any arguments\")}else{if(o.name!==\"case\")throw new Error(\"all children must be @case macros\");if(o.args.length===0)throw new Error(\"@case macro requires at least one argument\")}}let r=document.createDocumentFragment();for(let s of n){if(s.name===\"default\")return s.content&&b(r,s.content,this),r;for(let o of s.args){let i=k(o);if(t===i)return s.content&&b(r,s.content,this),r}}return r}});p(\"if\",{trailingMacros:[\"elseif\",\"else\"],handler(){if(!this.content)throw new Error(\"no child templates\");for(let e of this.content){if(!ne(e))throw new Error(\"child was not a MacroTemplate\");if(e.name===\"else\"||k(e.args.join(\",\"))){let t=document.createDocumentFragment();return e.content&&b(t,e.content,this),t}}return document.createDocumentFragment()}});p(\"redoable\",{handler(){let{content:e}=this;if(!e)throw new Error(\"must be called with a body\");let t=c(\"span\",{class:\"brick-macro-redoable\"});try{this.content&&b(t,this.content,this)}catch(n){throw n instanceof E?new C(n.context,\"Can't @\".concat(n.type,\" from inside @\").concat(this.name)):n}return t.addEventListener(\"brick-redo\",()=>{t.innerHTML=\"\",this.content&&b(t,this.content,this)}),t}});function W(e){return console.error(e),c(\"span\",{class:\"brick-error\"},String(e))}function S(e,t){if(typeof t==\"string\"){let n=_(t);return n?S(e,n):(e.innerHTML=\"\",e.append(c(\"span\",{class:\"brick-error\"},'No passage named \"'.concat(t,'\" found'))),!1)}return e.innerHTML=\"\",e.classList.add(\"psg-\".concat(t.slug)),e.dataset.name=t.name,e.dataset.tags=t.tags.join(\" \"),b(e,t)}var ie=1e3,ye=!1;function b(e,t,n){if(ye)return!1;if(ie<=0){let s=(n==null?void 0:n.passageName)||t instanceof B&&t.name||\"unknown\",o=(n==null?void 0:n.lineNumber)||0,i=new L(\"Infinite recursion detected\",s,o);return e.append(W(i)),ye=!0,!1}let r=!1;try{ie--,r=Vt(e,t,n)}finally{ie++,ie>=1e3&&(ye=!1)}return r}function Vt(e,t,n){let r=!0;if(t instanceof B){let s=w.preProcessText?w.preProcessText(t):t.content;if(typeof s!=\"string\")throw new TypeError(\"Config.preProcessText returned a \".concat(typeof s,\", expected a string\"));let o=new O(s,t.name);return b(e,o.parse(),n)}for(let s=0;s<t.length;s++){let o=t[s],i;if(typeof o==\"string\"){i=o;let a=i.split(\"\\n\\n\"),l=a.shift();if(typeof l==\"string\")for(e.append(l);typeof(l=a.shift())==\"string\";)e.append(c(\"br\")),e.append(c(\"br\")),e.append(l)}else if(o.type===\"macro\"){let a=be(o.name);if(!a){let u=new L('Macro not found: \"'.concat(o.name,'\"'),o.passageName,o.lineNumber);e.append(W(u)),r=!1;continue}let l,d;if(a.trailingMacros){let u=[o];for(let f=s+1;f<t.length;f++){let v=t[f];if(ne(v)&&a.trailingMacros.includes(v.name))u.push(v),s=f;else if(!(typeof v==\"string\"&&!v.trim()))break}l=new V(o.name,o.passageName,o.lineNumber,n,u),d=[]}else d=a.skipArgs?o.args:o.args.map(u=>k(u)),l=new V(o.name,o.passageName,o.lineNumber,n,o.content);try{let u=a.handler.apply(l,d);e.append(u)}catch(u){if(u instanceof E)throw u;let f=u instanceof C?u:new C(l,u);e.append(W(f))}}else if(o.type===\"element\")r=Ft(o,e,n)||r;else if(o.type===\"linkBox\"){let a=be(\"link\");if(!a)throw new Error(\"Can't find @link macro for wiki-style [[link]]\");if(!o.text)throw new Error(\"The text of a [[link box]] cannot be empty\");let l=new V(\"link\",o.passageName,o.lineNumber);e.append(a.handler.call(l,o.text,o.link))}else if(o.type===\"error\")r=!1,e.append(W(new L(o.message,o.passageName,o.lineNumber)));else{let a=(o.type===\"story\"?A:T)[o.name];Array.isArray(a)&&a.toString===Array.prototype.toString?e.append(\"[\".concat(a.join(\", \"),\"]\")):e.append(String(a))}}return r}function Ft(e,t,n){let r=c(e.name);for(let[o,i]of e.attributes)r.setAttribute(o,i);for(let[o,i]of e.evalAttributes)try{let a=String(k(i));r.setAttribute(o,a)}catch(a){if(a instanceof E)throw a;return t.append(W(new te(a,o,e))),!1}let s=b(r,e.content,n);return t.append(r),s}var xe=(e,t)=>t.some(n=>e instanceof n),Ke,Ge;function jt(){return Ke||(Ke=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function qt(){return Ge||(Ge=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var ve=new WeakMap,ke=new WeakMap,ae=new WeakMap;function Ut(e){let t=new Promise((n,r)=>{let s=()=>{e.removeEventListener(\"success\",o),e.removeEventListener(\"error\",i)},o=()=>{n(P(e.result)),s()},i=()=>{r(e.error),s()};e.addEventListener(\"success\",o),e.addEventListener(\"error\",i)});return ae.set(t,e),t}function Jt(e){if(ve.has(e))return;let t=new Promise((n,r)=>{let s=()=>{e.removeEventListener(\"complete\",o),e.removeEventListener(\"error\",i),e.removeEventListener(\"abort\",i)},o=()=>{n(),s()},i=()=>{r(e.error||new DOMException(\"AbortError\",\"AbortError\")),s()};e.addEventListener(\"complete\",o),e.addEventListener(\"error\",i),e.addEventListener(\"abort\",i)});ve.set(e,t)}var Ne={get(e,t,n){if(e instanceof IDBTransaction){if(t===\"done\")return ve.get(e);if(t===\"store\")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return P(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t===\"done\"||t===\"store\")?!0:t in e}};function Ye(e){Ne=e(Ne)}function Kt(e){return qt().includes(e)?function(...t){return e.apply(Te(this),t),P(this.request)}:function(...t){return P(e.apply(Te(this),t))}}function Gt(e){return typeof e==\"function\"?Kt(e):(e instanceof IDBTransaction&&Jt(e),xe(e,jt())?new Proxy(e,Ne):e)}function P(e){if(e instanceof IDBRequest)return Ut(e);if(ke.has(e))return ke.get(e);let t=Gt(e);return t!==e&&(ke.set(e,t),ae.set(t,e)),t}var Te=e=>ae.get(e);function Ze(e,t,{blocked:n,upgrade:r,blocking:s,terminated:o}={}){let i=indexedDB.open(e,t),a=P(i);return r&&i.addEventListener(\"upgradeneeded\",l=>{r(P(i.result),l.oldVersion,l.newVersion,P(i.transaction),l)}),n&&i.addEventListener(\"blocked\",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener(\"close\",()=>o()),s&&l.addEventListener(\"versionchange\",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),a}var Wt=[\"get\",\"getKey\",\"getAll\",\"getAllKeys\",\"count\"],zt=[\"put\",\"add\",\"delete\",\"clear\"],Ee=new Map;function We(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t==\"string\"))return;if(Ee.get(t))return Ee.get(t);let n=t.replace(/FromIndex$/,\"\"),r=t!==n,s=zt.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Wt.includes(n)))return;let o=async function(i,...a){let l=this.transaction(i,s?\"readwrite\":\"readonly\"),d=l.store;return r&&(d=d.index(a.shift())),(await Promise.all([d[n](...a),s&&l.done]))[0]};return Ee.set(t,o),o}Ye(e=>({...e,get:(t,n,r)=>We(t,n)||e.get(t,n,r),has:(t,n)=>!!We(t,n)||e.has(t,n)}));var Xt=[\"continue\",\"continuePrimaryKey\",\"advance\"],ze={},Me=new WeakMap,Qe=new WeakMap,Yt={get(e,t){if(!Xt.includes(t))return e[t];let n=ze[t];return n||(n=ze[t]=function(...r){Me.set(this,Qe.get(this)[t](...r))}),n}};async function*Zt(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;let n=new Proxy(t,Yt);for(Qe.set(n,t),ae.set(n,Te(t));t;)yield n,t=await(Me.get(n)||t.continue()),Me.delete(n)}function Xe(e,t){return t===Symbol.asyncIterator&&xe(e,[IDBIndex,IDBObjectStore,IDBCursor])||t===\"iterate\"&&xe(e,[IDBIndex,IDBObjectStore])}Ye(e=>({...e,get(t,n,r){return Xe(t,n)?Zt:e.get(t,n,r)},has(t,n){return Xe(t,n)||e.has(t,n)}}));var et,x;var tt=[];async function nt(e,t){et=\"brick.\".concat(H(e),\".\").concat(t),x=await Ze(et,1,{upgrade(n,r,s,o,i){n.createObjectStore(\"moments\",{autoIncrement:!0}),n.createObjectStore(\"histories\",{autoIncrement:!0,keyPath:\"id\"})}}),await en()}async function en(){let e=x.transaction(x.objectStoreNames,\"readwrite\"),t=e.objectStore(\"moments\");if(await t.count()>1e3){let r=await e.objectStore(\"histories\").getAll(),s=new Set;for(let a of r)for(let l of a.momentIds)s.add(l);let o=await t.openCursor(),i=[];for(;o;)s.has(o.key)||i.push(o.delete()),o=await o.continue();await Promise.all(i)}await e.done}async function rt(e){let t=await x.get(\"moments\",e);if(!t)throw new Error(\"Could not load moment \".concat(e));return{...t,vars:mt(t.vars)}}async function Se(e){let t={...e,vars:X(e.vars)};return await x.put(\"moments\",t)}async function st(e){return await x.get(\"histories\",e)}async function ot(){return await x.getAll(\"histories\",IDBKeyRange.upperBound(\"\"))}async function it(e,t,n){let r={id:\"active\",momentIds:e,index:t,timestamp:Date.now(),title:n};await x.put(\"histories\",r)}async function at(e,t,n){let r={momentIds:e,index:t,timestamp:Date.now(),title:n};return r.id=await x.put(\"histories\",r),r}async function ct(){return await x.delete(\"histories\",\"active\")}async function lt(){return await x.delete(\"histories\",IDBKeyRange.upperBound(\"\"))}async function ut(e){return await x.delete(\"histories\",e)}function mt(e){for(let t in Object.keys(e)){let n=e[t];typeof n==\"object\"&&n!==null&&(e[t]=mt(n))}if(e instanceof Array&&typeof e[0]==\"string\")if(e[0].startsWith(\"!brick-revive:\")){let t=e[0].substring(14);if(e.length!==2)throw new Error(\"malformed save data\");let n=tt.find(r=>r.name===t);if(!n)throw new Error(\"malformed save data\");return n.deserialize(e[1])}else/^!{2,}brick-revive:/.test(e[0])&&(e[0]=e[0].substring(1));else if(e instanceof Map){let t=new Map;for(let[n,r]of e)typeof n==\"object\"&&n&&(n=X(n)),typeof r==\"object\"&&r&&(r=X(r)),t.set(n,r);return t}else if(e instanceof Set){let t=new Set;for(let n of e)typeof n==\"object\"&&n&&(n=X(n)),t.add(n);return t}return e}function z(e){switch(typeof e){case\"boolean\":case\"string\":case\"number\":case\"undefined\":case\"bigint\":return e;case\"function\":case\"symbol\":throw new Error(\"Cannot serialize a \".concat(typeof e));case\"object\":return e===null?null:X(e)}}function X(e){if(Array.isArray(e))return typeof e[0]==\"string\"&&/^!+brick-revive:/.test(e[0])?[\"!\"+e[0],...e.slice(1)]:e;if(e instanceof Map){let r=new Map;for(let[s,o]of e)r.set(z(s),z(o));return r}if(e instanceof Set){let r=new Set;for(let s of e)r.add(z(s));return r}if(e instanceof Date||e instanceof RegExp)return e;for(let r of tt)if(e instanceof r.constructor)return[\"!brick-revive:\".concat(r.name),z(r.serialize(e))];let t=Object.getPrototypeOf(e);if(t!==null&&t!==Object.prototype)throw new Error(\"Can't serialize an object with an unknown prototype\");let n={};for(let r in e)n[r]=z(e[r]);return n}var F,M,D,h,ce,j,A,T;async function ft(){F=ee(\"brick-main\"),F.innerHTML=\"\",M=[],D=[],h=-1,ce=0,j=\"\",A={},T={}}async function pt(){if(!await Ie(\"active\")){let e={passageName:we().name,timestamp:Date.now(),turnCount:1,vars:A};D=[e],M=[await Se(e)],h=0,ue(),await le(),Y()}}async function le(){let e=D[h];e||(e=await rt(M[h]),D[h]=e),A=N(e.vars),ce=e.turnCount,j=e.passageName}async function se(){if(h===0)return!1;if(w.stream){let e=Array.from(document.querySelectorAll(\".brick-passage\"));for(let t of e.slice(-2))t.remove()}return h--,await le(),ue(),Y(),!0}async function oe(){return h===M.length-1?!1:(h++,await le(),ue(),Y(),!0)}async function Je(e){j=typeof e==\"string\"?e:e.name,M.length=h+1,D.length=h+1;let t={passageName:j,timestamp:Date.now(),turnCount:ce,vars:N(A)};D.push(t),M.push(await Se(t)),h++,ue(),Y()}async function ht(){return await at(M,h,gt())}async function Ie(e){let t=await st(e);if(t)M=t.momentIds,D=Array(M.length),D.fill(void 0),h=t.index;else return!1;return await le(),F.innerHTML=\"\",Y(),!0}function gt(){return\"\".concat(j,\" | Turn \").concat(ce)}function ue(){return it(M,h,gt())}function Y(){if(T={},w.stream){for(let r of F.querySelectorAll(\":enabled\"))r.setAttribute(\"disabled\",\"\");for(let r of document.querySelectorAll(\".brick-active-passage\"))r.classList.remove(\"brick-active-passage\")}else F.innerHTML=\"\";let e=c(\"article\",{class:\"brick-passage brick-active-passage brick-transparent\"});S(e,j);let t=_(\"StoryHeader\"),n=_(\"StoryFooter\");if(t){let r=c(\"header\");S(r,t),e.prepend(r)}if(n){let r=c(\"footer\");S(r,n),e.append(r)}F.append(e),e.scrollIntoView(),setTimeout(()=>e.classList.remove(\"brick-transparent\"),40)}function wt(){ct(),window.location.reload()}function je(){for(let e of document.querySelectorAll(\".brick-macro-redoable\"))e.dispatchEvent(new CustomEvent(\"brick-redo\"))}var y,Z,I;function yt(){let e=ee(\"brick-dialog\");if(e instanceof HTMLDialogElement)y=e;else throw new Error(\"#brick-dialog was not a <dialog> element\");me(),y.addEventListener(\"click\",t=>{let n=y.getBoundingClientRect(),{clientX:r,clientY:s}=t;n.top<=s&&s<=n.top+n.height&&n.left<=r&&r<=n.left+n.width||y.close()})}function me(){y.innerHTML=\"\",y.className=\"\",Z=c(\"h1\");let e=c(\"div\",{},Z);I=c(\"div\"),y.append(e,I)}function qe(e){me(),Z.append(e),S(I,e),y.showModal()}async function kt(){me(),Z.append(\"Saves\"),I.append(\"Loading...\"),y.classList.add(\"brick-saves-menu\"),y.showModal();let e=await ot();e.sort((s,o)=>o.timestamp-s.timestamp);let t=await Promise.all(e.map(Et));I.innerHTML=\"\";let n=c(\"ul\");I.append(n),t.length===0?n.append(c(\"li\",{class:\"brick-saves-empty\"},c(\"em\",{},\"No saves found\"))):n.append(...t);let r=c(\"div\",{class:\"brick-saves-buttons\"});Le(n,r),I.append(r)}function Le(e,t){let n=c(\"button\",{class:\"brick-ui-btn\"},\"Delete\");n.addEventListener(\"click\",()=>{for(let i of e.querySelectorAll(\"button\"))i.removeEventListener(\"click\",Ae),i.addEventListener(\"click\",xt),i.textContent=\"Delete\";tn(e,t)});let r=c(\"button\",{class:\"brick-ui-btn\"},\"Export\");r.addEventListener(\"click\",()=>alert(\"Not supported yet\"));let s=c(\"button\",{class:\"brick-ui-btn\"},\"Import\");s.addEventListener(\"click\",()=>alert(\"Not supported yet\"));let o=c(\"button\",{class:\"brick-ui-btn\"},\"Save\");o.addEventListener(\"click\",async()=>{var a;let i=await ht();(a=e.querySelector(\".brick-saves-empty\"))==null||a.remove(),e.prepend(Et(i))}),t.innerHTML=\"\",t.append(n,r,s,o)}function tn(e,t){let n=c(\"button\",{class:\"brick-ui-btn\",disabled:\"\"},\"Delete All\");n.addEventListener(\"click\",async function(){this.disabled=!0,await lt(),e.innerHTML=\"\",e.append(c(\"li\",{},c(\"em\",{},\"No saves found\"))),Le(e,t)}),setTimeout(()=>{n.disabled=!1},3e3);let r=c(\"button\",{class:\"brick-ui-btn\"},\"Cancel\");r.addEventListener(\"click\",()=>{for(let s of e.querySelectorAll(\"button\"))s.removeEventListener(\"click\",xt),s.addEventListener(\"click\",Ae),s.textContent=\"Load\";Le(e,t)}),t.innerHTML=\"\",t.append(n,r)}function Et(e){let t=new Date(e.timestamp).toLocaleString(),{id:n}=e;if(!n)throw new Error(\"Tried to create a save menu entry for an unsaved History\");let r=c(\"button\",{class:\"brick-ui-btn\",\"data-brick-history-id\":String(n)},\"Load\");return r.addEventListener(\"click\",Ae),c(\"li\",{},c(\"div\",{},e.title,c(\"br\"),c(\"small\",{},t)),r)}async function Ae(){let e=Number(this.dataset.brickHistoryId);if(e!==e)throw new Error('Tried to load invalid ID \"'.concat(this.dataset.brickHistoryId));if(y.close(),!await Ie(e))throw new Error(\"Could not load history #\".concat(e))}async function xt(){var n,r;let e=Number(this.dataset.brickHistoryId);if(e!==e)throw new Error('Tried to delete invalid ID \"'.concat(this.dataset.brickHistoryId));await ut(e);let t=(n=this.parentElement)==null?void 0:n.parentElement;(r=this.parentElement)==null||r.remove(),t&&t.childElementCount===0&&t.append(c(\"li\",{class:\"brick-saves-empty\"},c(\"em\",{},\"No saves found\")))}function vt(){me(),Z.textContent=\"Restart\",I.append(c(\"p\",{},\"Are you sure you would like to restart?\"));let e=c(\"button\",{class:\"brick-ui-btn\"},\"Restart\");e.addEventListener(\"click\",wt);let t=c(\"button\",{class:\"brick-ui-btn\"},\"Cancel\");t.addEventListener(\"click\",()=>y.close()),I.append(e,t),y.showModal()}window.addEventListener(\"error\",e=>{let{error:t}=e,n=\"\";t instanceof Error?(n+=\"Fatal Error!\\n\",n+=t.toString(),t.stack&&(n+=\"\\n\"+t.stack)):t instanceof E?n+=\"@\".concat(t.type,' was called outside a loop, at \"').concat(t.context.passageName,'\" line ').concat(t.context.lineNumber):(n+=\"Non-error object was thrown and not caught:\\n\",n+=String(e)),alert(n)});window.addEventListener(\"unhandledrejection\",e=>{let{reason:t}=e;alert(\"Fatal Error!\\n\".concat(t))});window.Brick=J;var Q=document.getElementsByTagName(\"tw-storydata\")[0];ge(Q);var rn=Q.querySelectorAll('style[type=\"text/twine-css\"]'),sn=Q.querySelectorAll('script[type=\"text/twine-javascript\"]'),on=Q.getAttribute(\"name\")||(()=>{throw new Error(\"Story has no title\")})(),an=Q.getAttribute(\"ifid\")||\"00000000-0000-4000-A000-000000000000\";for(let e of rn){let t=c(\"style\",{class:\"brick-author-style\"},e.textContent);document.head.appendChild(t)}function de(e,t){var n;(n=document.getElementById(e))==null||n.addEventListener(\"click\",t)}de(\"brick-history-backward\",se);de(\"brick-history-forward\",oe);de(\"brick-saves\",kt);de(\"brick-restart\",vt);async function cn(){yt(),await nt(on,an),await ft();for(let e of sn)K(e.textContent);await pt()}cn();})();\n</script>\n</body>\n\n</html>\n","hydrate":"\"use strict\";function startState(){return{blockComment:!1,expectMacroBody:!1,js:!1,nesting:[],jsNesting:[]}}const KEYWORDS=\"break case catch class const continue debugger default delete do else export extends false finally for function if import in instanceof new null return super switch this throw true try typeof var void while with let static yield await enum implements interface package private protected public arguments as async eval from get of set undefined\".split(\" \"),OPERATORS=[\"!\",\"!=\",\"!==\",\"%\",\"%=\",\"&\",\"&&\",\"&=\",\"&&=\",\"*\",\"**\",\"*=\",\"**=\",\"+\",\"++\",\"+=\",\"-\",\"--\",\"-=\",\"/\",\"/=\",\"<\",\"<<\",\"<=\",\"<<=\",\"=\",\"==\",\"===\",\">\",\">>\",\">>>\",\">=\",\">>=\",\">>>=\",\"^\",\"^=\",\"|\",\"||\",\"|=\",\"||=\",\"~\"],RE_NUMBER_ERROR=/^[0-9.a-fA-F]+n?/,RE_NUMBER_LEADING_ZERO=/^(?:[bB](?:_?[01])+n?|[oO](?:_?[0-7])+n?|[xX](?:_?[0-9a-fA-F])+n?|n|(?:\\.(?:_?[0-9])*)?(?:[eE](?:_?[0-9])+)?)/,RE_POSTNUMBER_ERROR=/^[0-9\\p{ID_Start}]/u;function tokenJsNumber(e,n){if(n===\"0\"){if(e.match(RE_NUMBER_LEADING_ZERO))return e.match(RE_POSTNUMBER_ERROR)?\"error number\":\"number\";if(e.eol()||e.peek().match(/^[^0-9\\p{ID_Start}]/u))return e.match(RE_POSTNUMBER_ERROR)?\"error number\":\"number\"}else if(n===\".\"){if(e.match(/^(?:_?[0-9])+(?:[eE](?:_?[0-9])+)?/))return e.match(RE_POSTNUMBER_ERROR)?\"error number\":\"number\"}else if(e.match(/^(?:(?:_?[0-9])*(?:\\.(?:_?[0-9])*)?(?:[eE](?:_?[0-9])+)?|(?:_?[0-9])*n)/))return e.match(RE_POSTNUMBER_ERROR)?\"error number\":\"number\";return e.match(RE_NUMBER_ERROR),\"error number\"}function tokenJs(e,n){if(e.match(/^[!%&*+\\-<=>^|~]+/))return OPERATORS.includes(e.current())?\"operator\":\"error operator\";if(e.match(/^[$_a-zA-Z][$_a-zA-Z0-9]*/))return[\"$\",\"_\"].includes(e.current()[0])?\"variable-3\":KEYWORDS.includes(e.current())?\"keyword\":\"variable\";const r=e.next();if(r>=\"0\"&&r<=\"9\"||r===\".\")return tokenJsNumber(e,r);switch(r){case\"/\":return e.peek()===\"/\"?(e.skipToEnd(),\"comment\"):e.peek()===\"*\"?(e.next(),n.blockComment=!0,\"comment\"):(e.eat(\"=\"),\"operator\");case\"(\":return n.jsNesting.push(\")\"),\"bracket\";case\"{\":return n.jsNesting.push(\"}\"),\"bracket\";case\"[\":return n.jsNesting.push(\"]\"),\"bracket\";case\")\":case\"}\":case\"]\":return r===n.jsNesting[n.jsNesting.length-1]?(n.jsNesting.pop(),n.jsNesting.length===0?(n.js=!1,n.expectMacroBody=!0,e.eatSpace(),\"variable-2\"):\"bracket\"):\"bracket error\";case'\"':return e.match(/^(?:[^\\\\\"]|\\\\[^]])*\"/)?\"string\":(e.skipToEnd(),\"string error\");case\"'\":return e.match(/^(?:[^\\\\']|\\\\[^])*'/)?\"string\":(e.skipToEnd(),\"string error\");default:return e.eatSpace(),null}}function token(e,n){if(n.blockComment)return e.match(/^[^]*?\\*\\//)?n.blockComment=!1:e.skipToEnd(),\"comment\";if(n.js)return tokenJs(e,n);const r=e.next();if(n.expectMacroBody&&(n.expectMacroBody=!1,r===\"{\"))return n.nesting.push(\"}\"),\"bracket\";switch(r){case\"$\":case\"_\":return e.match(/^[$_a-zA-Z]/)?(e.match(/^[$_a-zA-Z0-9]*/),\"variable-3\"):\"error\";case\"/\":return e.peek()===\"/\"?(e.skipToEnd(),\"comment\"):e.peek()===\"*\"?(e.next(),n.blockComment=!0,\"comment\"):null;case\"@\":return e.match(/^[a-zA-Z]*\\s*\\(/)?(n.jsNesting=[\")\"],n.js=!0,\"variable-2\"):e.match(/^[a-zA-Z]*\\s*\\{/)?(e.backUp(1),n.expectMacroBody=!0,\"variable-2\"):\"error\";case\"}\":return n.nesting[n.nesting.length-1]===\"}\"?(n.nesting.pop(),\"bracket\"):null;case\"\\\\\":return e.next()?\"atom\":\"error\";default:return e.match(/^[^$_/@{}\\\\]*/),null}}function mode(){return{startState,token}}this.editorExtensions={twine:{\"^2.0.0\":{codeMirror:{mode}}}};\n","url":"https://github.com/cjneidhart/brick","license":"GPL-3.0"});