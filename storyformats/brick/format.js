window.storyFormat({"name":"Brick","version":"0.1.0","author":"OrangeChris","image":"icon.svg","description":"A fully featured, highly customizable story format with numerous programming features and a rich passage editor. No Harlowe experience required. <a href=\"https://github.com/cjneidhart/brick\">Homepage</a>","source":"<!DOCTYPE html>\n<html lang=\"en-US\" data-bs-theme=\"dark\">\n\n<head>\n  <meta charset=\"utf-8\">\n  <title>{{STORY_NAME}}</title>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <style id=\"style-bootstrap\">\n    /*!\n * Bootstrap Reboot v5.3.3 (https://getbootstrap.com/)\n * Copyright 2011-2024 The Bootstrap Authors\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n */:root,[data-bs-theme=light]{--bs-blue:#0d6efd;--bs-indigo:#6610f2;--bs-purple:#6f42c1;--bs-pink:#d63384;--bs-red:#dc3545;--bs-orange:#fd7e14;--bs-yellow:#ffc107;--bs-green:#198754;--bs-teal:#20c997;--bs-cyan:#0dcaf0;--bs-black:#000;--bs-white:#fff;--bs-gray:#6c757d;--bs-gray-dark:#343a40;--bs-gray-100:#f8f9fa;--bs-gray-200:#e9ecef;--bs-gray-300:#dee2e6;--bs-gray-400:#ced4da;--bs-gray-500:#adb5bd;--bs-gray-600:#6c757d;--bs-gray-700:#495057;--bs-gray-800:#343a40;--bs-gray-900:#212529;--bs-primary:#0d6efd;--bs-secondary:#6c757d;--bs-success:#198754;--bs-info:#0dcaf0;--bs-warning:#ffc107;--bs-danger:#dc3545;--bs-light:#f8f9fa;--bs-dark:#212529;--bs-primary-rgb:13,110,253;--bs-secondary-rgb:108,117,125;--bs-success-rgb:25,135,84;--bs-info-rgb:13,202,240;--bs-warning-rgb:255,193,7;--bs-danger-rgb:220,53,69;--bs-light-rgb:248,249,250;--bs-dark-rgb:33,37,41;--bs-primary-text-emphasis:#052c65;--bs-secondary-text-emphasis:#2b2f32;--bs-success-text-emphasis:#0a3622;--bs-info-text-emphasis:#055160;--bs-warning-text-emphasis:#664d03;--bs-danger-text-emphasis:#58151c;--bs-light-text-emphasis:#495057;--bs-dark-text-emphasis:#495057;--bs-primary-bg-subtle:#cfe2ff;--bs-secondary-bg-subtle:#e2e3e5;--bs-success-bg-subtle:#d1e7dd;--bs-info-bg-subtle:#cff4fc;--bs-warning-bg-subtle:#fff3cd;--bs-danger-bg-subtle:#f8d7da;--bs-light-bg-subtle:#fcfcfd;--bs-dark-bg-subtle:#ced4da;--bs-primary-border-subtle:#9ec5fe;--bs-secondary-border-subtle:#c4c8cb;--bs-success-border-subtle:#a3cfbb;--bs-info-border-subtle:#9eeaf9;--bs-warning-border-subtle:#ffe69c;--bs-danger-border-subtle:#f1aeb5;--bs-light-border-subtle:#e9ecef;--bs-dark-border-subtle:#adb5bd;--bs-white-rgb:255,255,255;--bs-black-rgb:0,0,0;--bs-font-sans-serif:system-ui,-apple-system,\"Segoe UI\",Roboto,\"Helvetica Neue\",\"Noto Sans\",\"Liberation Sans\",Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\";--bs-font-monospace:SFMono-Regular,Menlo,Monaco,Consolas,\"Liberation Mono\",\"Courier New\",monospace;--bs-gradient:linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));--bs-body-font-family:var(--bs-font-sans-serif);--bs-body-font-size:1rem;--bs-body-font-weight:400;--bs-body-line-height:1.5;--bs-body-color:#212529;--bs-body-color-rgb:33,37,41;--bs-body-bg:#fff;--bs-body-bg-rgb:255,255,255;--bs-emphasis-color:#000;--bs-emphasis-color-rgb:0,0,0;--bs-secondary-color:rgba(33, 37, 41, 0.75);--bs-secondary-color-rgb:33,37,41;--bs-secondary-bg:#e9ecef;--bs-secondary-bg-rgb:233,236,239;--bs-tertiary-color:rgba(33, 37, 41, 0.5);--bs-tertiary-color-rgb:33,37,41;--bs-tertiary-bg:#f8f9fa;--bs-tertiary-bg-rgb:248,249,250;--bs-heading-color:inherit;--bs-link-color:#0d6efd;--bs-link-color-rgb:13,110,253;--bs-link-decoration:underline;--bs-link-hover-color:#0a58ca;--bs-link-hover-color-rgb:10,88,202;--bs-code-color:#d63384;--bs-highlight-color:#212529;--bs-highlight-bg:#fff3cd;--bs-border-width:1px;--bs-border-style:solid;--bs-border-color:#dee2e6;--bs-border-color-translucent:rgba(0, 0, 0, 0.175);--bs-border-radius:0.375rem;--bs-border-radius-sm:0.25rem;--bs-border-radius-lg:0.5rem;--bs-border-radius-xl:1rem;--bs-border-radius-xxl:2rem;--bs-border-radius-2xl:var(--bs-border-radius-xxl);--bs-border-radius-pill:50rem;--bs-box-shadow:0 0.5rem 1rem rgba(0, 0, 0, 0.15);--bs-box-shadow-sm:0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);--bs-box-shadow-lg:0 1rem 3rem rgba(0, 0, 0, 0.175);--bs-box-shadow-inset:inset 0 1px 2px rgba(0, 0, 0, 0.075);--bs-focus-ring-width:0.25rem;--bs-focus-ring-opacity:0.25;--bs-focus-ring-color:rgba(13, 110, 253, 0.25);--bs-form-valid-color:#198754;--bs-form-valid-border-color:#198754;--bs-form-invalid-color:#dc3545;--bs-form-invalid-border-color:#dc3545}[data-bs-theme=dark]{color-scheme:dark;--bs-body-color:#dee2e6;--bs-body-color-rgb:222,226,230;--bs-body-bg:#212529;--bs-body-bg-rgb:33,37,41;--bs-emphasis-color:#fff;--bs-emphasis-color-rgb:255,255,255;--bs-secondary-color:rgba(222, 226, 230, 0.75);--bs-secondary-color-rgb:222,226,230;--bs-secondary-bg:#343a40;--bs-secondary-bg-rgb:52,58,64;--bs-tertiary-color:rgba(222, 226, 230, 0.5);--bs-tertiary-color-rgb:222,226,230;--bs-tertiary-bg:#2b3035;--bs-tertiary-bg-rgb:43,48,53;--bs-primary-text-emphasis:#6ea8fe;--bs-secondary-text-emphasis:#a7acb1;--bs-success-text-emphasis:#75b798;--bs-info-text-emphasis:#6edff6;--bs-warning-text-emphasis:#ffda6a;--bs-danger-text-emphasis:#ea868f;--bs-light-text-emphasis:#f8f9fa;--bs-dark-text-emphasis:#dee2e6;--bs-primary-bg-subtle:#031633;--bs-secondary-bg-subtle:#161719;--bs-success-bg-subtle:#051b11;--bs-info-bg-subtle:#032830;--bs-warning-bg-subtle:#332701;--bs-danger-bg-subtle:#2c0b0e;--bs-light-bg-subtle:#343a40;--bs-dark-bg-subtle:#1a1d20;--bs-primary-border-subtle:#084298;--bs-secondary-border-subtle:#41464b;--bs-success-border-subtle:#0f5132;--bs-info-border-subtle:#087990;--bs-warning-border-subtle:#997404;--bs-danger-border-subtle:#842029;--bs-light-border-subtle:#495057;--bs-dark-border-subtle:#343a40;--bs-heading-color:inherit;--bs-link-color:#6ea8fe;--bs-link-hover-color:#8bb9fe;--bs-link-color-rgb:110,168,254;--bs-link-hover-color-rgb:139,185,254;--bs-code-color:#e685b5;--bs-highlight-color:#dee2e6;--bs-highlight-bg:#664d03;--bs-border-color:#495057;--bs-border-color-translucent:rgba(255, 255, 255, 0.15);--bs-form-valid-color:#75b798;--bs-form-valid-border-color:#75b798;--bs-form-invalid-color:#ea868f;--bs-form-invalid-border-color:#ea868f}*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:var(--bs-body-font-family);font-size:var(--bs-body-font-size);font-weight:var(--bs-body-font-weight);line-height:var(--bs-body-line-height);color:var(--bs-body-color);text-align:var(--bs-body-text-align);background-color:var(--bs-body-bg);-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;border:0;border-top:var(--bs-border-width) solid;opacity:.25}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2;color:var(--bs-heading-color)}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.1875em;color:var(--bs-highlight-color);background-color:var(--bs-highlight-bg)}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:rgba(var(--bs-link-color-rgb),var(--bs-link-opacity,1));text-decoration:underline}a:hover{--bs-link-color-rgb:var(--bs-link-hover-color-rgb)}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:var(--bs-font-monospace);font-size:1em}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:var(--bs-code-color);word-wrap:break-word}a>code{color:inherit}kbd{padding:.1875rem .375rem;font-size:.875em;color:var(--bs-body-bg);background-color:var(--bs-body-color);border-radius:.25rem}kbd kbd{padding:0;font-size:1em}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:var(--bs-secondary-color);text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]:not([type=date]):not([type=datetime-local]):not([type=month]):not([type=week]):not([type=time])::-webkit-calendar-picker-indicator{display:none!important}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}::file-selector-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}\n/* */\n  </style>\n  <style id=\"style-brick\">\n    #brick-viewport {\n  display: flex;\n  flex-direction: inline;\n\n  > * {\n    flex: 1;\n  }\n}\n\n.brick-linkReplace,\n.brick-active-passage {\n  transition: opacity 0.4s;\n}\n\n.brick-transparent {\n  opacity: 0;\n}\n\n#ui-bar {\n  height: 100vh;\n  height: 100dvh;\n  border-right: 1px solid var(--bs-border-color);\n  max-width: 24rem;\n  overflow-block: scroll;\n  padding: 0.5rem;\n  position: sticky;\n  top: 0;\n}\n\n.brick-sidebar-btn {\n  background: none;\n  border: 1px solid var(--bs-border-color);\n  padding-block: 0.25rem;\n  transition:\n    color 0.15s ease-in-out,\n    background-color 0.15s ease-in-out;\n  &:hover:enabled {\n    color: var(--bs-emphasis-color);\n    background-color: var(--bs-secondary-bg);\n  }\n  &:disabled {\n    color: var(--bs-secondary);\n  }\n}\n\n#brick-history-controls {\n  display: flex;\n  flex-direction: row;\n  text-align: center;\n  width: 100%;\n  margin-bottom: 0.5rem;\n\n  > * {\n    flex-grow: 1;\n  }\n}\n\n#story-title {\n  text-align: center;\n}\n\n#brick-menu-core {\n  width: 100%;\n  text-align: center;\n  list-style: none;\n  padding: 0;\n\n  button {\n    width: 100%;\n  }\n}\n\n#brick-main {\n  max-width: 60rem;\n  margin-inline: auto;\n  /* padding-top: 1rem; */\n}\n\n.brick-passage {\n  padding-top: 1rem;\n}\n\n.brick-passage:not(:last-child) {\n  border-bottom: 1px solid currentColor;\n  /* margin-bottom: 1rem; */\n  padding-bottom: 1rem;\n}\n\n.brick-active-passage {\n  margin-bottom: 5rem;\n}\n\n#brick-dialog {\n  border-color: var(--bs-border-color);\n  border-radius: 0.5rem;\n  margin-top: 2rem;\n  max-width: 90vw;\n  max-width: 90svw;\n  min-width: 30rem;\n  overflow-x: scroll;\n  &::backdrop {\n    backdrop-filter: brightness(50%) blur(0.25rem);\n  }\n}\n\n#brick-dialog.brick-saves table {\n  border: 1px solid var(--bs-border-color);\n  width: 100%;\n\n  :is(th, td) {\n    border: 1px solid var(--bs-border-color);\n    padding: 0.25rem;\n  }\n\n  td:nth-child(3) {\n    width: 100%;\n  }\n\n  td:last-child button:enabled {\n    background-color: var(--bs-danger);\n\n    &:hover {\n      background-color: inherit;\n      color: var(--bs-danger);\n    }\n  }\n}\n\n.brick-link {\n  padding: 0;\n  border: 0;\n  background: none;\n  text-decoration: underline var(--bs-link-color);\n  color: var(--bs-link-color);\n\n  &:hover:enabled {\n    color: var(--bs-link-hover-color);\n    text-decoration-color: var(--bs-link-hover-color);\n  }\n\n  &:disabled {\n    color: var(--bs-secondary);\n    cursor: not-allowed;\n    text-decoration-color: var(--bs-secondary);\n  }\n}\n\n.brick-text-secondary {\n  color: var(--bs-secondary);\n}\n\n.brick-error {\n  background-color: hsl(0 80 20);\n  border-inline: 0.25rem solid red;\n  line-height: 2;\n  padding: 0.25rem;\n\n  code {\n    background-color: var(--bs-body-bg);\n    color: var(--bs-body-color);\n    padding: 0.125rem;\n  }\n}\n\n  </style>\n</head>\n\n<body>\n  {{STORY_DATA}}\n  <div id=\"brick-viewport\">\n    <aside id=\"ui-bar\">\n      <div id=\"brick-history-controls\">\n        <button id=\"brick-history-backward\" class=\"brick-sidebar-btn\" type=\"button\">&#x2190;</button>\n        <button id=\"brick-history-forward\" class=\"brick-sidebar-btn\" type=\"button\">&#x2192;</button>\n      </div>\n      <h1 id=\"story-title\">{{STORY_NAME}}</h1>\n      <ul id=\"brick-menu-core\">\n        <li><button id=\"brick-saves\" class=\"brick-sidebar-btn\" type=\"button\">SAVES</button></li>\n        <li><button id=\"brick-restart\" class=\"brick-sidebar-btn\" type=\"button\">RESTART</button></li>\n      </ul>\n    </aside>\n\n    <main id=\"brick-main\">\n      <noscript>JavaScript must be enabled to play this story.</noscript>\n    </main>\n  </div>\n  <dialog id=\"brick-dialog\"></dialog>\n  <script id=\"script-brick\" type=\"text/javascript\">/*\n * ATTENTION: An \"eval-source-map\" devtool has been used.\n * This devtool is neither made for production nor for readable output files.\n * It uses \"eval()\" calls to create a separate source file with attached SourceMaps in the browser devtools.\n * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)\n * or disable the default devtool with \"devtool: false\".\n * If you are looking for production-ready output files, see mode: \"production\" (https://webpack.js.org/configuration/mode/).\n */\n/******/ (() => { // webpackBootstrap\n/******/ \t\"use strict\";\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ \"./src/config.ts\":\n/*!***********************!*\\\n  !*** ./src/config.ts ***!\n  \\***********************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   \\\"default\\\": () => (__WEBPACK_DEFAULT_EXPORT__)\\n/* harmony export */ });\\nconst config = {\\n    maxLoopIterations: 10000,\\n    preProcessText: undefined,\\n    stream: false,\\n};\\nfunction throwTypeError(location, expected, got) {\\n    throw new TypeError(`${location}: expected ${expected}, got ${typeof got}`);\\n}\\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({\\n    get maxLoopIterations() {\\n        return config.maxLoopIterations;\\n    },\\n    set maxLoopIterations(value) {\\n        if (typeof value !== \\\"number\\\" || value <= 0 || value % 1 !== 0) {\\n            throw new TypeError(\\\"Config.maxLoopIterations must be a positive integer\\\");\\n        }\\n        config.maxLoopIterations = value;\\n    },\\n    get preProcessText() {\\n        return config.preProcessText;\\n    },\\n    set preProcessText(func) {\\n        if (typeof func !== \\\"undefined\\\" && typeof func !== \\\"function\\\") {\\n            throwTypeError(\\\"Config.preProcessText\\\", \\\"function or undefined\\\", func);\\n        }\\n        config.preProcessText = func;\\n    },\\n    get stream() {\\n        return config.stream;\\n    },\\n    set stream(value) {\\n        config.stream = !!value;\\n    },\\n});\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvY29uZmlnLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsU0FBUyxhQUFhLFNBQVMsUUFBUSxXQUFXO0FBQzdFO0FBQ0EsaUVBQWU7QUFDZjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9icmljay8uL3NyYy9jb25maWcudHM/NGEwZCJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjb25maWcgPSB7XG4gICAgbWF4TG9vcEl0ZXJhdGlvbnM6IDEwMDAwLFxuICAgIHByZVByb2Nlc3NUZXh0OiB1bmRlZmluZWQsXG4gICAgc3RyZWFtOiBmYWxzZSxcbn07XG5mdW5jdGlvbiB0aHJvd1R5cGVFcnJvcihsb2NhdGlvbiwgZXhwZWN0ZWQsIGdvdCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYCR7bG9jYXRpb259OiBleHBlY3RlZCAke2V4cGVjdGVkfSwgZ290ICR7dHlwZW9mIGdvdH1gKTtcbn1cbmV4cG9ydCBkZWZhdWx0IHtcbiAgICBnZXQgbWF4TG9vcEl0ZXJhdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiBjb25maWcubWF4TG9vcEl0ZXJhdGlvbnM7XG4gICAgfSxcbiAgICBzZXQgbWF4TG9vcEl0ZXJhdGlvbnModmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJudW1iZXJcIiB8fCB2YWx1ZSA8PSAwIHx8IHZhbHVlICUgMSAhPT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNvbmZpZy5tYXhMb29wSXRlcmF0aW9ucyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlclwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25maWcubWF4TG9vcEl0ZXJhdGlvbnMgPSB2YWx1ZTtcbiAgICB9LFxuICAgIGdldCBwcmVQcm9jZXNzVGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5wcmVQcm9jZXNzVGV4dDtcbiAgICB9LFxuICAgIHNldCBwcmVQcm9jZXNzVGV4dChmdW5jKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZnVuYyAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgZnVuYyAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICB0aHJvd1R5cGVFcnJvcihcIkNvbmZpZy5wcmVQcm9jZXNzVGV4dFwiLCBcImZ1bmN0aW9uIG9yIHVuZGVmaW5lZFwiLCBmdW5jKTtcbiAgICAgICAgfVxuICAgICAgICBjb25maWcucHJlUHJvY2Vzc1RleHQgPSBmdW5jO1xuICAgIH0sXG4gICAgZ2V0IHN0cmVhbSgpIHtcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5zdHJlYW07XG4gICAgfSxcbiAgICBzZXQgc3RyZWFtKHZhbHVlKSB7XG4gICAgICAgIGNvbmZpZy5zdHJlYW0gPSAhIXZhbHVlO1xuICAgIH0sXG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\\n//# sourceURL=webpack-internal:///./src/config.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/dialog.ts\":\n/*!***********************!*\\\n  !*** ./src/dialog.ts ***!\n  \\***********************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   init: () => (/* binding */ init),\\n/* harmony export */   reset: () => (/* binding */ reset),\\n/* harmony export */   showPassage: () => (/* binding */ showPassage),\\n/* harmony export */   showSavesMenu: () => (/* binding */ showSavesMenu)\\n/* harmony export */ });\\n/* harmony import */ var _engine__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./engine */ \\\"./src/engine.ts\\\");\\n/* harmony import */ var _passages__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./passages */ \\\"./src/passages.ts\\\");\\n/* harmony import */ var _renderer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./renderer */ \\\"./src/renderer.ts\\\");\\n/* harmony import */ var _saves__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./saves */ \\\"./src/saves.ts\\\");\\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./util */ \\\"./src/util.ts\\\");\\n// import * as bootstrap from \\\"bootstrap\\\";\\n\\n\\n\\n\\n\\nlet dialogElement;\\nlet titleElt;\\nlet modalBody;\\nfunction init() {\\n    const maybeDialog = (0,_util__WEBPACK_IMPORTED_MODULE_4__.getElementById)(\\\"brick-dialog\\\");\\n    if (maybeDialog instanceof HTMLDialogElement) {\\n        dialogElement = maybeDialog;\\n    }\\n    else {\\n        throw new Error(\\\"#brick-dialog was not a <dialog> element\\\");\\n    }\\n    reset();\\n    dialogElement.addEventListener(\\\"click\\\", (event) => {\\n        const rect = dialogElement.getBoundingClientRect();\\n        const { clientX: x, clientY: y } = event;\\n        const inDialog = rect.top <= y && y <= rect.top + rect.height && rect.left <= x && x <= rect.left + rect.width;\\n        if (!inDialog) {\\n            dialogElement.close();\\n        }\\n    });\\n}\\nfunction reset() {\\n    dialogElement.innerHTML = \\\"\\\";\\n    dialogElement.className = \\\"\\\";\\n    titleElt = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"h1\\\");\\n    const modalHeader = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"div\\\", {}, titleElt);\\n    modalBody = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"div\\\");\\n    dialogElement.append(modalHeader, modalBody);\\n}\\nfunction showPassage(passageName) {\\n    const passage = (0,_passages__WEBPACK_IMPORTED_MODULE_1__.get)(passageName);\\n    if (!passage) {\\n        throw new Error(`Passage not found: ${passageName}`);\\n    }\\n    reset();\\n    titleElt.append(passageName);\\n    (0,_renderer__WEBPACK_IMPORTED_MODULE_2__.render)(modalBody, passage);\\n    dialogElement.showModal();\\n}\\nfunction showSavesMenu() {\\n    reset();\\n    titleElt.append(\\\"Saves\\\");\\n    const tbody = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"tbody\\\", {});\\n    for (let i = 0; i < 8; i++) {\\n        const tr = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"tr\\\", {});\\n        updateSaveMenuRow(i, tr);\\n        tbody.append(tr);\\n    }\\n    const table = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"table\\\", { class: \\\"table table-striped border\\\" }, tbody);\\n    modalBody.append(table);\\n    dialogElement.classList.add(\\\"brick-saves\\\");\\n    dialogElement.showModal();\\n}\\nfunction updateSaveMenuRow(slotNumber, row) {\\n    const slotTitle = _saves__WEBPACK_IMPORTED_MODULE_3__.slotTitles[slotNumber];\\n    const saveLoadButton = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"button\\\", { type: \\\"button\\\", class: \\\"brick-sidebar-btn\\\" });\\n    const deleteButton = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"button\\\", { type: \\\"button\\\", class: \\\"brick-sidebar-btn\\\" }, \\\"Delete\\\");\\n    row.innerHTML = \\\"\\\";\\n    row.append((0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"th\\\", { scope: \\\"row\\\" }, String(slotNumber + 1)));\\n    row.append((0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"td\\\", {}, saveLoadButton));\\n    if (typeof slotTitle === \\\"string\\\") {\\n        row.append((0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"td\\\", {}, slotTitle));\\n        saveLoadButton.innerText = \\\"Load\\\";\\n        saveLoadButton.addEventListener(\\\"click\\\", () => {\\n            _engine__WEBPACK_IMPORTED_MODULE_0__.loadFromSlot(slotNumber);\\n            updateSaveMenuRow(slotNumber, row);\\n        });\\n        deleteButton.addEventListener(\\\"click\\\", () => {\\n            (0,_saves__WEBPACK_IMPORTED_MODULE_3__.clearSlot)(slotNumber);\\n            updateSaveMenuRow(slotNumber, row);\\n        });\\n    }\\n    else {\\n        deleteButton.disabled = true;\\n        const em = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"em\\\", {}, \\\"Empty\\\");\\n        row.append((0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"td\\\", { class: \\\"brick-text-secondary\\\" }, em));\\n        saveLoadButton.innerText = \\\"Save\\\";\\n        saveLoadButton.addEventListener(\\\"click\\\", () => {\\n            _engine__WEBPACK_IMPORTED_MODULE_0__.saveToSlot(slotNumber);\\n            updateSaveMenuRow(slotNumber, row);\\n        });\\n    }\\n    row.append((0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"td\\\", {}, deleteButton));\\n}\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZGlhbG9nLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBO0FBQ21DO0FBQ1k7QUFDWDtBQUNZO0FBQ0s7QUFDckQ7QUFDQTtBQUNBO0FBQ087QUFDUCx3QkFBd0IscURBQWM7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHlCQUF5QjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNPO0FBQ1A7QUFDQTtBQUNBLGVBQWUsa0RBQVc7QUFDMUIsd0JBQXdCLGtEQUFXLFVBQVU7QUFDN0MsZ0JBQWdCLGtEQUFXO0FBQzNCO0FBQ0E7QUFDTztBQUNQLG9CQUFvQiw4Q0FBVTtBQUM5QjtBQUNBLDhDQUE4QyxZQUFZO0FBQzFEO0FBQ0E7QUFDQTtBQUNBLElBQUksaURBQU07QUFDVjtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0Esa0JBQWtCLGtEQUFXLFlBQVk7QUFDekMsb0JBQW9CLE9BQU87QUFDM0IsbUJBQW1CLGtEQUFXLFNBQVM7QUFDdkM7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGtEQUFXLFlBQVkscUNBQXFDO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsOENBQVU7QUFDaEMsMkJBQTJCLGtEQUFXLGFBQWEsNENBQTRDO0FBQy9GLHlCQUF5QixrREFBVyxhQUFhLDRDQUE0QztBQUM3RjtBQUNBLGVBQWUsa0RBQVcsU0FBUyxjQUFjO0FBQ2pELGVBQWUsa0RBQVcsU0FBUztBQUNuQztBQUNBLG1CQUFtQixrREFBVyxTQUFTO0FBQ3ZDO0FBQ0E7QUFDQSxZQUFZLGlEQUFtQjtBQUMvQjtBQUNBLFNBQVM7QUFDVDtBQUNBLFlBQVksaURBQVM7QUFDckI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLGtEQUFXLFNBQVM7QUFDdkMsbUJBQW1CLGtEQUFXLFNBQVMsK0JBQStCO0FBQ3RFO0FBQ0E7QUFDQSxZQUFZLCtDQUFpQjtBQUM3QjtBQUNBLFNBQVM7QUFDVDtBQUNBLGVBQWUsa0RBQVcsU0FBUztBQUNuQyIsInNvdXJjZXMiOlsid2VicGFjazovL2JyaWNrLy4vc3JjL2RpYWxvZy50cz8yZWRiIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCAqIGFzIGJvb3RzdHJhcCBmcm9tIFwiYm9vdHN0cmFwXCI7XG5pbXBvcnQgKiBhcyBlbmdpbmUgZnJvbSBcIi4vZW5naW5lXCI7XG5pbXBvcnQgeyBnZXQgYXMgZ2V0UGFzc2FnZSB9IGZyb20gXCIuL3Bhc3NhZ2VzXCI7XG5pbXBvcnQgeyByZW5kZXIgfSBmcm9tIFwiLi9yZW5kZXJlclwiO1xuaW1wb3J0IHsgY2xlYXJTbG90LCBzbG90VGl0bGVzIH0gZnJvbSBcIi4vc2F2ZXNcIjtcbmltcG9ydCB7IGdldEVsZW1lbnRCeUlkLCBtYWtlRWxlbWVudCB9IGZyb20gXCIuL3V0aWxcIjtcbmxldCBkaWFsb2dFbGVtZW50O1xubGV0IHRpdGxlRWx0O1xubGV0IG1vZGFsQm9keTtcbmV4cG9ydCBmdW5jdGlvbiBpbml0KCkge1xuICAgIGNvbnN0IG1heWJlRGlhbG9nID0gZ2V0RWxlbWVudEJ5SWQoXCJicmljay1kaWFsb2dcIik7XG4gICAgaWYgKG1heWJlRGlhbG9nIGluc3RhbmNlb2YgSFRNTERpYWxvZ0VsZW1lbnQpIHtcbiAgICAgICAgZGlhbG9nRWxlbWVudCA9IG1heWJlRGlhbG9nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiI2JyaWNrLWRpYWxvZyB3YXMgbm90IGEgPGRpYWxvZz4gZWxlbWVudFwiKTtcbiAgICB9XG4gICAgcmVzZXQoKTtcbiAgICBkaWFsb2dFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgcmVjdCA9IGRpYWxvZ0VsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIGNvbnN0IHsgY2xpZW50WDogeCwgY2xpZW50WTogeSB9ID0gZXZlbnQ7XG4gICAgICAgIGNvbnN0IGluRGlhbG9nID0gcmVjdC50b3AgPD0geSAmJiB5IDw9IHJlY3QudG9wICsgcmVjdC5oZWlnaHQgJiYgcmVjdC5sZWZ0IDw9IHggJiYgeCA8PSByZWN0LmxlZnQgKyByZWN0LndpZHRoO1xuICAgICAgICBpZiAoIWluRGlhbG9nKSB7XG4gICAgICAgICAgICBkaWFsb2dFbGVtZW50LmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZXNldCgpIHtcbiAgICBkaWFsb2dFbGVtZW50LmlubmVySFRNTCA9IFwiXCI7XG4gICAgZGlhbG9nRWxlbWVudC5jbGFzc05hbWUgPSBcIlwiO1xuICAgIHRpdGxlRWx0ID0gbWFrZUVsZW1lbnQoXCJoMVwiKTtcbiAgICBjb25zdCBtb2RhbEhlYWRlciA9IG1ha2VFbGVtZW50KFwiZGl2XCIsIHt9LCB0aXRsZUVsdCk7XG4gICAgbW9kYWxCb2R5ID0gbWFrZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgZGlhbG9nRWxlbWVudC5hcHBlbmQobW9kYWxIZWFkZXIsIG1vZGFsQm9keSk7XG59XG5leHBvcnQgZnVuY3Rpb24gc2hvd1Bhc3NhZ2UocGFzc2FnZU5hbWUpIHtcbiAgICBjb25zdCBwYXNzYWdlID0gZ2V0UGFzc2FnZShwYXNzYWdlTmFtZSk7XG4gICAgaWYgKCFwYXNzYWdlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgUGFzc2FnZSBub3QgZm91bmQ6ICR7cGFzc2FnZU5hbWV9YCk7XG4gICAgfVxuICAgIHJlc2V0KCk7XG4gICAgdGl0bGVFbHQuYXBwZW5kKHBhc3NhZ2VOYW1lKTtcbiAgICByZW5kZXIobW9kYWxCb2R5LCBwYXNzYWdlKTtcbiAgICBkaWFsb2dFbGVtZW50LnNob3dNb2RhbCgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNob3dTYXZlc01lbnUoKSB7XG4gICAgcmVzZXQoKTtcbiAgICB0aXRsZUVsdC5hcHBlbmQoXCJTYXZlc1wiKTtcbiAgICBjb25zdCB0Ym9keSA9IG1ha2VFbGVtZW50KFwidGJvZHlcIiwge30pO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHRyID0gbWFrZUVsZW1lbnQoXCJ0clwiLCB7fSk7XG4gICAgICAgIHVwZGF0ZVNhdmVNZW51Um93KGksIHRyKTtcbiAgICAgICAgdGJvZHkuYXBwZW5kKHRyKTtcbiAgICB9XG4gICAgY29uc3QgdGFibGUgPSBtYWtlRWxlbWVudChcInRhYmxlXCIsIHsgY2xhc3M6IFwidGFibGUgdGFibGUtc3RyaXBlZCBib3JkZXJcIiB9LCB0Ym9keSk7XG4gICAgbW9kYWxCb2R5LmFwcGVuZCh0YWJsZSk7XG4gICAgZGlhbG9nRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYnJpY2stc2F2ZXNcIik7XG4gICAgZGlhbG9nRWxlbWVudC5zaG93TW9kYWwoKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZVNhdmVNZW51Um93KHNsb3ROdW1iZXIsIHJvdykge1xuICAgIGNvbnN0IHNsb3RUaXRsZSA9IHNsb3RUaXRsZXNbc2xvdE51bWJlcl07XG4gICAgY29uc3Qgc2F2ZUxvYWRCdXR0b24gPSBtYWtlRWxlbWVudChcImJ1dHRvblwiLCB7IHR5cGU6IFwiYnV0dG9uXCIsIGNsYXNzOiBcImJyaWNrLXNpZGViYXItYnRuXCIgfSk7XG4gICAgY29uc3QgZGVsZXRlQnV0dG9uID0gbWFrZUVsZW1lbnQoXCJidXR0b25cIiwgeyB0eXBlOiBcImJ1dHRvblwiLCBjbGFzczogXCJicmljay1zaWRlYmFyLWJ0blwiIH0sIFwiRGVsZXRlXCIpO1xuICAgIHJvdy5pbm5lckhUTUwgPSBcIlwiO1xuICAgIHJvdy5hcHBlbmQobWFrZUVsZW1lbnQoXCJ0aFwiLCB7IHNjb3BlOiBcInJvd1wiIH0sIFN0cmluZyhzbG90TnVtYmVyICsgMSkpKTtcbiAgICByb3cuYXBwZW5kKG1ha2VFbGVtZW50KFwidGRcIiwge30sIHNhdmVMb2FkQnV0dG9uKSk7XG4gICAgaWYgKHR5cGVvZiBzbG90VGl0bGUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcm93LmFwcGVuZChtYWtlRWxlbWVudChcInRkXCIsIHt9LCBzbG90VGl0bGUpKTtcbiAgICAgICAgc2F2ZUxvYWRCdXR0b24uaW5uZXJUZXh0ID0gXCJMb2FkXCI7XG4gICAgICAgIHNhdmVMb2FkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBlbmdpbmUubG9hZEZyb21TbG90KHNsb3ROdW1iZXIpO1xuICAgICAgICAgICAgdXBkYXRlU2F2ZU1lbnVSb3coc2xvdE51bWJlciwgcm93KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY2xlYXJTbG90KHNsb3ROdW1iZXIpO1xuICAgICAgICAgICAgdXBkYXRlU2F2ZU1lbnVSb3coc2xvdE51bWJlciwgcm93KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBkZWxldGVCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICBjb25zdCBlbSA9IG1ha2VFbGVtZW50KFwiZW1cIiwge30sIFwiRW1wdHlcIik7XG4gICAgICAgIHJvdy5hcHBlbmQobWFrZUVsZW1lbnQoXCJ0ZFwiLCB7IGNsYXNzOiBcImJyaWNrLXRleHQtc2Vjb25kYXJ5XCIgfSwgZW0pKTtcbiAgICAgICAgc2F2ZUxvYWRCdXR0b24uaW5uZXJUZXh0ID0gXCJTYXZlXCI7XG4gICAgICAgIHNhdmVMb2FkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBlbmdpbmUuc2F2ZVRvU2xvdChzbG90TnVtYmVyKTtcbiAgICAgICAgICAgIHVwZGF0ZVNhdmVNZW51Um93KHNsb3ROdW1iZXIsIHJvdyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByb3cuYXBwZW5kKG1ha2VFbGVtZW50KFwidGRcIiwge30sIGRlbGV0ZUJ1dHRvbikpO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\\n//# sourceURL=webpack-internal:///./src/dialog.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/engine.ts\":\n/*!***********************!*\\\n  !*** ./src/engine.ts ***!\n  \\***********************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   backward: () => (/* binding */ backward),\\n/* harmony export */   forward: () => (/* binding */ forward),\\n/* harmony export */   init: () => (/* binding */ init),\\n/* harmony export */   loadFromActive: () => (/* binding */ loadFromActive),\\n/* harmony export */   loadFromSlot: () => (/* binding */ loadFromSlot),\\n/* harmony export */   navigate: () => (/* binding */ navigate),\\n/* harmony export */   redo: () => (/* binding */ redo),\\n/* harmony export */   restart: () => (/* binding */ restart),\\n/* harmony export */   saveToSlot: () => (/* binding */ saveToSlot),\\n/* harmony export */   storyVariables: () => (/* binding */ storyVariables),\\n/* harmony export */   tempVariables: () => (/* binding */ tempVariables)\\n/* harmony export */ });\\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ \\\"./src/config.ts\\\");\\n/* harmony import */ var _passages__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./passages */ \\\"./src/passages.ts\\\");\\n/* harmony import */ var _renderer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./renderer */ \\\"./src/renderer.ts\\\");\\n/* harmony import */ var _saves__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./saves */ \\\"./src/saves.ts\\\");\\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./util */ \\\"./src/util.ts\\\");\\n\\n\\n\\n\\n\\nlet mainElement;\\nlet history;\\nlet index;\\nlet storyVariables;\\nlet tempVariables;\\n/** Initialize the engine */\\nfunction init() {\\n    mainElement = (0,_util__WEBPACK_IMPORTED_MODULE_4__.getElementById)(\\\"brick-main\\\");\\n    mainElement.innerHTML = \\\"\\\";\\n    history = [];\\n    index = -1;\\n    storyVariables = {};\\n    tempVariables = {};\\n}\\n/** Attempt to move backwards in history. Returns whether the navigation was successful. */\\nfunction backward() {\\n    if (index === 0) {\\n        return false;\\n    }\\n    else {\\n        if (_config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"].stream) {\\n            const elts = Array.from(document.querySelectorAll(\\\".brick-passage\\\"));\\n            for (const elt of elts.slice(-2)) {\\n                elt.remove();\\n            }\\n        }\\n        index--;\\n        _saves__WEBPACK_IMPORTED_MODULE_3__.saveActive({ history, index });\\n        renderActive();\\n        return true;\\n    }\\n}\\n/** Attempt to move forward in history. Returns whether the navigation was successful. */\\nfunction forward() {\\n    if (index === history.length - 1) {\\n        return false;\\n    }\\n    else {\\n        index++;\\n        _saves__WEBPACK_IMPORTED_MODULE_3__.saveActive({ history, index });\\n        renderActive();\\n        return true;\\n    }\\n}\\n/** Navigate to the given passage, creating a new moment in the history. */\\nfunction navigate(passage) {\\n    const passageName = typeof passage === \\\"string\\\" ? passage : passage.name;\\n    // clear moments past the current index\\n    history.length = index + 1;\\n    const newMoment = {\\n        passageName,\\n        vars: (0,_util__WEBPACK_IMPORTED_MODULE_4__.clone)(storyVariables),\\n    };\\n    history.push(newMoment);\\n    index++;\\n    _saves__WEBPACK_IMPORTED_MODULE_3__.saveActive({ history, index });\\n    renderActive();\\n}\\n/** Render the active moment. */\\nfunction renderActive() {\\n    const moment = history[index];\\n    if (!moment) {\\n        throw new Error(`No active moment at index ${index}`);\\n    }\\n    const psg = (0,_passages__WEBPACK_IMPORTED_MODULE_1__.get)(moment.passageName);\\n    if (!psg) {\\n        throw new Error(`Couldn't find passage \\\"${moment.passageName}\\\"`);\\n    }\\n    storyVariables = (0,_util__WEBPACK_IMPORTED_MODULE_4__.clone)(moment.vars);\\n    tempVariables = {};\\n    if (_config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"].stream) {\\n        for (const elt of mainElement.querySelectorAll(\\\":enabled\\\")) {\\n            elt.setAttribute(\\\"disabled\\\", \\\"\\\");\\n        }\\n        for (const elt of document.querySelectorAll(\\\".brick-active-passage\\\")) {\\n            elt.classList.remove(\\\"brick-active-passage\\\");\\n        }\\n        // container.append(makeElement(\\\"hr\\\"));\\n    }\\n    else {\\n        mainElement.innerHTML = \\\"\\\";\\n    }\\n    const article = (0,_util__WEBPACK_IMPORTED_MODULE_4__.makeElement)(\\\"article\\\", {\\n        class: \\\"brick-passage brick-active-passage brick-transparent\\\",\\n    });\\n    const header = (0,_passages__WEBPACK_IMPORTED_MODULE_1__.get)(\\\"StoryHeader\\\");\\n    const footer = (0,_passages__WEBPACK_IMPORTED_MODULE_1__.get)(\\\"StoryFooter\\\");\\n    if (header)\\n        (0,_renderer__WEBPACK_IMPORTED_MODULE_2__.render)(article, header);\\n    (0,_renderer__WEBPACK_IMPORTED_MODULE_2__.render)(article, psg);\\n    if (footer)\\n        (0,_renderer__WEBPACK_IMPORTED_MODULE_2__.render)(article, footer);\\n    mainElement.append(article);\\n    article.scrollIntoView();\\n    setTimeout(() => article.classList.remove(\\\"brick-transparent\\\"), 40);\\n}\\n/**\\n * Attempt to load from the \\\"active\\\" entry in storage.\\n * Return whether the save existed and was loaded successfully.\\n */\\nfunction loadFromActive() {\\n    const state = _saves__WEBPACK_IMPORTED_MODULE_3__.loadActive();\\n    if (state) {\\n        loadState(state);\\n        return true;\\n    }\\n    else {\\n        return false;\\n    }\\n}\\n/**\\n * Attempt to load from the given slot.\\n * Return whether the load was successful.\\n */\\nfunction loadFromSlot(slot) {\\n    const state = _saves__WEBPACK_IMPORTED_MODULE_3__.loadFromSlot(slot);\\n    if (state) {\\n        loadState(state);\\n        return true;\\n    }\\n    else {\\n        return false;\\n    }\\n}\\n/** Save the most recent moment to the given slot. */\\nfunction saveToSlot(slot) {\\n    _saves__WEBPACK_IMPORTED_MODULE_3__.saveToSlot(slot, { history, index });\\n}\\nfunction loadState(state) {\\n    history = state.history;\\n    if (_config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"].stream) {\\n        mainElement.innerHTML = \\\"\\\";\\n        for (let i = 0; i <= state.index; i++) {\\n            index = i;\\n            renderActive();\\n        }\\n    }\\n    else {\\n        index = state.index;\\n        renderActive();\\n    }\\n}\\n/** Restart the game (by clearing the active slot then reloading the page). */\\nfunction restart() {\\n    _saves__WEBPACK_IMPORTED_MODULE_3__.clearActive();\\n    window.location.reload();\\n}\\nfunction redo() {\\n    for (const elt of document.querySelectorAll(\\\".brick-macro-do\\\")) {\\n        elt.dispatchEvent(new CustomEvent(\\\"brick-redo\\\"));\\n    }\\n}\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZW5naW5lLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBOEI7QUFDaUI7QUFDWDtBQUNIO0FBQzJCO0FBQzVEO0FBQ0E7QUFDQTtBQUNPO0FBQ0E7QUFDUDtBQUNPO0FBQ1Asa0JBQWtCLHFEQUFjO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksK0NBQU07QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSw4Q0FBZ0IsR0FBRyxnQkFBZ0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsOENBQWdCLEdBQUcsZ0JBQWdCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLDRDQUFLO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLElBQUksOENBQWdCLEdBQUcsZ0JBQWdCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCxNQUFNO0FBQzNEO0FBQ0EsZ0JBQWdCLDhDQUFVO0FBQzFCO0FBQ0Esa0RBQWtELG1CQUFtQjtBQUNyRTtBQUNBLHFCQUFxQiw0Q0FBSztBQUMxQjtBQUNBLFFBQVEsK0NBQU07QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGtEQUFXO0FBQy9CO0FBQ0EsS0FBSztBQUNMLG1CQUFtQiw4Q0FBVTtBQUM3QixtQkFBbUIsOENBQVU7QUFDN0I7QUFDQSxRQUFRLGlEQUFNO0FBQ2QsSUFBSSxpREFBTTtBQUNWO0FBQ0EsUUFBUSxpREFBTTtBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQLGtCQUFrQiw4Q0FBZ0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUCxrQkFBa0IsZ0RBQWtCO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1AsSUFBSSw4Q0FBZ0IsU0FBUyxnQkFBZ0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0EsUUFBUSwrQ0FBTTtBQUNkO0FBQ0Esd0JBQXdCLGtCQUFrQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1AsSUFBSSwrQ0FBaUI7QUFDckI7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9icmljay8uL3NyYy9lbmdpbmUudHM/NzFiOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY29uZmlnIGZyb20gXCIuL2NvbmZpZ1wiO1xuaW1wb3J0IHsgZ2V0IGFzIGdldFBhc3NhZ2UgfSBmcm9tIFwiLi9wYXNzYWdlc1wiO1xuaW1wb3J0IHsgcmVuZGVyIH0gZnJvbSBcIi4vcmVuZGVyZXJcIjtcbmltcG9ydCAqIGFzIHNhdmVzIGZyb20gXCIuL3NhdmVzXCI7XG5pbXBvcnQgeyBjbG9uZSwgZ2V0RWxlbWVudEJ5SWQsIG1ha2VFbGVtZW50IH0gZnJvbSBcIi4vdXRpbFwiO1xubGV0IG1haW5FbGVtZW50O1xubGV0IGhpc3Rvcnk7XG5sZXQgaW5kZXg7XG5leHBvcnQgbGV0IHN0b3J5VmFyaWFibGVzO1xuZXhwb3J0IGxldCB0ZW1wVmFyaWFibGVzO1xuLyoqIEluaXRpYWxpemUgdGhlIGVuZ2luZSAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgbWFpbkVsZW1lbnQgPSBnZXRFbGVtZW50QnlJZChcImJyaWNrLW1haW5cIik7XG4gICAgbWFpbkVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBoaXN0b3J5ID0gW107XG4gICAgaW5kZXggPSAtMTtcbiAgICBzdG9yeVZhcmlhYmxlcyA9IHt9O1xuICAgIHRlbXBWYXJpYWJsZXMgPSB7fTtcbn1cbi8qKiBBdHRlbXB0IHRvIG1vdmUgYmFja3dhcmRzIGluIGhpc3RvcnkuIFJldHVybnMgd2hldGhlciB0aGUgbmF2aWdhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4gKi9cbmV4cG9ydCBmdW5jdGlvbiBiYWNrd2FyZCgpIHtcbiAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGNvbmZpZy5zdHJlYW0pIHtcbiAgICAgICAgICAgIGNvbnN0IGVsdHMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYnJpY2stcGFzc2FnZVwiKSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGVsdCBvZiBlbHRzLnNsaWNlKC0yKSkge1xuICAgICAgICAgICAgICAgIGVsdC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpbmRleC0tO1xuICAgICAgICBzYXZlcy5zYXZlQWN0aXZlKHsgaGlzdG9yeSwgaW5kZXggfSk7XG4gICAgICAgIHJlbmRlckFjdGl2ZSgpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG4vKiogQXR0ZW1wdCB0byBtb3ZlIGZvcndhcmQgaW4gaGlzdG9yeS4gUmV0dXJucyB3aGV0aGVyIHRoZSBuYXZpZ2F0aW9uIHdhcyBzdWNjZXNzZnVsLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcndhcmQoKSB7XG4gICAgaWYgKGluZGV4ID09PSBoaXN0b3J5Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaW5kZXgrKztcbiAgICAgICAgc2F2ZXMuc2F2ZUFjdGl2ZSh7IGhpc3RvcnksIGluZGV4IH0pO1xuICAgICAgICByZW5kZXJBY3RpdmUoKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuLyoqIE5hdmlnYXRlIHRvIHRoZSBnaXZlbiBwYXNzYWdlLCBjcmVhdGluZyBhIG5ldyBtb21lbnQgaW4gdGhlIGhpc3RvcnkuICovXG5leHBvcnQgZnVuY3Rpb24gbmF2aWdhdGUocGFzc2FnZSkge1xuICAgIGNvbnN0IHBhc3NhZ2VOYW1lID0gdHlwZW9mIHBhc3NhZ2UgPT09IFwic3RyaW5nXCIgPyBwYXNzYWdlIDogcGFzc2FnZS5uYW1lO1xuICAgIC8vIGNsZWFyIG1vbWVudHMgcGFzdCB0aGUgY3VycmVudCBpbmRleFxuICAgIGhpc3RvcnkubGVuZ3RoID0gaW5kZXggKyAxO1xuICAgIGNvbnN0IG5ld01vbWVudCA9IHtcbiAgICAgICAgcGFzc2FnZU5hbWUsXG4gICAgICAgIHZhcnM6IGNsb25lKHN0b3J5VmFyaWFibGVzKSxcbiAgICB9O1xuICAgIGhpc3RvcnkucHVzaChuZXdNb21lbnQpO1xuICAgIGluZGV4Kys7XG4gICAgc2F2ZXMuc2F2ZUFjdGl2ZSh7IGhpc3RvcnksIGluZGV4IH0pO1xuICAgIHJlbmRlckFjdGl2ZSgpO1xufVxuLyoqIFJlbmRlciB0aGUgYWN0aXZlIG1vbWVudC4gKi9cbmZ1bmN0aW9uIHJlbmRlckFjdGl2ZSgpIHtcbiAgICBjb25zdCBtb21lbnQgPSBoaXN0b3J5W2luZGV4XTtcbiAgICBpZiAoIW1vbWVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGFjdGl2ZSBtb21lbnQgYXQgaW5kZXggJHtpbmRleH1gKTtcbiAgICB9XG4gICAgY29uc3QgcHNnID0gZ2V0UGFzc2FnZShtb21lbnQucGFzc2FnZU5hbWUpO1xuICAgIGlmICghcHNnKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGRuJ3QgZmluZCBwYXNzYWdlIFwiJHttb21lbnQucGFzc2FnZU5hbWV9XCJgKTtcbiAgICB9XG4gICAgc3RvcnlWYXJpYWJsZXMgPSBjbG9uZShtb21lbnQudmFycyk7XG4gICAgdGVtcFZhcmlhYmxlcyA9IHt9O1xuICAgIGlmIChjb25maWcuc3RyZWFtKSB7XG4gICAgICAgIGZvciAoY29uc3QgZWx0IG9mIG1haW5FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCI6ZW5hYmxlZFwiKSkge1xuICAgICAgICAgICAgZWx0LnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgZWx0IG9mIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYnJpY2stYWN0aXZlLXBhc3NhZ2VcIikpIHtcbiAgICAgICAgICAgIGVsdC5jbGFzc0xpc3QucmVtb3ZlKFwiYnJpY2stYWN0aXZlLXBhc3NhZ2VcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY29udGFpbmVyLmFwcGVuZChtYWtlRWxlbWVudChcImhyXCIpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG1haW5FbGVtZW50LmlubmVySFRNTCA9IFwiXCI7XG4gICAgfVxuICAgIGNvbnN0IGFydGljbGUgPSBtYWtlRWxlbWVudChcImFydGljbGVcIiwge1xuICAgICAgICBjbGFzczogXCJicmljay1wYXNzYWdlIGJyaWNrLWFjdGl2ZS1wYXNzYWdlIGJyaWNrLXRyYW5zcGFyZW50XCIsXG4gICAgfSk7XG4gICAgY29uc3QgaGVhZGVyID0gZ2V0UGFzc2FnZShcIlN0b3J5SGVhZGVyXCIpO1xuICAgIGNvbnN0IGZvb3RlciA9IGdldFBhc3NhZ2UoXCJTdG9yeUZvb3RlclwiKTtcbiAgICBpZiAoaGVhZGVyKVxuICAgICAgICByZW5kZXIoYXJ0aWNsZSwgaGVhZGVyKTtcbiAgICByZW5kZXIoYXJ0aWNsZSwgcHNnKTtcbiAgICBpZiAoZm9vdGVyKVxuICAgICAgICByZW5kZXIoYXJ0aWNsZSwgZm9vdGVyKTtcbiAgICBtYWluRWxlbWVudC5hcHBlbmQoYXJ0aWNsZSk7XG4gICAgYXJ0aWNsZS5zY3JvbGxJbnRvVmlldygpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4gYXJ0aWNsZS5jbGFzc0xpc3QucmVtb3ZlKFwiYnJpY2stdHJhbnNwYXJlbnRcIiksIDQwKTtcbn1cbi8qKlxuICogQXR0ZW1wdCB0byBsb2FkIGZyb20gdGhlIFwiYWN0aXZlXCIgZW50cnkgaW4gc3RvcmFnZS5cbiAqIFJldHVybiB3aGV0aGVyIHRoZSBzYXZlIGV4aXN0ZWQgYW5kIHdhcyBsb2FkZWQgc3VjY2Vzc2Z1bGx5LlxuICovXG5leHBvcnQgZnVuY3Rpb24gbG9hZEZyb21BY3RpdmUoKSB7XG4gICAgY29uc3Qgc3RhdGUgPSBzYXZlcy5sb2FkQWN0aXZlKCk7XG4gICAgaWYgKHN0YXRlKSB7XG4gICAgICAgIGxvYWRTdGF0ZShzdGF0ZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbi8qKlxuICogQXR0ZW1wdCB0byBsb2FkIGZyb20gdGhlIGdpdmVuIHNsb3QuXG4gKiBSZXR1cm4gd2hldGhlciB0aGUgbG9hZCB3YXMgc3VjY2Vzc2Z1bC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvYWRGcm9tU2xvdChzbG90KSB7XG4gICAgY29uc3Qgc3RhdGUgPSBzYXZlcy5sb2FkRnJvbVNsb3Qoc2xvdCk7XG4gICAgaWYgKHN0YXRlKSB7XG4gICAgICAgIGxvYWRTdGF0ZShzdGF0ZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbi8qKiBTYXZlIHRoZSBtb3N0IHJlY2VudCBtb21lbnQgdG8gdGhlIGdpdmVuIHNsb3QuICovXG5leHBvcnQgZnVuY3Rpb24gc2F2ZVRvU2xvdChzbG90KSB7XG4gICAgc2F2ZXMuc2F2ZVRvU2xvdChzbG90LCB7IGhpc3RvcnksIGluZGV4IH0pO1xufVxuZnVuY3Rpb24gbG9hZFN0YXRlKHN0YXRlKSB7XG4gICAgaGlzdG9yeSA9IHN0YXRlLmhpc3Rvcnk7XG4gICAgaWYgKGNvbmZpZy5zdHJlYW0pIHtcbiAgICAgICAgbWFpbkVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gc3RhdGUuaW5kZXg7IGkrKykge1xuICAgICAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICAgICAgcmVuZGVyQWN0aXZlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGluZGV4ID0gc3RhdGUuaW5kZXg7XG4gICAgICAgIHJlbmRlckFjdGl2ZSgpO1xuICAgIH1cbn1cbi8qKiBSZXN0YXJ0IHRoZSBnYW1lIChieSBjbGVhcmluZyB0aGUgYWN0aXZlIHNsb3QgdGhlbiByZWxvYWRpbmcgdGhlIHBhZ2UpLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc3RhcnQoKSB7XG4gICAgc2F2ZXMuY2xlYXJBY3RpdmUoKTtcbiAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVkbygpIHtcbiAgICBmb3IgKGNvbnN0IGVsdCBvZiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJyaWNrLW1hY3JvLWRvXCIpKSB7XG4gICAgICAgIGVsdC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImJyaWNrLXJlZG9cIikpO1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\\n//# sourceURL=webpack-internal:///./src/engine.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/macros.ts\":\n/*!***********************!*\\\n  !*** ./src/macros.ts ***!\n  \\***********************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   LoopStatus: () => (/* binding */ LoopStatus),\\n/* harmony export */   MacroContext: () => (/* binding */ MacroContext),\\n/* harmony export */   add: () => (/* binding */ add),\\n/* harmony export */   alias: () => (/* binding */ alias),\\n/* harmony export */   get: () => (/* binding */ get),\\n/* harmony export */   remove: () => (/* binding */ remove)\\n/* harmony export */ });\\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ \\\"./src/config.ts\\\");\\n/* harmony import */ var _engine__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./engine */ \\\"./src/engine.ts\\\");\\n/* harmony import */ var _parser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./parser */ \\\"./src/parser.ts\\\");\\n/* harmony import */ var _passages__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./passages */ \\\"./src/passages.ts\\\");\\n/* harmony import */ var _renderer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./renderer */ \\\"./src/renderer.ts\\\");\\n/* harmony import */ var _scripting__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./scripting */ \\\"./src/scripting.ts\\\");\\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./util */ \\\"./src/util.ts\\\");\\n\\n\\n\\n\\n\\n\\n\\nvar LoopStatus;\\n(function (LoopStatus) {\\n    LoopStatus[LoopStatus[\\\"OUTSIDE_LOOP\\\"] = 1] = \\\"OUTSIDE_LOOP\\\";\\n    LoopStatus[LoopStatus[\\\"IN_LOOP\\\"] = 2] = \\\"IN_LOOP\\\";\\n    LoopStatus[LoopStatus[\\\"BREAKING\\\"] = 3] = \\\"BREAKING\\\";\\n    LoopStatus[LoopStatus[\\\"CONTINUING\\\"] = 4] = \\\"CONTINUING\\\";\\n})(LoopStatus || (LoopStatus = {}));\\n/** Each time a macro is called, it receives a MacroContext as its `this`. */\\nclass MacroContext {\\n    constructor(name, parent, content) {\\n        this.name = name;\\n        this.loopStatus = (parent === null || parent === void 0 ? void 0 : parent.loopStatus) || LoopStatus.OUTSIDE_LOOP;\\n        this.content = content;\\n        if (parent === null || parent === void 0 ? void 0 : parent.captures) {\\n            this.captures = parent.captures;\\n        }\\n    }\\n    /**\\n     * Render `input` into `target`.\\n     * No-op if the macro is after a `@break` or `@continue`.\\n     * `input` defaults to the macro's content field.\\n     */\\n    render(target, input) {\\n        input || (input = this.content || []);\\n        switch (this.loopStatus) {\\n            case LoopStatus.OUTSIDE_LOOP:\\n            case LoopStatus.IN_LOOP:\\n                (0,_renderer__WEBPACK_IMPORTED_MODULE_4__.render)(target, input, this);\\n                break;\\n            case LoopStatus.BREAKING:\\n            case LoopStatus.CONTINUING:\\n                // pass;\\n                break;\\n            default:\\n                throw new Error(`unknown loopStatus: \\\"${this.loopStatus}\\\"`);\\n        }\\n    }\\n    /** Create a callback that will properly respect this macro's captured variables. */\\n    createCallback(func) {\\n        const context = this;\\n        const wrapped = function (...args) {\\n            if (!context.captures) {\\n                return func.apply(this, args);\\n            }\\n            const oldVals = {};\\n            for (const capture of context.captures) {\\n                // In case of repeats, avoid overwriting existing old value\\n                if (!(capture.name in oldVals)) {\\n                    oldVals[capture.name] = _engine__WEBPACK_IMPORTED_MODULE_1__.tempVariables[capture.name];\\n                }\\n                _engine__WEBPACK_IMPORTED_MODULE_1__.tempVariables[capture.name] = capture.value;\\n            }\\n            let returnValue;\\n            try {\\n                returnValue = func.apply(this, args);\\n            }\\n            finally {\\n                Object.assign(_engine__WEBPACK_IMPORTED_MODULE_1__.tempVariables, oldVals);\\n            }\\n            return returnValue;\\n        };\\n        return wrapped;\\n    }\\n}\\nconst macros = new Map();\\n/** Add a new macro */\\nfunction add(name, macro) {\\n    if (macros.has(name)) {\\n        console.warn(`Replacing an existing macro: \\\"${name}\\\"`);\\n    }\\n    macros.set(name, macro);\\n}\\n/** Add a new macro, identical to another.\\n * If the older macro is later removed, the newer macro will be unaffected. */\\nfunction alias(oldName, newName) {\\n    const m = macros.get(oldName);\\n    if (!m) {\\n        throw new Error(`No macro \\\"${oldName}\\\" found`);\\n    }\\n    macros.set(newName, m);\\n}\\n/** Get a macro definition */\\nfunction get(name) {\\n    return macros.get(name) || null;\\n}\\n/** Remove a macro definition */\\nfunction remove(name) {\\n    return macros.delete(name);\\n}\\nadd(\\\"include\\\", {\\n    handler(...args) {\\n        const [psgName, elementName] = args;\\n        if (args.length < 1 || args.length > 2) {\\n            throw new Error(\\\"@include must be called with 1 argument\\\");\\n        }\\n        if (typeof psgName !== \\\"string\\\") {\\n            throw new Error(\\\"@include: first arg (passage name) must be a string\\\");\\n        }\\n        if (typeof elementName !== \\\"undefined\\\" && typeof elementName !== \\\"string\\\") {\\n            throw new Error(\\\"@include: second arg (element type) must be a string or undefined\\\");\\n        }\\n        const actualEltName = elementName || \\\"div\\\";\\n        const passage = (0,_passages__WEBPACK_IMPORTED_MODULE_3__.get)(psgName);\\n        if (!passage) {\\n            throw new Error(`Passage not found: \\\"${psgName}\\\"`);\\n        }\\n        const div = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(actualEltName);\\n        this.render(div, passage);\\n        return div;\\n    },\\n});\\nadd(\\\"\\\", {\\n    skipArgs: true,\\n    handler(...args) {\\n        (0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalJavaScript)(args.join(\\\", \\\"));\\n        return document.createDocumentFragment();\\n    },\\n});\\nadd(\\\"print\\\", {\\n    handler(...args) {\\n        if (args.length !== 1) {\\n            throw new Error(`@${this.name}: requires 1 argument (got ${args.length})`);\\n        }\\n        if (this.content) {\\n            throw new Error(`@${this.name}: no body allowed`);\\n        }\\n        return new Text(String(args[0]));\\n    },\\n});\\nalias(\\\"print\\\", \\\"-\\\");\\nadd(\\\"render\\\", {\\n    handler(...args) {\\n        if (args.length !== 1) {\\n            throw new Error(`@${this.name}: requires 1 argument (got ${args.length})`);\\n        }\\n        if (this.content) {\\n            throw new Error(`@${this.name}: no body allowed`);\\n        }\\n        const frag = document.createDocumentFragment();\\n        // TODO prevent infinite recursion\\n        this.render(frag, String(args[0]));\\n        return frag;\\n    },\\n});\\nalias(\\\"render\\\", \\\"=\\\");\\nadd(\\\"link\\\", {\\n    handler(...args) {\\n        if (args.length !== 2) {\\n            throw new Error(\\\"@link: requires 2 arguments\\\");\\n        }\\n        const [linkText, onClick] = args;\\n        if (typeof linkText !== \\\"string\\\") {\\n            throw new Error(\\\"@link: first arg (label) was not a string\\\");\\n        }\\n        if (typeof onClick !== \\\"function\\\") {\\n            throw new Error(\\\"@link: second arg (handler) was not a function\\\");\\n        }\\n        const button = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"button\\\", { class: \\\"brick-link\\\", type: \\\"button\\\" }, linkText);\\n        button.addEventListener(\\\"click\\\", this.createCallback((event) => onClick.call(this, event)));\\n        return button;\\n    },\\n});\\nadd(\\\"linkTo\\\", {\\n    handler(...args) {\\n        let psgName, linkText;\\n        if (args.length < 1 || args.length > 2) {\\n            throw new Error(\\\"@linkTo requires 1 or 2 arguments\\\");\\n        }\\n        else if (args.length === 1) {\\n            psgName = linkText = args[0];\\n        }\\n        else {\\n            psgName = args[0];\\n            linkText = args[1];\\n        }\\n        if (typeof psgName !== \\\"string\\\") {\\n            throw new Error(\\\"@linkTo: first arg (passage name) must be a string\\\");\\n        }\\n        else if (typeof linkText !== \\\"string\\\") {\\n            throw new Error(\\\"@linkTo: second arg (link text) must be a string\\\");\\n        }\\n        // const className = getPassage(psgName) ? \\\"btn-outline-primary\\\" : \\\"btn-outline-danger\\\";\\n        const button = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"button\\\", { class: \\\"brick-link\\\", type: \\\"button\\\" }, linkText);\\n        button.addEventListener(\\\"click\\\", () => (0,_engine__WEBPACK_IMPORTED_MODULE_1__.navigate)(psgName));\\n        return button;\\n    },\\n});\\nadd(\\\"linkReplace\\\", {\\n    handler(...args) {\\n        if (args.length !== 1) {\\n            throw new Error(\\\"@linkReplace: requires exactly 1 argument\\\");\\n        }\\n        const [linkText] = args;\\n        if (typeof linkText !== \\\"string\\\") {\\n            throw new Error(\\\"@linkReplace: first arg (link text) must be a string\\\");\\n        }\\n        const button = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"button\\\", { class: \\\"brick-link\\\", type: \\\"button\\\" }, linkText);\\n        button.addEventListener(\\\"click\\\", () => {\\n            const span = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"span\\\", { class: \\\"brick-linkReplace brick-transparent\\\" });\\n            if (this.content) {\\n                this.render(span);\\n            }\\n            button.replaceWith(span);\\n            setTimeout(() => span.classList.remove(\\\"brick-transparent\\\"), 40);\\n        });\\n        return button;\\n    },\\n});\\nadd(\\\"while\\\", {\\n    skipArgs: true,\\n    handler(...args) {\\n        if (args.some((x) => typeof x !== \\\"string\\\")) {\\n            throw new Error(\\\"@while: received a non-string arg\\\");\\n        }\\n        const conditionStr = args.join(\\\",\\\");\\n        const frag = document.createDocumentFragment();\\n        const { content } = this;\\n        this.loopStatus = LoopStatus.IN_LOOP;\\n        let iterations = 1;\\n        while ((0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalExpression)(conditionStr)) {\\n            if (iterations > _config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"].maxLoopIterations) {\\n                throw new Error(`@for: Too many iterations (Config.maxLoopIterations = ${_config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"].maxLoopIterations})`);\\n            }\\n            iterations++;\\n            this.render(frag, content);\\n            // HACK - loosen the type of `this.loopStatus` so tsc doesn't complain\\n            this.loopStatus = this.loopStatus;\\n            if (this.loopStatus === LoopStatus.BREAKING) {\\n                this.loopStatus = LoopStatus.IN_LOOP;\\n                break;\\n            }\\n            else if (this.loopStatus === LoopStatus.CONTINUING) {\\n                this.loopStatus = LoopStatus.IN_LOOP;\\n                continue;\\n            }\\n        }\\n        return frag;\\n    },\\n});\\nadd(\\\"break\\\", {\\n    handler() {\\n        this.loopStatus = LoopStatus.BREAKING;\\n        return document.createDocumentFragment();\\n    },\\n});\\nadd(\\\"continue\\\", {\\n    handler() {\\n        this.loopStatus = LoopStatus.CONTINUING;\\n        return document.createDocumentFragment();\\n    },\\n});\\nadd(\\\"for\\\", {\\n    skipArgs: true,\\n    handler(...args) {\\n        if (args.some((x) => typeof x !== \\\"string\\\")) {\\n            throw new Error(\\\"@for: received a non-string arg\\\");\\n        }\\n        if (args.length !== 2) {\\n            throw new Error(\\\"@for: requires exactly 2 arguments\\\");\\n        }\\n        const [varStr, iterableStr] = args;\\n        if (!varStr.startsWith(\\\"_\\\")) {\\n            throw new Error(\\\"@for: loop variable must be a temp variable\\\");\\n        }\\n        const varName = varStr.substring(1);\\n        const place = `Engine.temp.${varName}`;\\n        const iterable = (0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalExpression)(iterableStr);\\n        if (typeof iterable[Symbol.iterator] !== \\\"function\\\") {\\n            throw new Error(\\\"@for: Right-hand side must be an iterable value, such as an array\\\");\\n        }\\n        const frag = document.createDocumentFragment();\\n        const { content } = this;\\n        this.loopStatus = LoopStatus.IN_LOOP;\\n        const actualCaptures = this.captures || [];\\n        let iterations = 1;\\n        for (const loopVal of iterable) {\\n            if (iterations > _config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"].maxLoopIterations) {\\n                throw new Error(`@for: Too many iterations (Config.maxLoopIterations = ${_config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"].maxLoopIterations})`);\\n            }\\n            iterations++;\\n            (0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalAssign)(place, loopVal);\\n            this.captures = [...actualCaptures, { name: varName, value: loopVal }];\\n            this.render(frag, content);\\n            // HACK - loosen the type of `this.loopStatus` so tsc doesn't complain\\n            this.loopStatus = this.loopStatus;\\n            if (this.loopStatus === LoopStatus.BREAKING) {\\n                this.loopStatus = LoopStatus.IN_LOOP;\\n                break;\\n            }\\n            else if (this.loopStatus === LoopStatus.CONTINUING) {\\n                this.loopStatus = LoopStatus.IN_LOOP;\\n            }\\n        }\\n        this.captures = actualCaptures;\\n        return frag;\\n    },\\n});\\nadd(\\\"checkBox\\\", {\\n    skipArgs: true,\\n    handler(...args) {\\n        if (args.length !== 2) {\\n            throw new Error(\\\"@checkBox: requires 2 arguments\\\");\\n        }\\n        if (args.some((arg) => typeof arg !== \\\"string\\\")) {\\n            throw new Error(\\\"@checkBox: both arguments must be strings\\\");\\n        }\\n        const [place, labelExpr] = args;\\n        const labelText = (0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalExpression)(labelExpr);\\n        if (typeof labelText !== \\\"string\\\" && !(labelText instanceof Node)) {\\n            throw new Error(\\\"@checkBox: label must be a string or Node\\\");\\n        }\\n        const initValue = (0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalExpression)(place);\\n        const input = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"input\\\", {\\n            type: \\\"checkbox\\\",\\n            id: (0,_util__WEBPACK_IMPORTED_MODULE_6__.uniqueId)(),\\n        });\\n        input.checked = !!initValue;\\n        input.addEventListener(\\\"change\\\", () => (0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalAssign)(place, input.checked));\\n        const labelElt = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"label\\\", { for: input.id }, labelText);\\n        const div = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"div\\\", {}, input, \\\" \\\", labelElt);\\n        return div;\\n    },\\n});\\nadd(\\\"switch\\\", {\\n    handler(...args) {\\n        if (args.length !== 1) {\\n            throw new Error(\\\"@switch: requires 1 arg\\\");\\n        }\\n        if (!this.content) {\\n            throw new Error(\\\"@switch: requires a body\\\");\\n        }\\n        const [value] = args;\\n        const children = [];\\n        for (const node of this.content) {\\n            if (typeof node === \\\"string\\\") {\\n                if (node.trim()) {\\n                    throw new Error(\\\"@switch: all children must be @case macros\\\");\\n                }\\n                // pass: skip over text nodes that are all whitespace\\n            }\\n            else if (node.type === \\\"macro\\\") {\\n                children.push(node);\\n            }\\n            else {\\n                throw new Error(\\\"@switch: all children must be @case macros\\\");\\n            }\\n        }\\n        for (let i = 0; i < children.length; i++) {\\n            const child = children[i];\\n            if (child.name === \\\"default\\\") {\\n                if (i !== children.length - 1) {\\n                    throw new Error(\\\"@switch: @default must be the last macro\\\");\\n                }\\n                if (child.args.length > 0) {\\n                    throw new Error(\\\"@switch: @default cannot receive any arguments\\\");\\n                }\\n            }\\n            else if (child.name !== \\\"case\\\") {\\n                throw new Error(\\\"@switch: all children must be @case macros\\\");\\n            }\\n            else if (child.args.length === 0) {\\n                throw new Error(\\\"@switch: @case macro requires at least one argument\\\");\\n            }\\n        }\\n        const output = document.createDocumentFragment();\\n        for (const child of children) {\\n            if (child.name === \\\"default\\\") {\\n                this.render(output, child.content);\\n                return output;\\n            }\\n            for (const arg of child.args) {\\n                const other = (0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalExpression)(arg);\\n                if (value === other) {\\n                    this.render(output, child.content);\\n                    return output;\\n                }\\n            }\\n        }\\n        return output;\\n    },\\n});\\nadd(\\\"if\\\", {\\n    trailingMacros: [\\\"elseif\\\", \\\"else\\\"],\\n    handler() {\\n        if (!this.content) {\\n            throw new Error(\\\"@if: no child templates\\\");\\n        }\\n        for (const template of this.content) {\\n            if (!(0,_parser__WEBPACK_IMPORTED_MODULE_2__.isMacro)(template)) {\\n                throw new Error(\\\"@if: child was not a MacroTemplate\\\");\\n            }\\n            if (template.name === \\\"else\\\" || (0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalExpression)(template.args.join(\\\",\\\"))) {\\n                const output = document.createDocumentFragment();\\n                this.render(output, template.content);\\n                return output;\\n            }\\n        }\\n        // no conditions matched\\n        return document.createDocumentFragment();\\n    },\\n});\\nadd(\\\"redoable\\\", {\\n    handler() {\\n        const { content } = this;\\n        if (!content) {\\n            throw new Error(\\\"@redoable: must be called with a body\\\");\\n        }\\n        const span = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"span\\\", { class: \\\"brick-macro-redoable\\\" });\\n        // Catch a bad break/continue on first render\\n        this.loopStatus = LoopStatus.OUTSIDE_LOOP;\\n        try {\\n            this.render(span);\\n        }\\n        catch (error) {\\n            if (error instanceof Error) {\\n                const re = /^Can't (@break|@continue) from outside a loop$/;\\n                const match = re.exec(error.message);\\n                if (match) {\\n                    error.message = `Can't ${match[1]} from within a @do macro`;\\n                }\\n            }\\n            throw error;\\n        }\\n        span.addEventListener(\\\"brick-redo\\\", () => {\\n            span.innerHTML = \\\"\\\";\\n            this.render(span);\\n        });\\n        return span;\\n    },\\n});\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbWFjcm9zLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBOEI7QUFDcUI7QUFDaEI7QUFDWTtBQUNYO0FBQ3FDO0FBQzFCO0FBQ3hDO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsZ0NBQWdDO0FBQ2pDO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQU07QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELGdCQUFnQjtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxrREFBYTtBQUN6RDtBQUNBLGdCQUFnQixrREFBYTtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsa0RBQWE7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQSxzREFBc0QsS0FBSztBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0EscUNBQXFDLFFBQVE7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDhDQUFVO0FBQ2xDO0FBQ0EsbURBQW1ELFFBQVE7QUFDM0Q7QUFDQSxvQkFBb0Isa0RBQVc7QUFDL0I7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSwwREFBYztBQUN0QjtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLFVBQVUsNkJBQTZCLFlBQVk7QUFDbkY7QUFDQTtBQUNBLGdDQUFnQyxVQUFVO0FBQzFDO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLFVBQVUsNkJBQTZCLFlBQVk7QUFDbkY7QUFDQTtBQUNBLGdDQUFnQyxVQUFVO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGtEQUFXLGFBQWEscUNBQXFDO0FBQ3BGO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0RBQVcsYUFBYSxxQ0FBcUM7QUFDcEYsK0NBQStDLGlEQUFRO0FBQ3ZEO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0RBQVcsYUFBYSxxQ0FBcUM7QUFDcEY7QUFDQSx5QkFBeUIsa0RBQVcsV0FBVyw4Q0FBOEM7QUFDN0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixVQUFVO0FBQzFCO0FBQ0E7QUFDQSxlQUFlLDBEQUFjO0FBQzdCLDZCQUE2QiwrQ0FBTTtBQUNuQyx5RkFBeUYsK0NBQU0sbUJBQW1CO0FBQ2xIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLFFBQVE7QUFDN0MseUJBQXlCLDBEQUFjO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsK0NBQU07QUFDbkMseUZBQXlGLCtDQUFNLG1CQUFtQjtBQUNsSDtBQUNBO0FBQ0EsWUFBWSxzREFBVTtBQUN0QixrREFBa0QsK0JBQStCO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiwwREFBYztBQUN4QztBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsMERBQWM7QUFDeEMsc0JBQXNCLGtEQUFXO0FBQ2pDO0FBQ0EsZ0JBQWdCLCtDQUFRO0FBQ3hCLFNBQVM7QUFDVDtBQUNBLCtDQUErQyxzREFBVTtBQUN6RCx5QkFBeUIsa0RBQVcsWUFBWSxlQUFlO0FBQy9ELG9CQUFvQixrREFBVyxVQUFVO0FBQ3pDO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IscUJBQXFCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsMERBQWM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLGdEQUFPO0FBQ3hCO0FBQ0E7QUFDQSw0Q0FBNEMsMERBQWM7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQSxnQkFBZ0IsVUFBVTtBQUMxQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsa0RBQVcsV0FBVywrQkFBK0I7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsVUFBVTtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7QUFDTCxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYnJpY2svLi9zcmMvbWFjcm9zLnRzP2FiZmUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNvbmZpZyBmcm9tIFwiLi9jb25maWdcIjtcbmltcG9ydCB7IG5hdmlnYXRlLCB0ZW1wVmFyaWFibGVzIH0gZnJvbSBcIi4vZW5naW5lXCI7XG5pbXBvcnQgeyBpc01hY3JvIH0gZnJvbSBcIi4vcGFyc2VyXCI7XG5pbXBvcnQgeyBnZXQgYXMgZ2V0UGFzc2FnZSB9IGZyb20gXCIuL3Bhc3NhZ2VzXCI7XG5pbXBvcnQgeyByZW5kZXIgfSBmcm9tIFwiLi9yZW5kZXJlclwiO1xuaW1wb3J0IHsgZXZhbEFzc2lnbiwgZXZhbEV4cHJlc3Npb24sIGV2YWxKYXZhU2NyaXB0IH0gZnJvbSBcIi4vc2NyaXB0aW5nXCI7XG5pbXBvcnQgeyBtYWtlRWxlbWVudCwgdW5pcXVlSWQgfSBmcm9tIFwiLi91dGlsXCI7XG5leHBvcnQgdmFyIExvb3BTdGF0dXM7XG4oZnVuY3Rpb24gKExvb3BTdGF0dXMpIHtcbiAgICBMb29wU3RhdHVzW0xvb3BTdGF0dXNbXCJPVVRTSURFX0xPT1BcIl0gPSAxXSA9IFwiT1VUU0lERV9MT09QXCI7XG4gICAgTG9vcFN0YXR1c1tMb29wU3RhdHVzW1wiSU5fTE9PUFwiXSA9IDJdID0gXCJJTl9MT09QXCI7XG4gICAgTG9vcFN0YXR1c1tMb29wU3RhdHVzW1wiQlJFQUtJTkdcIl0gPSAzXSA9IFwiQlJFQUtJTkdcIjtcbiAgICBMb29wU3RhdHVzW0xvb3BTdGF0dXNbXCJDT05USU5VSU5HXCJdID0gNF0gPSBcIkNPTlRJTlVJTkdcIjtcbn0pKExvb3BTdGF0dXMgfHwgKExvb3BTdGF0dXMgPSB7fSkpO1xuLyoqIEVhY2ggdGltZSBhIG1hY3JvIGlzIGNhbGxlZCwgaXQgcmVjZWl2ZXMgYSBNYWNyb0NvbnRleHQgYXMgaXRzIGB0aGlzYC4gKi9cbmV4cG9ydCBjbGFzcyBNYWNyb0NvbnRleHQge1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHBhcmVudCwgY29udGVudCkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLmxvb3BTdGF0dXMgPSAocGFyZW50ID09PSBudWxsIHx8IHBhcmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGFyZW50Lmxvb3BTdGF0dXMpIHx8IExvb3BTdGF0dXMuT1VUU0lERV9MT09QO1xuICAgICAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50O1xuICAgICAgICBpZiAocGFyZW50ID09PSBudWxsIHx8IHBhcmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGFyZW50LmNhcHR1cmVzKSB7XG4gICAgICAgICAgICB0aGlzLmNhcHR1cmVzID0gcGFyZW50LmNhcHR1cmVzO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbmRlciBgaW5wdXRgIGludG8gYHRhcmdldGAuXG4gICAgICogTm8tb3AgaWYgdGhlIG1hY3JvIGlzIGFmdGVyIGEgYEBicmVha2Agb3IgYEBjb250aW51ZWAuXG4gICAgICogYGlucHV0YCBkZWZhdWx0cyB0byB0aGUgbWFjcm8ncyBjb250ZW50IGZpZWxkLlxuICAgICAqL1xuICAgIHJlbmRlcih0YXJnZXQsIGlucHV0KSB7XG4gICAgICAgIGlucHV0IHx8IChpbnB1dCA9IHRoaXMuY29udGVudCB8fCBbXSk7XG4gICAgICAgIHN3aXRjaCAodGhpcy5sb29wU3RhdHVzKSB7XG4gICAgICAgICAgICBjYXNlIExvb3BTdGF0dXMuT1VUU0lERV9MT09QOlxuICAgICAgICAgICAgY2FzZSBMb29wU3RhdHVzLklOX0xPT1A6XG4gICAgICAgICAgICAgICAgcmVuZGVyKHRhcmdldCwgaW5wdXQsIHRoaXMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBMb29wU3RhdHVzLkJSRUFLSU5HOlxuICAgICAgICAgICAgY2FzZSBMb29wU3RhdHVzLkNPTlRJTlVJTkc6XG4gICAgICAgICAgICAgICAgLy8gcGFzcztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bmtub3duIGxvb3BTdGF0dXM6IFwiJHt0aGlzLmxvb3BTdGF0dXN9XCJgKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQ3JlYXRlIGEgY2FsbGJhY2sgdGhhdCB3aWxsIHByb3Blcmx5IHJlc3BlY3QgdGhpcyBtYWNybydzIGNhcHR1cmVkIHZhcmlhYmxlcy4gKi9cbiAgICBjcmVhdGVDYWxsYmFjayhmdW5jKSB7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzO1xuICAgICAgICBjb25zdCB3cmFwcGVkID0gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcbiAgICAgICAgICAgIGlmICghY29udGV4dC5jYXB0dXJlcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgb2xkVmFscyA9IHt9O1xuICAgICAgICAgICAgZm9yIChjb25zdCBjYXB0dXJlIG9mIGNvbnRleHQuY2FwdHVyZXMpIHtcbiAgICAgICAgICAgICAgICAvLyBJbiBjYXNlIG9mIHJlcGVhdHMsIGF2b2lkIG92ZXJ3cml0aW5nIGV4aXN0aW5nIG9sZCB2YWx1ZVxuICAgICAgICAgICAgICAgIGlmICghKGNhcHR1cmUubmFtZSBpbiBvbGRWYWxzKSkge1xuICAgICAgICAgICAgICAgICAgICBvbGRWYWxzW2NhcHR1cmUubmFtZV0gPSB0ZW1wVmFyaWFibGVzW2NhcHR1cmUubmFtZV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRlbXBWYXJpYWJsZXNbY2FwdHVyZS5uYW1lXSA9IGNhcHR1cmUudmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcmV0dXJuVmFsdWU7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gZnVuYy5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGVtcFZhcmlhYmxlcywgb2xkVmFscyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB3cmFwcGVkO1xuICAgIH1cbn1cbmNvbnN0IG1hY3JvcyA9IG5ldyBNYXAoKTtcbi8qKiBBZGQgYSBuZXcgbWFjcm8gKi9cbmV4cG9ydCBmdW5jdGlvbiBhZGQobmFtZSwgbWFjcm8pIHtcbiAgICBpZiAobWFjcm9zLmhhcyhuYW1lKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYFJlcGxhY2luZyBhbiBleGlzdGluZyBtYWNybzogXCIke25hbWV9XCJgKTtcbiAgICB9XG4gICAgbWFjcm9zLnNldChuYW1lLCBtYWNybyk7XG59XG4vKiogQWRkIGEgbmV3IG1hY3JvLCBpZGVudGljYWwgdG8gYW5vdGhlci5cbiAqIElmIHRoZSBvbGRlciBtYWNybyBpcyBsYXRlciByZW1vdmVkLCB0aGUgbmV3ZXIgbWFjcm8gd2lsbCBiZSB1bmFmZmVjdGVkLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFsaWFzKG9sZE5hbWUsIG5ld05hbWUpIHtcbiAgICBjb25zdCBtID0gbWFjcm9zLmdldChvbGROYW1lKTtcbiAgICBpZiAoIW0pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBtYWNybyBcIiR7b2xkTmFtZX1cIiBmb3VuZGApO1xuICAgIH1cbiAgICBtYWNyb3Muc2V0KG5ld05hbWUsIG0pO1xufVxuLyoqIEdldCBhIG1hY3JvIGRlZmluaXRpb24gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXQobmFtZSkge1xuICAgIHJldHVybiBtYWNyb3MuZ2V0KG5hbWUpIHx8IG51bGw7XG59XG4vKiogUmVtb3ZlIGEgbWFjcm8gZGVmaW5pdGlvbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZShuYW1lKSB7XG4gICAgcmV0dXJuIG1hY3Jvcy5kZWxldGUobmFtZSk7XG59XG5hZGQoXCJpbmNsdWRlXCIsIHtcbiAgICBoYW5kbGVyKC4uLmFyZ3MpIHtcbiAgICAgICAgY29uc3QgW3BzZ05hbWUsIGVsZW1lbnROYW1lXSA9IGFyZ3M7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCA8IDEgfHwgYXJncy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAaW5jbHVkZSBtdXN0IGJlIGNhbGxlZCB3aXRoIDEgYXJndW1lbnRcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBwc2dOYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAaW5jbHVkZTogZmlyc3QgYXJnIChwYXNzYWdlIG5hbWUpIG11c3QgYmUgYSBzdHJpbmdcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50TmFtZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgZWxlbWVudE5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBpbmNsdWRlOiBzZWNvbmQgYXJnIChlbGVtZW50IHR5cGUpIG11c3QgYmUgYSBzdHJpbmcgb3IgdW5kZWZpbmVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFjdHVhbEVsdE5hbWUgPSBlbGVtZW50TmFtZSB8fCBcImRpdlwiO1xuICAgICAgICBjb25zdCBwYXNzYWdlID0gZ2V0UGFzc2FnZShwc2dOYW1lKTtcbiAgICAgICAgaWYgKCFwYXNzYWdlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFBhc3NhZ2Ugbm90IGZvdW5kOiBcIiR7cHNnTmFtZX1cImApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRpdiA9IG1ha2VFbGVtZW50KGFjdHVhbEVsdE5hbWUpO1xuICAgICAgICB0aGlzLnJlbmRlcihkaXYsIHBhc3NhZ2UpO1xuICAgICAgICByZXR1cm4gZGl2O1xuICAgIH0sXG59KTtcbmFkZChcIlwiLCB7XG4gICAgc2tpcEFyZ3M6IHRydWUsXG4gICAgaGFuZGxlciguLi5hcmdzKSB7XG4gICAgICAgIGV2YWxKYXZhU2NyaXB0KGFyZ3Muam9pbihcIiwgXCIpKTtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICB9LFxufSk7XG5hZGQoXCJwcmludFwiLCB7XG4gICAgaGFuZGxlciguLi5hcmdzKSB7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBAJHt0aGlzLm5hbWV9OiByZXF1aXJlcyAxIGFyZ3VtZW50IChnb3QgJHthcmdzLmxlbmd0aH0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29udGVudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBAJHt0aGlzLm5hbWV9OiBubyBib2R5IGFsbG93ZWRgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFRleHQoU3RyaW5nKGFyZ3NbMF0pKTtcbiAgICB9LFxufSk7XG5hbGlhcyhcInByaW50XCIsIFwiLVwiKTtcbmFkZChcInJlbmRlclwiLCB7XG4gICAgaGFuZGxlciguLi5hcmdzKSB7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBAJHt0aGlzLm5hbWV9OiByZXF1aXJlcyAxIGFyZ3VtZW50IChnb3QgJHthcmdzLmxlbmd0aH0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29udGVudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBAJHt0aGlzLm5hbWV9OiBubyBib2R5IGFsbG93ZWRgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICAvLyBUT0RPIHByZXZlbnQgaW5maW5pdGUgcmVjdXJzaW9uXG4gICAgICAgIHRoaXMucmVuZGVyKGZyYWcsIFN0cmluZyhhcmdzWzBdKSk7XG4gICAgICAgIHJldHVybiBmcmFnO1xuICAgIH0sXG59KTtcbmFsaWFzKFwicmVuZGVyXCIsIFwiPVwiKTtcbmFkZChcImxpbmtcIiwge1xuICAgIGhhbmRsZXIoLi4uYXJncykge1xuICAgICAgICBpZiAoYXJncy5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBsaW5rOiByZXF1aXJlcyAyIGFyZ3VtZW50c1wiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBbbGlua1RleHQsIG9uQ2xpY2tdID0gYXJncztcbiAgICAgICAgaWYgKHR5cGVvZiBsaW5rVGV4dCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQGxpbms6IGZpcnN0IGFyZyAobGFiZWwpIHdhcyBub3QgYSBzdHJpbmdcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvbkNsaWNrICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBsaW5rOiBzZWNvbmQgYXJnIChoYW5kbGVyKSB3YXMgbm90IGEgZnVuY3Rpb25cIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYnV0dG9uID0gbWFrZUVsZW1lbnQoXCJidXR0b25cIiwgeyBjbGFzczogXCJicmljay1saW5rXCIsIHR5cGU6IFwiYnV0dG9uXCIgfSwgbGlua1RleHQpO1xuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY3JlYXRlQ2FsbGJhY2soKGV2ZW50KSA9PiBvbkNsaWNrLmNhbGwodGhpcywgZXZlbnQpKSk7XG4gICAgICAgIHJldHVybiBidXR0b247XG4gICAgfSxcbn0pO1xuYWRkKFwibGlua1RvXCIsIHtcbiAgICBoYW5kbGVyKC4uLmFyZ3MpIHtcbiAgICAgICAgbGV0IHBzZ05hbWUsIGxpbmtUZXh0O1xuICAgICAgICBpZiAoYXJncy5sZW5ndGggPCAxIHx8IGFyZ3MubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQGxpbmtUbyByZXF1aXJlcyAxIG9yIDIgYXJndW1lbnRzXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICBwc2dOYW1lID0gbGlua1RleHQgPSBhcmdzWzBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcHNnTmFtZSA9IGFyZ3NbMF07XG4gICAgICAgICAgICBsaW5rVGV4dCA9IGFyZ3NbMV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBwc2dOYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAbGlua1RvOiBmaXJzdCBhcmcgKHBhc3NhZ2UgbmFtZSkgbXVzdCBiZSBhIHN0cmluZ1wiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgbGlua1RleHQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBsaW5rVG86IHNlY29uZCBhcmcgKGxpbmsgdGV4dCkgbXVzdCBiZSBhIHN0cmluZ1wiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjb25zdCBjbGFzc05hbWUgPSBnZXRQYXNzYWdlKHBzZ05hbWUpID8gXCJidG4tb3V0bGluZS1wcmltYXJ5XCIgOiBcImJ0bi1vdXRsaW5lLWRhbmdlclwiO1xuICAgICAgICBjb25zdCBidXR0b24gPSBtYWtlRWxlbWVudChcImJ1dHRvblwiLCB7IGNsYXNzOiBcImJyaWNrLWxpbmtcIiwgdHlwZTogXCJidXR0b25cIiB9LCBsaW5rVGV4dCk7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gbmF2aWdhdGUocHNnTmFtZSkpO1xuICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgIH0sXG59KTtcbmFkZChcImxpbmtSZXBsYWNlXCIsIHtcbiAgICBoYW5kbGVyKC4uLmFyZ3MpIHtcbiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAbGlua1JlcGxhY2U6IHJlcXVpcmVzIGV4YWN0bHkgMSBhcmd1bWVudFwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBbbGlua1RleHRdID0gYXJncztcbiAgICAgICAgaWYgKHR5cGVvZiBsaW5rVGV4dCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQGxpbmtSZXBsYWNlOiBmaXJzdCBhcmcgKGxpbmsgdGV4dCkgbXVzdCBiZSBhIHN0cmluZ1wiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBidXR0b24gPSBtYWtlRWxlbWVudChcImJ1dHRvblwiLCB7IGNsYXNzOiBcImJyaWNrLWxpbmtcIiwgdHlwZTogXCJidXR0b25cIiB9LCBsaW5rVGV4dCk7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3BhbiA9IG1ha2VFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzOiBcImJyaWNrLWxpbmtSZXBsYWNlIGJyaWNrLXRyYW5zcGFyZW50XCIgfSk7XG4gICAgICAgICAgICBpZiAodGhpcy5jb250ZW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoc3Bhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBidXR0b24ucmVwbGFjZVdpdGgoc3Bhbik7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHNwYW4uY2xhc3NMaXN0LnJlbW92ZShcImJyaWNrLXRyYW5zcGFyZW50XCIpLCA0MCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgIH0sXG59KTtcbmFkZChcIndoaWxlXCIsIHtcbiAgICBza2lwQXJnczogdHJ1ZSxcbiAgICBoYW5kbGVyKC4uLmFyZ3MpIHtcbiAgICAgICAgaWYgKGFyZ3Muc29tZSgoeCkgPT4gdHlwZW9mIHggIT09IFwic3RyaW5nXCIpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAd2hpbGU6IHJlY2VpdmVkIGEgbm9uLXN0cmluZyBhcmdcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29uZGl0aW9uU3RyID0gYXJncy5qb2luKFwiLFwiKTtcbiAgICAgICAgY29uc3QgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgY29uc3QgeyBjb250ZW50IH0gPSB0aGlzO1xuICAgICAgICB0aGlzLmxvb3BTdGF0dXMgPSBMb29wU3RhdHVzLklOX0xPT1A7XG4gICAgICAgIGxldCBpdGVyYXRpb25zID0gMTtcbiAgICAgICAgd2hpbGUgKGV2YWxFeHByZXNzaW9uKGNvbmRpdGlvblN0cikpIHtcbiAgICAgICAgICAgIGlmIChpdGVyYXRpb25zID4gY29uZmlnLm1heExvb3BJdGVyYXRpb25zKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBAZm9yOiBUb28gbWFueSBpdGVyYXRpb25zIChDb25maWcubWF4TG9vcEl0ZXJhdGlvbnMgPSAke2NvbmZpZy5tYXhMb29wSXRlcmF0aW9uc30pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpdGVyYXRpb25zKys7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcihmcmFnLCBjb250ZW50KTtcbiAgICAgICAgICAgIC8vIEhBQ0sgLSBsb29zZW4gdGhlIHR5cGUgb2YgYHRoaXMubG9vcFN0YXR1c2Agc28gdHNjIGRvZXNuJ3QgY29tcGxhaW5cbiAgICAgICAgICAgIHRoaXMubG9vcFN0YXR1cyA9IHRoaXMubG9vcFN0YXR1cztcbiAgICAgICAgICAgIGlmICh0aGlzLmxvb3BTdGF0dXMgPT09IExvb3BTdGF0dXMuQlJFQUtJTkcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvb3BTdGF0dXMgPSBMb29wU3RhdHVzLklOX0xPT1A7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmxvb3BTdGF0dXMgPT09IExvb3BTdGF0dXMuQ09OVElOVUlORykge1xuICAgICAgICAgICAgICAgIHRoaXMubG9vcFN0YXR1cyA9IExvb3BTdGF0dXMuSU5fTE9PUDtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnJhZztcbiAgICB9LFxufSk7XG5hZGQoXCJicmVha1wiLCB7XG4gICAgaGFuZGxlcigpIHtcbiAgICAgICAgdGhpcy5sb29wU3RhdHVzID0gTG9vcFN0YXR1cy5CUkVBS0lORztcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICB9LFxufSk7XG5hZGQoXCJjb250aW51ZVwiLCB7XG4gICAgaGFuZGxlcigpIHtcbiAgICAgICAgdGhpcy5sb29wU3RhdHVzID0gTG9vcFN0YXR1cy5DT05USU5VSU5HO1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIH0sXG59KTtcbmFkZChcImZvclwiLCB7XG4gICAgc2tpcEFyZ3M6IHRydWUsXG4gICAgaGFuZGxlciguLi5hcmdzKSB7XG4gICAgICAgIGlmIChhcmdzLnNvbWUoKHgpID0+IHR5cGVvZiB4ICE9PSBcInN0cmluZ1wiKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQGZvcjogcmVjZWl2ZWQgYSBub24tc3RyaW5nIGFyZ1wiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXJncy5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBmb3I6IHJlcXVpcmVzIGV4YWN0bHkgMiBhcmd1bWVudHNcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgW3ZhclN0ciwgaXRlcmFibGVTdHJdID0gYXJncztcbiAgICAgICAgaWYgKCF2YXJTdHIuc3RhcnRzV2l0aChcIl9cIikpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBmb3I6IGxvb3AgdmFyaWFibGUgbXVzdCBiZSBhIHRlbXAgdmFyaWFibGVcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdmFyTmFtZSA9IHZhclN0ci5zdWJzdHJpbmcoMSk7XG4gICAgICAgIGNvbnN0IHBsYWNlID0gYEVuZ2luZS50ZW1wLiR7dmFyTmFtZX1gO1xuICAgICAgICBjb25zdCBpdGVyYWJsZSA9IGV2YWxFeHByZXNzaW9uKGl0ZXJhYmxlU3RyKTtcbiAgICAgICAgaWYgKHR5cGVvZiBpdGVyYWJsZVtTeW1ib2wuaXRlcmF0b3JdICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBmb3I6IFJpZ2h0LWhhbmQgc2lkZSBtdXN0IGJlIGFuIGl0ZXJhYmxlIHZhbHVlLCBzdWNoIGFzIGFuIGFycmF5XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIGNvbnN0IHsgY29udGVudCB9ID0gdGhpcztcbiAgICAgICAgdGhpcy5sb29wU3RhdHVzID0gTG9vcFN0YXR1cy5JTl9MT09QO1xuICAgICAgICBjb25zdCBhY3R1YWxDYXB0dXJlcyA9IHRoaXMuY2FwdHVyZXMgfHwgW107XG4gICAgICAgIGxldCBpdGVyYXRpb25zID0gMTtcbiAgICAgICAgZm9yIChjb25zdCBsb29wVmFsIG9mIGl0ZXJhYmxlKSB7XG4gICAgICAgICAgICBpZiAoaXRlcmF0aW9ucyA+IGNvbmZpZy5tYXhMb29wSXRlcmF0aW9ucykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQGZvcjogVG9vIG1hbnkgaXRlcmF0aW9ucyAoQ29uZmlnLm1heExvb3BJdGVyYXRpb25zID0gJHtjb25maWcubWF4TG9vcEl0ZXJhdGlvbnN9KWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlcmF0aW9ucysrO1xuICAgICAgICAgICAgZXZhbEFzc2lnbihwbGFjZSwgbG9vcFZhbCk7XG4gICAgICAgICAgICB0aGlzLmNhcHR1cmVzID0gWy4uLmFjdHVhbENhcHR1cmVzLCB7IG5hbWU6IHZhck5hbWUsIHZhbHVlOiBsb29wVmFsIH1dO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoZnJhZywgY29udGVudCk7XG4gICAgICAgICAgICAvLyBIQUNLIC0gbG9vc2VuIHRoZSB0eXBlIG9mIGB0aGlzLmxvb3BTdGF0dXNgIHNvIHRzYyBkb2Vzbid0IGNvbXBsYWluXG4gICAgICAgICAgICB0aGlzLmxvb3BTdGF0dXMgPSB0aGlzLmxvb3BTdGF0dXM7XG4gICAgICAgICAgICBpZiAodGhpcy5sb29wU3RhdHVzID09PSBMb29wU3RhdHVzLkJSRUFLSU5HKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb29wU3RhdHVzID0gTG9vcFN0YXR1cy5JTl9MT09QO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5sb29wU3RhdHVzID09PSBMb29wU3RhdHVzLkNPTlRJTlVJTkcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvb3BTdGF0dXMgPSBMb29wU3RhdHVzLklOX0xPT1A7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYXB0dXJlcyA9IGFjdHVhbENhcHR1cmVzO1xuICAgICAgICByZXR1cm4gZnJhZztcbiAgICB9LFxufSk7XG5hZGQoXCJjaGVja0JveFwiLCB7XG4gICAgc2tpcEFyZ3M6IHRydWUsXG4gICAgaGFuZGxlciguLi5hcmdzKSB7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCAhPT0gMikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQGNoZWNrQm94OiByZXF1aXJlcyAyIGFyZ3VtZW50c1wiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXJncy5zb21lKChhcmcpID0+IHR5cGVvZiBhcmcgIT09IFwic3RyaW5nXCIpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAY2hlY2tCb3g6IGJvdGggYXJndW1lbnRzIG11c3QgYmUgc3RyaW5nc1wiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBbcGxhY2UsIGxhYmVsRXhwcl0gPSBhcmdzO1xuICAgICAgICBjb25zdCBsYWJlbFRleHQgPSBldmFsRXhwcmVzc2lvbihsYWJlbEV4cHIpO1xuICAgICAgICBpZiAodHlwZW9mIGxhYmVsVGV4dCAhPT0gXCJzdHJpbmdcIiAmJiAhKGxhYmVsVGV4dCBpbnN0YW5jZW9mIE5vZGUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAY2hlY2tCb3g6IGxhYmVsIG11c3QgYmUgYSBzdHJpbmcgb3IgTm9kZVwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbml0VmFsdWUgPSBldmFsRXhwcmVzc2lvbihwbGFjZSk7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gbWFrZUVsZW1lbnQoXCJpbnB1dFwiLCB7XG4gICAgICAgICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICAgICAgICBpZDogdW5pcXVlSWQoKSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlucHV0LmNoZWNrZWQgPSAhIWluaXRWYWx1ZTtcbiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoKSA9PiBldmFsQXNzaWduKHBsYWNlLCBpbnB1dC5jaGVja2VkKSk7XG4gICAgICAgIGNvbnN0IGxhYmVsRWx0ID0gbWFrZUVsZW1lbnQoXCJsYWJlbFwiLCB7IGZvcjogaW5wdXQuaWQgfSwgbGFiZWxUZXh0KTtcbiAgICAgICAgY29uc3QgZGl2ID0gbWFrZUVsZW1lbnQoXCJkaXZcIiwge30sIGlucHV0LCBcIiBcIiwgbGFiZWxFbHQpO1xuICAgICAgICByZXR1cm4gZGl2O1xuICAgIH0sXG59KTtcbmFkZChcInN3aXRjaFwiLCB7XG4gICAgaGFuZGxlciguLi5hcmdzKSB7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQHN3aXRjaDogcmVxdWlyZXMgMSBhcmdcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBzd2l0Y2g6IHJlcXVpcmVzIGEgYm9keVwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBbdmFsdWVdID0gYXJncztcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIHRoaXMuY29udGVudCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBub2RlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUudHJpbSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBzd2l0Y2g6IGFsbCBjaGlsZHJlbiBtdXN0IGJlIEBjYXNlIG1hY3Jvc1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gcGFzczogc2tpcCBvdmVyIHRleHQgbm9kZXMgdGhhdCBhcmUgYWxsIHdoaXRlc3BhY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gXCJtYWNyb1wiKSB7XG4gICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChub2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBzd2l0Y2g6IGFsbCBjaGlsZHJlbiBtdXN0IGJlIEBjYXNlIG1hY3Jvc1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgaWYgKGNoaWxkLm5hbWUgPT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGkgIT09IGNoaWxkcmVuLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQHN3aXRjaDogQGRlZmF1bHQgbXVzdCBiZSB0aGUgbGFzdCBtYWNyb1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkLmFyZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAc3dpdGNoOiBAZGVmYXVsdCBjYW5ub3QgcmVjZWl2ZSBhbnkgYXJndW1lbnRzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoaWxkLm5hbWUgIT09IFwiY2FzZVwiKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQHN3aXRjaDogYWxsIGNoaWxkcmVuIG11c3QgYmUgQGNhc2UgbWFjcm9zXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hpbGQuYXJncy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAc3dpdGNoOiBAY2FzZSBtYWNybyByZXF1aXJlcyBhdCBsZWFzdCBvbmUgYXJndW1lbnRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGNoaWxkcmVuKSB7XG4gICAgICAgICAgICBpZiAoY2hpbGQubmFtZSA9PT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcihvdXRwdXQsIGNoaWxkLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGFyZyBvZiBjaGlsZC5hcmdzKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3RoZXIgPSBldmFsRXhwcmVzc2lvbihhcmcpO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gb3RoZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIob3V0cHV0LCBjaGlsZC5jb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9LFxufSk7XG5hZGQoXCJpZlwiLCB7XG4gICAgdHJhaWxpbmdNYWNyb3M6IFtcImVsc2VpZlwiLCBcImVsc2VcIl0sXG4gICAgaGFuZGxlcigpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkBpZjogbm8gY2hpbGQgdGVtcGxhdGVzXCIpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgdGVtcGxhdGUgb2YgdGhpcy5jb250ZW50KSB7XG4gICAgICAgICAgICBpZiAoIWlzTWFjcm8odGVtcGxhdGUpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQGlmOiBjaGlsZCB3YXMgbm90IGEgTWFjcm9UZW1wbGF0ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0ZW1wbGF0ZS5uYW1lID09PSBcImVsc2VcIiB8fCBldmFsRXhwcmVzc2lvbih0ZW1wbGF0ZS5hcmdzLmpvaW4oXCIsXCIpKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcihvdXRwdXQsIHRlbXBsYXRlLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gbm8gY29uZGl0aW9ucyBtYXRjaGVkXG4gICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgfSxcbn0pO1xuYWRkKFwicmVkb2FibGVcIiwge1xuICAgIGhhbmRsZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudCB9ID0gdGhpcztcbiAgICAgICAgaWYgKCFjb250ZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJAcmVkb2FibGU6IG11c3QgYmUgY2FsbGVkIHdpdGggYSBib2R5XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNwYW4gPSBtYWtlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzczogXCJicmljay1tYWNyby1yZWRvYWJsZVwiIH0pO1xuICAgICAgICAvLyBDYXRjaCBhIGJhZCBicmVhay9jb250aW51ZSBvbiBmaXJzdCByZW5kZXJcbiAgICAgICAgdGhpcy5sb29wU3RhdHVzID0gTG9vcFN0YXR1cy5PVVRTSURFX0xPT1A7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcihzcGFuKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmUgPSAvXkNhbid0IChAYnJlYWt8QGNvbnRpbnVlKSBmcm9tIG91dHNpZGUgYSBsb29wJC87XG4gICAgICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSByZS5leGVjKGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICBlcnJvci5tZXNzYWdlID0gYENhbid0ICR7bWF0Y2hbMV19IGZyb20gd2l0aGluIGEgQGRvIG1hY3JvYDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBzcGFuLmFkZEV2ZW50TGlzdGVuZXIoXCJicmljay1yZWRvXCIsICgpID0+IHtcbiAgICAgICAgICAgIHNwYW4uaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKHNwYW4pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHNwYW47XG4gICAgfSxcbn0pO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\\n//# sourceURL=webpack-internal:///./src/macros.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/main.ts\":\n/*!*********************!*\\\n  !*** ./src/main.ts ***!\n  \\*********************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   storyTitle: () => (/* binding */ storyTitle)\\n/* harmony export */ });\\n/* harmony import */ var _dialog__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dialog */ \\\"./src/dialog.ts\\\");\\n/* harmony import */ var _engine__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./engine */ \\\"./src/engine.ts\\\");\\n/* harmony import */ var _passages__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./passages */ \\\"./src/passages.ts\\\");\\n/* harmony import */ var _saves__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./saves */ \\\"./src/saves.ts\\\");\\n/* harmony import */ var _scripting__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./scripting */ \\\"./src/scripting.ts\\\");\\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./util */ \\\"./src/util.ts\\\");\\n\\n\\n\\n\\n\\n\\nwindow.addEventListener(\\\"error\\\", (event) => {\\n    const { error } = event;\\n    let msg = \\\"\\\";\\n    if (error instanceof Error) {\\n        msg += \\\"Fatal Error!\\\\n\\\";\\n        msg += error.toString();\\n        if (error.stack) {\\n            msg += \\\"\\\\n\\\" + error.stack;\\n        }\\n    }\\n    else {\\n        msg += \\\"Non-error object was thrown and not caught:\\\\n\\\";\\n        msg += String(event);\\n    }\\n    alert(msg);\\n});\\nwindow.addEventListener(\\\"unhandledrejection\\\", (event) => {\\n    const { reason } = event;\\n    alert(`Fatal Error!\\\\n${reason}`);\\n});\\nwindow.Brick = _scripting__WEBPACK_IMPORTED_MODULE_4__.BrickPublic;\\nconst storyData = document.getElementsByTagName(\\\"tw-storydata\\\")[0];\\n_passages__WEBPACK_IMPORTED_MODULE_2__.init(storyData);\\nconst styles = storyData.querySelectorAll('style[type=\\\"text/twine-css\\\"]');\\nconst scripts = storyData.querySelectorAll('script[type=\\\"text/twine-javascript\\\"]');\\nconst storyTitle = storyData.getAttribute(\\\"name\\\") ||\\n    (() => {\\n        throw new Error(\\\"Story has no title\\\");\\n    })();\\nfor (const stylesheet of styles) {\\n    const styleElt = (0,_util__WEBPACK_IMPORTED_MODULE_5__.makeElement)(\\\"style\\\", {}, stylesheet.innerText);\\n    document.head.appendChild(styleElt);\\n}\\n_dialog__WEBPACK_IMPORTED_MODULE_0__.init();\\n_engine__WEBPACK_IMPORTED_MODULE_1__.init();\\n(0,_saves__WEBPACK_IMPORTED_MODULE_3__.init)();\\nfor (const script of scripts) {\\n    (0,_scripting__WEBPACK_IMPORTED_MODULE_4__.evalJavaScript)(script.textContent || \\\"\\\");\\n}\\nconst startPassage = _passages__WEBPACK_IMPORTED_MODULE_2__.get(\\\"Start\\\");\\nif (!startPassage) {\\n    throw new Error(\\\"No starting passage found\\\");\\n}\\nif (!_engine__WEBPACK_IMPORTED_MODULE_1__.loadFromActive()) {\\n    _engine__WEBPACK_IMPORTED_MODULE_1__.navigate(_passages__WEBPACK_IMPORTED_MODULE_2__.start());\\n}\\nfunction addClicker(id, handler) {\\n    var _a;\\n    (_a = document.getElementById(id)) === null || _a === void 0 ? void 0 : _a.addEventListener(\\\"click\\\", handler);\\n}\\naddClicker(\\\"brick-history-backward\\\", _engine__WEBPACK_IMPORTED_MODULE_1__.backward);\\naddClicker(\\\"brick-history-forward\\\", _engine__WEBPACK_IMPORTED_MODULE_1__.forward);\\naddClicker(\\\"brick-saves\\\", _dialog__WEBPACK_IMPORTED_MODULE_0__.showSavesMenu);\\naddClicker(\\\"brick-restart\\\", _engine__WEBPACK_IMPORTED_MODULE_1__.restart);\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbWFpbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQW1DO0FBQ0E7QUFDSTtBQUNLO0FBQ2M7QUFDckI7QUFDckM7QUFDQSxZQUFZLFFBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxZQUFZLFNBQVM7QUFDckIsMkJBQTJCLE9BQU87QUFDbEMsQ0FBQztBQUNELGVBQWUsbURBQVc7QUFDMUI7QUFDQSwyQ0FBYTtBQUNiO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxxQkFBcUIsa0RBQVcsWUFBWTtBQUM1QztBQUNBO0FBQ0EseUNBQVc7QUFDWCx5Q0FBVztBQUNYLDRDQUFTO0FBQ1Q7QUFDQSxJQUFJLDBEQUFjO0FBQ2xCO0FBQ0EscUJBQXFCLDBDQUFZO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBLEtBQUssbURBQXFCO0FBQzFCLElBQUksNkNBQWUsQ0FBQyw0Q0FBYztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLDZDQUFlO0FBQ3BELG9DQUFvQyw0Q0FBYztBQUNsRCwwQkFBMEIsa0RBQW9CO0FBQzlDLDRCQUE0Qiw0Q0FBYyIsInNvdXJjZXMiOlsid2VicGFjazovL2JyaWNrLy4vc3JjL21haW4udHM/MzRkMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBkaWFsb2cgZnJvbSBcIi4vZGlhbG9nXCI7XG5pbXBvcnQgKiBhcyBlbmdpbmUgZnJvbSBcIi4vZW5naW5lXCI7XG5pbXBvcnQgKiBhcyBwYXNzYWdlcyBmcm9tIFwiLi9wYXNzYWdlc1wiO1xuaW1wb3J0IHsgaW5pdCBhcyBpbml0U2F2ZXMgfSBmcm9tIFwiLi9zYXZlc1wiO1xuaW1wb3J0IHsgQnJpY2tQdWJsaWMsIGV2YWxKYXZhU2NyaXB0IH0gZnJvbSBcIi4vc2NyaXB0aW5nXCI7XG5pbXBvcnQgeyBtYWtlRWxlbWVudCB9IGZyb20gXCIuL3V0aWxcIjtcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgeyBlcnJvciB9ID0gZXZlbnQ7XG4gICAgbGV0IG1zZyA9IFwiXCI7XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgbXNnICs9IFwiRmF0YWwgRXJyb3IhXFxuXCI7XG4gICAgICAgIG1zZyArPSBlcnJvci50b1N0cmluZygpO1xuICAgICAgICBpZiAoZXJyb3Iuc3RhY2spIHtcbiAgICAgICAgICAgIG1zZyArPSBcIlxcblwiICsgZXJyb3Iuc3RhY2s7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG1zZyArPSBcIk5vbi1lcnJvciBvYmplY3Qgd2FzIHRocm93biBhbmQgbm90IGNhdWdodDpcXG5cIjtcbiAgICAgICAgbXNnICs9IFN0cmluZyhldmVudCk7XG4gICAgfVxuICAgIGFsZXJ0KG1zZyk7XG59KTtcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwidW5oYW5kbGVkcmVqZWN0aW9uXCIsIChldmVudCkgPT4ge1xuICAgIGNvbnN0IHsgcmVhc29uIH0gPSBldmVudDtcbiAgICBhbGVydChgRmF0YWwgRXJyb3IhXFxuJHtyZWFzb259YCk7XG59KTtcbndpbmRvdy5CcmljayA9IEJyaWNrUHVibGljO1xuY29uc3Qgc3RvcnlEYXRhID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0dy1zdG9yeWRhdGFcIilbMF07XG5wYXNzYWdlcy5pbml0KHN0b3J5RGF0YSk7XG5jb25zdCBzdHlsZXMgPSBzdG9yeURhdGEucXVlcnlTZWxlY3RvckFsbCgnc3R5bGVbdHlwZT1cInRleHQvdHdpbmUtY3NzXCJdJyk7XG5jb25zdCBzY3JpcHRzID0gc3RvcnlEYXRhLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NjcmlwdFt0eXBlPVwidGV4dC90d2luZS1qYXZhc2NyaXB0XCJdJyk7XG5leHBvcnQgY29uc3Qgc3RvcnlUaXRsZSA9IHN0b3J5RGF0YS5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpIHx8XG4gICAgKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3RvcnkgaGFzIG5vIHRpdGxlXCIpO1xuICAgIH0pKCk7XG5mb3IgKGNvbnN0IHN0eWxlc2hlZXQgb2Ygc3R5bGVzKSB7XG4gICAgY29uc3Qgc3R5bGVFbHQgPSBtYWtlRWxlbWVudChcInN0eWxlXCIsIHt9LCBzdHlsZXNoZWV0LmlubmVyVGV4dCk7XG4gICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZUVsdCk7XG59XG5kaWFsb2cuaW5pdCgpO1xuZW5naW5lLmluaXQoKTtcbmluaXRTYXZlcygpO1xuZm9yIChjb25zdCBzY3JpcHQgb2Ygc2NyaXB0cykge1xuICAgIGV2YWxKYXZhU2NyaXB0KHNjcmlwdC50ZXh0Q29udGVudCB8fCBcIlwiKTtcbn1cbmNvbnN0IHN0YXJ0UGFzc2FnZSA9IHBhc3NhZ2VzLmdldChcIlN0YXJ0XCIpO1xuaWYgKCFzdGFydFBhc3NhZ2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBzdGFydGluZyBwYXNzYWdlIGZvdW5kXCIpO1xufVxuaWYgKCFlbmdpbmUubG9hZEZyb21BY3RpdmUoKSkge1xuICAgIGVuZ2luZS5uYXZpZ2F0ZShwYXNzYWdlcy5zdGFydCgpKTtcbn1cbmZ1bmN0aW9uIGFkZENsaWNrZXIoaWQsIGhhbmRsZXIpIHtcbiAgICB2YXIgX2E7XG4gICAgKF9hID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZXIpO1xufVxuYWRkQ2xpY2tlcihcImJyaWNrLWhpc3RvcnktYmFja3dhcmRcIiwgZW5naW5lLmJhY2t3YXJkKTtcbmFkZENsaWNrZXIoXCJicmljay1oaXN0b3J5LWZvcndhcmRcIiwgZW5naW5lLmZvcndhcmQpO1xuYWRkQ2xpY2tlcihcImJyaWNrLXNhdmVzXCIsIGRpYWxvZy5zaG93U2F2ZXNNZW51KTtcbmFkZENsaWNrZXIoXCJicmljay1yZXN0YXJ0XCIsIGVuZ2luZS5yZXN0YXJ0KTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\\n//# sourceURL=webpack-internal:///./src/main.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/parser.ts\":\n/*!***********************!*\\\n  !*** ./src/parser.ts ***!\n  \\***********************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   Parser: () => (/* binding */ Parser),\\n/* harmony export */   isMacro: () => (/* binding */ isMacro)\\n/* harmony export */ });\\nconst RE = {\\n    closeTag: />/y,\\n    commentBlock: /\\\\*(?:[^])*?\\\\*\\\\//y,\\n    commentLine: /\\\\/.*\\\\n?/y,\\n    elementName: /([-\\\\p{ID_Continue}]+)(#[-\\\\p{ID_Continue}]+)?((?:\\\\.[-\\\\p{ID_Continue}]+)*)/uy,\\n    htmlAttr: /\\\\s*([-@\\\\p{ID_Start}][-\\\\p{ID_Continue}]*)=\\\"([^\\\"]*)\\\"/uy,\\n    js: {\\n        closingParen: /\\\\s*\\\\)/y,\\n        closingSquareBracket: /\\\\s*\\\\]/y,\\n        field: /\\\\.\\\\p{ID_Start}[$\\\\p{ID_Continue}]*/uy,\\n        identifier: /\\\\p{ID_Start}[$\\\\p{ID_Continue}]*/uy,\\n        normalChars: /[^\\\"'`[\\\\]{}()/$_,a-zA-Z]+/y,\\n        stringDouble: /\\\"(?:[^\\\\\\\\\\\"]|\\\\\\\\(?:.|\\\\s))*\\\"/y,\\n        stringSingle: /'(?:[^\\\\\\\\']|\\\\\\\\(?:.|\\\\s))*'/y,\\n        normalInTemplateString: /(?:[^`$\\\\\\\\]|\\\\\\\\[^]|\\\\$(?!\\\\{))*/y,\\n    },\\n    macroArgsStart: /\\\\s*\\\\(/y,\\n    macroBodyStart: /\\\\s*\\\\{/y,\\n    macroName: /[-_=<>\\\\p{ID_Start}][-=<>\\\\p{ID_Continue}]*/uy,\\n    normalChars: /[^[\\\\]{}\\\\\\\\($_?<@/]+/y,\\n    singleChar: /.|\\\\s/y,\\n    whitespace: /\\\\s*/y,\\n};\\n// These HTML elements don't allow a closing tag.\\nconst UNCLOSED_TAGS = [\\\"area\\\", \\\"br\\\", \\\"embed\\\", \\\"hr\\\", \\\"img\\\", \\\"input\\\", \\\"link\\\", \\\"meta\\\", \\\"track\\\", \\\"wbr\\\"];\\nfunction isMacro(nt) {\\n    return typeof nt === \\\"object\\\" && nt.type === \\\"macro\\\";\\n}\\nclass Parser {\\n    constructor(source) {\\n        this.input = source;\\n        this.index = 0;\\n    }\\n    consume(pattern) {\\n        // if (typeof pattern === \\\"string\\\") {\\n        //   if (this.input.substring(this.index).startsWith(pattern)) {\\n        //     this.index += pattern.length;\\n        //     return [this.input.substring(this.index, pattern.length + this.index)];\\n        //   } else {\\n        //     return null;\\n        //   }\\n        // } else {\\n        // }\\n        pattern.lastIndex = this.index;\\n        const match = pattern.exec(this.input);\\n        if (match) {\\n            this.index = pattern.lastIndex;\\n        }\\n        return match;\\n    }\\n    lookahead() {\\n        return this.input[this.index] || null;\\n    }\\n    locationSample() {\\n        // edge case: we are at a line break\\n        if (this.input[this.index] === \\\"\\\\n\\\") {\\n            const start = this.input.lastIndexOf(\\\"\\\\n\\\", this.index - 1) + 1;\\n            return this.input.slice(start, this.index);\\n        }\\n        // This will be zero if a newline is not found\\n        const start = this.input.lastIndexOf(\\\"\\\\n\\\", this.index - 1) + 1;\\n        const end = this.input.indexOf(\\\"\\\\n\\\", this.index + 1);\\n        return this.input.slice(start, end);\\n    }\\n    error(message) {\\n        return { type: \\\"error\\\", message, locationSample: this.locationSample() };\\n    }\\n    parse(closer) {\\n        var _a;\\n        const output = [];\\n        let iterations = 0;\\n        outer: while (this.index < this.input.length) {\\n            if (iterations >= 1000000) {\\n                output.push(this.error(\\\"Parser stuck in infinite loop\\\"));\\n                return output;\\n            }\\n            else {\\n                iterations++;\\n            }\\n            const oldIndex = this.index;\\n            this.consume(RE.normalChars);\\n            if (this.index !== oldIndex) {\\n                output.push(this.input.substring(oldIndex, this.index));\\n            }\\n            if (closer && this.consume(closer)) {\\n                return output;\\n            }\\n            const c = (_a = this.consume(RE.singleChar)) === null || _a === void 0 ? void 0 : _a[0];\\n            switch (c) {\\n                case \\\"\\\\\\\\\\\": {\\n                    const c2 = this.lookahead();\\n                    if (!c2) {\\n                        // Assume they meant to place an escaped newline, that got trimmed.\\n                        output.push(\\\"\\\\n\\\");\\n                    }\\n                    else {\\n                        output.push(c2);\\n                    }\\n                    this.index++;\\n                    break;\\n                }\\n                case \\\"<\\\":\\n                    output.push(this.parseElement());\\n                    break;\\n                case \\\"@\\\":\\n                    output.push(this.parseMacro());\\n                    break;\\n                case \\\"/\\\":\\n                    switch (this.lookahead()) {\\n                        case \\\"/\\\":\\n                            this.consume(RE.commentLine);\\n                            break;\\n                        case \\\"*\\\":\\n                            if (!this.consume(RE.commentBlock)) {\\n                                output.push(this.error(\\\"Missing trailing `*/` to close the block comment\\\"));\\n                                return output;\\n                            }\\n                            break;\\n                        default:\\n                            output.push(c);\\n                            break;\\n                    }\\n                    break;\\n                case \\\"$\\\": {\\n                    output.push(this.parseNakedVariable(\\\"story\\\"));\\n                    break;\\n                }\\n                case \\\"_\\\": {\\n                    output.push(this.parseNakedVariable(\\\"temp\\\"));\\n                    break;\\n                }\\n                case \\\"[\\\":\\n                    if (this.lookahead() === \\\"[\\\") {\\n                        this.index++;\\n                        const m = this.consume(/((?:[^\\\\\\\\\\\\]]|\\\\\\\\.)*)\\\\]\\\\]/y);\\n                        if (!m) {\\n                            throw new Error(\\\"Unmatched `[[`\\\");\\n                        }\\n                        const linkBoxFull = m[1];\\n                        const hasRightArrow = linkBoxFull.includes(\\\"->\\\");\\n                        const hasLeftArrow = linkBoxFull.includes(\\\"<-\\\");\\n                        const hasPipe = linkBoxFull.includes(\\\"|\\\");\\n                        const separatorCount = Number(hasRightArrow) + Number(hasLeftArrow) + Number(hasPipe);\\n                        if (separatorCount > 1) {\\n                            output.push(this.error(\\\"Link boxes can only have one of '->', '<-', or '|'\\\"));\\n                        }\\n                        else if (separatorCount === 0) {\\n                            output.push({ type: \\\"linkBox\\\", link: linkBoxFull, text: linkBoxFull });\\n                        }\\n                        else {\\n                            const separator = hasRightArrow ? \\\"->\\\" : hasLeftArrow ? \\\"<-\\\" : \\\"|\\\";\\n                            output.push(this.makeLinkBox(linkBoxFull, separator));\\n                        }\\n                    }\\n                    else {\\n                        output.push(\\\"[\\\");\\n                    }\\n                    break;\\n                case \\\"]\\\":\\n                case \\\"?\\\":\\n                case \\\">\\\":\\n                    throw new Error(`Cannot yet handle unescaped '${c}' (U+${c.charCodeAt(0)})`);\\n                case undefined:\\n                    // end of input\\n                    break outer;\\n                default:\\n                    throw new Error(`Logic Error (${c})`);\\n            }\\n        }\\n        if (closer && !this.consume(closer)) {\\n            throw new Error(`Failed to match regex \\\"${closer.source}\\\"`);\\n        }\\n        return output;\\n    }\\n    parseElement() {\\n        const longName = this.consume(RE.elementName);\\n        if (!longName) {\\n            return this.error(\\\"Element names can contain only hyphens, underscores, and ASCII letters and numbers\\\");\\n        }\\n        const [_fullMatch, name, id, className] = longName;\\n        const attributes = new Map();\\n        if (id) {\\n            attributes.set(\\\"id\\\", id.slice(1));\\n        }\\n        if (className.length) {\\n            attributes.set(\\\"class\\\", className.replace(\\\".\\\", \\\" \\\").trim());\\n        }\\n        this.consume(RE.whitespace);\\n        while (!this.consume(RE.closeTag)) {\\n            const match = this.consume(RE.htmlAttr);\\n            if (!match) {\\n                return this.error(\\\"Missing trailing `>` to close the HTML tag\\\");\\n            }\\n            const [_, key, value] = match;\\n            if (attributes.has(key)) {\\n                console.warn(`Ignoring duplicate attribute '${key}`);\\n            }\\n            attributes.set(key, value);\\n        }\\n        const content = UNCLOSED_TAGS.includes(name) ? [] : this.parse(new RegExp(`</${name}>`, \\\"y\\\"));\\n        return { type: \\\"element\\\", name, attributes, content };\\n    }\\n    parseNakedVariable(type) {\\n        const startIdx = this.index;\\n        let match = this.consume(RE.js.identifier);\\n        if (!match) {\\n            const leadingChar = type === \\\"story\\\" ? \\\"$\\\" : \\\"_\\\";\\n            const bs = \\\"or escaped with a backslash `\\\\\\\\`\\\";\\n            return this.error(`${leadingChar} must be part of a ${type} variable, ${bs}`);\\n        }\\n        const baseVarName = match[0];\\n        const suffixStart = this.index;\\n        while (true) {\\n            switch (this.lookahead()) {\\n                case \\\".\\\":\\n                    match = this.consume(RE.js.field);\\n                    if (match) {\\n                        continue;\\n                    }\\n                    // not a match: break out, the period will be treated as plain markup later\\n                    break;\\n                case \\\"[\\\":\\n                    this.index++;\\n                    this.parseJsArgs(\\\"]\\\");\\n                    continue;\\n                case \\\"(\\\":\\n                    this.index++;\\n                    this.parseJsArgs(\\\")\\\");\\n                    continue;\\n            }\\n            break;\\n        }\\n        if (this.index === suffixStart) {\\n            // simple: just a plain variable\\n            return { type, name: baseVarName };\\n        }\\n        else {\\n            // more complicated: substitute with @print\\n            const prefix = type === \\\"story\\\" ? \\\"Engine.vars.\\\" : \\\"Engine.temp.\\\";\\n            return {\\n                type: \\\"macro\\\",\\n                name: \\\"print\\\",\\n                args: [prefix + this.input.substring(startIdx, this.index)],\\n            };\\n        }\\n    }\\n    parseMacro() {\\n        const match = this.consume(RE.macroName);\\n        let macroName;\\n        if (match) {\\n            macroName = match[0];\\n        }\\n        else {\\n            // edge case: unnamed macro\\n            if (this.lookahead() === \\\"(\\\") {\\n                macroName = \\\"\\\";\\n            }\\n            else {\\n                return this.error(\\\"`@` must be followed by a macro name, or be escaped with a `\\\\\\\\`\\\");\\n            }\\n        }\\n        let args = null;\\n        if (this.consume(RE.macroArgsStart)) {\\n            args = macroName === \\\"for\\\" ? this.parseForArgs() : this.parseJsArgs(\\\")\\\");\\n        }\\n        const hasContent = this.consume(RE.macroBodyStart);\\n        if (!args && !hasContent) {\\n            return this.error(\\\"Macro invocations must be followed by `(` or `[`\\\");\\n        }\\n        const content = hasContent ? this.parse(/\\\\}/y) : undefined;\\n        return {\\n            type: \\\"macro\\\",\\n            name: macroName,\\n            args: args || [],\\n            content,\\n        };\\n    }\\n    parseForArgs() {\\n        // TODO refine this\\n        const match = this.consume(/\\\\s*([^]*?)\\\\s+of\\\\b/y);\\n        if (!match) {\\n            throw new Error(\\\"Could not find 'of' in @for macro\\\");\\n        }\\n        const loopVar = match[1];\\n        const loopCond = this.parseJsExpression();\\n        if (loopCond.trim() === \\\"\\\") {\\n            throw new Error(\\\"Right-hand side of a for macro must be an Iterable\\\");\\n        }\\n        if (!this.consume(/\\\\s*\\\\)/uy)) {\\n            throw new Error(\\\"No closing paren\\\");\\n        }\\n        return [loopVar, loopCond];\\n    }\\n    parseJsArgs(closer) {\\n        const args = [];\\n        let arg;\\n        while ((arg = this.parseJsExpression())) {\\n            args.push(arg);\\n            if (!this.consume(/\\\\s*,/uy)) {\\n                break;\\n            }\\n        }\\n        this.consume(RE.whitespace);\\n        if (this.lookahead() !== closer) {\\n            throw new Error(`Missing a closing \\\\`${closer}\\\\``);\\n        }\\n        this.index++;\\n        return args;\\n    }\\n    parseJsExpression() {\\n        const nesting = [];\\n        const output = [];\\n        let match;\\n        outer: while (this.index < this.input.length) {\\n            match = this.consume(RE.js.normalChars);\\n            if (match) {\\n                output.push(match[0]);\\n            }\\n            const c = this.lookahead();\\n            match = this.consume(RE.js.identifier);\\n            if (match) {\\n                output.push(match[0]);\\n                continue;\\n            }\\n            switch (c) {\\n                case '\\\"':\\n                    match = this.consume(RE.js.stringDouble);\\n                    if (match) {\\n                        output.push(match[0]);\\n                    }\\n                    else {\\n                        throw new Error(\\\"Unclosed double-quoted string\\\");\\n                    }\\n                    break;\\n                case \\\"'\\\":\\n                    match = this.consume(RE.js.stringSingle);\\n                    if (match) {\\n                        output.push(match[0]);\\n                    }\\n                    else {\\n                        throw new Error(\\\"Unclosed single-quoted string\\\");\\n                    }\\n                    break;\\n                case \\\"`\\\":\\n                    this.index++;\\n                    output.push(c);\\n                    this.parseJsTemplateString(output);\\n                    break;\\n                case \\\"(\\\":\\n                    nesting.push(\\\")\\\");\\n                    output.push(c);\\n                    this.index++;\\n                    break;\\n                case \\\"[\\\":\\n                    nesting.push(\\\"]\\\");\\n                    output.push(c);\\n                    this.index++;\\n                    break;\\n                case \\\"{\\\":\\n                    nesting.push(\\\"}\\\");\\n                    output.push(c);\\n                    this.index++;\\n                    break;\\n                case \\\"$\\\":\\n                    this.index++;\\n                    match = this.consume(RE.js.identifier);\\n                    if (match) {\\n                        output.push(\\\"Engine.vars.\\\", match[0]);\\n                    }\\n                    else {\\n                        throw new Error(\\\"Illegal identifier\\\");\\n                    }\\n                    break;\\n                case \\\"_\\\":\\n                    this.index++;\\n                    match = this.consume(RE.js.identifier);\\n                    if (match) {\\n                        output.push(\\\"Engine.temp.\\\", match[0]);\\n                    }\\n                    else {\\n                        throw new Error(\\\"Illegal identifier\\\");\\n                    }\\n                    break;\\n                case \\\",\\\":\\n                    if (nesting.length > 0) {\\n                        // in a sub-expression, just continue\\n                        this.index++;\\n                        output.push(c);\\n                    }\\n                    else {\\n                        // at outer level, end the expression\\n                        break outer;\\n                    }\\n                    break;\\n                default:\\n                    if (c && c === nesting[nesting.length - 1]) {\\n                        this.index++;\\n                        output.push(c);\\n                        nesting.pop();\\n                        break;\\n                    }\\n                    if (![\\\")\\\", \\\"]\\\", \\\"}\\\"].includes(c || \\\"\\\")) {\\n                        throw new Error(`Can't handle unescaped ${c} yet`);\\n                    }\\n                    break outer;\\n            }\\n        }\\n        if (nesting.length > 0) {\\n            throw new Error(`Expected a \\\"${nesting.pop()}\\\"`);\\n        }\\n        return output.join(\\\"\\\");\\n    }\\n    parseJsTemplateString(output) {\\n        while (true) {\\n            const match = this.consume(RE.js.normalInTemplateString);\\n            if (match) {\\n                output.push(match[0]);\\n            }\\n            const c = this.lookahead();\\n            if (!c) {\\n                throw new Error(\\\"Unclosed template string\\\");\\n            }\\n            switch (c) {\\n                case \\\"`\\\":\\n                    output.push(c);\\n                    this.index++;\\n                    return;\\n                case \\\"$\\\":\\n                    // from regex, we already know the left bracket is present\\n                    this.index += 2;\\n                    output.push(\\\"${\\\");\\n                    output.push(this.parseJsExpression());\\n                    if (this.lookahead() !== \\\"}\\\") {\\n                        throw Error('missing \\\"}\\\" inside template string');\\n                    }\\n                    this.index++;\\n                    output.push(\\\"}\\\");\\n                    break;\\n                default:\\n                    throw Error(`Logic Error: '${c}' (U+${c.charCodeAt(0)}) was not matched by regex`);\\n            }\\n        }\\n    }\\n    makeLinkBox(fullText, separator) {\\n        const split = fullText.split(separator);\\n        if (split.length !== 2) {\\n            const msg = `Links in [[...]] can only contain \\\"${separator}\\\" once`;\\n            return this.error(msg);\\n        }\\n        if (separator === \\\"<-\\\") {\\n            return { type: \\\"linkBox\\\", link: split[0], text: split[1] };\\n        }\\n        else {\\n            return { type: \\\"linkBox\\\", link: split[1], text: split[0] };\\n        }\\n    }\\n}\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGFyc2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsWUFBWSxVQUFVLFlBQVksZUFBZSxZQUFZO0FBQ3JGLHlCQUF5QixTQUFTLE1BQU0sWUFBWTtBQUNwRDtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsU0FBUyxLQUFLLFlBQVk7QUFDL0Msd0JBQXdCLFNBQVMsS0FBSyxZQUFZO0FBQ2xELGdDQUFnQztBQUNoQztBQUNBO0FBQ0EseURBQXlEO0FBQ3pELEtBQUs7QUFDTDtBQUNBLDBCQUEwQjtBQUMxQix5QkFBeUIsU0FBUyxTQUFTLFlBQVk7QUFDdkQseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLHVEQUF1RDtBQUNqRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9FQUFvRSxFQUFFLE9BQU8sZ0JBQWdCO0FBQzdGO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELEVBQUU7QUFDdEQ7QUFDQTtBQUNBO0FBQ0Esc0RBQXNELGNBQWM7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOERBQThELElBQUk7QUFDbEU7QUFDQTtBQUNBO0FBQ0EsdUZBQXVGLEtBQUs7QUFDNUYsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLGFBQWEsb0JBQW9CLE1BQU0sWUFBWSxHQUFHO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1EO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELE9BQU87QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QixtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0QyxrRUFBa0UsR0FBRztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLGNBQWM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DO0FBQ0EsK0NBQStDO0FBQy9DLCtDQUErQztBQUMvQztBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQSxpREFBaUQsRUFBRSxPQUFPLGdCQUFnQjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4REFBOEQsVUFBVTtBQUN4RTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9icmljay8uL3NyYy9wYXJzZXIudHM/Y2I3NCJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBSRSA9IHtcbiAgICBjbG9zZVRhZzogLz4veSxcbiAgICBjb21tZW50QmxvY2s6IC9cXCooPzpbXl0pKj9cXCpcXC8veSxcbiAgICBjb21tZW50TGluZTogL1xcLy4qXFxuPy95LFxuICAgIGVsZW1lbnROYW1lOiAvKFstXFxwe0lEX0NvbnRpbnVlfV0rKSgjWy1cXHB7SURfQ29udGludWV9XSspPygoPzpcXC5bLVxccHtJRF9Db250aW51ZX1dKykqKS91eSxcbiAgICBodG1sQXR0cjogL1xccyooWy1AXFxwe0lEX1N0YXJ0fV1bLVxccHtJRF9Db250aW51ZX1dKik9XCIoW15cIl0qKVwiL3V5LFxuICAgIGpzOiB7XG4gICAgICAgIGNsb3NpbmdQYXJlbjogL1xccypcXCkveSxcbiAgICAgICAgY2xvc2luZ1NxdWFyZUJyYWNrZXQ6IC9cXHMqXFxdL3ksXG4gICAgICAgIGZpZWxkOiAvXFwuXFxwe0lEX1N0YXJ0fVskXFxwe0lEX0NvbnRpbnVlfV0qL3V5LFxuICAgICAgICBpZGVudGlmaWVyOiAvXFxwe0lEX1N0YXJ0fVskXFxwe0lEX0NvbnRpbnVlfV0qL3V5LFxuICAgICAgICBub3JtYWxDaGFyczogL1teXCInYFtcXF17fSgpLyRfLGEtekEtWl0rL3ksXG4gICAgICAgIHN0cmluZ0RvdWJsZTogL1wiKD86W15cXFxcXCJdfFxcXFwoPzoufFxccykpKlwiL3ksXG4gICAgICAgIHN0cmluZ1NpbmdsZTogLycoPzpbXlxcXFwnXXxcXFxcKD86LnxcXHMpKSonL3ksXG4gICAgICAgIG5vcm1hbEluVGVtcGxhdGVTdHJpbmc6IC8oPzpbXmAkXFxcXF18XFxcXFteXXxcXCQoPyFcXHspKSoveSxcbiAgICB9LFxuICAgIG1hY3JvQXJnc1N0YXJ0OiAvXFxzKlxcKC95LFxuICAgIG1hY3JvQm9keVN0YXJ0OiAvXFxzKlxcey95LFxuICAgIG1hY3JvTmFtZTogL1stXz08PlxccHtJRF9TdGFydH1dWy09PD5cXHB7SURfQ29udGludWV9XSovdXksXG4gICAgbm9ybWFsQ2hhcnM6IC9bXltcXF17fVxcXFwoJF8/PEAvXSsveSxcbiAgICBzaW5nbGVDaGFyOiAvLnxcXHMveSxcbiAgICB3aGl0ZXNwYWNlOiAvXFxzKi95LFxufTtcbi8vIFRoZXNlIEhUTUwgZWxlbWVudHMgZG9uJ3QgYWxsb3cgYSBjbG9zaW5nIHRhZy5cbmNvbnN0IFVOQ0xPU0VEX1RBR1MgPSBbXCJhcmVhXCIsIFwiYnJcIiwgXCJlbWJlZFwiLCBcImhyXCIsIFwiaW1nXCIsIFwiaW5wdXRcIiwgXCJsaW5rXCIsIFwibWV0YVwiLCBcInRyYWNrXCIsIFwid2JyXCJdO1xuZXhwb3J0IGZ1bmN0aW9uIGlzTWFjcm8obnQpIHtcbiAgICByZXR1cm4gdHlwZW9mIG50ID09PSBcIm9iamVjdFwiICYmIG50LnR5cGUgPT09IFwibWFjcm9cIjtcbn1cbmV4cG9ydCBjbGFzcyBQYXJzZXIge1xuICAgIGNvbnN0cnVjdG9yKHNvdXJjZSkge1xuICAgICAgICB0aGlzLmlucHV0ID0gc291cmNlO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9XG4gICAgY29uc3VtZShwYXR0ZXJuKSB7XG4gICAgICAgIC8vIGlmICh0eXBlb2YgcGF0dGVybiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAvLyAgIGlmICh0aGlzLmlucHV0LnN1YnN0cmluZyh0aGlzLmluZGV4KS5zdGFydHNXaXRoKHBhdHRlcm4pKSB7XG4gICAgICAgIC8vICAgICB0aGlzLmluZGV4ICs9IHBhdHRlcm4ubGVuZ3RoO1xuICAgICAgICAvLyAgICAgcmV0dXJuIFt0aGlzLmlucHV0LnN1YnN0cmluZyh0aGlzLmluZGV4LCBwYXR0ZXJuLmxlbmd0aCArIHRoaXMuaW5kZXgpXTtcbiAgICAgICAgLy8gICB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIC8vICAgfVxuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyB9XG4gICAgICAgIHBhdHRlcm4ubGFzdEluZGV4ID0gdGhpcy5pbmRleDtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWModGhpcy5pbnB1dCk7XG4gICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgdGhpcy5pbmRleCA9IHBhdHRlcm4ubGFzdEluZGV4O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtYXRjaDtcbiAgICB9XG4gICAgbG9va2FoZWFkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnB1dFt0aGlzLmluZGV4XSB8fCBudWxsO1xuICAgIH1cbiAgICBsb2NhdGlvblNhbXBsZSgpIHtcbiAgICAgICAgLy8gZWRnZSBjYXNlOiB3ZSBhcmUgYXQgYSBsaW5lIGJyZWFrXG4gICAgICAgIGlmICh0aGlzLmlucHV0W3RoaXMuaW5kZXhdID09PSBcIlxcblwiKSB7XG4gICAgICAgICAgICBjb25zdCBzdGFydCA9IHRoaXMuaW5wdXQubGFzdEluZGV4T2YoXCJcXG5cIiwgdGhpcy5pbmRleCAtIDEpICsgMTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0LnNsaWNlKHN0YXJ0LCB0aGlzLmluZGV4KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUaGlzIHdpbGwgYmUgemVybyBpZiBhIG5ld2xpbmUgaXMgbm90IGZvdW5kXG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5pbnB1dC5sYXN0SW5kZXhPZihcIlxcblwiLCB0aGlzLmluZGV4IC0gMSkgKyAxO1xuICAgICAgICBjb25zdCBlbmQgPSB0aGlzLmlucHV0LmluZGV4T2YoXCJcXG5cIiwgdGhpcy5pbmRleCArIDEpO1xuICAgICAgICByZXR1cm4gdGhpcy5pbnB1dC5zbGljZShzdGFydCwgZW5kKTtcbiAgICB9XG4gICAgZXJyb3IobWVzc2FnZSkge1xuICAgICAgICByZXR1cm4geyB0eXBlOiBcImVycm9yXCIsIG1lc3NhZ2UsIGxvY2F0aW9uU2FtcGxlOiB0aGlzLmxvY2F0aW9uU2FtcGxlKCkgfTtcbiAgICB9XG4gICAgcGFyc2UoY2xvc2VyKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gW107XG4gICAgICAgIGxldCBpdGVyYXRpb25zID0gMDtcbiAgICAgICAgb3V0ZXI6IHdoaWxlICh0aGlzLmluZGV4IDwgdGhpcy5pbnB1dC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChpdGVyYXRpb25zID49IDEwMDAwMDApIHtcbiAgICAgICAgICAgICAgICBvdXRwdXQucHVzaCh0aGlzLmVycm9yKFwiUGFyc2VyIHN0dWNrIGluIGluZmluaXRlIGxvb3BcIikpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpdGVyYXRpb25zKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBvbGRJbmRleCA9IHRoaXMuaW5kZXg7XG4gICAgICAgICAgICB0aGlzLmNvbnN1bWUoUkUubm9ybWFsQ2hhcnMpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXggIT09IG9sZEluZGV4KSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0LnB1c2godGhpcy5pbnB1dC5zdWJzdHJpbmcob2xkSW5kZXgsIHRoaXMuaW5kZXgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjbG9zZXIgJiYgdGhpcy5jb25zdW1lKGNsb3NlcikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYyA9IChfYSA9IHRoaXMuY29uc3VtZShSRS5zaW5nbGVDaGFyKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdO1xuICAgICAgICAgICAgc3dpdGNoIChjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcIlxcXFxcIjoge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjMiA9IHRoaXMubG9va2FoZWFkKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghYzIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFzc3VtZSB0aGV5IG1lYW50IHRvIHBsYWNlIGFuIGVzY2FwZWQgbmV3bGluZSwgdGhhdCBnb3QgdHJpbW1lZC5cbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKFwiXFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goYzIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCI8XCI6XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHRoaXMucGFyc2VFbGVtZW50KCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiQFwiOlxuICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaCh0aGlzLnBhcnNlTWFjcm8oKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCIvXCI6XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5sb29rYWhlYWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIi9cIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnN1bWUoUkUuY29tbWVudExpbmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIipcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29uc3VtZShSRS5jb21tZW50QmxvY2spKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHRoaXMuZXJyb3IoXCJNaXNzaW5nIHRyYWlsaW5nIGAqL2AgdG8gY2xvc2UgdGhlIGJsb2NrIGNvbW1lbnRcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIiRcIjoge1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaCh0aGlzLnBhcnNlTmFrZWRWYXJpYWJsZShcInN0b3J5XCIpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJfXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2godGhpcy5wYXJzZU5ha2VkVmFyaWFibGUoXCJ0ZW1wXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgXCJbXCI6XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb2thaGVhZCgpID09PSBcIltcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbSA9IHRoaXMuY29uc3VtZSgvKCg/OlteXFxcXFxcXV18XFxcXC4pKilcXF1cXF0veSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbm1hdGNoZWQgYFtbYFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmtCb3hGdWxsID0gbVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc1JpZ2h0QXJyb3cgPSBsaW5rQm94RnVsbC5pbmNsdWRlcyhcIi0+XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzTGVmdEFycm93ID0gbGlua0JveEZ1bGwuaW5jbHVkZXMoXCI8LVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc1BpcGUgPSBsaW5rQm94RnVsbC5pbmNsdWRlcyhcInxcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXBhcmF0b3JDb3VudCA9IE51bWJlcihoYXNSaWdodEFycm93KSArIE51bWJlcihoYXNMZWZ0QXJyb3cpICsgTnVtYmVyKGhhc1BpcGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlcGFyYXRvckNvdW50ID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHRoaXMuZXJyb3IoXCJMaW5rIGJveGVzIGNhbiBvbmx5IGhhdmUgb25lIG9mICctPicsICc8LScsIG9yICd8J1wiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzZXBhcmF0b3JDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHsgdHlwZTogXCJsaW5rQm94XCIsIGxpbms6IGxpbmtCb3hGdWxsLCB0ZXh0OiBsaW5rQm94RnVsbCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlcGFyYXRvciA9IGhhc1JpZ2h0QXJyb3cgPyBcIi0+XCIgOiBoYXNMZWZ0QXJyb3cgPyBcIjwtXCIgOiBcInxcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaCh0aGlzLm1ha2VMaW5rQm94KGxpbmtCb3hGdWxsLCBzZXBhcmF0b3IpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKFwiW1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiXVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCI/XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIj5cIjpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgeWV0IGhhbmRsZSB1bmVzY2FwZWQgJyR7Y30nIChVKyR7Yy5jaGFyQ29kZUF0KDApfSlgKTtcbiAgICAgICAgICAgICAgICBjYXNlIHVuZGVmaW5lZDpcbiAgICAgICAgICAgICAgICAgICAgLy8gZW5kIG9mIGlucHV0XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTG9naWMgRXJyb3IgKCR7Y30pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsb3NlciAmJiAhdGhpcy5jb25zdW1lKGNsb3NlcikpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIG1hdGNoIHJlZ2V4IFwiJHtjbG9zZXIuc291cmNlfVwiYCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG4gICAgcGFyc2VFbGVtZW50KCkge1xuICAgICAgICBjb25zdCBsb25nTmFtZSA9IHRoaXMuY29uc3VtZShSRS5lbGVtZW50TmFtZSk7XG4gICAgICAgIGlmICghbG9uZ05hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVycm9yKFwiRWxlbWVudCBuYW1lcyBjYW4gY29udGFpbiBvbmx5IGh5cGhlbnMsIHVuZGVyc2NvcmVzLCBhbmQgQVNDSUkgbGV0dGVycyBhbmQgbnVtYmVyc1wiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBbX2Z1bGxNYXRjaCwgbmFtZSwgaWQsIGNsYXNzTmFtZV0gPSBsb25nTmFtZTtcbiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzLnNldChcImlkXCIsIGlkLnNsaWNlKDEpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2xhc3NOYW1lLmxlbmd0aCkge1xuICAgICAgICAgICAgYXR0cmlidXRlcy5zZXQoXCJjbGFzc1wiLCBjbGFzc05hbWUucmVwbGFjZShcIi5cIiwgXCIgXCIpLnRyaW0oKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25zdW1lKFJFLndoaXRlc3BhY2UpO1xuICAgICAgICB3aGlsZSAoIXRoaXMuY29uc3VtZShSRS5jbG9zZVRhZykpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gdGhpcy5jb25zdW1lKFJFLmh0bWxBdHRyKTtcbiAgICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lcnJvcihcIk1pc3NpbmcgdHJhaWxpbmcgYD5gIHRvIGNsb3NlIHRoZSBIVE1MIHRhZ1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IFtfLCBrZXksIHZhbHVlXSA9IG1hdGNoO1xuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZXMuaGFzKGtleSkpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYElnbm9yaW5nIGR1cGxpY2F0ZSBhdHRyaWJ1dGUgJyR7a2V5fWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXR0cmlidXRlcy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGVudCA9IFVOQ0xPU0VEX1RBR1MuaW5jbHVkZXMobmFtZSkgPyBbXSA6IHRoaXMucGFyc2UobmV3IFJlZ0V4cChgPC8ke25hbWV9PmAsIFwieVwiKSk7XG4gICAgICAgIHJldHVybiB7IHR5cGU6IFwiZWxlbWVudFwiLCBuYW1lLCBhdHRyaWJ1dGVzLCBjb250ZW50IH07XG4gICAgfVxuICAgIHBhcnNlTmFrZWRWYXJpYWJsZSh0eXBlKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0SWR4ID0gdGhpcy5pbmRleDtcbiAgICAgICAgbGV0IG1hdGNoID0gdGhpcy5jb25zdW1lKFJFLmpzLmlkZW50aWZpZXIpO1xuICAgICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgICAgICBjb25zdCBsZWFkaW5nQ2hhciA9IHR5cGUgPT09IFwic3RvcnlcIiA/IFwiJFwiIDogXCJfXCI7XG4gICAgICAgICAgICBjb25zdCBicyA9IFwib3IgZXNjYXBlZCB3aXRoIGEgYmFja3NsYXNoIGBcXFxcYFwiO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3IoYCR7bGVhZGluZ0NoYXJ9IG11c3QgYmUgcGFydCBvZiBhICR7dHlwZX0gdmFyaWFibGUsICR7YnN9YCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYmFzZVZhck5hbWUgPSBtYXRjaFswXTtcbiAgICAgICAgY29uc3Qgc3VmZml4U3RhcnQgPSB0aGlzLmluZGV4O1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLmxvb2thaGVhZCgpKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcIi5cIjpcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSB0aGlzLmNvbnN1bWUoUkUuanMuZmllbGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIG5vdCBhIG1hdGNoOiBicmVhayBvdXQsIHRoZSBwZXJpb2Qgd2lsbCBiZSB0cmVhdGVkIGFzIHBsYWluIG1hcmt1cCBsYXRlclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiW1wiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VKc0FyZ3MoXCJdXCIpO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiKFwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VKc0FyZ3MoXCIpXCIpO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmluZGV4ID09PSBzdWZmaXhTdGFydCkge1xuICAgICAgICAgICAgLy8gc2ltcGxlOiBqdXN0IGEgcGxhaW4gdmFyaWFibGVcbiAgICAgICAgICAgIHJldHVybiB7IHR5cGUsIG5hbWU6IGJhc2VWYXJOYW1lIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBtb3JlIGNvbXBsaWNhdGVkOiBzdWJzdGl0dXRlIHdpdGggQHByaW50XG4gICAgICAgICAgICBjb25zdCBwcmVmaXggPSB0eXBlID09PSBcInN0b3J5XCIgPyBcIkVuZ2luZS52YXJzLlwiIDogXCJFbmdpbmUudGVtcC5cIjtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJtYWNyb1wiLFxuICAgICAgICAgICAgICAgIG5hbWU6IFwicHJpbnRcIixcbiAgICAgICAgICAgICAgICBhcmdzOiBbcHJlZml4ICsgdGhpcy5pbnB1dC5zdWJzdHJpbmcoc3RhcnRJZHgsIHRoaXMuaW5kZXgpXSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcGFyc2VNYWNybygpIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSB0aGlzLmNvbnN1bWUoUkUubWFjcm9OYW1lKTtcbiAgICAgICAgbGV0IG1hY3JvTmFtZTtcbiAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICBtYWNyb05hbWUgPSBtYXRjaFswXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIGVkZ2UgY2FzZTogdW5uYW1lZCBtYWNyb1xuICAgICAgICAgICAgaWYgKHRoaXMubG9va2FoZWFkKCkgPT09IFwiKFwiKSB7XG4gICAgICAgICAgICAgICAgbWFjcm9OYW1lID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVycm9yKFwiYEBgIG11c3QgYmUgZm9sbG93ZWQgYnkgYSBtYWNybyBuYW1lLCBvciBiZSBlc2NhcGVkIHdpdGggYSBgXFxcXGBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGFyZ3MgPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5jb25zdW1lKFJFLm1hY3JvQXJnc1N0YXJ0KSkge1xuICAgICAgICAgICAgYXJncyA9IG1hY3JvTmFtZSA9PT0gXCJmb3JcIiA/IHRoaXMucGFyc2VGb3JBcmdzKCkgOiB0aGlzLnBhcnNlSnNBcmdzKFwiKVwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBoYXNDb250ZW50ID0gdGhpcy5jb25zdW1lKFJFLm1hY3JvQm9keVN0YXJ0KTtcbiAgICAgICAgaWYgKCFhcmdzICYmICFoYXNDb250ZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lcnJvcihcIk1hY3JvIGludm9jYXRpb25zIG11c3QgYmUgZm9sbG93ZWQgYnkgYChgIG9yIGBbYFwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250ZW50ID0gaGFzQ29udGVudCA/IHRoaXMucGFyc2UoL1xcfS95KSA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6IFwibWFjcm9cIixcbiAgICAgICAgICAgIG5hbWU6IG1hY3JvTmFtZSxcbiAgICAgICAgICAgIGFyZ3M6IGFyZ3MgfHwgW10sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICB9O1xuICAgIH1cbiAgICBwYXJzZUZvckFyZ3MoKSB7XG4gICAgICAgIC8vIFRPRE8gcmVmaW5lIHRoaXNcbiAgICAgICAgY29uc3QgbWF0Y2ggPSB0aGlzLmNvbnN1bWUoL1xccyooW15dKj8pXFxzK29mXFxiL3kpO1xuICAgICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZmluZCAnb2YnIGluIEBmb3IgbWFjcm9cIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9vcFZhciA9IG1hdGNoWzFdO1xuICAgICAgICBjb25zdCBsb29wQ29uZCA9IHRoaXMucGFyc2VKc0V4cHJlc3Npb24oKTtcbiAgICAgICAgaWYgKGxvb3BDb25kLnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmlnaHQtaGFuZCBzaWRlIG9mIGEgZm9yIG1hY3JvIG11c3QgYmUgYW4gSXRlcmFibGVcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmNvbnN1bWUoL1xccypcXCkvdXkpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBjbG9zaW5nIHBhcmVuXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbbG9vcFZhciwgbG9vcENvbmRdO1xuICAgIH1cbiAgICBwYXJzZUpzQXJncyhjbG9zZXIpIHtcbiAgICAgICAgY29uc3QgYXJncyA9IFtdO1xuICAgICAgICBsZXQgYXJnO1xuICAgICAgICB3aGlsZSAoKGFyZyA9IHRoaXMucGFyc2VKc0V4cHJlc3Npb24oKSkpIHtcbiAgICAgICAgICAgIGFyZ3MucHVzaChhcmcpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmNvbnN1bWUoL1xccyosL3V5KSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29uc3VtZShSRS53aGl0ZXNwYWNlKTtcbiAgICAgICAgaWYgKHRoaXMubG9va2FoZWFkKCkgIT09IGNsb3Nlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIGEgY2xvc2luZyBcXGAke2Nsb3Nlcn1cXGBgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgIHJldHVybiBhcmdzO1xuICAgIH1cbiAgICBwYXJzZUpzRXhwcmVzc2lvbigpIHtcbiAgICAgICAgY29uc3QgbmVzdGluZyA9IFtdO1xuICAgICAgICBjb25zdCBvdXRwdXQgPSBbXTtcbiAgICAgICAgbGV0IG1hdGNoO1xuICAgICAgICBvdXRlcjogd2hpbGUgKHRoaXMuaW5kZXggPCB0aGlzLmlucHV0Lmxlbmd0aCkge1xuICAgICAgICAgICAgbWF0Y2ggPSB0aGlzLmNvbnN1bWUoUkUuanMubm9ybWFsQ2hhcnMpO1xuICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0LnB1c2gobWF0Y2hbMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMubG9va2FoZWFkKCk7XG4gICAgICAgICAgICBtYXRjaCA9IHRoaXMuY29uc3VtZShSRS5qcy5pZGVudGlmaWVyKTtcbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKG1hdGNoWzBdKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAoYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ1wiJzpcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSB0aGlzLmNvbnN1bWUoUkUuanMuc3RyaW5nRG91YmxlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaChtYXRjaFswXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmNsb3NlZCBkb3VibGUtcXVvdGVkIHN0cmluZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiJ1wiOlxuICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IHRoaXMuY29uc3VtZShSRS5qcy5zdHJpbmdTaW5nbGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKG1hdGNoWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuY2xvc2VkIHNpbmdsZS1xdW90ZWQgc3RyaW5nXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJgXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goYyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VKc1RlbXBsYXRlU3RyaW5nKG91dHB1dCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCIoXCI6XG4gICAgICAgICAgICAgICAgICAgIG5lc3RpbmcucHVzaChcIilcIik7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKGMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJbXCI6XG4gICAgICAgICAgICAgICAgICAgIG5lc3RpbmcucHVzaChcIl1cIik7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKGMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ7XCI6XG4gICAgICAgICAgICAgICAgICAgIG5lc3RpbmcucHVzaChcIn1cIik7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKGMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCIkXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSB0aGlzLmNvbnN1bWUoUkUuanMuaWRlbnRpZmllcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goXCJFbmdpbmUudmFycy5cIiwgbWF0Y2hbMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSWxsZWdhbCBpZGVudGlmaWVyXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJfXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSB0aGlzLmNvbnN1bWUoUkUuanMuaWRlbnRpZmllcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goXCJFbmdpbmUudGVtcC5cIiwgbWF0Y2hbMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSWxsZWdhbCBpZGVudGlmaWVyXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCIsXCI6XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXN0aW5nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluIGEgc3ViLWV4cHJlc3Npb24sIGp1c3QgY29udGludWVcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKGMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXQgb3V0ZXIgbGV2ZWwsIGVuZCB0aGUgZXhwcmVzc2lvblxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKGMgJiYgYyA9PT0gbmVzdGluZ1tuZXN0aW5nLmxlbmd0aCAtIDFdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaChjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lc3RpbmcucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIVtcIilcIiwgXCJdXCIsIFwifVwiXS5pbmNsdWRlcyhjIHx8IFwiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0IGhhbmRsZSB1bmVzY2FwZWQgJHtjfSB5ZXRgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhayBvdXRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobmVzdGluZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGEgXCIke25lc3RpbmcucG9wKCl9XCJgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0cHV0LmpvaW4oXCJcIik7XG4gICAgfVxuICAgIHBhcnNlSnNUZW1wbGF0ZVN0cmluZyhvdXRwdXQpIHtcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gdGhpcy5jb25zdW1lKFJFLmpzLm5vcm1hbEluVGVtcGxhdGVTdHJpbmcpO1xuICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0LnB1c2gobWF0Y2hbMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMubG9va2FoZWFkKCk7XG4gICAgICAgICAgICBpZiAoIWMpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmNsb3NlZCB0ZW1wbGF0ZSBzdHJpbmdcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzd2l0Y2ggKGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYFwiOlxuICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaChjKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgY2FzZSBcIiRcIjpcbiAgICAgICAgICAgICAgICAgICAgLy8gZnJvbSByZWdleCwgd2UgYWxyZWFkeSBrbm93IHRoZSBsZWZ0IGJyYWNrZXQgaXMgcHJlc2VudFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4ICs9IDI7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKFwiJHtcIik7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHRoaXMucGFyc2VKc0V4cHJlc3Npb24oKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb2thaGVhZCgpICE9PSBcIn1cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ21pc3NpbmcgXCJ9XCIgaW5zaWRlIHRlbXBsYXRlIHN0cmluZycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goXCJ9XCIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgTG9naWMgRXJyb3I6ICcke2N9JyAoVSske2MuY2hhckNvZGVBdCgwKX0pIHdhcyBub3QgbWF0Y2hlZCBieSByZWdleGApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIG1ha2VMaW5rQm94KGZ1bGxUZXh0LCBzZXBhcmF0b3IpIHtcbiAgICAgICAgY29uc3Qgc3BsaXQgPSBmdWxsVGV4dC5zcGxpdChzZXBhcmF0b3IpO1xuICAgICAgICBpZiAoc3BsaXQubGVuZ3RoICE9PSAyKSB7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSBgTGlua3MgaW4gW1suLi5dXSBjYW4gb25seSBjb250YWluIFwiJHtzZXBhcmF0b3J9XCIgb25jZWA7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lcnJvcihtc2cpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZXBhcmF0b3IgPT09IFwiPC1cIikge1xuICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogXCJsaW5rQm94XCIsIGxpbms6IHNwbGl0WzBdLCB0ZXh0OiBzcGxpdFsxXSB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogXCJsaW5rQm94XCIsIGxpbms6IHNwbGl0WzFdLCB0ZXh0OiBzcGxpdFswXSB9O1xuICAgICAgICB9XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\\n//# sourceURL=webpack-internal:///./src/parser.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/passages.ts\":\n/*!*************************!*\\\n  !*** ./src/passages.ts ***!\n  \\*************************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   Passage: () => (/* binding */ Passage),\\n/* harmony export */   filter: () => (/* binding */ filter),\\n/* harmony export */   find: () => (/* binding */ find),\\n/* harmony export */   get: () => (/* binding */ get),\\n/* harmony export */   init: () => (/* binding */ init),\\n/* harmony export */   start: () => (/* binding */ start),\\n/* harmony export */   withTag: () => (/* binding */ withTag)\\n/* harmony export */ });\\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \\\"./src/util.ts\\\");\\nvar __classPrivateFieldSet = (undefined && undefined.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\\n    if (kind === \\\"m\\\") throw new TypeError(\\\"Private method is not writable\\\");\\n    if (kind === \\\"a\\\" && !f) throw new TypeError(\\\"Private accessor was defined without a setter\\\");\\n    if (typeof state === \\\"function\\\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\\\"Cannot write private member to an object whose class did not declare it\\\");\\n    return (kind === \\\"a\\\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\\n};\\nvar __classPrivateFieldGet = (undefined && undefined.__classPrivateFieldGet) || function (receiver, state, kind, f) {\\n    if (kind === \\\"a\\\" && !f) throw new TypeError(\\\"Private accessor was defined without a getter\\\");\\n    if (typeof state === \\\"function\\\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\\\"Cannot read private member from an object whose class did not declare it\\\");\\n    return kind === \\\"m\\\" ? f : kind === \\\"a\\\" ? f.call(receiver) : f ? f.value : state.get(receiver);\\n};\\nvar _Passage_element;\\n\\nclass Passage {\\n    constructor(element) {\\n        var _a;\\n        _Passage_element.set(this, void 0);\\n        const id = element.getAttribute(\\\"pid\\\");\\n        if (!id) {\\n            throw new Error(\\\"Passage has no pid: \\\" + element.outerHTML);\\n        }\\n        const name = element.getAttribute(\\\"name\\\");\\n        if (!name) {\\n            throw new Error(`Passage ${id} has no name`);\\n        }\\n        this.id = id;\\n        this.name = name;\\n        this.slug = (0,_util__WEBPACK_IMPORTED_MODULE_0__.slugify)(name);\\n        this.tags =\\n            ((_a = element\\n                .getAttribute(\\\"tags\\\")) === null || _a === void 0 ? void 0 : _a.split(\\\" \\\").filter((tag) => tag.length >= 0)) || [];\\n        __classPrivateFieldSet(this, _Passage_element, element, \\\"f\\\");\\n    }\\n    get content() {\\n        return __classPrivateFieldGet(this, _Passage_element, \\\"f\\\").textContent || \\\"\\\";\\n    }\\n}\\n_Passage_element = new WeakMap();\\n// TODO: provide more detailed error messages, which recommend an alternative.\\nconst BANNED_NAMES = [\\n    \\\"PassageDone\\\",\\n    \\\"PassageFooter\\\",\\n    \\\"PassageHeader\\\",\\n    \\\"PassageReady\\\",\\n    \\\"StoryAuthor\\\",\\n    \\\"StoryBanner\\\",\\n    \\\"StoryCaption\\\",\\n    \\\"StoryDisplayTitle\\\",\\n    \\\"StoryInit\\\",\\n    \\\"StoryInterface\\\",\\n    \\\"StoryMenu\\\",\\n    \\\"StorySettings\\\",\\n    \\\"StorySubtitle\\\",\\n    \\\"StoryTitle\\\",\\n];\\nconst BANNED_TAGS = [\\n    \\\"init\\\",\\n    \\\"script\\\",\\n    \\\"stylesheet\\\",\\n    \\\"Twine.audio\\\",\\n    \\\"Twine.image\\\",\\n    \\\"Twine.video\\\",\\n    \\\"Twine.vtt\\\",\\n    \\\"widget\\\",\\n    \\\"header\\\",\\n    \\\"footer\\\",\\n    \\\"startup\\\",\\n    \\\"debug-header\\\",\\n    \\\"debug-footer\\\",\\n    \\\"debug-startup\\\",\\n    \\\"nobr\\\",\\n];\\nfunction checkBannedNames(name) {\\n    if (BANNED_NAMES.includes(name)) {\\n        throw new Error(`The passage name \\\"${name}\\\" is not allowed`);\\n    }\\n}\\nfunction checkBannedTags(tags, passageName) {\\n    for (const tag of tags) {\\n        if (BANNED_TAGS.includes(tag)) {\\n            throw new Error(`The tag '${tag}' on the passage \\\"${passageName} is not allowed`);\\n        }\\n    }\\n}\\nconst byId = new Map();\\nconst byName = new Map();\\nlet startPassage;\\n/** @param storyData The `<tw-storydata>` element */\\nfunction init(storyData) {\\n    const passageElements = storyData.getElementsByTagName(\\\"tw-passagedata\\\");\\n    for (const elt of passageElements) {\\n        const passage = new Passage(elt);\\n        const { id, name } = passage;\\n        checkBannedNames(passage.name);\\n        if (passage.name.startsWith(\\\"::\\\")) {\\n            console.warn(`Found a passage named \\\"${name}\\\". Although starting a passage name with \\\"::\\\" is allowed, this is likely a mistake.`);\\n        }\\n        checkBannedTags(passage.tags, name);\\n        if (byId.has(id)) {\\n            throw new Error(`Duplicate passage id ${id}`);\\n        }\\n        if (byName.has(name)) {\\n            throw new Error(`Duplicate passage name ${name}`);\\n        }\\n        if (!passage.content.trim()) {\\n            console.warn(`Passage ${name} has no text.`);\\n        }\\n        byId.set(id, passage);\\n        byName.set(name, passage);\\n    }\\n    const startPid = storyData.getAttribute(\\\"startnode\\\");\\n    if (startPid) {\\n        const maybeStart = byId.get(startPid);\\n        if (!maybeStart) {\\n            throw new Error(`Could not determine starting passage; no passage with ${startPid}`);\\n        }\\n        startPassage = maybeStart;\\n    }\\n    else {\\n        const maybeStart = byName.get(\\\"Start\\\");\\n        if (!maybeStart) {\\n            throw new Error(`Could not find a passage named \\\"Start\\\"`);\\n        }\\n        startPassage = maybeStart;\\n    }\\n}\\n/** @returns all passages for which `predicate` returned true */\\nfunction filter(predicate) {\\n    const result = [];\\n    for (const passage of byName.values()) {\\n        if (predicate(passage)) {\\n            result.push(passage);\\n        }\\n    }\\n    return result;\\n}\\n/** @returns a passage for which `predicate` returned true */\\nfunction find(predicate) {\\n    for (const passage of byName.values()) {\\n        if (predicate(passage)) {\\n            return passage;\\n        }\\n    }\\n    return undefined;\\n}\\n/** @returns the passage with the given name */\\nfunction get(name) {\\n    return byName.get(name);\\n}\\n/** @returns the passage that should be used as the story start */\\nfunction start() {\\n    return startPassage;\\n}\\n/** @returns all passages with the given tag */\\nfunction withTag(tag) {\\n    return filter((psg) => psg.tags.includes(tag));\\n}\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGFzc2FnZXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSw4QkFBOEIsU0FBSSxJQUFJLFNBQUk7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixTQUFJLElBQUksU0FBSTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ2lDO0FBQzFCO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLElBQUk7QUFDM0M7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDhDQUFPO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLEtBQUs7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxJQUFJLG9CQUFvQixhQUFhO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsV0FBVztBQUMzQjtBQUNBO0FBQ0EsbURBQW1ELEtBQUs7QUFDeEQ7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELEdBQUc7QUFDdkQ7QUFDQTtBQUNBLHNEQUFzRCxLQUFLO0FBQzNEO0FBQ0E7QUFDQSxvQ0FBb0MsTUFBTTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FLGtCQUFrQixTQUFTO0FBQzlGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2JyaWNrLy4vc3JjL3Bhc3NhZ2VzLnRzP2E2ZTgiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIF9fY2xhc3NQcml2YXRlRmllbGRTZXQgPSAodGhpcyAmJiB0aGlzLl9fY2xhc3NQcml2YXRlRmllbGRTZXQpIHx8IGZ1bmN0aW9uIChyZWNlaXZlciwgc3RhdGUsIHZhbHVlLCBraW5kLCBmKSB7XG4gICAgaWYgKGtpbmQgPT09IFwibVwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlXCIpO1xuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIHNldHRlclwiKTtcbiAgICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCB3cml0ZSBwcml2YXRlIG1lbWJlciB0byBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xuICAgIHJldHVybiAoa2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIsIHZhbHVlKSA6IGYgPyBmLnZhbHVlID0gdmFsdWUgOiBzdGF0ZS5zZXQocmVjZWl2ZXIsIHZhbHVlKSksIHZhbHVlO1xufTtcbnZhciBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0ID0gKHRoaXMgJiYgdGhpcy5fX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KSB8fCBmdW5jdGlvbiAocmVjZWl2ZXIsIHN0YXRlLCBraW5kLCBmKSB7XG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgZ2V0dGVyXCIpO1xuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHJlYWQgcHJpdmF0ZSBtZW1iZXIgZnJvbSBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xuICAgIHJldHVybiBraW5kID09PSBcIm1cIiA/IGYgOiBraW5kID09PSBcImFcIiA/IGYuY2FsbChyZWNlaXZlcikgOiBmID8gZi52YWx1ZSA6IHN0YXRlLmdldChyZWNlaXZlcik7XG59O1xudmFyIF9QYXNzYWdlX2VsZW1lbnQ7XG5pbXBvcnQgeyBzbHVnaWZ5IH0gZnJvbSBcIi4vdXRpbFwiO1xuZXhwb3J0IGNsYXNzIFBhc3NhZ2Uge1xuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBfUGFzc2FnZV9lbGVtZW50LnNldCh0aGlzLCB2b2lkIDApO1xuICAgICAgICBjb25zdCBpZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwicGlkXCIpO1xuICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQYXNzYWdlIGhhcyBubyBwaWQ6IFwiICsgZWxlbWVudC5vdXRlckhUTUwpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5hbWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShcIm5hbWVcIik7XG4gICAgICAgIGlmICghbmFtZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQYXNzYWdlICR7aWR9IGhhcyBubyBuYW1lYCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnNsdWcgPSBzbHVnaWZ5KG5hbWUpO1xuICAgICAgICB0aGlzLnRhZ3MgPVxuICAgICAgICAgICAgKChfYSA9IGVsZW1lbnRcbiAgICAgICAgICAgICAgICAuZ2V0QXR0cmlidXRlKFwidGFnc1wiKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNwbGl0KFwiIFwiKS5maWx0ZXIoKHRhZykgPT4gdGFnLmxlbmd0aCA+PSAwKSkgfHwgW107XG4gICAgICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQodGhpcywgX1Bhc3NhZ2VfZWxlbWVudCwgZWxlbWVudCwgXCJmXCIpO1xuICAgIH1cbiAgICBnZXQgY29udGVudCgpIHtcbiAgICAgICAgcmV0dXJuIF9fY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX1Bhc3NhZ2VfZWxlbWVudCwgXCJmXCIpLnRleHRDb250ZW50IHx8IFwiXCI7XG4gICAgfVxufVxuX1Bhc3NhZ2VfZWxlbWVudCA9IG5ldyBXZWFrTWFwKCk7XG4vLyBUT0RPOiBwcm92aWRlIG1vcmUgZGV0YWlsZWQgZXJyb3IgbWVzc2FnZXMsIHdoaWNoIHJlY29tbWVuZCBhbiBhbHRlcm5hdGl2ZS5cbmNvbnN0IEJBTk5FRF9OQU1FUyA9IFtcbiAgICBcIlBhc3NhZ2VEb25lXCIsXG4gICAgXCJQYXNzYWdlRm9vdGVyXCIsXG4gICAgXCJQYXNzYWdlSGVhZGVyXCIsXG4gICAgXCJQYXNzYWdlUmVhZHlcIixcbiAgICBcIlN0b3J5QXV0aG9yXCIsXG4gICAgXCJTdG9yeUJhbm5lclwiLFxuICAgIFwiU3RvcnlDYXB0aW9uXCIsXG4gICAgXCJTdG9yeURpc3BsYXlUaXRsZVwiLFxuICAgIFwiU3RvcnlJbml0XCIsXG4gICAgXCJTdG9yeUludGVyZmFjZVwiLFxuICAgIFwiU3RvcnlNZW51XCIsXG4gICAgXCJTdG9yeVNldHRpbmdzXCIsXG4gICAgXCJTdG9yeVN1YnRpdGxlXCIsXG4gICAgXCJTdG9yeVRpdGxlXCIsXG5dO1xuY29uc3QgQkFOTkVEX1RBR1MgPSBbXG4gICAgXCJpbml0XCIsXG4gICAgXCJzY3JpcHRcIixcbiAgICBcInN0eWxlc2hlZXRcIixcbiAgICBcIlR3aW5lLmF1ZGlvXCIsXG4gICAgXCJUd2luZS5pbWFnZVwiLFxuICAgIFwiVHdpbmUudmlkZW9cIixcbiAgICBcIlR3aW5lLnZ0dFwiLFxuICAgIFwid2lkZ2V0XCIsXG4gICAgXCJoZWFkZXJcIixcbiAgICBcImZvb3RlclwiLFxuICAgIFwic3RhcnR1cFwiLFxuICAgIFwiZGVidWctaGVhZGVyXCIsXG4gICAgXCJkZWJ1Zy1mb290ZXJcIixcbiAgICBcImRlYnVnLXN0YXJ0dXBcIixcbiAgICBcIm5vYnJcIixcbl07XG5mdW5jdGlvbiBjaGVja0Jhbm5lZE5hbWVzKG5hbWUpIHtcbiAgICBpZiAoQkFOTkVEX05BTUVTLmluY2x1ZGVzKG5hbWUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHBhc3NhZ2UgbmFtZSBcIiR7bmFtZX1cIiBpcyBub3QgYWxsb3dlZGApO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGNoZWNrQmFubmVkVGFncyh0YWdzLCBwYXNzYWdlTmFtZSkge1xuICAgIGZvciAoY29uc3QgdGFnIG9mIHRhZ3MpIHtcbiAgICAgICAgaWYgKEJBTk5FRF9UQUdTLmluY2x1ZGVzKHRhZykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHRhZyAnJHt0YWd9JyBvbiB0aGUgcGFzc2FnZSBcIiR7cGFzc2FnZU5hbWV9IGlzIG5vdCBhbGxvd2VkYCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5jb25zdCBieUlkID0gbmV3IE1hcCgpO1xuY29uc3QgYnlOYW1lID0gbmV3IE1hcCgpO1xubGV0IHN0YXJ0UGFzc2FnZTtcbi8qKiBAcGFyYW0gc3RvcnlEYXRhIFRoZSBgPHR3LXN0b3J5ZGF0YT5gIGVsZW1lbnQgKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0KHN0b3J5RGF0YSkge1xuICAgIGNvbnN0IHBhc3NhZ2VFbGVtZW50cyA9IHN0b3J5RGF0YS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInR3LXBhc3NhZ2VkYXRhXCIpO1xuICAgIGZvciAoY29uc3QgZWx0IG9mIHBhc3NhZ2VFbGVtZW50cykge1xuICAgICAgICBjb25zdCBwYXNzYWdlID0gbmV3IFBhc3NhZ2UoZWx0KTtcbiAgICAgICAgY29uc3QgeyBpZCwgbmFtZSB9ID0gcGFzc2FnZTtcbiAgICAgICAgY2hlY2tCYW5uZWROYW1lcyhwYXNzYWdlLm5hbWUpO1xuICAgICAgICBpZiAocGFzc2FnZS5uYW1lLnN0YXJ0c1dpdGgoXCI6OlwiKSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBGb3VuZCBhIHBhc3NhZ2UgbmFtZWQgXCIke25hbWV9XCIuIEFsdGhvdWdoIHN0YXJ0aW5nIGEgcGFzc2FnZSBuYW1lIHdpdGggXCI6OlwiIGlzIGFsbG93ZWQsIHRoaXMgaXMgbGlrZWx5IGEgbWlzdGFrZS5gKTtcbiAgICAgICAgfVxuICAgICAgICBjaGVja0Jhbm5lZFRhZ3MocGFzc2FnZS50YWdzLCBuYW1lKTtcbiAgICAgICAgaWYgKGJ5SWQuaGFzKGlkKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBEdXBsaWNhdGUgcGFzc2FnZSBpZCAke2lkfWApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChieU5hbWUuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYER1cGxpY2F0ZSBwYXNzYWdlIG5hbWUgJHtuYW1lfWApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcGFzc2FnZS5jb250ZW50LnRyaW0oKSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBQYXNzYWdlICR7bmFtZX0gaGFzIG5vIHRleHQuYCk7XG4gICAgICAgIH1cbiAgICAgICAgYnlJZC5zZXQoaWQsIHBhc3NhZ2UpO1xuICAgICAgICBieU5hbWUuc2V0KG5hbWUsIHBhc3NhZ2UpO1xuICAgIH1cbiAgICBjb25zdCBzdGFydFBpZCA9IHN0b3J5RGF0YS5nZXRBdHRyaWJ1dGUoXCJzdGFydG5vZGVcIik7XG4gICAgaWYgKHN0YXJ0UGlkKSB7XG4gICAgICAgIGNvbnN0IG1heWJlU3RhcnQgPSBieUlkLmdldChzdGFydFBpZCk7XG4gICAgICAgIGlmICghbWF5YmVTdGFydCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZGV0ZXJtaW5lIHN0YXJ0aW5nIHBhc3NhZ2U7IG5vIHBhc3NhZ2Ugd2l0aCAke3N0YXJ0UGlkfWApO1xuICAgICAgICB9XG4gICAgICAgIHN0YXJ0UGFzc2FnZSA9IG1heWJlU3RhcnQ7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBtYXliZVN0YXJ0ID0gYnlOYW1lLmdldChcIlN0YXJ0XCIpO1xuICAgICAgICBpZiAoIW1heWJlU3RhcnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgYSBwYXNzYWdlIG5hbWVkIFwiU3RhcnRcImApO1xuICAgICAgICB9XG4gICAgICAgIHN0YXJ0UGFzc2FnZSA9IG1heWJlU3RhcnQ7XG4gICAgfVxufVxuLyoqIEByZXR1cm5zIGFsbCBwYXNzYWdlcyBmb3Igd2hpY2ggYHByZWRpY2F0ZWAgcmV0dXJuZWQgdHJ1ZSAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlcihwcmVkaWNhdGUpIHtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICBmb3IgKGNvbnN0IHBhc3NhZ2Ugb2YgYnlOYW1lLnZhbHVlcygpKSB7XG4gICAgICAgIGlmIChwcmVkaWNhdGUocGFzc2FnZSkpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHBhc3NhZ2UpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG4vKiogQHJldHVybnMgYSBwYXNzYWdlIGZvciB3aGljaCBgcHJlZGljYXRlYCByZXR1cm5lZCB0cnVlICovXG5leHBvcnQgZnVuY3Rpb24gZmluZChwcmVkaWNhdGUpIHtcbiAgICBmb3IgKGNvbnN0IHBhc3NhZ2Ugb2YgYnlOYW1lLnZhbHVlcygpKSB7XG4gICAgICAgIGlmIChwcmVkaWNhdGUocGFzc2FnZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXNzYWdlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG59XG4vKiogQHJldHVybnMgdGhlIHBhc3NhZ2Ugd2l0aCB0aGUgZ2l2ZW4gbmFtZSAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldChuYW1lKSB7XG4gICAgcmV0dXJuIGJ5TmFtZS5nZXQobmFtZSk7XG59XG4vKiogQHJldHVybnMgdGhlIHBhc3NhZ2UgdGhhdCBzaG91bGQgYmUgdXNlZCBhcyB0aGUgc3Rvcnkgc3RhcnQgKi9cbmV4cG9ydCBmdW5jdGlvbiBzdGFydCgpIHtcbiAgICByZXR1cm4gc3RhcnRQYXNzYWdlO1xufVxuLyoqIEByZXR1cm5zIGFsbCBwYXNzYWdlcyB3aXRoIHRoZSBnaXZlbiB0YWcgKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoVGFnKHRhZykge1xuICAgIHJldHVybiBmaWx0ZXIoKHBzZykgPT4gcHNnLnRhZ3MuaW5jbHVkZXModGFnKSk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\\n//# sourceURL=webpack-internal:///./src/passages.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/renderer.ts\":\n/*!*************************!*\\\n  !*** ./src/renderer.ts ***!\n  \\*************************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   render: () => (/* binding */ render)\\n/* harmony export */ });\\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ \\\"./src/config.ts\\\");\\n/* harmony import */ var _engine__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./engine */ \\\"./src/engine.ts\\\");\\n/* harmony import */ var _macros__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./macros */ \\\"./src/macros.ts\\\");\\n/* harmony import */ var _parser__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./parser */ \\\"./src/parser.ts\\\");\\n/* harmony import */ var _passages__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./passages */ \\\"./src/passages.ts\\\");\\n/* harmony import */ var _scripting__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./scripting */ \\\"./src/scripting.ts\\\");\\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./util */ \\\"./src/util.ts\\\");\\n\\n\\n\\n\\n\\n\\n\\n/** Tags which are not allowed to be descended from `<body>` */\\nconst BANNED_TAGS = [\\\"base\\\", \\\"body\\\", \\\"link\\\", \\\"head\\\", \\\"html\\\", \\\"meta\\\", \\\"script\\\", \\\"style\\\", \\\"title\\\"];\\nconst PHRASING_TAGS = [\\n    \\\"abbr\\\",\\n    \\\"audio\\\",\\n    \\\"b\\\",\\n    \\\"bdi\\\",\\n    \\\"bdo\\\",\\n    \\\"br\\\",\\n    \\\"button\\\",\\n    \\\"canvas\\\",\\n    \\\"cite\\\",\\n    \\\"code\\\",\\n    \\\"data\\\",\\n    \\\"datalist\\\",\\n    \\\"dfn\\\",\\n    \\\"em\\\",\\n    \\\"embed\\\",\\n    \\\"i\\\",\\n    \\\"iframe\\\",\\n    \\\"img\\\",\\n    \\\"input\\\",\\n    \\\"kbd\\\",\\n    \\\"label\\\",\\n    \\\"mark\\\",\\n    \\\"math\\\",\\n    \\\"meter\\\",\\n    \\\"noscript\\\",\\n    \\\"object\\\",\\n    \\\"output\\\",\\n    \\\"picture\\\",\\n    \\\"progress\\\",\\n    \\\"q\\\",\\n    \\\"ruby\\\",\\n    \\\"s\\\",\\n    \\\"samp\\\",\\n    \\\"script\\\",\\n    \\\"select\\\",\\n    \\\"slot\\\",\\n    \\\"small\\\",\\n    \\\"span\\\",\\n    \\\"strong\\\",\\n    \\\"sub\\\",\\n    \\\"sup\\\",\\n    \\\"svg\\\",\\n    \\\"template\\\",\\n    \\\"textarea\\\",\\n    \\\"time\\\",\\n    \\\"u\\\",\\n    \\\"var\\\",\\n    \\\"video\\\",\\n    \\\"wbr\\\",\\n];\\nconst SOMETIMES_PHRASING_TAGS = [\\\"a\\\", \\\"del\\\", \\\"ins\\\", \\\"map\\\"];\\nfunction _isPhrasingNode(node) {\\n    // TODO:\\n    // <link> and <meta> if the `itemprop` attribute is present\\n    // <area> if it is a descendant of a <map> element\\n    if (typeof node === \\\"string\\\" || PHRASING_TAGS.includes(node.tagName.toLowerCase())) {\\n        return true;\\n    }\\n    else if (SOMETIMES_PHRASING_TAGS.includes(node.tagName.toLowerCase())) {\\n        return Array.from(node.childNodes).every((n) => n.nodeType === Node.TEXT_NODE ||\\n            (n.nodeType === Node.ELEMENT_NODE && _isPhrasingNode(n)));\\n    }\\n    else {\\n        return false;\\n    }\\n}\\n/** Render the given Brick markup and append it to an element. */\\nfunction render(target, input, parentContext) {\\n    let inputNodes;\\n    if (typeof input === \\\"string\\\") {\\n        const parser = new _parser__WEBPACK_IMPORTED_MODULE_3__.Parser(input);\\n        inputNodes = parser.parse();\\n    }\\n    else if (input instanceof _passages__WEBPACK_IMPORTED_MODULE_4__.Passage) {\\n        if (_config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"].preProcessText) {\\n            const text = _config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"].preProcessText(input);\\n            if (typeof text !== \\\"string\\\") {\\n                throw new TypeError(`Config.preProcessText returned a ${typeof text}, expected a string`);\\n            }\\n            return render(target, text);\\n        }\\n        else {\\n            return render(target, input.content);\\n        }\\n    }\\n    else {\\n        inputNodes = input;\\n    }\\n    // let pBuffer: (string | Element)[] = [];\\n    for (let i = 0; i < inputNodes.length; i++) {\\n        const nt = inputNodes[i];\\n        let elt;\\n        if (typeof nt === \\\"string\\\") {\\n            elt = nt;\\n            const paragraphs = elt.split(\\\"\\\\n\\\\n\\\");\\n            let p = paragraphs.shift();\\n            if (typeof p === \\\"string\\\") {\\n                target.append(p);\\n                while (typeof (p = paragraphs.shift()) === \\\"string\\\") {\\n                    target.append((0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"br\\\"));\\n                    target.append((0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"br\\\"));\\n                    target.append(p);\\n                }\\n            }\\n        }\\n        else if (nt.type === \\\"macro\\\") {\\n            const macroData = (0,_macros__WEBPACK_IMPORTED_MODULE_2__.get)(nt.name);\\n            if (!macroData) {\\n                throw new Error(`Macro not found: \\\"${nt.name}\\\"`);\\n            }\\n            let childContext;\\n            let params;\\n            if (macroData.trailingMacros) {\\n                const templates = [nt];\\n                for (let j = i + 1; j < inputNodes.length; j++) {\\n                    const nextNode = inputNodes[j];\\n                    if ((0,_parser__WEBPACK_IMPORTED_MODULE_3__.isMacro)(nextNode) && macroData.trailingMacros.includes(nextNode.name)) {\\n                        templates.push(nextNode);\\n                        i = j;\\n                    }\\n                    else if (typeof nextNode === \\\"string\\\" && !nextNode.trim()) {\\n                        // skip over whitespace\\n                    }\\n                    else {\\n                        break;\\n                    }\\n                }\\n                childContext = new _macros__WEBPACK_IMPORTED_MODULE_2__.MacroContext(nt.name, parentContext, templates);\\n                params = [];\\n            }\\n            else {\\n                params = macroData.skipArgs ? nt.args : nt.args.map((arg) => (0,_scripting__WEBPACK_IMPORTED_MODULE_5__.evalExpression)(arg));\\n                childContext = new _macros__WEBPACK_IMPORTED_MODULE_2__.MacroContext(nt.name, parentContext, nt.content);\\n            }\\n            const node = macroData.handler.apply(childContext, params);\\n            target.append(node);\\n            const childLoopStatus = childContext.loopStatus;\\n            if (childLoopStatus === _macros__WEBPACK_IMPORTED_MODULE_2__.LoopStatus.BREAKING || childLoopStatus === _macros__WEBPACK_IMPORTED_MODULE_2__.LoopStatus.CONTINUING) {\\n                if (!parentContext || parentContext.loopStatus === _macros__WEBPACK_IMPORTED_MODULE_2__.LoopStatus.OUTSIDE_LOOP) {\\n                    const badName = childContext.loopStatus === _macros__WEBPACK_IMPORTED_MODULE_2__.LoopStatus.BREAKING ? \\\"@break\\\" : \\\"@continue\\\";\\n                    throw new Error(`Can't ${badName} from outside a loop`);\\n                }\\n                parentContext.loopStatus = childContext.loopStatus;\\n                return;\\n            }\\n            // Markup rendered later is always considered outside a loop\\n            childContext.loopStatus = _macros__WEBPACK_IMPORTED_MODULE_2__.LoopStatus.OUTSIDE_LOOP;\\n        }\\n        else if (nt.type === \\\"element\\\") {\\n            // Note: This could be a parse-time error, but renderer errors can be presented better.\\n            if (BANNED_TAGS.includes(nt.name)) {\\n                throw new Error(`<${nt.name}> elements cannot be created from markup`);\\n            }\\n            elt = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(nt.name);\\n            for (const [attrKey, attrVal] of nt.attributes) {\\n                if (attrKey.startsWith(\\\"@\\\")) {\\n                    throw new Error('Unsupported: attribute names starting with \\\"@\\\"');\\n                }\\n                elt.setAttribute(attrKey, attrVal);\\n            }\\n            render(elt, nt.content, parentContext);\\n            target.append(elt);\\n        }\\n        else if (nt.type === \\\"linkBox\\\") {\\n            const macroData = (0,_macros__WEBPACK_IMPORTED_MODULE_2__.get)(\\\"linkTo\\\");\\n            if (!macroData) {\\n                throw new Error(\\\"Can't find @linkTo macro for wiki-style [[link]]\\\");\\n            }\\n            if (!nt.text) {\\n                throw new Error(\\\"The text of a [[link box]] cannot be empty\\\");\\n            }\\n            const childContext = new _macros__WEBPACK_IMPORTED_MODULE_2__.MacroContext(\\\"linkTo\\\");\\n            target.append(macroData.handler.call(childContext, nt.link, nt.text));\\n        }\\n        else if (nt.type === \\\"error\\\") {\\n            const br = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"br\\\");\\n            const loc = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"code\\\", {}, nt.locationSample);\\n            const span = (0,_util__WEBPACK_IMPORTED_MODULE_6__.makeElement)(\\\"span\\\", { class: \\\"brick-error\\\" }, `ERROR: ${nt.message}`, br, loc);\\n            target.append(span);\\n        }\\n        else {\\n            const value = (nt.type === \\\"story\\\" ? _engine__WEBPACK_IMPORTED_MODULE_1__.storyVariables : _engine__WEBPACK_IMPORTED_MODULE_1__.tempVariables)[nt.name];\\n            target.append(String(value));\\n        }\\n    }\\n}\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcmVuZGVyZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBOEI7QUFDMkI7QUFDWTtBQUMxQjtBQUNOO0FBQ1E7QUFDUjtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBLDJCQUEyQiwyQ0FBTTtBQUNqQztBQUNBO0FBQ0EsOEJBQThCLDhDQUFPO0FBQ3JDLFlBQVksK0NBQU07QUFDbEIseUJBQXlCLCtDQUFNO0FBQy9CO0FBQ0Esd0VBQXdFLFlBQVk7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQix1QkFBdUI7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGtEQUFXO0FBQzdDLGtDQUFrQyxrREFBVztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLDRDQUFRO0FBQ3RDO0FBQ0EscURBQXFELFFBQVE7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyx1QkFBdUI7QUFDM0Q7QUFDQSx3QkFBd0IsZ0RBQU87QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsaURBQVk7QUFDL0M7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFLDBEQUFjO0FBQzNGLG1DQUFtQyxpREFBWTtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQywrQ0FBVSxpQ0FBaUMsK0NBQVU7QUFDekYsbUVBQW1FLCtDQUFVO0FBQzdFLGdFQUFnRSwrQ0FBVTtBQUMxRSw2Q0FBNkMsU0FBUztBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLCtDQUFVO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLFFBQVE7QUFDNUM7QUFDQSxrQkFBa0Isa0RBQVc7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsNENBQVE7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLGlEQUFZO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixrREFBVztBQUNsQyx3QkFBd0Isa0RBQVcsV0FBVztBQUM5Qyx5QkFBeUIsa0RBQVcsV0FBVyxzQkFBc0IsWUFBWSxXQUFXO0FBQzVGO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxtREFBYyxHQUFHLGtEQUFhO0FBQy9FO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYnJpY2svLi9zcmMvcmVuZGVyZXIudHM/ODJiNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ29uZmlnIGZyb20gXCIuL2NvbmZpZ1wiO1xuaW1wb3J0IHsgc3RvcnlWYXJpYWJsZXMsIHRlbXBWYXJpYWJsZXMgfSBmcm9tIFwiLi9lbmdpbmVcIjtcbmltcG9ydCB7IGdldCBhcyBnZXRNYWNybywgTG9vcFN0YXR1cywgTWFjcm9Db250ZXh0IH0gZnJvbSBcIi4vbWFjcm9zXCI7XG5pbXBvcnQgeyBpc01hY3JvLCBQYXJzZXIgfSBmcm9tIFwiLi9wYXJzZXJcIjtcbmltcG9ydCB7IFBhc3NhZ2UgfSBmcm9tIFwiLi9wYXNzYWdlc1wiO1xuaW1wb3J0IHsgZXZhbEV4cHJlc3Npb24gfSBmcm9tIFwiLi9zY3JpcHRpbmdcIjtcbmltcG9ydCB7IG1ha2VFbGVtZW50IH0gZnJvbSBcIi4vdXRpbFwiO1xuLyoqIFRhZ3Mgd2hpY2ggYXJlIG5vdCBhbGxvd2VkIHRvIGJlIGRlc2NlbmRlZCBmcm9tIGA8Ym9keT5gICovXG5jb25zdCBCQU5ORURfVEFHUyA9IFtcImJhc2VcIiwgXCJib2R5XCIsIFwibGlua1wiLCBcImhlYWRcIiwgXCJodG1sXCIsIFwibWV0YVwiLCBcInNjcmlwdFwiLCBcInN0eWxlXCIsIFwidGl0bGVcIl07XG5jb25zdCBQSFJBU0lOR19UQUdTID0gW1xuICAgIFwiYWJiclwiLFxuICAgIFwiYXVkaW9cIixcbiAgICBcImJcIixcbiAgICBcImJkaVwiLFxuICAgIFwiYmRvXCIsXG4gICAgXCJiclwiLFxuICAgIFwiYnV0dG9uXCIsXG4gICAgXCJjYW52YXNcIixcbiAgICBcImNpdGVcIixcbiAgICBcImNvZGVcIixcbiAgICBcImRhdGFcIixcbiAgICBcImRhdGFsaXN0XCIsXG4gICAgXCJkZm5cIixcbiAgICBcImVtXCIsXG4gICAgXCJlbWJlZFwiLFxuICAgIFwiaVwiLFxuICAgIFwiaWZyYW1lXCIsXG4gICAgXCJpbWdcIixcbiAgICBcImlucHV0XCIsXG4gICAgXCJrYmRcIixcbiAgICBcImxhYmVsXCIsXG4gICAgXCJtYXJrXCIsXG4gICAgXCJtYXRoXCIsXG4gICAgXCJtZXRlclwiLFxuICAgIFwibm9zY3JpcHRcIixcbiAgICBcIm9iamVjdFwiLFxuICAgIFwib3V0cHV0XCIsXG4gICAgXCJwaWN0dXJlXCIsXG4gICAgXCJwcm9ncmVzc1wiLFxuICAgIFwicVwiLFxuICAgIFwicnVieVwiLFxuICAgIFwic1wiLFxuICAgIFwic2FtcFwiLFxuICAgIFwic2NyaXB0XCIsXG4gICAgXCJzZWxlY3RcIixcbiAgICBcInNsb3RcIixcbiAgICBcInNtYWxsXCIsXG4gICAgXCJzcGFuXCIsXG4gICAgXCJzdHJvbmdcIixcbiAgICBcInN1YlwiLFxuICAgIFwic3VwXCIsXG4gICAgXCJzdmdcIixcbiAgICBcInRlbXBsYXRlXCIsXG4gICAgXCJ0ZXh0YXJlYVwiLFxuICAgIFwidGltZVwiLFxuICAgIFwidVwiLFxuICAgIFwidmFyXCIsXG4gICAgXCJ2aWRlb1wiLFxuICAgIFwid2JyXCIsXG5dO1xuY29uc3QgU09NRVRJTUVTX1BIUkFTSU5HX1RBR1MgPSBbXCJhXCIsIFwiZGVsXCIsIFwiaW5zXCIsIFwibWFwXCJdO1xuZnVuY3Rpb24gX2lzUGhyYXNpbmdOb2RlKG5vZGUpIHtcbiAgICAvLyBUT0RPOlxuICAgIC8vIDxsaW5rPiBhbmQgPG1ldGE+IGlmIHRoZSBgaXRlbXByb3BgIGF0dHJpYnV0ZSBpcyBwcmVzZW50XG4gICAgLy8gPGFyZWE+IGlmIGl0IGlzIGEgZGVzY2VuZGFudCBvZiBhIDxtYXA+IGVsZW1lbnRcbiAgICBpZiAodHlwZW9mIG5vZGUgPT09IFwic3RyaW5nXCIgfHwgUEhSQVNJTkdfVEFHUy5pbmNsdWRlcyhub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYgKFNPTUVUSU1FU19QSFJBU0lOR19UQUdTLmluY2x1ZGVzKG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShub2RlLmNoaWxkTm9kZXMpLmV2ZXJ5KChuKSA9PiBuLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSB8fFxuICAgICAgICAgICAgKG4ubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFICYmIF9pc1BocmFzaW5nTm9kZShuKSkpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbi8qKiBSZW5kZXIgdGhlIGdpdmVuIEJyaWNrIG1hcmt1cCBhbmQgYXBwZW5kIGl0IHRvIGFuIGVsZW1lbnQuICovXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyKHRhcmdldCwgaW5wdXQsIHBhcmVudENvbnRleHQpIHtcbiAgICBsZXQgaW5wdXROb2RlcztcbiAgICBpZiAodHlwZW9mIGlucHV0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBQYXJzZXIoaW5wdXQpO1xuICAgICAgICBpbnB1dE5vZGVzID0gcGFyc2VyLnBhcnNlKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgUGFzc2FnZSkge1xuICAgICAgICBpZiAoQ29uZmlnLnByZVByb2Nlc3NUZXh0KSB7XG4gICAgICAgICAgICBjb25zdCB0ZXh0ID0gQ29uZmlnLnByZVByb2Nlc3NUZXh0KGlucHV0KTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYENvbmZpZy5wcmVQcm9jZXNzVGV4dCByZXR1cm5lZCBhICR7dHlwZW9mIHRleHR9LCBleHBlY3RlZCBhIHN0cmluZ2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlbmRlcih0YXJnZXQsIHRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlbmRlcih0YXJnZXQsIGlucHV0LmNvbnRlbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpbnB1dE5vZGVzID0gaW5wdXQ7XG4gICAgfVxuICAgIC8vIGxldCBwQnVmZmVyOiAoc3RyaW5nIHwgRWxlbWVudClbXSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXROb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBudCA9IGlucHV0Tm9kZXNbaV07XG4gICAgICAgIGxldCBlbHQ7XG4gICAgICAgIGlmICh0eXBlb2YgbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIGVsdCA9IG50O1xuICAgICAgICAgICAgY29uc3QgcGFyYWdyYXBocyA9IGVsdC5zcGxpdChcIlxcblxcblwiKTtcbiAgICAgICAgICAgIGxldCBwID0gcGFyYWdyYXBocy5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LmFwcGVuZChwKTtcbiAgICAgICAgICAgICAgICB3aGlsZSAodHlwZW9mIChwID0gcGFyYWdyYXBocy5zaGlmdCgpKSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuYXBwZW5kKG1ha2VFbGVtZW50KFwiYnJcIikpO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuYXBwZW5kKG1ha2VFbGVtZW50KFwiYnJcIikpO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuYXBwZW5kKHApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChudC50eXBlID09PSBcIm1hY3JvXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hY3JvRGF0YSA9IGdldE1hY3JvKG50Lm5hbWUpO1xuICAgICAgICAgICAgaWYgKCFtYWNyb0RhdGEpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1hY3JvIG5vdCBmb3VuZDogXCIke250Lm5hbWV9XCJgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBjaGlsZENvbnRleHQ7XG4gICAgICAgICAgICBsZXQgcGFyYW1zO1xuICAgICAgICAgICAgaWYgKG1hY3JvRGF0YS50cmFpbGluZ01hY3Jvcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlcyA9IFtudF07XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgaW5wdXROb2Rlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0Tm9kZSA9IGlucHV0Tm9kZXNbal07XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc01hY3JvKG5leHROb2RlKSAmJiBtYWNyb0RhdGEudHJhaWxpbmdNYWNyb3MuaW5jbHVkZXMobmV4dE5vZGUubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlcy5wdXNoKG5leHROb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBqO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBuZXh0Tm9kZSA9PT0gXCJzdHJpbmdcIiAmJiAhbmV4dE5vZGUudHJpbSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBza2lwIG92ZXIgd2hpdGVzcGFjZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2hpbGRDb250ZXh0ID0gbmV3IE1hY3JvQ29udGV4dChudC5uYW1lLCBwYXJlbnRDb250ZXh0LCB0ZW1wbGF0ZXMpO1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gbWFjcm9EYXRhLnNraXBBcmdzID8gbnQuYXJncyA6IG50LmFyZ3MubWFwKChhcmcpID0+IGV2YWxFeHByZXNzaW9uKGFyZykpO1xuICAgICAgICAgICAgICAgIGNoaWxkQ29udGV4dCA9IG5ldyBNYWNyb0NvbnRleHQobnQubmFtZSwgcGFyZW50Q29udGV4dCwgbnQuY29udGVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBub2RlID0gbWFjcm9EYXRhLmhhbmRsZXIuYXBwbHkoY2hpbGRDb250ZXh0LCBwYXJhbXMpO1xuICAgICAgICAgICAgdGFyZ2V0LmFwcGVuZChub2RlKTtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkTG9vcFN0YXR1cyA9IGNoaWxkQ29udGV4dC5sb29wU3RhdHVzO1xuICAgICAgICAgICAgaWYgKGNoaWxkTG9vcFN0YXR1cyA9PT0gTG9vcFN0YXR1cy5CUkVBS0lORyB8fCBjaGlsZExvb3BTdGF0dXMgPT09IExvb3BTdGF0dXMuQ09OVElOVUlORykge1xuICAgICAgICAgICAgICAgIGlmICghcGFyZW50Q29udGV4dCB8fCBwYXJlbnRDb250ZXh0Lmxvb3BTdGF0dXMgPT09IExvb3BTdGF0dXMuT1VUU0lERV9MT09QKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhZE5hbWUgPSBjaGlsZENvbnRleHQubG9vcFN0YXR1cyA9PT0gTG9vcFN0YXR1cy5CUkVBS0lORyA/IFwiQGJyZWFrXCIgOiBcIkBjb250aW51ZVwiO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0ICR7YmFkTmFtZX0gZnJvbSBvdXRzaWRlIGEgbG9vcGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwYXJlbnRDb250ZXh0Lmxvb3BTdGF0dXMgPSBjaGlsZENvbnRleHQubG9vcFN0YXR1cztcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBNYXJrdXAgcmVuZGVyZWQgbGF0ZXIgaXMgYWx3YXlzIGNvbnNpZGVyZWQgb3V0c2lkZSBhIGxvb3BcbiAgICAgICAgICAgIGNoaWxkQ29udGV4dC5sb29wU3RhdHVzID0gTG9vcFN0YXR1cy5PVVRTSURFX0xPT1A7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobnQudHlwZSA9PT0gXCJlbGVtZW50XCIpIHtcbiAgICAgICAgICAgIC8vIE5vdGU6IFRoaXMgY291bGQgYmUgYSBwYXJzZS10aW1lIGVycm9yLCBidXQgcmVuZGVyZXIgZXJyb3JzIGNhbiBiZSBwcmVzZW50ZWQgYmV0dGVyLlxuICAgICAgICAgICAgaWYgKEJBTk5FRF9UQUdTLmluY2x1ZGVzKG50Lm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGA8JHtudC5uYW1lfT4gZWxlbWVudHMgY2Fubm90IGJlIGNyZWF0ZWQgZnJvbSBtYXJrdXBgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsdCA9IG1ha2VFbGVtZW50KG50Lm5hbWUpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBbYXR0cktleSwgYXR0clZhbF0gb2YgbnQuYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgIGlmIChhdHRyS2V5LnN0YXJ0c1dpdGgoXCJAXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5zdXBwb3J0ZWQ6IGF0dHJpYnV0ZSBuYW1lcyBzdGFydGluZyB3aXRoIFwiQFwiJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsdC5zZXRBdHRyaWJ1dGUoYXR0cktleSwgYXR0clZhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZW5kZXIoZWx0LCBudC5jb250ZW50LCBwYXJlbnRDb250ZXh0KTtcbiAgICAgICAgICAgIHRhcmdldC5hcHBlbmQoZWx0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChudC50eXBlID09PSBcImxpbmtCb3hcIikge1xuICAgICAgICAgICAgY29uc3QgbWFjcm9EYXRhID0gZ2V0TWFjcm8oXCJsaW5rVG9cIik7XG4gICAgICAgICAgICBpZiAoIW1hY3JvRGF0YSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGZpbmQgQGxpbmtUbyBtYWNybyBmb3Igd2lraS1zdHlsZSBbW2xpbmtdXVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghbnQudGV4dCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSB0ZXh0IG9mIGEgW1tsaW5rIGJveF1dIGNhbm5vdCBiZSBlbXB0eVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNoaWxkQ29udGV4dCA9IG5ldyBNYWNyb0NvbnRleHQoXCJsaW5rVG9cIik7XG4gICAgICAgICAgICB0YXJnZXQuYXBwZW5kKG1hY3JvRGF0YS5oYW5kbGVyLmNhbGwoY2hpbGRDb250ZXh0LCBudC5saW5rLCBudC50ZXh0KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobnQudHlwZSA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgICAgICBjb25zdCBiciA9IG1ha2VFbGVtZW50KFwiYnJcIik7XG4gICAgICAgICAgICBjb25zdCBsb2MgPSBtYWtlRWxlbWVudChcImNvZGVcIiwge30sIG50LmxvY2F0aW9uU2FtcGxlKTtcbiAgICAgICAgICAgIGNvbnN0IHNwYW4gPSBtYWtlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzczogXCJicmljay1lcnJvclwiIH0sIGBFUlJPUjogJHtudC5tZXNzYWdlfWAsIGJyLCBsb2MpO1xuICAgICAgICAgICAgdGFyZ2V0LmFwcGVuZChzcGFuKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gKG50LnR5cGUgPT09IFwic3RvcnlcIiA/IHN0b3J5VmFyaWFibGVzIDogdGVtcFZhcmlhYmxlcylbbnQubmFtZV07XG4gICAgICAgICAgICB0YXJnZXQuYXBwZW5kKFN0cmluZyh2YWx1ZSkpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\\n//# sourceURL=webpack-internal:///./src/renderer.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/saves.ts\":\n/*!**********************!*\\\n  !*** ./src/saves.ts ***!\n  \\**********************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   clearActive: () => (/* binding */ clearActive),\\n/* harmony export */   clearSlot: () => (/* binding */ clearSlot),\\n/* harmony export */   init: () => (/* binding */ init),\\n/* harmony export */   loadActive: () => (/* binding */ loadActive),\\n/* harmony export */   loadFromSlot: () => (/* binding */ loadFromSlot),\\n/* harmony export */   registerClass: () => (/* binding */ registerClass),\\n/* harmony export */   saveActive: () => (/* binding */ saveActive),\\n/* harmony export */   saveToSlot: () => (/* binding */ saveToSlot),\\n/* harmony export */   slotTitles: () => (/* binding */ slotTitles)\\n/* harmony export */ });\\n/* harmony import */ var _main__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./main */ \\\"./src/main.ts\\\");\\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util */ \\\"./src/util.ts\\\");\\n\\n\\nlet prefix;\\nlet sm;\\nlet slotTitles;\\nconst specialClasses = [];\\nregisterClass(Date, undefined, (date) => date.toJSON(), (value) => new Date(value));\\nregisterClass(Map, undefined, Array.from, (plain) => new Map(plain));\\nregisterClass(RegExp, undefined, (value) => [value.source, value.flags], (plain) => new RegExp(...plain));\\nregisterClass(Set, undefined, Array.from, (plain) => new Set(plain));\\n/**\\n * Register a class in the save system.\\n * @param constructor The class to register.\\n * @param name A unique name to refer to the class by, defaults to `constructor.name`\\n * @param serialize A method which converts an object of this class to a JSON-stringifiable object\\n * or array. Defaults to `constructor.deserialize`.\\n * @param deserialize A method which converts data from `serialize` back to an object of this\\n * class. Defaults to `constructor.deserialize`.\\n */\\nfunction registerClass(constructor, name, serialize, deserialize) {\\n    if (typeof constructor !== \\\"function\\\") {\\n        throw new Error(\\\"addSerializer: `constructor` must be a function\\\");\\n    }\\n    if (name === undefined) {\\n        name = constructor.name;\\n    }\\n    if (typeof name !== \\\"string\\\") {\\n        throw new Error(\\\"addSerializer: `name` must be undefined or a string\\\");\\n    }\\n    if (serialize === undefined) {\\n        const c = constructor;\\n        serialize = c.serialize;\\n    }\\n    if (typeof serialize !== \\\"function\\\") {\\n        throw new Error(\\\"addSerializer: `serialize` must be undefined or a string\\\");\\n    }\\n    if (deserialize === undefined) {\\n        const c = constructor;\\n        deserialize = c.deserialize;\\n    }\\n    if (typeof deserialize !== \\\"function\\\") {\\n        throw new Error(\\\"addSerializer: `deserialize` must be undefined or a string\\\");\\n    }\\n    if (specialClasses.some((specialClass) => specialClass.name === name) || name === \\\"undefined\\\") {\\n        throw new Error(`addSerializer: \\\"${name}\\\" has already been registered`);\\n    }\\n    specialClasses.push({\\n        constructor,\\n        name,\\n        serialize,\\n        deserialize,\\n    });\\n}\\nfunction init() {\\n    // TODO: add IFID\\n    prefix = `brick.${(0,_util__WEBPACK_IMPORTED_MODULE_1__.slugify)(_main__WEBPACK_IMPORTED_MODULE_0__.storyTitle)}`;\\n    sm = window.localStorage;\\n    slotTitles = JSON.parse(sm.getItem(prefix + \\\".slotTitles\\\") || \\\"[]\\\");\\n    if (slotTitles.length < 8) {\\n        slotTitles.length = 8;\\n        slotTitles.fill(null);\\n    }\\n}\\nfunction clearActive() {\\n    sm.removeItem(prefix + \\\".active\\\");\\n}\\nfunction saveActive(state) {\\n    sm.setItem(prefix + \\\".active\\\", JSON.stringify(state, saveReplacer));\\n}\\nfunction loadActive() {\\n    return load(prefix + \\\".active\\\");\\n}\\nfunction saveToSlot(slot, state) {\\n    sm.setItem(prefix + \\\".slot-\\\" + String(slot), JSON.stringify(state, saveReplacer));\\n    const title = state.history[state.index].passageName;\\n    slotTitles[slot] = title;\\n    sm.setItem(prefix + \\\".slotTitles\\\", JSON.stringify(slotTitles));\\n}\\nfunction loadFromSlot(slot) {\\n    return load(prefix + \\\".slot-\\\" + String(slot));\\n}\\nfunction clearSlot(slot) {\\n    sm.removeItem(prefix + \\\".slot-\\\" + String(slot));\\n    slotTitles[slot] = null;\\n    sm.setItem(prefix + \\\".slotTitles\\\", JSON.stringify(slotTitles));\\n}\\nfunction load(key) {\\n    const json = sm.getItem(key);\\n    return json ? reviveSaveObject(JSON.parse(json)) : undefined;\\n}\\nfunction revivePrimitive(tag) {\\n    switch (tag) {\\n        case \\\"undefined\\\":\\n            return undefined;\\n        case \\\"nan\\\":\\n            return NaN;\\n        case \\\"infinity\\\":\\n            return Infinity;\\n        case \\\"negative-infinity\\\":\\n            return -Infinity;\\n        default:\\n            return false;\\n    }\\n}\\nfunction reviveSaveObject(object) {\\n    for (const key in object) {\\n        const value = object[key];\\n        if (typeof value === \\\"object\\\" && value !== null) {\\n            object[key] = reviveSaveObject(value);\\n        }\\n    }\\n    if (object instanceof Array && typeof object[0] === \\\"string\\\") {\\n        if (object[0].startsWith(\\\"!brick-revive:\\\")) {\\n            const tag = object[0].substring(14);\\n            console.log(tag);\\n            const primitive = revivePrimitive(tag);\\n            if (primitive !== false) {\\n                return primitive;\\n            }\\n            if (object.length !== 2) {\\n                throw new Error(\\\"malformed save data\\\");\\n            }\\n            const defn = specialClasses.find((defn) => defn.name === tag);\\n            if (!defn) {\\n                throw new Error(\\\"malformed save data\\\");\\n            }\\n            return defn.deserialize(object[1]);\\n        }\\n        else if (/^!{2,}brick-revive:/.test(object[0])) {\\n            object[0] = object[0].substring(1);\\n        }\\n    }\\n    return object;\\n}\\nfunction saveReplacer(_key, value) {\\n    switch (typeof value) {\\n        case \\\"boolean\\\":\\n        case \\\"string\\\":\\n            return value;\\n        case \\\"bigint\\\":\\n        case \\\"function\\\":\\n        case \\\"symbol\\\":\\n            throw new Error(`Cannot serialize a ${typeof value}`);\\n        case \\\"undefined\\\":\\n            return [\\\"!brick-revive:undefined\\\"];\\n        case \\\"number\\\":\\n            if (isNaN(value)) {\\n                return [\\\"!brick-revive:nan\\\"];\\n            }\\n            else if (value === Infinity) {\\n                return [\\\"!brick-revive:infinity\\\"];\\n            }\\n            else if (value === -Infinity) {\\n                return [\\\"!brick-revive:negative-infinity\\\"];\\n            }\\n            else {\\n                return value;\\n            }\\n        case \\\"object\\\": {\\n            if (value === null) {\\n                return null;\\n            }\\n            if (Array.isArray(value)) {\\n                if (typeof value[0] === \\\"string\\\" && /^!+brick-revive:/.test(value[0])) {\\n                    return [\\\"!\\\" + value[0], ...value.slice(1)];\\n                }\\n                else {\\n                    return value;\\n                }\\n            }\\n            for (const defn of specialClasses) {\\n                if (value instanceof defn.constructor) {\\n                    return [`!brick-revive:${defn.name}`, defn.serialize(value)];\\n                }\\n            }\\n            const proto = Object.getPrototypeOf(value);\\n            if (proto !== null && proto !== Object.prototype) {\\n                throw new Error(\\\"Can't serialize an object with an unknown prototype\\\");\\n            }\\n            return value;\\n        }\\n    }\\n}\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2F2ZXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBb0M7QUFDSDtBQUNqQztBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsS0FBSztBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDTztBQUNQO0FBQ0Esc0JBQXNCLDhDQUFPLENBQUMsNkNBQVUsRUFBRTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsR0FBRztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxhQUFhO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsVUFBVTtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2JyaWNrLy4vc3JjL3NhdmVzLnRzPzI4ZDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3RvcnlUaXRsZSB9IGZyb20gXCIuL21haW5cIjtcbmltcG9ydCB7IHNsdWdpZnkgfSBmcm9tIFwiLi91dGlsXCI7XG5sZXQgcHJlZml4O1xubGV0IHNtO1xuZXhwb3J0IGxldCBzbG90VGl0bGVzO1xuY29uc3Qgc3BlY2lhbENsYXNzZXMgPSBbXTtcbnJlZ2lzdGVyQ2xhc3MoRGF0ZSwgdW5kZWZpbmVkLCAoZGF0ZSkgPT4gZGF0ZS50b0pTT04oKSwgKHZhbHVlKSA9PiBuZXcgRGF0ZSh2YWx1ZSkpO1xucmVnaXN0ZXJDbGFzcyhNYXAsIHVuZGVmaW5lZCwgQXJyYXkuZnJvbSwgKHBsYWluKSA9PiBuZXcgTWFwKHBsYWluKSk7XG5yZWdpc3RlckNsYXNzKFJlZ0V4cCwgdW5kZWZpbmVkLCAodmFsdWUpID0+IFt2YWx1ZS5zb3VyY2UsIHZhbHVlLmZsYWdzXSwgKHBsYWluKSA9PiBuZXcgUmVnRXhwKC4uLnBsYWluKSk7XG5yZWdpc3RlckNsYXNzKFNldCwgdW5kZWZpbmVkLCBBcnJheS5mcm9tLCAocGxhaW4pID0+IG5ldyBTZXQocGxhaW4pKTtcbi8qKlxuICogUmVnaXN0ZXIgYSBjbGFzcyBpbiB0aGUgc2F2ZSBzeXN0ZW0uXG4gKiBAcGFyYW0gY29uc3RydWN0b3IgVGhlIGNsYXNzIHRvIHJlZ2lzdGVyLlxuICogQHBhcmFtIG5hbWUgQSB1bmlxdWUgbmFtZSB0byByZWZlciB0byB0aGUgY2xhc3MgYnksIGRlZmF1bHRzIHRvIGBjb25zdHJ1Y3Rvci5uYW1lYFxuICogQHBhcmFtIHNlcmlhbGl6ZSBBIG1ldGhvZCB3aGljaCBjb252ZXJ0cyBhbiBvYmplY3Qgb2YgdGhpcyBjbGFzcyB0byBhIEpTT04tc3RyaW5naWZpYWJsZSBvYmplY3RcbiAqIG9yIGFycmF5LiBEZWZhdWx0cyB0byBgY29uc3RydWN0b3IuZGVzZXJpYWxpemVgLlxuICogQHBhcmFtIGRlc2VyaWFsaXplIEEgbWV0aG9kIHdoaWNoIGNvbnZlcnRzIGRhdGEgZnJvbSBgc2VyaWFsaXplYCBiYWNrIHRvIGFuIG9iamVjdCBvZiB0aGlzXG4gKiBjbGFzcy4gRGVmYXVsdHMgdG8gYGNvbnN0cnVjdG9yLmRlc2VyaWFsaXplYC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyQ2xhc3MoY29uc3RydWN0b3IsIG5hbWUsIHNlcmlhbGl6ZSwgZGVzZXJpYWxpemUpIHtcbiAgICBpZiAodHlwZW9mIGNvbnN0cnVjdG9yICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiYWRkU2VyaWFsaXplcjogYGNvbnN0cnVjdG9yYCBtdXN0IGJlIGEgZnVuY3Rpb25cIik7XG4gICAgfVxuICAgIGlmIChuYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgbmFtZSA9IGNvbnN0cnVjdG9yLm5hbWU7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJhZGRTZXJpYWxpemVyOiBgbmFtZWAgbXVzdCBiZSB1bmRlZmluZWQgb3IgYSBzdHJpbmdcIik7XG4gICAgfVxuICAgIGlmIChzZXJpYWxpemUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCBjID0gY29uc3RydWN0b3I7XG4gICAgICAgIHNlcmlhbGl6ZSA9IGMuc2VyaWFsaXplO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHNlcmlhbGl6ZSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImFkZFNlcmlhbGl6ZXI6IGBzZXJpYWxpemVgIG11c3QgYmUgdW5kZWZpbmVkIG9yIGEgc3RyaW5nXCIpO1xuICAgIH1cbiAgICBpZiAoZGVzZXJpYWxpemUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCBjID0gY29uc3RydWN0b3I7XG4gICAgICAgIGRlc2VyaWFsaXplID0gYy5kZXNlcmlhbGl6ZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBkZXNlcmlhbGl6ZSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImFkZFNlcmlhbGl6ZXI6IGBkZXNlcmlhbGl6ZWAgbXVzdCBiZSB1bmRlZmluZWQgb3IgYSBzdHJpbmdcIik7XG4gICAgfVxuICAgIGlmIChzcGVjaWFsQ2xhc3Nlcy5zb21lKChzcGVjaWFsQ2xhc3MpID0+IHNwZWNpYWxDbGFzcy5uYW1lID09PSBuYW1lKSB8fCBuYW1lID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgYWRkU2VyaWFsaXplcjogXCIke25hbWV9XCIgaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkYCk7XG4gICAgfVxuICAgIHNwZWNpYWxDbGFzc2VzLnB1c2goe1xuICAgICAgICBjb25zdHJ1Y3RvcixcbiAgICAgICAgbmFtZSxcbiAgICAgICAgc2VyaWFsaXplLFxuICAgICAgICBkZXNlcmlhbGl6ZSxcbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbml0KCkge1xuICAgIC8vIFRPRE86IGFkZCBJRklEXG4gICAgcHJlZml4ID0gYGJyaWNrLiR7c2x1Z2lmeShzdG9yeVRpdGxlKX1gO1xuICAgIHNtID0gd2luZG93LmxvY2FsU3RvcmFnZTtcbiAgICBzbG90VGl0bGVzID0gSlNPTi5wYXJzZShzbS5nZXRJdGVtKHByZWZpeCArIFwiLnNsb3RUaXRsZXNcIikgfHwgXCJbXVwiKTtcbiAgICBpZiAoc2xvdFRpdGxlcy5sZW5ndGggPCA4KSB7XG4gICAgICAgIHNsb3RUaXRsZXMubGVuZ3RoID0gODtcbiAgICAgICAgc2xvdFRpdGxlcy5maWxsKG51bGwpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBjbGVhckFjdGl2ZSgpIHtcbiAgICBzbS5yZW1vdmVJdGVtKHByZWZpeCArIFwiLmFjdGl2ZVwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzYXZlQWN0aXZlKHN0YXRlKSB7XG4gICAgc20uc2V0SXRlbShwcmVmaXggKyBcIi5hY3RpdmVcIiwgSlNPTi5zdHJpbmdpZnkoc3RhdGUsIHNhdmVSZXBsYWNlcikpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRBY3RpdmUoKSB7XG4gICAgcmV0dXJuIGxvYWQocHJlZml4ICsgXCIuYWN0aXZlXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNhdmVUb1Nsb3Qoc2xvdCwgc3RhdGUpIHtcbiAgICBzbS5zZXRJdGVtKHByZWZpeCArIFwiLnNsb3QtXCIgKyBTdHJpbmcoc2xvdCksIEpTT04uc3RyaW5naWZ5KHN0YXRlLCBzYXZlUmVwbGFjZXIpKTtcbiAgICBjb25zdCB0aXRsZSA9IHN0YXRlLmhpc3Rvcnlbc3RhdGUuaW5kZXhdLnBhc3NhZ2VOYW1lO1xuICAgIHNsb3RUaXRsZXNbc2xvdF0gPSB0aXRsZTtcbiAgICBzbS5zZXRJdGVtKHByZWZpeCArIFwiLnNsb3RUaXRsZXNcIiwgSlNPTi5zdHJpbmdpZnkoc2xvdFRpdGxlcykpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRGcm9tU2xvdChzbG90KSB7XG4gICAgcmV0dXJuIGxvYWQocHJlZml4ICsgXCIuc2xvdC1cIiArIFN0cmluZyhzbG90KSk7XG59XG5leHBvcnQgZnVuY3Rpb24gY2xlYXJTbG90KHNsb3QpIHtcbiAgICBzbS5yZW1vdmVJdGVtKHByZWZpeCArIFwiLnNsb3QtXCIgKyBTdHJpbmcoc2xvdCkpO1xuICAgIHNsb3RUaXRsZXNbc2xvdF0gPSBudWxsO1xuICAgIHNtLnNldEl0ZW0ocHJlZml4ICsgXCIuc2xvdFRpdGxlc1wiLCBKU09OLnN0cmluZ2lmeShzbG90VGl0bGVzKSk7XG59XG5mdW5jdGlvbiBsb2FkKGtleSkge1xuICAgIGNvbnN0IGpzb24gPSBzbS5nZXRJdGVtKGtleSk7XG4gICAgcmV0dXJuIGpzb24gPyByZXZpdmVTYXZlT2JqZWN0KEpTT04ucGFyc2UoanNvbikpIDogdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gcmV2aXZlUHJpbWl0aXZlKHRhZykge1xuICAgIHN3aXRjaCAodGFnKSB7XG4gICAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjpcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIGNhc2UgXCJuYW5cIjpcbiAgICAgICAgICAgIHJldHVybiBOYU47XG4gICAgICAgIGNhc2UgXCJpbmZpbml0eVwiOlxuICAgICAgICAgICAgcmV0dXJuIEluZmluaXR5O1xuICAgICAgICBjYXNlIFwibmVnYXRpdmUtaW5maW5pdHlcIjpcbiAgICAgICAgICAgIHJldHVybiAtSW5maW5pdHk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuZnVuY3Rpb24gcmV2aXZlU2F2ZU9iamVjdChvYmplY3QpIHtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmplY3QpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBvYmplY3Rba2V5XTtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgb2JqZWN0W2tleV0gPSByZXZpdmVTYXZlT2JqZWN0KHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgQXJyYXkgJiYgdHlwZW9mIG9iamVjdFswXSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBpZiAob2JqZWN0WzBdLnN0YXJ0c1dpdGgoXCIhYnJpY2stcmV2aXZlOlwiKSkge1xuICAgICAgICAgICAgY29uc3QgdGFnID0gb2JqZWN0WzBdLnN1YnN0cmluZygxNCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0YWcpO1xuICAgICAgICAgICAgY29uc3QgcHJpbWl0aXZlID0gcmV2aXZlUHJpbWl0aXZlKHRhZyk7XG4gICAgICAgICAgICBpZiAocHJpbWl0aXZlICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwcmltaXRpdmU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob2JqZWN0Lmxlbmd0aCAhPT0gMikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIm1hbGZvcm1lZCBzYXZlIGRhdGFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBkZWZuID0gc3BlY2lhbENsYXNzZXMuZmluZCgoZGVmbikgPT4gZGVmbi5uYW1lID09PSB0YWcpO1xuICAgICAgICAgICAgaWYgKCFkZWZuKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibWFsZm9ybWVkIHNhdmUgZGF0YVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkZWZuLmRlc2VyaWFsaXplKG9iamVjdFsxXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoL14hezIsfWJyaWNrLXJldml2ZTovLnRlc3Qob2JqZWN0WzBdKSkge1xuICAgICAgICAgICAgb2JqZWN0WzBdID0gb2JqZWN0WzBdLnN1YnN0cmluZygxKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb2JqZWN0O1xufVxuZnVuY3Rpb24gc2F2ZVJlcGxhY2VyKF9rZXksIHZhbHVlKSB7XG4gICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHtcbiAgICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICBjYXNlIFwiYmlnaW50XCI6XG4gICAgICAgIGNhc2UgXCJmdW5jdGlvblwiOlxuICAgICAgICBjYXNlIFwic3ltYm9sXCI6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBzZXJpYWxpemUgYSAke3R5cGVvZiB2YWx1ZX1gKTtcbiAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgICAgICAgcmV0dXJuIFtcIiFicmljay1yZXZpdmU6dW5kZWZpbmVkXCJdO1xuICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgICAgICBpZiAoaXNOYU4odmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcIiFicmljay1yZXZpdmU6bmFuXCJdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IEluZmluaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcIiFicmljay1yZXZpdmU6aW5maW5pdHlcIl07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA9PT0gLUluZmluaXR5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcIiFicmljay1yZXZpdmU6bmVnYXRpdmUtaW5maW5pdHlcIl07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJvYmplY3RcIjoge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlWzBdID09PSBcInN0cmluZ1wiICYmIC9eISticmljay1yZXZpdmU6Ly50ZXN0KHZhbHVlWzBdKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW1wiIVwiICsgdmFsdWVbMF0sIC4uLnZhbHVlLnNsaWNlKDEpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGRlZm4gb2Ygc3BlY2lhbENsYXNzZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBkZWZuLmNvbnN0cnVjdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbYCFicmljay1yZXZpdmU6JHtkZWZuLm5hbWV9YCwgZGVmbi5zZXJpYWxpemUodmFsdWUpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBwcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih2YWx1ZSk7XG4gICAgICAgICAgICBpZiAocHJvdG8gIT09IG51bGwgJiYgcHJvdG8gIT09IE9iamVjdC5wcm90b3R5cGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBzZXJpYWxpemUgYW4gb2JqZWN0IHdpdGggYW4gdW5rbm93biBwcm90b3R5cGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\\n//# sourceURL=webpack-internal:///./src/saves.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/scripting.ts\":\n/*!**************************!*\\\n  !*** ./src/scripting.ts ***!\n  \\**************************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   BrickPublic: () => (/* binding */ BrickPublic),\\n/* harmony export */   evalAssign: () => (/* binding */ evalAssign),\\n/* harmony export */   evalExpression: () => (/* binding */ evalExpression),\\n/* harmony export */   evalJavaScript: () => (/* binding */ evalJavaScript)\\n/* harmony export */ });\\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ \\\"./src/config.ts\\\");\\n/* harmony import */ var _dialog__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dialog */ \\\"./src/dialog.ts\\\");\\n/* harmony import */ var _engine__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./engine */ \\\"./src/engine.ts\\\");\\n/* harmony import */ var _passages__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./passages */ \\\"./src/passages.ts\\\");\\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./util */ \\\"./src/util.ts\\\");\\n\\n\\n\\n\\n\\n/** The public API available to authors */\\n// TODO: type-checking\\nconst BrickPublic = Object.freeze({\\n    forward: _engine__WEBPACK_IMPORTED_MODULE_2__.forward,\\n    backward: _engine__WEBPACK_IMPORTED_MODULE_2__.backward,\\n    redo: _engine__WEBPACK_IMPORTED_MODULE_2__.redo,\\n    Dialog: Object.freeze({\\n        showPassage: _dialog__WEBPACK_IMPORTED_MODULE_1__.showPassage,\\n    }),\\n    Passages: _passages__WEBPACK_IMPORTED_MODULE_3__,\\n    Util: Object.freeze(_util__WEBPACK_IMPORTED_MODULE_4__),\\n    get vars() {\\n        return _engine__WEBPACK_IMPORTED_MODULE_2__.storyVariables;\\n    },\\n    get temp() {\\n        return _engine__WEBPACK_IMPORTED_MODULE_2__.tempVariables;\\n    },\\n});\\nconst env = {\\n    Engine: {\\n        forward: _engine__WEBPACK_IMPORTED_MODULE_2__.forward,\\n        backward: _engine__WEBPACK_IMPORTED_MODULE_2__.backward,\\n        redo: _engine__WEBPACK_IMPORTED_MODULE_2__.redo,\\n        get vars() {\\n            return _engine__WEBPACK_IMPORTED_MODULE_2__.storyVariables;\\n        },\\n        get temp() {\\n            return _engine__WEBPACK_IMPORTED_MODULE_2__.tempVariables;\\n        }\\n    },\\n    Config: _config__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"],\\n    Dialog: {\\n        showPassage: _dialog__WEBPACK_IMPORTED_MODULE_1__.showPassage,\\n    },\\n    Passages: _passages__WEBPACK_IMPORTED_MODULE_3__,\\n    clone: _util__WEBPACK_IMPORTED_MODULE_4__.clone,\\n    slugify: _util__WEBPACK_IMPORTED_MODULE_4__.slugify,\\n    makeElement: _util__WEBPACK_IMPORTED_MODULE_4__.makeElement,\\n    numberRange: _util__WEBPACK_IMPORTED_MODULE_4__.numberRange,\\n};\\nconst envKeys = Object.keys(env);\\nconst envValues = Object.values(env);\\nfunction evalJavaScript(js) {\\n    console.log(js);\\n    const fn = new Function(...envKeys, `'use strict';${js}`);\\n    return fn(...envValues);\\n}\\nfunction evalExpression(js) {\\n    return evalJavaScript(\\\"return \\\" + js);\\n}\\nfunction evalAssign(place, value) {\\n    const fn = new Function(...envKeys, `\\\"use strict\\\"; ${place} = arguments[arguments.length - 1]`);\\n    fn(...envValues, value);\\n}\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0aW5nLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUE4QjtBQUNTO0FBQzJDO0FBQzNDO0FBQ1I7QUFDL0I7QUFDQTtBQUNPO0FBQ1AsV0FBVztBQUNYLFlBQVk7QUFDWixRQUFRO0FBQ1I7QUFDQSxtQkFBbUI7QUFDbkIsS0FBSztBQUNMLFlBQVk7QUFDWix3QkFBd0Isa0NBQUk7QUFDNUI7QUFDQSxlQUFlLG1EQUFjO0FBQzdCLEtBQUs7QUFDTDtBQUNBLGVBQWUsa0RBQWE7QUFDNUIsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0EsZUFBZTtBQUNmLGdCQUFnQjtBQUNoQixZQUFZO0FBQ1o7QUFDQSxtQkFBbUIsbURBQWM7QUFDakMsU0FBUztBQUNUO0FBQ0EsbUJBQW1CLGtEQUFhO0FBQ2hDO0FBQ0EsS0FBSztBQUNMLFVBQVU7QUFDVjtBQUNBLG1CQUFtQjtBQUNuQixLQUFLO0FBQ0wsWUFBWTtBQUNaLFdBQVcsd0NBQVU7QUFDckIsYUFBYSwwQ0FBWTtBQUN6QixpQkFBaUIsOENBQWdCO0FBQ2pDLGlCQUFpQiw4Q0FBZ0I7QUFDakM7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBLHNEQUFzRCxFQUFFLEdBQUc7QUFDM0Q7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNPO0FBQ1AsdURBQXVELEVBQUUsT0FBTztBQUNoRTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYnJpY2svLi9zcmMvc2NyaXB0aW5nLnRzPzlkOGUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbmZpZyBmcm9tIFwiLi9jb25maWdcIjtcbmltcG9ydCB7IHNob3dQYXNzYWdlIH0gZnJvbSBcIi4vZGlhbG9nXCI7XG5pbXBvcnQgeyBiYWNrd2FyZCwgZm9yd2FyZCwgcmVkbywgc3RvcnlWYXJpYWJsZXMsIHRlbXBWYXJpYWJsZXMgfSBmcm9tIFwiLi9lbmdpbmVcIjtcbmltcG9ydCAqIGFzIFBhc3NhZ2VzIGZyb20gXCIuL3Bhc3NhZ2VzXCI7XG5pbXBvcnQgKiBhcyBVdGlsIGZyb20gXCIuL3V0aWxcIjtcbi8qKiBUaGUgcHVibGljIEFQSSBhdmFpbGFibGUgdG8gYXV0aG9ycyAqL1xuLy8gVE9ETzogdHlwZS1jaGVja2luZ1xuZXhwb3J0IGNvbnN0IEJyaWNrUHVibGljID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgZm9yd2FyZCxcbiAgICBiYWNrd2FyZCxcbiAgICByZWRvLFxuICAgIERpYWxvZzogT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIHNob3dQYXNzYWdlLFxuICAgIH0pLFxuICAgIFBhc3NhZ2VzLFxuICAgIFV0aWw6IE9iamVjdC5mcmVlemUoVXRpbCksXG4gICAgZ2V0IHZhcnMoKSB7XG4gICAgICAgIHJldHVybiBzdG9yeVZhcmlhYmxlcztcbiAgICB9LFxuICAgIGdldCB0ZW1wKCkge1xuICAgICAgICByZXR1cm4gdGVtcFZhcmlhYmxlcztcbiAgICB9LFxufSk7XG5jb25zdCBlbnYgPSB7XG4gICAgRW5naW5lOiB7XG4gICAgICAgIGZvcndhcmQsXG4gICAgICAgIGJhY2t3YXJkLFxuICAgICAgICByZWRvLFxuICAgICAgICBnZXQgdmFycygpIHtcbiAgICAgICAgICAgIHJldHVybiBzdG9yeVZhcmlhYmxlcztcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0IHRlbXAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGVtcFZhcmlhYmxlcztcbiAgICAgICAgfVxuICAgIH0sXG4gICAgQ29uZmlnLFxuICAgIERpYWxvZzoge1xuICAgICAgICBzaG93UGFzc2FnZSxcbiAgICB9LFxuICAgIFBhc3NhZ2VzLFxuICAgIGNsb25lOiBVdGlsLmNsb25lLFxuICAgIHNsdWdpZnk6IFV0aWwuc2x1Z2lmeSxcbiAgICBtYWtlRWxlbWVudDogVXRpbC5tYWtlRWxlbWVudCxcbiAgICBudW1iZXJSYW5nZTogVXRpbC5udW1iZXJSYW5nZSxcbn07XG5jb25zdCBlbnZLZXlzID0gT2JqZWN0LmtleXMoZW52KTtcbmNvbnN0IGVudlZhbHVlcyA9IE9iamVjdC52YWx1ZXMoZW52KTtcbmV4cG9ydCBmdW5jdGlvbiBldmFsSmF2YVNjcmlwdChqcykge1xuICAgIGNvbnNvbGUubG9nKGpzKTtcbiAgICBjb25zdCBmbiA9IG5ldyBGdW5jdGlvbiguLi5lbnZLZXlzLCBgJ3VzZSBzdHJpY3QnOyR7anN9YCk7XG4gICAgcmV0dXJuIGZuKC4uLmVudlZhbHVlcyk7XG59XG5leHBvcnQgZnVuY3Rpb24gZXZhbEV4cHJlc3Npb24oanMpIHtcbiAgICByZXR1cm4gZXZhbEphdmFTY3JpcHQoXCJyZXR1cm4gXCIgKyBqcyk7XG59XG5leHBvcnQgZnVuY3Rpb24gZXZhbEFzc2lnbihwbGFjZSwgdmFsdWUpIHtcbiAgICBjb25zdCBmbiA9IG5ldyBGdW5jdGlvbiguLi5lbnZLZXlzLCBgXCJ1c2Ugc3RyaWN0XCI7ICR7cGxhY2V9ID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXWApO1xuICAgIGZuKC4uLmVudlZhbHVlcywgdmFsdWUpO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\\n//# sourceURL=webpack-internal:///./src/scripting.ts\\n\");\n\n/***/ }),\n\n/***/ \"./src/util.ts\":\n/*!*********************!*\\\n  !*** ./src/util.ts ***!\n  \\*********************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\neval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\\n/* harmony export */   assertString: () => (/* binding */ assertString),\\n/* harmony export */   clone: () => (/* binding */ clone),\\n/* harmony export */   getElementById: () => (/* binding */ getElementById),\\n/* harmony export */   makeElement: () => (/* binding */ makeElement),\\n/* harmony export */   numberRange: () => (/* binding */ numberRange),\\n/* harmony export */   slugify: () => (/* binding */ slugify),\\n/* harmony export */   uniqueId: () => (/* binding */ uniqueId)\\n/* harmony export */ });\\nconst DELETED_CHARS = new Set(\\\"'\\\\\\\",()[]{}.!`?\\\");\\n/** Convert a string into a \\\"slug\\\" which is easier to use within CSS\\n * Example: \\\"The Iron Giant\\\" becomes \\\"the-iron-giant\\\" */\\nfunction slugify(input) {\\n    return Array.from(input)\\n        .map((c) => {\\n        if ((c >= \\\"a\\\" && c <= \\\"z\\\") || (c >= \\\"0\\\" && c <= \\\"9\\\")) {\\n            return c;\\n        }\\n        else if ((c >= \\\"A\\\" && c <= \\\"Z\\\") || c > \\\"\\\\x7F\\\") {\\n            return c.toLowerCase();\\n        }\\n        else if (DELETED_CHARS.has(c)) {\\n            return \\\"\\\";\\n        }\\n        else {\\n            return \\\"-\\\";\\n        }\\n    })\\n        .join(\\\"\\\")\\n        .replace(/-+/g, \\\"-\\\");\\n}\\n/** Perform a deep clone of a given object */\\nfunction clone(original) {\\n    // TODO: circular reference detection\\n    switch (typeof original) {\\n        case \\\"bigint\\\":\\n        case \\\"boolean\\\":\\n        case \\\"number\\\":\\n        case \\\"string\\\":\\n        case \\\"undefined\\\":\\n            return original;\\n        case \\\"symbol\\\":\\n            throw new Error(\\\"Symbols cannot be cloned\\\");\\n        case \\\"function\\\":\\n            throw new Error(\\\"Functions cannot be cloned\\\");\\n        case \\\"object\\\":\\n            if (original === null) {\\n                return original;\\n            }\\n            else if (\\\"clone\\\" in original && typeof original.clone === \\\"function\\\") {\\n                return original.clone();\\n            }\\n            else if (original instanceof Array) {\\n                return original.map(clone);\\n            }\\n            else if (original instanceof Date) {\\n                return new Date(original);\\n            }\\n            else if (original instanceof Map) {\\n                const newMap = new Map();\\n                for (const [k, v] of original) {\\n                    newMap.set(clone(k), clone(v));\\n                }\\n                return newMap;\\n            }\\n            else if (original instanceof RegExp) {\\n                return new RegExp(original);\\n            }\\n            else if (original instanceof Set) {\\n                const newSet = new Set();\\n                for (const val of original) {\\n                    newSet.add(clone(val));\\n                }\\n                return newSet;\\n            }\\n            else {\\n                // generic object\\n                const prototype = Object.getPrototypeOf(original);\\n                if (prototype !== null && prototype !== Object.prototype) {\\n                    throw new Error(\\\"Can't clone an object with an unknown prototype and no `.clone()` method\\\");\\n                }\\n                const newObj = {};\\n                for (const key in original) {\\n                    newObj[key] = clone(original[key]);\\n                }\\n                return newObj;\\n            }\\n        default:\\n            throw new Error(`Unknown type: ${typeof original}`);\\n    }\\n}\\n/** Similar to `document.getElementById`, but throws an error if the element wasn't found. */\\nfunction getElementById(elementId) {\\n    const elt = document.getElementById(elementId);\\n    if (!elt) {\\n        throw new Error(`No element with id \\\"${elementId}\\\" found`);\\n    }\\n    return elt;\\n}\\nlet idCounter = 0;\\n/** Return a unique identifier */\\nfunction uniqueId() {\\n    return `brick-unique-id-${idCounter++}`;\\n}\\nfunction makeElement(tagName, attributes = {}, ...childNodes) {\\n    const element = document.createElement(tagName);\\n    for (const attr in attributes) {\\n        element.setAttribute(attr, attributes[attr]);\\n    }\\n    element.append(...childNodes);\\n    return element;\\n}\\n/** Assert that a value is a string */\\nfunction assertString(maybeString) {\\n    if (typeof maybeString !== \\\"string\\\") {\\n        throw new Error(`Expected string, instead received a ${typeof maybeString}`);\\n    }\\n}\\n/** Return an iterator, similar to Python's `range()` */\\nfunction* numberRange(startOrStop, stop, step = 1) {\\n    let nextValue;\\n    if (typeof stop === \\\"undefined\\\") {\\n        nextValue = 0;\\n        stop = startOrStop;\\n    }\\n    else {\\n        nextValue = startOrStop;\\n    }\\n    if (step > 0) {\\n        while (nextValue < stop) {\\n            yield nextValue;\\n            nextValue += step;\\n        }\\n    }\\n    else {\\n        while (nextValue > stop) {\\n            yield nextValue;\\n            nextValue += step;\\n        }\\n    }\\n}\\n//# sourceURL=[module]\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdXRpbC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEseUNBQXlDO0FBQ3pDO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLGdCQUFnQjtBQUM3RDtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQSwrQ0FBK0MsVUFBVTtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUCw4QkFBOEIsWUFBWTtBQUMxQztBQUNPLDZDQUE2QztBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBLCtEQUErRCxtQkFBbUI7QUFDbEY7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9icmljay8uL3NyYy91dGlsLnRzPzk4ODciXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgREVMRVRFRF9DSEFSUyA9IG5ldyBTZXQoXCInXFxcIiwoKVtde30uIWA/XCIpO1xuLyoqIENvbnZlcnQgYSBzdHJpbmcgaW50byBhIFwic2x1Z1wiIHdoaWNoIGlzIGVhc2llciB0byB1c2Ugd2l0aGluIENTU1xuICogRXhhbXBsZTogXCJUaGUgSXJvbiBHaWFudFwiIGJlY29tZXMgXCJ0aGUtaXJvbi1naWFudFwiICovXG5leHBvcnQgZnVuY3Rpb24gc2x1Z2lmeShpbnB1dCkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKGlucHV0KVxuICAgICAgICAubWFwKChjKSA9PiB7XG4gICAgICAgIGlmICgoYyA+PSBcImFcIiAmJiBjIDw9IFwielwiKSB8fCAoYyA+PSBcIjBcIiAmJiBjIDw9IFwiOVwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIGM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKGMgPj0gXCJBXCIgJiYgYyA8PSBcIlpcIikgfHwgYyA+IFwiXFx4N0ZcIikge1xuICAgICAgICAgICAgcmV0dXJuIGMudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChERUxFVEVEX0NIQVJTLmhhcyhjKSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCItXCI7XG4gICAgICAgIH1cbiAgICB9KVxuICAgICAgICAuam9pbihcIlwiKVxuICAgICAgICAucmVwbGFjZSgvLSsvZywgXCItXCIpO1xufVxuLyoqIFBlcmZvcm0gYSBkZWVwIGNsb25lIG9mIGEgZ2l2ZW4gb2JqZWN0ICovXG5leHBvcnQgZnVuY3Rpb24gY2xvbmUob3JpZ2luYWwpIHtcbiAgICAvLyBUT0RPOiBjaXJjdWxhciByZWZlcmVuY2UgZGV0ZWN0aW9uXG4gICAgc3dpdGNoICh0eXBlb2Ygb3JpZ2luYWwpIHtcbiAgICAgICAgY2FzZSBcImJpZ2ludFwiOlxuICAgICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsO1xuICAgICAgICBjYXNlIFwic3ltYm9sXCI6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTeW1ib2xzIGNhbm5vdCBiZSBjbG9uZWRcIik7XG4gICAgICAgIGNhc2UgXCJmdW5jdGlvblwiOlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRnVuY3Rpb25zIGNhbm5vdCBiZSBjbG9uZWRcIik7XG4gICAgICAgIGNhc2UgXCJvYmplY3RcIjpcbiAgICAgICAgICAgIGlmIChvcmlnaW5hbCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKFwiY2xvbmVcIiBpbiBvcmlnaW5hbCAmJiB0eXBlb2Ygb3JpZ2luYWwuY2xvbmUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5jbG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAob3JpZ2luYWwgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5tYXAoY2xvbmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAob3JpZ2luYWwgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKG9yaWdpbmFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG9yaWdpbmFsIGluc3RhbmNlb2YgTWFwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3TWFwID0gbmV3IE1hcCgpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2ssIHZdIG9mIG9yaWdpbmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld01hcC5zZXQoY2xvbmUoayksIGNsb25lKHYpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld01hcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG9yaWdpbmFsIGluc3RhbmNlb2YgUmVnRXhwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAob3JpZ2luYWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAob3JpZ2luYWwgaW5zdGFuY2VvZiBTZXQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdTZXQgPSBuZXcgU2V0KCk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCB2YWwgb2Ygb3JpZ2luYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3U2V0LmFkZChjbG9uZSh2YWwpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld1NldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGdlbmVyaWMgb2JqZWN0XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9yaWdpbmFsKTtcbiAgICAgICAgICAgICAgICBpZiAocHJvdG90eXBlICE9PSBudWxsICYmIHByb3RvdHlwZSAhPT0gT2JqZWN0LnByb3RvdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBjbG9uZSBhbiBvYmplY3Qgd2l0aCBhbiB1bmtub3duIHByb3RvdHlwZSBhbmQgbm8gYC5jbG9uZSgpYCBtZXRob2RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld09iaiA9IHt9O1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG9yaWdpbmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld09ialtrZXldID0gY2xvbmUob3JpZ2luYWxba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXdPYmo7XG4gICAgICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gdHlwZTogJHt0eXBlb2Ygb3JpZ2luYWx9YCk7XG4gICAgfVxufVxuLyoqIFNpbWlsYXIgdG8gYGRvY3VtZW50LmdldEVsZW1lbnRCeUlkYCwgYnV0IHRocm93cyBhbiBlcnJvciBpZiB0aGUgZWxlbWVudCB3YXNuJ3QgZm91bmQuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKSB7XG4gICAgY29uc3QgZWx0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTtcbiAgICBpZiAoIWVsdCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGVsZW1lbnQgd2l0aCBpZCBcIiR7ZWxlbWVudElkfVwiIGZvdW5kYCk7XG4gICAgfVxuICAgIHJldHVybiBlbHQ7XG59XG5sZXQgaWRDb3VudGVyID0gMDtcbi8qKiBSZXR1cm4gYSB1bmlxdWUgaWRlbnRpZmllciAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVuaXF1ZUlkKCkge1xuICAgIHJldHVybiBgYnJpY2stdW5pcXVlLWlkLSR7aWRDb3VudGVyKyt9YDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtYWtlRWxlbWVudCh0YWdOYW1lLCBhdHRyaWJ1dGVzID0ge30sIC4uLmNoaWxkTm9kZXMpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTtcbiAgICBmb3IgKGNvbnN0IGF0dHIgaW4gYXR0cmlidXRlcykge1xuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShhdHRyLCBhdHRyaWJ1dGVzW2F0dHJdKTtcbiAgICB9XG4gICAgZWxlbWVudC5hcHBlbmQoLi4uY2hpbGROb2Rlcyk7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG59XG4vKiogQXNzZXJ0IHRoYXQgYSB2YWx1ZSBpcyBhIHN0cmluZyAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydFN0cmluZyhtYXliZVN0cmluZykge1xuICAgIGlmICh0eXBlb2YgbWF5YmVTdHJpbmcgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBzdHJpbmcsIGluc3RlYWQgcmVjZWl2ZWQgYSAke3R5cGVvZiBtYXliZVN0cmluZ31gKTtcbiAgICB9XG59XG4vKiogUmV0dXJuIGFuIGl0ZXJhdG9yLCBzaW1pbGFyIHRvIFB5dGhvbidzIGByYW5nZSgpYCAqL1xuZXhwb3J0IGZ1bmN0aW9uKiBudW1iZXJSYW5nZShzdGFydE9yU3RvcCwgc3RvcCwgc3RlcCA9IDEpIHtcbiAgICBsZXQgbmV4dFZhbHVlO1xuICAgIGlmICh0eXBlb2Ygc3RvcCA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICBuZXh0VmFsdWUgPSAwO1xuICAgICAgICBzdG9wID0gc3RhcnRPclN0b3A7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBuZXh0VmFsdWUgPSBzdGFydE9yU3RvcDtcbiAgICB9XG4gICAgaWYgKHN0ZXAgPiAwKSB7XG4gICAgICAgIHdoaWxlIChuZXh0VmFsdWUgPCBzdG9wKSB7XG4gICAgICAgICAgICB5aWVsZCBuZXh0VmFsdWU7XG4gICAgICAgICAgICBuZXh0VmFsdWUgKz0gc3RlcDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgd2hpbGUgKG5leHRWYWx1ZSA+IHN0b3ApIHtcbiAgICAgICAgICAgIHlpZWxkIG5leHRWYWx1ZTtcbiAgICAgICAgICAgIG5leHRWYWx1ZSArPSBzdGVwO1xuICAgICAgICB9XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\\n//# sourceURL=webpack-internal:///./src/util.ts\\n\");\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t(() => {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = (exports, definition) => {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t(() => {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = (exports) => {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/************************************************************************/\n/******/ \t\n/******/ \t// startup\n/******/ \t// Load entry module and return exports\n/******/ \t// This entry module is referenced by other modules so it can't be inlined\n/******/ \tvar __webpack_exports__ = __webpack_require__(\"./src/main.ts\");\n/******/ \t\n/******/ })()\n;</script>\n</body>\n\n</html>\n","hydrate":"\"use strict\";\n\nfunction startState() {\n  return {\n    blockComment: false,\n    expectMacroBody: false,\n    js: false,\n    nesting: [],\n    jsNesting: [],\n  };\n}\n\nconst KEYWORDS = (\n  \"break case catch class const continue debugger default delete \" +\n  \"do else export extends false finally for function if import in instanceof \" +\n  \"new null return super switch this throw true try typeof var void while \" +\n  \"with let static yield await enum implements interface package private \" +\n  \"protected public arguments as async eval from get of set undefined\"\n)\n  .split(\" \")\n  .filter((kw) => kw);\n\nfunction tokenJs(stream, state) {\n  if (stream.match(/[!%&*+-<=>^|~]+/)) {\n    return \"operator\";\n  }\n\n  if (stream.match(/[$_a-zA-Z][$_a-zA-Z0-9]*/)) {\n    if ([\"$\", \"_\"].includes(stream.current()[0])) {\n      return \"variable-3\";\n    } else if (KEYWORDS.includes(stream.current())) {\n      return \"keyword\";\n    } else {\n      return \"variable\";\n    }\n  }\n\n  const c = stream.next();\n  switch (c) {\n    case \"/\":\n      if (stream.peek() === \"/\") {\n        stream.skipToEnd();\n        return \"comment\";\n      } else if (stream.peek() === \"*\") {\n        stream.next();\n        state.blockComment = true;\n        return \"comment\";\n      } else {\n        stream.eat(\"=\");\n        return \"operator\";\n      }\n\n    case \"(\":\n      state.jsNesting.push(\")\");\n      return \"bracket\";\n    case \"{\":\n      state.jsNesting.push(\"}\");\n      return \"bracket\";\n    case \"[\":\n      state.jsNesting.push(\"]\");\n      return \"bracket\";\n\n    case \")\":\n    case \"}\":\n    case \"]\":\n      if (c === state.jsNesting[state.jsNesting.length - 1]) {\n        state.jsNesting.pop();\n        if (state.jsNesting.length === 0) {\n          state.js = false;\n          state.expectMacroBody = true;\n          stream.eatSpace();\n          return \"variable-2\";\n        } else {\n          return \"bracket\";\n        }\n      } else {\n        return \"bracket error\";\n      }\n\n    case '\"':\n      if (stream.match(/(?:[^\\\\\"]|\\\\(?:.|\\s))*\"/)) {\n        return \"string\";\n      } else {\n        stream.skipToEnd();\n        return \"string error\";\n      }\n\n    case \"'\":\n      if (stream.match(/(?:[^\\\\']|\\\\(?:.|\\s))*'/)) {\n        return \"string\";\n      } else {\n        stream.skipToEnd();\n        return \"string error\";\n      }\n\n    default:\n      stream.eatSpace();\n      return null;\n  }\n}\n\nfunction token(stream, state) {\n  if (state.blockComment) {\n    if (stream.match(/[^]*?\\*\\//)) {\n      state.blockComment = false;\n    } else {\n      stream.skipToEnd();\n    }\n    return \"comment\";\n  }\n\n  if (state.js) {\n    return tokenJs(stream, state);\n  }\n\n  const c = stream.next();\n  if (state.expectMacroBody) {\n    state.expectMacroBody = false;\n    if (c === \"{\") {\n      state.nesting.push(\"}\");\n      return \"bracket\";\n    }\n  }\n\n  switch (c) {\n    case \"$\":\n    case \"_\":\n      if (stream.match(/[$_a-zA-Z]/)) {\n        stream.match(/[$_a-zA-Z0-9]*/);\n        return \"variable-3\";\n      } else {\n        return \"error\";\n      }\n\n    case \"/\":\n      if (stream.peek() === \"/\") {\n        stream.skipToEnd();\n        return \"comment\";\n      } else if (stream.peek() === \"*\") {\n        stream.next();\n        state.blockComment = true;\n        return \"comment\";\n      } else {\n        return null;\n      }\n\n    case \"@\":\n      if (stream.match(/[a-zA-Z]*\\s*\\(/)) {\n        state.jsNesting = [\")\"];\n        state.js = true;\n        return \"variable-2\";\n      } else if (stream.match(/[a-zA-Z]*\\s*\\{/)) {\n        stream.backUp(1);\n        state.expectMacroBody = true;\n        return \"variable-2\";\n      } else {\n        return \"error\";\n      }\n\n    case \"}\":\n      if (state.nesting[state.nesting.length - 1] === \"}\") {\n        state.nesting.pop();\n        return \"bracket\";\n      } else {\n        return null;\n      }\n\n    case \"\\\\\":\n      if (stream.next()) {\n        return \"atom\";\n      } else {\n        return \"error\";\n      }\n\n    default:\n      stream.match(/[^$_/@{}\\\\]*/);\n      return null;\n  }\n}\n\nfunction mode() {\n  return { startState, token };\n}\n\nthis.editorExtensions = {\n  twine: {\n    \"^2.0.0\": {\n      codeMirror: { mode },\n    },\n  },\n};\n"});
